var __defProp=Object.defineProperty;var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});var __publicField=(obj,key,value)=>__defNormalProp(obj,typeof key!="symbol"?key+"":key,value);import{e as element,r as requireElement,a as requireElements,b as elements}from"./requiredQuerySelector.js";import{i as is_promise,g as get_current_component,s as set_current_component,a as group_outros,t as transition_out,c as check_outros,b as transition_in,f as flush,n as noop$1,d as safe_not_equal,S as SvelteComponent,e as init,h as element$1,j as space,k as src_url_equal,l as attr,m as set_style,o as toggle_class,p as insert,q as append,r as listen,u as detach,v as run_all,w as createEventDispatcher,x as text,y as set_data,z as bubble,A as empty,B as binding_callbacks,C as bind$1,D as create_component,E as mount_component,F as add_flush_callback,G as destroy_component,H as subscribe,I as set_input_value,J as to_number,K as add_render_callback,L as select_option,M as destroy_each,N as select_value,O as onMount,P as component_subscribe,Q as construct_svelte_component,R as onDestroy,T as assign,U as action_destroyer,V as is_function,W as null_to_empty,X as set_store_value}from"./index.js";const Metadata$1=new WeakMap;function decorateProperty(decorators,target,propertyKey,descriptor){return decorators.reverse().forEach(decorator=>{descriptor=decorator(target,propertyKey,descriptor)||descriptor}),descriptor}__name(decorateProperty,"decorateProperty");function decorateConstructor(decorators,target){return decorators.reverse().forEach(decorator=>{const decorated=decorator(target);decorated&&(target=decorated)}),target}__name(decorateConstructor,"decorateConstructor");function decorate(decorators,target,propertyKey,attributes){if(!Array.isArray(decorators)||decorators.length===0)throw new TypeError;if(propertyKey!==void 0)return decorateProperty(decorators,target,propertyKey,attributes);if(typeof target=="function")return decorateConstructor(decorators,target)}__name(decorate,"decorate");function getMetadataMap(target,propertyKey){return Metadata$1.get(target)&&Metadata$1.get(target).get(propertyKey)}__name(getMetadataMap,"getMetadataMap");function ordinaryGetOwnMetadata(metadataKey,target,propertyKey){if(target===void 0)throw new TypeError;const metadataMap=getMetadataMap(target,propertyKey);return metadataMap&&metadataMap.get(metadataKey)}__name(ordinaryGetOwnMetadata,"ordinaryGetOwnMetadata");function createMetadataMap(target,propertyKey){const targetMetadata=Metadata$1.get(target)||new Map;Metadata$1.set(target,targetMetadata);const metadataMap=targetMetadata.get(propertyKey)||new Map;return targetMetadata.set(propertyKey,metadataMap),metadataMap}__name(createMetadataMap,"createMetadataMap");function ordinaryDefineOwnMetadata(metadataKey,metadataValue,target,propertyKey){if(propertyKey&&!["string","symbol"].includes(typeof propertyKey))throw new TypeError;(getMetadataMap(target,propertyKey)||createMetadataMap(target,propertyKey)).set(metadataKey,metadataValue)}__name(ordinaryDefineOwnMetadata,"ordinaryDefineOwnMetadata");function ordinaryGetMetadata(metadataKey,target,propertyKey){return ordinaryGetOwnMetadata(metadataKey,target,propertyKey)?ordinaryGetOwnMetadata(metadataKey,target,propertyKey):Object.getPrototypeOf(target)?ordinaryGetMetadata(metadataKey,Object.getPrototypeOf(target),propertyKey):void 0}__name(ordinaryGetMetadata,"ordinaryGetMetadata");function metadata(metadataKey,metadataValue){return __name(function(target,propertyKey){ordinaryDefineOwnMetadata(metadataKey,metadataValue,target,propertyKey)},"decorator")}__name(metadata,"metadata");function getMetadata(metadataKey,target,propertyKey){return ordinaryGetMetadata(metadataKey,target,propertyKey)}__name(getMetadata,"getMetadata");function getOwnMetadata(metadataKey,target,propertyKey){return ordinaryGetOwnMetadata(metadataKey,target,propertyKey)}__name(getOwnMetadata,"getOwnMetadata");function hasOwnMetadata(metadataKey,target,propertyKey){return!!ordinaryGetOwnMetadata(metadataKey,target,propertyKey)}__name(hasOwnMetadata,"hasOwnMetadata");function hasMetadata(metadataKey,target,propertyKey){return!!ordinaryGetMetadata(metadataKey,target,propertyKey)}__name(hasMetadata,"hasMetadata");function defineMetadata(metadataKey,metadataValue,target,propertyKey){ordinaryDefineOwnMetadata(metadataKey,metadataValue,target,propertyKey)}__name(defineMetadata,"defineMetadata");const Reflection={decorate,defineMetadata,getMetadata,getOwnMetadata,hasMetadata,hasOwnMetadata,metadata};Object.assign(Reflect,Reflection);var extendStatics=__name(function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d2,b2){d2.__proto__=b2}||function(d2,b2){for(var p in b2)Object.prototype.hasOwnProperty.call(b2,p)&&(d2[p]=b2[p])},extendStatics(d,b)},"extendStatics");function __extends(d,b){if(typeof b!="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}__name(__,"__"),d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}__name(__extends,"__extends");function __awaiter$4(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve2){resolve2(value)})}return __name(adopt,"adopt"),new(P||(P=Promise))(function(resolve2,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}__name(fulfilled,"fulfilled");function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}__name(rejected,"rejected");function step(result){result.done?resolve2(result.value):adopt(result.value).then(fulfilled,rejected)}__name(step,"step"),step((generator=generator.apply(thisArg,_arguments||[])).next())})}__name(__awaiter$4,"__awaiter$4");function __generator$4(thisArg,body){var _={label:0,sent:__name(function(){if(t[0]&1)throw t[1];return t[1]},"sent"),trys:[],ops:[]},f,y,t,g=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return g.next=verb(0),g.throw=verb(1),g.return=verb(2),typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;g&&(g=0,op[0]&&(_=0)),_;)try{if(f=1,y&&(t=op[0]&2?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[op[0]&2,t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}}__name(__generator$4,"__generator$4");function __values(o){var s=typeof Symbol=="function"&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&typeof o.length=="number")return{next:__name(function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}},"next")};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}__name(__values,"__values");function __read(o,n){var m=typeof Symbol=="function"&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),r,ar=[],e;try{for(;(n===void 0||n-- >0)&&!(r=i.next()).done;)ar.push(r.value)}catch(error){e={error}}finally{try{r&&!r.done&&(m=i.return)&&m.call(i)}finally{if(e)throw e.error}}return ar}__name(__read,"__read");function __spreadArray$3(to,from2,pack){if(pack||arguments.length===2)for(var i=0,l=from2.length,ar;i<l;i++)(ar||!(i in from2))&&(ar||(ar=Array.prototype.slice.call(from2,0,i)),ar[i]=from2[i]);return to.concat(ar||Array.prototype.slice.call(from2))}__name(__spreadArray$3,"__spreadArray$3");function __await(v){return this instanceof __await?(this.v=v,this):new __await(v)}__name(__await,"__await");function __asyncGenerator(thisArg,_arguments,generator){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var g=generator.apply(thisArg,_arguments||[]),i,q=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),verb("next"),verb("throw"),verb("return",awaitReturn),i[Symbol.asyncIterator]=function(){return this},i;function awaitReturn(f){return function(v){return Promise.resolve(v).then(f,reject)}}function verb(n,f){g[n]&&(i[n]=function(v){return new Promise(function(a,b){q.push([n,v,a,b])>1||resume(n,v)})},f&&(i[n]=f(i[n])))}function resume(n,v){try{step(g[n](v))}catch(e){settle(q[0][3],e)}}function step(r){r.value instanceof __await?Promise.resolve(r.value.v).then(fulfill,reject):settle(q[0][2],r)}function fulfill(value){resume("next",value)}function reject(value){resume("throw",value)}function settle(f,v){f(v),q.shift(),q.length&&resume(q[0][0],q[0][1])}}__name(__asyncGenerator,"__asyncGenerator");function __asyncValues(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=o[Symbol.asyncIterator],i;return m?m.call(o):(o=typeof __values=="function"?__values(o):o[Symbol.iterator](),i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i);function verb(n){i[n]=o[n]&&function(v){return new Promise(function(resolve2,reject){v=o[n](v),settle(resolve2,reject,v.done,v.value)})}}function settle(resolve2,reject,d,v){Promise.resolve(v).then(function(v2){resolve2({value:v2,done:d})},reject)}}__name(__asyncValues,"__asyncValues");function isFunction(value){return typeof value=="function"}__name(isFunction,"isFunction");function createErrorClass(createImpl){var _super=__name(function(instance2){Error.call(instance2),instance2.stack=new Error().stack},"_super"),ctorFunc=createImpl(_super);return ctorFunc.prototype=Object.create(Error.prototype),ctorFunc.prototype.constructor=ctorFunc,ctorFunc}__name(createErrorClass,"createErrorClass");var UnsubscriptionError=createErrorClass(function(_super){return __name(function(errors){_super(this),this.message=errors?errors.length+` errors occurred during unsubscription:
`+errors.map(function(err,i){return i+1+") "+err.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=errors},"UnsubscriptionErrorImpl")});function arrRemove(arr,item){if(arr){var index=arr.indexOf(item);0<=index&&arr.splice(index,1)}}__name(arrRemove,"arrRemove");var Subscription=function(){function Subscription2(initialTeardown){this.initialTeardown=initialTeardown,this.closed=!1,this._parentage=null,this._finalizers=null}return __name(Subscription2,"Subscription"),Subscription2.prototype.unsubscribe=function(){var e_1,_a81,e_2,_b,errors;if(!this.closed){this.closed=!0;var _parentage=this._parentage;if(_parentage)if(this._parentage=null,Array.isArray(_parentage))try{for(var _parentage_1=__values(_parentage),_parentage_1_1=_parentage_1.next();!_parentage_1_1.done;_parentage_1_1=_parentage_1.next()){var parent_1=_parentage_1_1.value;parent_1.remove(this)}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_parentage_1_1&&!_parentage_1_1.done&&(_a81=_parentage_1.return)&&_a81.call(_parentage_1)}finally{if(e_1)throw e_1.error}}else _parentage.remove(this);var initialFinalizer=this.initialTeardown;if(isFunction(initialFinalizer))try{initialFinalizer()}catch(e){errors=e instanceof UnsubscriptionError?e.errors:[e]}var _finalizers=this._finalizers;if(_finalizers){this._finalizers=null;try{for(var _finalizers_1=__values(_finalizers),_finalizers_1_1=_finalizers_1.next();!_finalizers_1_1.done;_finalizers_1_1=_finalizers_1.next()){var finalizer=_finalizers_1_1.value;try{execFinalizer(finalizer)}catch(err){errors=errors??[],err instanceof UnsubscriptionError?errors=__spreadArray$3(__spreadArray$3([],__read(errors)),__read(err.errors)):errors.push(err)}}}catch(e_2_1){e_2={error:e_2_1}}finally{try{_finalizers_1_1&&!_finalizers_1_1.done&&(_b=_finalizers_1.return)&&_b.call(_finalizers_1)}finally{if(e_2)throw e_2.error}}}if(errors)throw new UnsubscriptionError(errors)}},Subscription2.prototype.add=function(teardown){var _a81;if(teardown&&teardown!==this)if(this.closed)execFinalizer(teardown);else{if(teardown instanceof Subscription2){if(teardown.closed||teardown._hasParent(this))return;teardown._addParent(this)}(this._finalizers=(_a81=this._finalizers)!==null&&_a81!==void 0?_a81:[]).push(teardown)}},Subscription2.prototype._hasParent=function(parent){var _parentage=this._parentage;return _parentage===parent||Array.isArray(_parentage)&&_parentage.includes(parent)},Subscription2.prototype._addParent=function(parent){var _parentage=this._parentage;this._parentage=Array.isArray(_parentage)?(_parentage.push(parent),_parentage):_parentage?[_parentage,parent]:parent},Subscription2.prototype._removeParent=function(parent){var _parentage=this._parentage;_parentage===parent?this._parentage=null:Array.isArray(_parentage)&&arrRemove(_parentage,parent)},Subscription2.prototype.remove=function(teardown){var _finalizers=this._finalizers;_finalizers&&arrRemove(_finalizers,teardown),teardown instanceof Subscription2&&teardown._removeParent(this)},Subscription2.EMPTY=function(){var empty2=new Subscription2;return empty2.closed=!0,empty2}(),Subscription2}(),EMPTY_SUBSCRIPTION=Subscription.EMPTY;function isSubscription(value){return value instanceof Subscription||value&&"closed"in value&&isFunction(value.remove)&&isFunction(value.add)&&isFunction(value.unsubscribe)}__name(isSubscription,"isSubscription");function execFinalizer(finalizer){isFunction(finalizer)?finalizer():finalizer.unsubscribe()}__name(execFinalizer,"execFinalizer");var config={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},timeoutProvider={setTimeout:__name(function(handler,timeout2){for(var args=[],_i=2;_i<arguments.length;_i++)args[_i-2]=arguments[_i];return setTimeout.apply(void 0,__spreadArray$3([handler,timeout2],__read(args)))},"setTimeout"),clearTimeout:__name(function(handle){var delegate=timeoutProvider.delegate;return((delegate==null?void 0:delegate.clearTimeout)||clearTimeout)(handle)},"clearTimeout"),delegate:void 0};function reportUnhandledError(err){timeoutProvider.setTimeout(function(){throw err})}__name(reportUnhandledError,"reportUnhandledError");function noop(){}__name(noop,"noop");function errorContext(cb){cb()}__name(errorContext,"errorContext");var Subscriber=function(_super){__extends(Subscriber2,_super);function Subscriber2(destination){var _this=_super.call(this)||this;return _this.isStopped=!1,destination?(_this.destination=destination,isSubscription(destination)&&destination.add(_this)):_this.destination=EMPTY_OBSERVER,_this}return __name(Subscriber2,"Subscriber"),Subscriber2.create=function(next,error,complete){return new SafeSubscriber(next,error,complete)},Subscriber2.prototype.next=function(value){this.isStopped||this._next(value)},Subscriber2.prototype.error=function(err){this.isStopped||(this.isStopped=!0,this._error(err))},Subscriber2.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},Subscriber2.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,_super.prototype.unsubscribe.call(this),this.destination=null)},Subscriber2.prototype._next=function(value){this.destination.next(value)},Subscriber2.prototype._error=function(err){try{this.destination.error(err)}finally{this.unsubscribe()}},Subscriber2.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},Subscriber2}(Subscription),_bind=Function.prototype.bind;function bind(fn,thisArg){return _bind.call(fn,thisArg)}__name(bind,"bind");var ConsumerObserver=function(){function ConsumerObserver2(partialObserver){this.partialObserver=partialObserver}return __name(ConsumerObserver2,"ConsumerObserver"),ConsumerObserver2.prototype.next=function(value){var partialObserver=this.partialObserver;if(partialObserver.next)try{partialObserver.next(value)}catch(error){handleUnhandledError(error)}},ConsumerObserver2.prototype.error=function(err){var partialObserver=this.partialObserver;if(partialObserver.error)try{partialObserver.error(err)}catch(error){handleUnhandledError(error)}else handleUnhandledError(err)},ConsumerObserver2.prototype.complete=function(){var partialObserver=this.partialObserver;if(partialObserver.complete)try{partialObserver.complete()}catch(error){handleUnhandledError(error)}},ConsumerObserver2}(),SafeSubscriber=function(_super){__extends(SafeSubscriber2,_super);function SafeSubscriber2(observerOrNext,error,complete){var _this=_super.call(this)||this,partialObserver;if(isFunction(observerOrNext)||!observerOrNext)partialObserver={next:observerOrNext??void 0,error:error??void 0,complete:complete??void 0};else{var context_1;_this&&config.useDeprecatedNextContext?(context_1=Object.create(observerOrNext),context_1.unsubscribe=function(){return _this.unsubscribe()},partialObserver={next:observerOrNext.next&&bind(observerOrNext.next,context_1),error:observerOrNext.error&&bind(observerOrNext.error,context_1),complete:observerOrNext.complete&&bind(observerOrNext.complete,context_1)}):partialObserver=observerOrNext}return _this.destination=new ConsumerObserver(partialObserver),_this}return __name(SafeSubscriber2,"SafeSubscriber"),SafeSubscriber2}(Subscriber);function handleUnhandledError(error){reportUnhandledError(error)}__name(handleUnhandledError,"handleUnhandledError");function defaultErrorHandler(err){throw err}__name(defaultErrorHandler,"defaultErrorHandler");var EMPTY_OBSERVER={closed:!0,next:noop,error:defaultErrorHandler,complete:noop},observable=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function identity(x){return x}__name(identity,"identity");function pipe(){for(var fns=[],_i=0;_i<arguments.length;_i++)fns[_i]=arguments[_i];return pipeFromArray(fns)}__name(pipe,"pipe");function pipeFromArray(fns){return fns.length===0?identity:fns.length===1?fns[0]:__name(function(input){return fns.reduce(function(prev,fn){return fn(prev)},input)},"piped")}__name(pipeFromArray,"pipeFromArray");var Observable=function(){function Observable2(subscribe2){subscribe2&&(this._subscribe=subscribe2)}return __name(Observable2,"Observable"),Observable2.prototype.lift=function(operator){var observable2=new Observable2;return observable2.source=this,observable2.operator=operator,observable2},Observable2.prototype.subscribe=function(observerOrNext,error,complete){var _this=this,subscriber=isSubscriber(observerOrNext)?observerOrNext:new SafeSubscriber(observerOrNext,error,complete);return errorContext(function(){var _a81=_this,operator=_a81.operator,source=_a81.source;subscriber.add(operator?operator.call(subscriber,source):source?_this._subscribe(subscriber):_this._trySubscribe(subscriber))}),subscriber},Observable2.prototype._trySubscribe=function(sink){try{return this._subscribe(sink)}catch(err){sink.error(err)}},Observable2.prototype.forEach=function(next,promiseCtor){var _this=this;return promiseCtor=getPromiseCtor(promiseCtor),new promiseCtor(function(resolve2,reject){var subscriber=new SafeSubscriber({next:__name(function(value){try{next(value)}catch(err){reject(err),subscriber.unsubscribe()}},"next"),error:reject,complete:resolve2});_this.subscribe(subscriber)})},Observable2.prototype._subscribe=function(subscriber){var _a81;return(_a81=this.source)===null||_a81===void 0?void 0:_a81.subscribe(subscriber)},Observable2.prototype[observable]=function(){return this},Observable2.prototype.pipe=function(){for(var operations=[],_i=0;_i<arguments.length;_i++)operations[_i]=arguments[_i];return pipeFromArray(operations)(this)},Observable2.prototype.toPromise=function(promiseCtor){var _this=this;return promiseCtor=getPromiseCtor(promiseCtor),new promiseCtor(function(resolve2,reject){var value;_this.subscribe(function(x){return value=x},function(err){return reject(err)},function(){return resolve2(value)})})},Observable2.create=function(subscribe2){return new Observable2(subscribe2)},Observable2}();function getPromiseCtor(promiseCtor){var _a81;return(_a81=promiseCtor??config.Promise)!==null&&_a81!==void 0?_a81:Promise}__name(getPromiseCtor,"getPromiseCtor");function isObserver(value){return value&&isFunction(value.next)&&isFunction(value.error)&&isFunction(value.complete)}__name(isObserver,"isObserver");function isSubscriber(value){return value&&value instanceof Subscriber||isObserver(value)&&isSubscription(value)}__name(isSubscriber,"isSubscriber");function hasLift(source){return isFunction(source==null?void 0:source.lift)}__name(hasLift,"hasLift");function operate(init2){return function(source){if(hasLift(source))return source.lift(function(liftedSource){try{return init2(liftedSource,this)}catch(err){this.error(err)}});throw new TypeError("Unable to lift unknown Observable type")}}__name(operate,"operate");function createOperatorSubscriber(destination,onNext,onComplete,onError,onFinalize){return new OperatorSubscriber(destination,onNext,onComplete,onError,onFinalize)}__name(createOperatorSubscriber,"createOperatorSubscriber");var OperatorSubscriber=function(_super){__extends(OperatorSubscriber2,_super);function OperatorSubscriber2(destination,onNext,onComplete,onError,onFinalize,shouldUnsubscribe){var _this=_super.call(this,destination)||this;return _this.onFinalize=onFinalize,_this.shouldUnsubscribe=shouldUnsubscribe,_this._next=onNext?function(value){try{onNext(value)}catch(err){destination.error(err)}}:_super.prototype._next,_this._error=onError?function(err){try{onError(err)}catch(err2){destination.error(err2)}finally{this.unsubscribe()}}:_super.prototype._error,_this._complete=onComplete?function(){try{onComplete()}catch(err){destination.error(err)}finally{this.unsubscribe()}}:_super.prototype._complete,_this}return __name(OperatorSubscriber2,"OperatorSubscriber"),OperatorSubscriber2.prototype.unsubscribe=function(){var _a81;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var closed_1=this.closed;_super.prototype.unsubscribe.call(this),!closed_1&&((_a81=this.onFinalize)===null||_a81===void 0||_a81.call(this))}},OperatorSubscriber2}(Subscriber),ObjectUnsubscribedError=createErrorClass(function(_super){return __name(function(){_super(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"},"ObjectUnsubscribedErrorImpl")}),Subject$1=function(_super){__extends(Subject2,_super);function Subject2(){var _this=_super.call(this)||this;return _this.closed=!1,_this.currentObservers=null,_this.observers=[],_this.isStopped=!1,_this.hasError=!1,_this.thrownError=null,_this}return __name(Subject2,"Subject"),Subject2.prototype.lift=function(operator){var subject=new AnonymousSubject(this,this);return subject.operator=operator,subject},Subject2.prototype._throwIfClosed=function(){if(this.closed)throw new ObjectUnsubscribedError},Subject2.prototype.next=function(value){var _this=this;errorContext(function(){var e_1,_a81;if(_this._throwIfClosed(),!_this.isStopped){_this.currentObservers||(_this.currentObservers=Array.from(_this.observers));try{for(var _b=__values(_this.currentObservers),_c=_b.next();!_c.done;_c=_b.next()){var observer=_c.value;observer.next(value)}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_c&&!_c.done&&(_a81=_b.return)&&_a81.call(_b)}finally{if(e_1)throw e_1.error}}}})},Subject2.prototype.error=function(err){var _this=this;errorContext(function(){if(_this._throwIfClosed(),!_this.isStopped){_this.hasError=_this.isStopped=!0,_this.thrownError=err;for(var observers=_this.observers;observers.length;)observers.shift().error(err)}})},Subject2.prototype.complete=function(){var _this=this;errorContext(function(){if(_this._throwIfClosed(),!_this.isStopped){_this.isStopped=!0;for(var observers=_this.observers;observers.length;)observers.shift().complete()}})},Subject2.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(Subject2.prototype,"observed",{get:__name(function(){var _a81;return((_a81=this.observers)===null||_a81===void 0?void 0:_a81.length)>0},"get"),enumerable:!1,configurable:!0}),Subject2.prototype._trySubscribe=function(subscriber){return this._throwIfClosed(),_super.prototype._trySubscribe.call(this,subscriber)},Subject2.prototype._subscribe=function(subscriber){return this._throwIfClosed(),this._checkFinalizedStatuses(subscriber),this._innerSubscribe(subscriber)},Subject2.prototype._innerSubscribe=function(subscriber){var _this=this,_a81=this,hasError=_a81.hasError,isStopped=_a81.isStopped,observers=_a81.observers;return hasError||isStopped?EMPTY_SUBSCRIPTION:(this.currentObservers=null,observers.push(subscriber),new Subscription(function(){_this.currentObservers=null,arrRemove(observers,subscriber)}))},Subject2.prototype._checkFinalizedStatuses=function(subscriber){var _a81=this,hasError=_a81.hasError,thrownError=_a81.thrownError,isStopped=_a81.isStopped;hasError?subscriber.error(thrownError):isStopped&&subscriber.complete()},Subject2.prototype.asObservable=function(){var observable2=new Observable;return observable2.source=this,observable2},Subject2.create=function(destination,source){return new AnonymousSubject(destination,source)},Subject2}(Observable),AnonymousSubject=function(_super){__extends(AnonymousSubject2,_super);function AnonymousSubject2(destination,source){var _this=_super.call(this)||this;return _this.destination=destination,_this.source=source,_this}return __name(AnonymousSubject2,"AnonymousSubject"),AnonymousSubject2.prototype.next=function(value){var _a81,_b;(_b=(_a81=this.destination)===null||_a81===void 0?void 0:_a81.next)===null||_b===void 0||_b.call(_a81,value)},AnonymousSubject2.prototype.error=function(err){var _a81,_b;(_b=(_a81=this.destination)===null||_a81===void 0?void 0:_a81.error)===null||_b===void 0||_b.call(_a81,err)},AnonymousSubject2.prototype.complete=function(){var _a81,_b;(_b=(_a81=this.destination)===null||_a81===void 0?void 0:_a81.complete)===null||_b===void 0||_b.call(_a81)},AnonymousSubject2.prototype._subscribe=function(subscriber){var _a81,_b;return(_b=(_a81=this.source)===null||_a81===void 0?void 0:_a81.subscribe(subscriber))!==null&&_b!==void 0?_b:EMPTY_SUBSCRIPTION},AnonymousSubject2}(Subject$1),BehaviorSubject=function(_super){__extends(BehaviorSubject2,_super);function BehaviorSubject2(_value){var _this=_super.call(this)||this;return _this._value=_value,_this}return __name(BehaviorSubject2,"BehaviorSubject"),Object.defineProperty(BehaviorSubject2.prototype,"value",{get:__name(function(){return this.getValue()},"get"),enumerable:!1,configurable:!0}),BehaviorSubject2.prototype._subscribe=function(subscriber){var subscription=_super.prototype._subscribe.call(this,subscriber);return!subscription.closed&&subscriber.next(this._value),subscription},BehaviorSubject2.prototype.getValue=function(){var _a81=this,hasError=_a81.hasError,thrownError=_a81.thrownError,_value=_a81._value;if(hasError)throw thrownError;return this._throwIfClosed(),_value},BehaviorSubject2.prototype.next=function(value){_super.prototype.next.call(this,this._value=value)},BehaviorSubject2}(Subject$1),dateTimestampProvider={now:__name(function(){return Date.now()},"now"),delegate:void 0},Action=function(_super){__extends(Action2,_super);function Action2(scheduler,work){return _super.call(this)||this}return __name(Action2,"Action"),Action2.prototype.schedule=function(state,delay2){return this},Action2}(Subscription),intervalProvider={setInterval:__name(function(handler,timeout2){for(var args=[],_i=2;_i<arguments.length;_i++)args[_i-2]=arguments[_i];return setInterval.apply(void 0,__spreadArray$3([handler,timeout2],__read(args)))},"setInterval"),clearInterval:__name(function(handle){return clearInterval(handle)},"clearInterval"),delegate:void 0},AsyncAction=function(_super){__extends(AsyncAction2,_super);function AsyncAction2(scheduler,work){var _this=_super.call(this,scheduler,work)||this;return _this.scheduler=scheduler,_this.work=work,_this.pending=!1,_this}return __name(AsyncAction2,"AsyncAction"),AsyncAction2.prototype.schedule=function(state,delay2){var _a81;if(delay2===void 0&&(delay2=0),this.closed)return this;this.state=state;var id2=this.id,scheduler=this.scheduler;return id2!=null&&(this.id=this.recycleAsyncId(scheduler,id2,delay2)),this.pending=!0,this.delay=delay2,this.id=(_a81=this.id)!==null&&_a81!==void 0?_a81:this.requestAsyncId(scheduler,this.id,delay2),this},AsyncAction2.prototype.requestAsyncId=function(scheduler,_id,delay2){return delay2===void 0&&(delay2=0),intervalProvider.setInterval(scheduler.flush.bind(scheduler,this),delay2)},AsyncAction2.prototype.recycleAsyncId=function(_scheduler,id2,delay2){if(delay2===void 0&&(delay2=0),delay2!=null&&this.delay===delay2&&this.pending===!1)return id2;id2!=null&&intervalProvider.clearInterval(id2)},AsyncAction2.prototype.execute=function(state,delay2){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var error=this._execute(state,delay2);if(error)return error;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},AsyncAction2.prototype._execute=function(state,_delay){var errored=!1,errorValue;try{this.work(state)}catch(e){errored=!0,errorValue=e||new Error("Scheduled action threw falsy error")}if(errored)return this.unsubscribe(),errorValue},AsyncAction2.prototype.unsubscribe=function(){if(!this.closed){var _a81=this,id2=_a81.id,scheduler=_a81.scheduler,actions=scheduler.actions;this.work=this.state=this.scheduler=null,this.pending=!1,arrRemove(actions,this),id2!=null&&(this.id=this.recycleAsyncId(scheduler,id2,null)),this.delay=null,_super.prototype.unsubscribe.call(this)}},AsyncAction2}(Action),Scheduler=function(){function Scheduler2(schedulerActionCtor,now){now===void 0&&(now=Scheduler2.now),this.schedulerActionCtor=schedulerActionCtor,this.now=now}return __name(Scheduler2,"Scheduler"),Scheduler2.prototype.schedule=function(work,delay2,state){return delay2===void 0&&(delay2=0),new this.schedulerActionCtor(this,work).schedule(state,delay2)},Scheduler2.now=dateTimestampProvider.now,Scheduler2}(),AsyncScheduler=function(_super){__extends(AsyncScheduler2,_super);function AsyncScheduler2(SchedulerAction,now){now===void 0&&(now=Scheduler.now);var _this=_super.call(this,SchedulerAction,now)||this;return _this.actions=[],_this._active=!1,_this}return __name(AsyncScheduler2,"AsyncScheduler"),AsyncScheduler2.prototype.flush=function(action){var actions=this.actions;if(this._active){actions.push(action);return}var error;this._active=!0;do if(error=action.execute(action.state,action.delay))break;while(action=actions.shift());if(this._active=!1,error){for(;action=actions.shift();)action.unsubscribe();throw error}},AsyncScheduler2}(Scheduler),asyncScheduler=new AsyncScheduler(AsyncAction),async=asyncScheduler,EMPTY=new Observable(function(subscriber){return subscriber.complete()});function isScheduler(value){return value&&isFunction(value.schedule)}__name(isScheduler,"isScheduler");function last(arr){return arr[arr.length-1]}__name(last,"last");function popResultSelector(args){return isFunction(last(args))?args.pop():void 0}__name(popResultSelector,"popResultSelector");function popScheduler(args){return isScheduler(last(args))?args.pop():void 0}__name(popScheduler,"popScheduler");function popNumber(args,defaultValue){return typeof last(args)=="number"?args.pop():defaultValue}__name(popNumber,"popNumber");var isArrayLike=__name(function(x){return x&&typeof x.length=="number"&&typeof x!="function"},"isArrayLike");function isPromise$1(value){return isFunction(value==null?void 0:value.then)}__name(isPromise$1,"isPromise$1");function isInteropObservable(input){return isFunction(input[observable])}__name(isInteropObservable,"isInteropObservable");function isAsyncIterable(obj){return Symbol.asyncIterator&&isFunction(obj==null?void 0:obj[Symbol.asyncIterator])}__name(isAsyncIterable,"isAsyncIterable");function createInvalidObservableTypeError(input){return new TypeError("You provided "+(input!==null&&typeof input=="object"?"an invalid object":"'"+input+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}__name(createInvalidObservableTypeError,"createInvalidObservableTypeError");function getSymbolIterator(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}__name(getSymbolIterator,"getSymbolIterator");var iterator=getSymbolIterator();function isIterable(input){return isFunction(input==null?void 0:input[iterator])}__name(isIterable,"isIterable");function readableStreamLikeToAsyncGenerator(readableStream){return __asyncGenerator(this,arguments,__name(function(){var reader,_a81,value,done;return __generator$4(this,function(_b){switch(_b.label){case 0:reader=readableStream.getReader(),_b.label=1;case 1:_b.trys.push([1,,9,10]),_b.label=2;case 2:return[4,__await(reader.read())];case 3:return _a81=_b.sent(),value=_a81.value,done=_a81.done,done?[4,__await(void 0)]:[3,5];case 4:return[2,_b.sent()];case 5:return[4,__await(value)];case 6:return[4,_b.sent()];case 7:return _b.sent(),[3,2];case 8:return[3,10];case 9:return reader.releaseLock(),[7];case 10:return[2]}})},"readableStreamLikeToAsyncGenerator_1"))}__name(readableStreamLikeToAsyncGenerator,"readableStreamLikeToAsyncGenerator");function isReadableStreamLike(obj){return isFunction(obj==null?void 0:obj.getReader)}__name(isReadableStreamLike,"isReadableStreamLike");function innerFrom(input){if(input instanceof Observable)return input;if(input!=null){if(isInteropObservable(input))return fromInteropObservable(input);if(isArrayLike(input))return fromArrayLike(input);if(isPromise$1(input))return fromPromise(input);if(isAsyncIterable(input))return fromAsyncIterable(input);if(isIterable(input))return fromIterable(input);if(isReadableStreamLike(input))return fromReadableStreamLike(input)}throw createInvalidObservableTypeError(input)}__name(innerFrom,"innerFrom");function fromInteropObservable(obj){return new Observable(function(subscriber){var obs=obj[observable]();if(isFunction(obs.subscribe))return obs.subscribe(subscriber);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}__name(fromInteropObservable,"fromInteropObservable");function fromArrayLike(array){return new Observable(function(subscriber){for(var i=0;i<array.length&&!subscriber.closed;i++)subscriber.next(array[i]);subscriber.complete()})}__name(fromArrayLike,"fromArrayLike");function fromPromise(promise){return new Observable(function(subscriber){promise.then(function(value){subscriber.closed||(subscriber.next(value),subscriber.complete())},function(err){return subscriber.error(err)}).then(null,reportUnhandledError)})}__name(fromPromise,"fromPromise");function fromIterable(iterable){return new Observable(function(subscriber){var e_1,_a81;try{for(var iterable_1=__values(iterable),iterable_1_1=iterable_1.next();!iterable_1_1.done;iterable_1_1=iterable_1.next()){var value=iterable_1_1.value;if(subscriber.next(value),subscriber.closed)return}}catch(e_1_1){e_1={error:e_1_1}}finally{try{iterable_1_1&&!iterable_1_1.done&&(_a81=iterable_1.return)&&_a81.call(iterable_1)}finally{if(e_1)throw e_1.error}}subscriber.complete()})}__name(fromIterable,"fromIterable");function fromAsyncIterable(asyncIterable){return new Observable(function(subscriber){process$1(asyncIterable,subscriber).catch(function(err){return subscriber.error(err)})})}__name(fromAsyncIterable,"fromAsyncIterable");function fromReadableStreamLike(readableStream){return fromAsyncIterable(readableStreamLikeToAsyncGenerator(readableStream))}__name(fromReadableStreamLike,"fromReadableStreamLike");function process$1(asyncIterable,subscriber){var asyncIterable_1,asyncIterable_1_1,e_2,_a81;return __awaiter$4(this,void 0,void 0,function(){var value,e_2_1;return __generator$4(this,function(_b){switch(_b.label){case 0:_b.trys.push([0,5,6,11]),asyncIterable_1=__asyncValues(asyncIterable),_b.label=1;case 1:return[4,asyncIterable_1.next()];case 2:if(asyncIterable_1_1=_b.sent(),!!asyncIterable_1_1.done)return[3,4];if(value=asyncIterable_1_1.value,subscriber.next(value),subscriber.closed)return[2];_b.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return e_2_1=_b.sent(),e_2={error:e_2_1},[3,11];case 6:return _b.trys.push([6,,9,10]),asyncIterable_1_1&&!asyncIterable_1_1.done&&(_a81=asyncIterable_1.return)?[4,_a81.call(asyncIterable_1)]:[3,8];case 7:_b.sent(),_b.label=8;case 8:return[3,10];case 9:if(e_2)throw e_2.error;return[7];case 10:return[7];case 11:return subscriber.complete(),[2]}})})}__name(process$1,"process$1");function executeSchedule(parentSubscription,scheduler,work,delay2,repeat2){delay2===void 0&&(delay2=0),repeat2===void 0&&(repeat2=!1);var scheduleSubscription=scheduler.schedule(function(){work(),repeat2?parentSubscription.add(this.schedule(null,delay2)):this.unsubscribe()},delay2);if(parentSubscription.add(scheduleSubscription),!repeat2)return scheduleSubscription}__name(executeSchedule,"executeSchedule");function observeOn(scheduler,delay2){return delay2===void 0&&(delay2=0),operate(function(source,subscriber){source.subscribe(createOperatorSubscriber(subscriber,function(value){return executeSchedule(subscriber,scheduler,function(){return subscriber.next(value)},delay2)},function(){return executeSchedule(subscriber,scheduler,function(){return subscriber.complete()},delay2)},function(err){return executeSchedule(subscriber,scheduler,function(){return subscriber.error(err)},delay2)}))})}__name(observeOn,"observeOn");function subscribeOn(scheduler,delay2){return delay2===void 0&&(delay2=0),operate(function(source,subscriber){subscriber.add(scheduler.schedule(function(){return source.subscribe(subscriber)},delay2))})}__name(subscribeOn,"subscribeOn");function scheduleObservable(input,scheduler){return innerFrom(input).pipe(subscribeOn(scheduler),observeOn(scheduler))}__name(scheduleObservable,"scheduleObservable");function schedulePromise(input,scheduler){return innerFrom(input).pipe(subscribeOn(scheduler),observeOn(scheduler))}__name(schedulePromise,"schedulePromise");function scheduleArray(input,scheduler){return new Observable(function(subscriber){var i=0;return scheduler.schedule(function(){i===input.length?subscriber.complete():(subscriber.next(input[i++]),subscriber.closed||this.schedule())})})}__name(scheduleArray,"scheduleArray");function scheduleIterable(input,scheduler){return new Observable(function(subscriber){var iterator$1;return executeSchedule(subscriber,scheduler,function(){iterator$1=input[iterator](),executeSchedule(subscriber,scheduler,function(){var _a81,value,done;try{_a81=iterator$1.next(),value=_a81.value,done=_a81.done}catch(err){subscriber.error(err);return}done?subscriber.complete():subscriber.next(value)},0,!0)}),function(){return isFunction(iterator$1==null?void 0:iterator$1.return)&&iterator$1.return()}})}__name(scheduleIterable,"scheduleIterable");function scheduleAsyncIterable(input,scheduler){if(!input)throw new Error("Iterable cannot be null");return new Observable(function(subscriber){executeSchedule(subscriber,scheduler,function(){var iterator2=input[Symbol.asyncIterator]();executeSchedule(subscriber,scheduler,function(){iterator2.next().then(function(result){result.done?subscriber.complete():subscriber.next(result.value)})},0,!0)})})}__name(scheduleAsyncIterable,"scheduleAsyncIterable");function scheduleReadableStreamLike(input,scheduler){return scheduleAsyncIterable(readableStreamLikeToAsyncGenerator(input),scheduler)}__name(scheduleReadableStreamLike,"scheduleReadableStreamLike");function scheduled(input,scheduler){if(input!=null){if(isInteropObservable(input))return scheduleObservable(input,scheduler);if(isArrayLike(input))return scheduleArray(input,scheduler);if(isPromise$1(input))return schedulePromise(input,scheduler);if(isAsyncIterable(input))return scheduleAsyncIterable(input,scheduler);if(isIterable(input))return scheduleIterable(input,scheduler);if(isReadableStreamLike(input))return scheduleReadableStreamLike(input,scheduler)}throw createInvalidObservableTypeError(input)}__name(scheduled,"scheduled");function from(input,scheduler){return scheduler?scheduled(input,scheduler):innerFrom(input)}__name(from,"from");function of(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var scheduler=popScheduler(args);return from(args,scheduler)}__name(of,"of");var EmptyError=createErrorClass(function(_super){return __name(function(){_super(this),this.name="EmptyError",this.message="no elements in sequence"},"EmptyErrorImpl")});function firstValueFrom(source,config2){return new Promise(function(resolve2,reject){var subscriber=new SafeSubscriber({next:__name(function(value){resolve2(value),subscriber.unsubscribe()},"next"),error:reject,complete:__name(function(){reject(new EmptyError)},"complete")});source.subscribe(subscriber)})}__name(firstValueFrom,"firstValueFrom");function isValidDate(value){return value instanceof Date&&!isNaN(value)}__name(isValidDate,"isValidDate");var TimeoutError$1=createErrorClass(function(_super){return __name(function(info){info===void 0&&(info=null),_super(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=info},"TimeoutErrorImpl")});function timeout(config2,schedulerArg){var _a81=isValidDate(config2)?{first:config2}:typeof config2=="number"?{each:config2}:config2,first=_a81.first,each=_a81.each,_b=_a81.with,_with=_b===void 0?timeoutErrorFactory:_b,_c=_a81.scheduler,scheduler=_c===void 0?asyncScheduler:_c,_d=_a81.meta,meta=_d===void 0?null:_d;if(first==null&&each==null)throw new TypeError("No timeout provided.");return operate(function(source,subscriber){var originalSourceSubscription,timerSubscription,lastValue=null,seen=0,startTimer=__name(function(delay2){timerSubscription=executeSchedule(subscriber,scheduler,function(){try{originalSourceSubscription.unsubscribe(),innerFrom(_with({meta,lastValue,seen})).subscribe(subscriber)}catch(err){subscriber.error(err)}},delay2)},"startTimer");originalSourceSubscription=source.subscribe(createOperatorSubscriber(subscriber,function(value){timerSubscription==null||timerSubscription.unsubscribe(),seen++,subscriber.next(lastValue=value),each>0&&startTimer(each)},void 0,void 0,function(){timerSubscription!=null&&timerSubscription.closed||timerSubscription==null||timerSubscription.unsubscribe(),lastValue=null})),!seen&&startTimer(first!=null?typeof first=="number"?first:+first-scheduler.now():each)})}__name(timeout,"timeout");function timeoutErrorFactory(info){throw new TimeoutError$1(info)}__name(timeoutErrorFactory,"timeoutErrorFactory");function map(project,thisArg){return operate(function(source,subscriber){var index=0;source.subscribe(createOperatorSubscriber(subscriber,function(value){subscriber.next(project.call(thisArg,value,index++))}))})}__name(map,"map");var isArray$2=Array.isArray;function callOrApply(fn,args){return isArray$2(args)?fn.apply(void 0,__spreadArray$3([],__read(args))):fn(args)}__name(callOrApply,"callOrApply");function mapOneOrManyArgs(fn){return map(function(args){return callOrApply(fn,args)})}__name(mapOneOrManyArgs,"mapOneOrManyArgs");var isArray$1=Array.isArray,getPrototypeOf=Object.getPrototypeOf,objectProto=Object.prototype,getKeys=Object.keys;function argsArgArrayOrObject(args){if(args.length===1){var first_1=args[0];if(isArray$1(first_1))return{args:first_1,keys:null};if(isPOJO(first_1)){var keys=getKeys(first_1);return{args:keys.map(function(key){return first_1[key]}),keys}}}return{args,keys:null}}__name(argsArgArrayOrObject,"argsArgArrayOrObject");function isPOJO(obj){return obj&&typeof obj=="object"&&getPrototypeOf(obj)===objectProto}__name(isPOJO,"isPOJO");function createObject(keys,values){return keys.reduce(function(result,key,i){return result[key]=values[i],result},{})}__name(createObject,"createObject");function combineLatest$1(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var scheduler=popScheduler(args),resultSelector=popResultSelector(args),_a81=argsArgArrayOrObject(args),observables=_a81.args,keys=_a81.keys;if(observables.length===0)return from([],scheduler);var result=new Observable(combineLatestInit(observables,scheduler,keys?function(values){return createObject(keys,values)}:identity));return resultSelector?result.pipe(mapOneOrManyArgs(resultSelector)):result}__name(combineLatest$1,"combineLatest$1");function combineLatestInit(observables,scheduler,valueTransform){return valueTransform===void 0&&(valueTransform=identity),function(subscriber){maybeSchedule(scheduler,function(){for(var length=observables.length,values=new Array(length),active=length,remainingFirstValues=length,_loop_1=__name(function(i2){maybeSchedule(scheduler,function(){var source=from(observables[i2],scheduler),hasFirstValue=!1;source.subscribe(createOperatorSubscriber(subscriber,function(value){values[i2]=value,hasFirstValue||(hasFirstValue=!0,remainingFirstValues--),remainingFirstValues||subscriber.next(valueTransform(values.slice()))},function(){--active||subscriber.complete()}))},subscriber)},"_loop_1"),i=0;i<length;i++)_loop_1(i)},subscriber)}}__name(combineLatestInit,"combineLatestInit");function maybeSchedule(scheduler,execute,subscription){scheduler?executeSchedule(subscription,scheduler,execute):execute()}__name(maybeSchedule,"maybeSchedule");function mergeInternals(source,subscriber,project,concurrent,onBeforeNext,expand,innerSubScheduler,additionalFinalizer){var buffer=[],active=0,index=0,isComplete=!1,checkComplete=__name(function(){isComplete&&!buffer.length&&!active&&subscriber.complete()},"checkComplete"),outerNext=__name(function(value){return active<concurrent?doInnerSub(value):buffer.push(value)},"outerNext"),doInnerSub=__name(function(value){active++;var innerComplete=!1;innerFrom(project(value,index++)).subscribe(createOperatorSubscriber(subscriber,function(innerValue){subscriber.next(innerValue)},function(){innerComplete=!0},void 0,function(){if(innerComplete)try{active--;for(var _loop_1=__name(function(){var bufferedValue=buffer.shift();innerSubScheduler||doInnerSub(bufferedValue)},"_loop_1");buffer.length&&active<concurrent;)_loop_1();checkComplete()}catch(err){subscriber.error(err)}}))},"doInnerSub");return source.subscribe(createOperatorSubscriber(subscriber,outerNext,function(){isComplete=!0,checkComplete()})),function(){}}__name(mergeInternals,"mergeInternals");function mergeMap(project,resultSelector,concurrent){return concurrent===void 0&&(concurrent=1/0),isFunction(resultSelector)?mergeMap(function(a,i){return map(function(b,ii){return resultSelector(a,b,i,ii)})(innerFrom(project(a,i)))},concurrent):(typeof resultSelector=="number"&&(concurrent=resultSelector),operate(function(source,subscriber){return mergeInternals(source,subscriber,project,concurrent)}))}__name(mergeMap,"mergeMap");function mergeAll(concurrent){return concurrent===void 0&&(concurrent=1/0),mergeMap(identity,concurrent)}__name(mergeAll,"mergeAll");function concatAll(){return mergeAll(1)}__name(concatAll,"concatAll");function concat(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return concatAll()(from(args,popScheduler(args)))}__name(concat,"concat");function forkJoin(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var resultSelector=popResultSelector(args),_a81=argsArgArrayOrObject(args),sources=_a81.args,keys=_a81.keys,result=new Observable(function(subscriber){var length=sources.length;if(!length){subscriber.complete();return}for(var values=new Array(length),remainingCompletions=length,remainingEmissions=length,_loop_1=__name(function(sourceIndex2){var hasValue=!1;innerFrom(sources[sourceIndex2]).subscribe(createOperatorSubscriber(subscriber,function(value){hasValue||(hasValue=!0,remainingEmissions--),values[sourceIndex2]=value},function(){return remainingCompletions--},void 0,function(){(!remainingCompletions||!hasValue)&&(remainingEmissions||subscriber.next(keys?createObject(keys,values):values),subscriber.complete())}))},"_loop_1"),sourceIndex=0;sourceIndex<length;sourceIndex++)_loop_1(sourceIndex)});return resultSelector?result.pipe(mapOneOrManyArgs(resultSelector)):result}__name(forkJoin,"forkJoin");function timer(dueTime,intervalOrScheduler,scheduler){dueTime===void 0&&(dueTime=0),scheduler===void 0&&(scheduler=async);var intervalDuration=-1;return intervalOrScheduler!=null&&(isScheduler(intervalOrScheduler)?scheduler=intervalOrScheduler:intervalDuration=intervalOrScheduler),new Observable(function(subscriber){var due=isValidDate(dueTime)?+dueTime-scheduler.now():dueTime;due<0&&(due=0);var n=0;return scheduler.schedule(function(){subscriber.closed||(subscriber.next(n++),0<=intervalDuration?this.schedule(void 0,intervalDuration):subscriber.complete())},due)})}__name(timer,"timer");function interval(period,scheduler){return scheduler===void 0&&(scheduler=asyncScheduler),timer(period,period,scheduler)}__name(interval,"interval");function merge$1(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var scheduler=popScheduler(args),concurrent=popNumber(args,1/0),sources=args;return sources.length?sources.length===1?innerFrom(sources[0]):mergeAll(concurrent)(from(sources,scheduler)):EMPTY}__name(merge$1,"merge$1");var isArray=Array.isArray;function argsOrArgArray(args){return args.length===1&&isArray(args[0])?args[0]:args}__name(argsOrArgArray,"argsOrArgArray");function filter(predicate,thisArg){return operate(function(source,subscriber){var index=0;source.subscribe(createOperatorSubscriber(subscriber,function(value){return predicate.call(thisArg,value,index++)&&subscriber.next(value)}))})}__name(filter,"filter");function bufferTime(bufferTimeSpan){for(var _a81,_b,otherArgs=[],_i=1;_i<arguments.length;_i++)otherArgs[_i-1]=arguments[_i];var scheduler=(_a81=popScheduler(otherArgs))!==null&&_a81!==void 0?_a81:asyncScheduler,bufferCreationInterval=(_b=otherArgs[0])!==null&&_b!==void 0?_b:null,maxBufferSize=otherArgs[1]||1/0;return operate(function(source,subscriber){var bufferRecords=[],restartOnEmit=!1,emit=__name(function(record){var buffer=record.buffer,subs=record.subs;subs.unsubscribe(),arrRemove(bufferRecords,record),subscriber.next(buffer),restartOnEmit&&startBuffer()},"emit"),startBuffer=__name(function(){if(bufferRecords){var subs=new Subscription;subscriber.add(subs);var buffer=[],record_1={buffer,subs};bufferRecords.push(record_1),executeSchedule(subs,scheduler,function(){return emit(record_1)},bufferTimeSpan)}},"startBuffer");bufferCreationInterval!==null&&bufferCreationInterval>=0?executeSchedule(subscriber,scheduler,startBuffer,bufferCreationInterval,!0):restartOnEmit=!0,startBuffer();var bufferTimeSubscriber=createOperatorSubscriber(subscriber,function(value){var e_1,_a82,recordsCopy=bufferRecords.slice();try{for(var recordsCopy_1=__values(recordsCopy),recordsCopy_1_1=recordsCopy_1.next();!recordsCopy_1_1.done;recordsCopy_1_1=recordsCopy_1.next()){var record=recordsCopy_1_1.value,buffer=record.buffer;buffer.push(value),maxBufferSize<=buffer.length&&emit(record)}}catch(e_1_1){e_1={error:e_1_1}}finally{try{recordsCopy_1_1&&!recordsCopy_1_1.done&&(_a82=recordsCopy_1.return)&&_a82.call(recordsCopy_1)}finally{if(e_1)throw e_1.error}}},function(){for(;bufferRecords!=null&&bufferRecords.length;)subscriber.next(bufferRecords.shift().buffer);bufferTimeSubscriber==null||bufferTimeSubscriber.unsubscribe(),subscriber.complete(),subscriber.unsubscribe()},void 0,function(){return bufferRecords=null});source.subscribe(bufferTimeSubscriber)})}__name(bufferTime,"bufferTime");function catchError(selector){return operate(function(source,subscriber){var innerSub=null,syncUnsub=!1,handledResult;innerSub=source.subscribe(createOperatorSubscriber(subscriber,void 0,void 0,function(err){handledResult=innerFrom(selector(err,catchError(selector)(source))),innerSub?(innerSub.unsubscribe(),innerSub=null,handledResult.subscribe(subscriber)):syncUnsub=!0})),syncUnsub&&(innerSub.unsubscribe(),innerSub=null,handledResult.subscribe(subscriber))})}__name(catchError,"catchError");function scanInternals(accumulator,seed,hasSeed,emitOnNext,emitBeforeComplete){return function(source,subscriber){var hasState=hasSeed,state=seed,index=0;source.subscribe(createOperatorSubscriber(subscriber,function(value){var i=index++;state=hasState?accumulator(state,value,i):(hasState=!0,value),subscriber.next(state)},emitBeforeComplete))}}__name(scanInternals,"scanInternals");function combineLatest(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var resultSelector=popResultSelector(args);return resultSelector?pipe(combineLatest.apply(void 0,__spreadArray$3([],__read(args))),mapOneOrManyArgs(resultSelector)):operate(function(source,subscriber){combineLatestInit(__spreadArray$3([source],__read(argsOrArgArray(args))))(subscriber)})}__name(combineLatest,"combineLatest");function combineLatestWith(){for(var otherSources=[],_i=0;_i<arguments.length;_i++)otherSources[_i]=arguments[_i];return combineLatest.apply(void 0,__spreadArray$3([],__read(otherSources)))}__name(combineLatestWith,"combineLatestWith");function concatMap(project,resultSelector){return isFunction(resultSelector)?mergeMap(project,resultSelector,1):mergeMap(project,1)}__name(concatMap,"concatMap");function debounce(durationSelector){return operate(function(source,subscriber){var hasValue=!1,lastValue=null,durationSubscriber=null,emit=__name(function(){if(durationSubscriber==null||durationSubscriber.unsubscribe(),durationSubscriber=null,hasValue){hasValue=!1;var value=lastValue;lastValue=null,subscriber.next(value)}},"emit");source.subscribe(createOperatorSubscriber(subscriber,function(value){durationSubscriber==null||durationSubscriber.unsubscribe(),hasValue=!0,lastValue=value,durationSubscriber=createOperatorSubscriber(subscriber,emit,noop),innerFrom(durationSelector(value)).subscribe(durationSubscriber)},function(){emit(),subscriber.complete()},void 0,function(){lastValue=durationSubscriber=null}))})}__name(debounce,"debounce");function debounceTime(dueTime,scheduler){return scheduler===void 0&&(scheduler=asyncScheduler),operate(function(source,subscriber){var activeTask=null,lastValue=null,lastTime=null,emit=__name(function(){if(activeTask){activeTask.unsubscribe(),activeTask=null;var value=lastValue;lastValue=null,subscriber.next(value)}},"emit");function emitWhenIdle(){var targetTime=lastTime+dueTime,now=scheduler.now();if(now<targetTime){activeTask=this.schedule(void 0,targetTime-now),subscriber.add(activeTask);return}emit()}__name(emitWhenIdle,"emitWhenIdle"),source.subscribe(createOperatorSubscriber(subscriber,function(value){lastValue=value,lastTime=scheduler.now(),activeTask||(activeTask=scheduler.schedule(emitWhenIdle,dueTime),subscriber.add(activeTask))},function(){emit(),subscriber.complete()},void 0,function(){lastValue=activeTask=null}))})}__name(debounceTime,"debounceTime");function take(count){return count<=0?function(){return EMPTY}:operate(function(source,subscriber){var seen=0;source.subscribe(createOperatorSubscriber(subscriber,function(value){++seen<=count&&(subscriber.next(value),count<=seen&&subscriber.complete())}))})}__name(take,"take");function mapTo(value){return map(function(){return value})}__name(mapTo,"mapTo");function delayWhen(delayDurationSelector,subscriptionDelay){return mergeMap(function(value,index){return innerFrom(delayDurationSelector(value,index)).pipe(take(1),mapTo(value))})}__name(delayWhen,"delayWhen");function delay(due,scheduler){scheduler===void 0&&(scheduler=asyncScheduler);var duration=timer(due,scheduler);return delayWhen(function(){return duration})}__name(delay,"delay");function distinctUntilChanged(comparator,keySelector){return keySelector===void 0&&(keySelector=identity),comparator=comparator??defaultCompare,operate(function(source,subscriber){var previousKey,first=!0;source.subscribe(createOperatorSubscriber(subscriber,function(value){var currentKey=keySelector(value);(first||!comparator(previousKey,currentKey))&&(first=!1,previousKey=currentKey,subscriber.next(value))}))})}__name(distinctUntilChanged,"distinctUntilChanged");function defaultCompare(a,b){return a===b}__name(defaultCompare,"defaultCompare");function exhaustMap(project,resultSelector){return operate(function(source,subscriber){var index=0,innerSub=null,isComplete=!1;source.subscribe(createOperatorSubscriber(subscriber,function(outerValue){innerSub||(innerSub=createOperatorSubscriber(subscriber,void 0,function(){innerSub=null,isComplete&&subscriber.complete()}),innerFrom(project(outerValue,index++)).subscribe(innerSub))},function(){isComplete=!0,!innerSub&&subscriber.complete()}))})}__name(exhaustMap,"exhaustMap");function merge(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var scheduler=popScheduler(args),concurrent=popNumber(args,1/0);return args=argsOrArgArray(args),operate(function(source,subscriber){mergeAll(concurrent)(from(__spreadArray$3([source],__read(args)),scheduler)).subscribe(subscriber)})}__name(merge,"merge");function mergeWith(){for(var otherSources=[],_i=0;_i<arguments.length;_i++)otherSources[_i]=arguments[_i];return merge.apply(void 0,__spreadArray$3([],__read(otherSources)))}__name(mergeWith,"mergeWith");function pairwise(){return operate(function(source,subscriber){var prev,hasPrev=!1;source.subscribe(createOperatorSubscriber(subscriber,function(value){var p=prev;prev=value,hasPrev&&subscriber.next([p,value]),hasPrev=!0}))})}__name(pairwise,"pairwise");function repeat(countOrConfig){var _a81,count=1/0,delay2;return countOrConfig!=null&&(typeof countOrConfig=="object"?(_a81=countOrConfig.count,count=_a81===void 0?1/0:_a81,delay2=countOrConfig.delay):count=countOrConfig),count<=0?function(){return EMPTY}:operate(function(source,subscriber){var soFar=0,sourceSub,resubscribe=__name(function(){if(sourceSub==null||sourceSub.unsubscribe(),sourceSub=null,delay2!=null){var notifier=typeof delay2=="number"?timer(delay2):innerFrom(delay2(soFar)),notifierSubscriber_1=createOperatorSubscriber(subscriber,function(){notifierSubscriber_1.unsubscribe(),subscribeToSource()});notifier.subscribe(notifierSubscriber_1)}else subscribeToSource()},"resubscribe"),subscribeToSource=__name(function(){var syncUnsub=!1;sourceSub=source.subscribe(createOperatorSubscriber(subscriber,void 0,function(){++soFar<count?sourceSub?resubscribe():syncUnsub=!0:subscriber.complete()})),syncUnsub&&resubscribe()},"subscribeToSource");subscribeToSource()})}__name(repeat,"repeat");function scan(accumulator,seed){return operate(scanInternals(accumulator,seed,arguments.length>=2,!0))}__name(scan,"scan");function skip(count){return filter(function(_,index){return count<=index})}__name(skip,"skip");function startWith(){for(var values=[],_i=0;_i<arguments.length;_i++)values[_i]=arguments[_i];var scheduler=popScheduler(values);return operate(function(source,subscriber){(scheduler?concat(values,source,scheduler):concat(values,source)).subscribe(subscriber)})}__name(startWith,"startWith");function switchMap(project,resultSelector){return operate(function(source,subscriber){var innerSubscriber=null,index=0,isComplete=!1,checkComplete=__name(function(){return isComplete&&!innerSubscriber&&subscriber.complete()},"checkComplete");source.subscribe(createOperatorSubscriber(subscriber,function(value){innerSubscriber==null||innerSubscriber.unsubscribe();var innerIndex=0,outerIndex=index++;innerFrom(project(value,outerIndex)).subscribe(innerSubscriber=createOperatorSubscriber(subscriber,function(innerValue){return subscriber.next(resultSelector?resultSelector(value,innerValue,outerIndex,innerIndex++):innerValue)},function(){innerSubscriber=null,checkComplete()}))},function(){isComplete=!0,checkComplete()}))})}__name(switchMap,"switchMap");function takeUntil(notifier){return operate(function(source,subscriber){innerFrom(notifier).subscribe(createOperatorSubscriber(subscriber,function(){return subscriber.complete()},noop)),!subscriber.closed&&source.subscribe(subscriber)})}__name(takeUntil,"takeUntil");function tap(observerOrNext,error,complete){var tapObserver=isFunction(observerOrNext)||error||complete?{next:observerOrNext,error,complete}:observerOrNext;return tapObserver?operate(function(source,subscriber){var _a81;(_a81=tapObserver.subscribe)===null||_a81===void 0||_a81.call(tapObserver);var isUnsub=!0;source.subscribe(createOperatorSubscriber(subscriber,function(value){var _a82;(_a82=tapObserver.next)===null||_a82===void 0||_a82.call(tapObserver,value),subscriber.next(value)},function(){var _a82;isUnsub=!1,(_a82=tapObserver.complete)===null||_a82===void 0||_a82.call(tapObserver),subscriber.complete()},function(err){var _a82;isUnsub=!1,(_a82=tapObserver.error)===null||_a82===void 0||_a82.call(tapObserver,err),subscriber.error(err)},function(){var _a82,_b;isUnsub&&((_a82=tapObserver.unsubscribe)===null||_a82===void 0||_a82.call(tapObserver)),(_b=tapObserver.finalize)===null||_b===void 0||_b.call(tapObserver)}))}):identity}__name(tap,"tap");function withLatestFrom(){for(var inputs=[],_i=0;_i<arguments.length;_i++)inputs[_i]=arguments[_i];var project=popResultSelector(inputs);return operate(function(source,subscriber){for(var len=inputs.length,otherValues=new Array(len),hasValue=inputs.map(function(){return!1}),ready=!1,_loop_1=__name(function(i2){innerFrom(inputs[i2]).subscribe(createOperatorSubscriber(subscriber,function(value){otherValues[i2]=value,!ready&&!hasValue[i2]&&(hasValue[i2]=!0,(ready=hasValue.every(identity))&&(hasValue=null))},noop))},"_loop_1"),i=0;i<len;i++)_loop_1(i);source.subscribe(createOperatorSubscriber(subscriber,function(value){if(ready){var values=__spreadArray$3([value],__read(otherValues));subscriber.next(project?project.apply(void 0,__spreadArray$3([],__read(values))):values)}}))})}__name(withLatestFrom,"withLatestFrom");const _Interceptor=class _Interceptor{constructor(_debuggingEnabled=!1){__publicField(this,"_typoBodyLoaded$",new BehaviorSubject(!1));__publicField(this,"_canvasFound$",new BehaviorSubject(!1));__publicField(this,"_contentScriptLoaded$",new BehaviorSubject(!1));__publicField(this,"_tokenProcessed$",new BehaviorSubject(!1));__publicField(this,"_patchLoaded$",new BehaviorSubject(!1));__publicField(this,"_canvasPrioritizedEventsReady$",new BehaviorSubject(void 0));__publicField(this,"_canvasEventListener",new Map);__publicField(this,"_canvasPrioritizedEventsReady",firstValueFrom(this._canvasPrioritizedEventsReady$.pipe(filter(v=>v!==void 0))));this._debuggingEnabled=_debuggingEnabled,this._typoBodyLoaded$.pipe(filter(loaded=>loaded),tap(()=>this.listenForCanvas()),combineLatestWith(this._canvasFound$,this._contentScriptLoaded$,this._tokenProcessed$),filter(([,canvas,content,token])=>canvas&&content&&token)).subscribe(()=>{this.debug("All prerequisites executed, injecting patch and listening to canvas events"),this.listenPrioritizedCanvasElements(),this.injectPatch()}),this.debug("Interceptor initialized, starting listeners for token and game.js"),this.waitForTypoLoadedBody(),this.processToken(),this.patchLoaded$.subscribe(()=>{document.body.dataset.typo_loaded="true"})}debug(...args){this._debuggingEnabled&&console.log("[INTERCEPTOR DEBUG]",...args)}injectPatch(){this.debug("Injecting game patch");const patch=document.createElement("script");patch.src=chrome.runtime.getURL("gamePatch.js"),patch.onload=async()=>{this.debug("Game patch loaded"),this._patchLoaded$.next(!0),this._patchLoaded$.complete()},document.body.appendChild(patch)}async processToken(){this.debug("Processing token");const url=new URL(window.location.href),tokenParam=url.searchParams.get("accessToken");tokenParam!==null&&(await chrome.runtime.sendMessage({type:"set token",token:tokenParam}),url.searchParams.delete("accessToken"),window.history.replaceState({},"",url.toString())),this.debug("Token processed"),this._tokenProcessed$.next(!0),this._tokenProcessed$.complete()}waitForTypoLoadedBody(){if(this.debug("Listening for body from typo loader"),document.body.dataset.typo_loader==="true"){this.debug("Body already loaded"),this._typoBodyLoaded$.next(!0),this._typoBodyLoaded$.complete();return}const bodyObserver=new MutationObserver(()=>{document.body.dataset.typo_loader==="true"&&(this.debug("Typo body loaded"),this._typoBodyLoaded$.next(!0),this._typoBodyLoaded$.complete(),bodyObserver.disconnect())});bodyObserver.observe(document,{childList:!0,subtree:!0})}listenForCanvas(){if(this.debug("Listening on DOM buildup until canvas element is added"),element("#game-canvas > canvas")){this.debug("Canvas already present"),this._canvasFound$.next(!0),this._canvasFound$.complete();return}new MutationObserver(mutations=>{mutations.forEach(mutation=>{mutation.type==="childList"&&[...mutation.addedNodes].find(n=>{var _a81;return n.nodeName==="CANVAS"&&((_a81=n.parentElement)==null?void 0:_a81.id)==="game-canvas"})&&(this.debug("Canvas found"),this._canvasFound$.next(!0),this._canvasFound$.complete())})}).observe(document.body,{childList:!0,subtree:!0})}listenPrioritizedCanvasElements(){const addListener=__name(priority=>(type,listener)=>{const listeners=this._canvasEventListener.get(type);if(listeners===void 0)this._canvasEventListener.set(type,new Map([[priority,new Set([{priority,handler:listener}])]]));else{const priorityListeners=listeners.get(priority);priorityListeners===void 0?listeners.set(priority,new Set([{priority,handler:listener}])):priorityListeners.add({priority,handler:listener})}},"addListener"),removeListener=__name((type,listener)=>{const listeners=this._canvasEventListener.get(type);if(listeners!==void 0)for(const priorityListeners of listeners.values())for(const priorityListener of priorityListeners)priorityListener.handler===listener&&priorityListeners.delete(priorityListener)},"removeListener"),canvas=requireElement("#game-canvas > canvas");for(const key in canvas)if(/^on/.test(key)){const eventType=key.slice(2);canvas.addEventListener(eventType,event=>{const eventListeners=this._canvasEventListener.get(eventType);if(eventListeners===void 0)return;const listeners=[...eventListeners.get("preDraw")??[],...eventListeners.get("draw")??[],...eventListeners.get("postDraw")??[]];for(const listener of listeners)if(listener.handler(event)===!1){event.stopImmediatePropagation();return}})}this._canvasPrioritizedEventsReady$.next({add:addListener,remove:removeListener})}triggerPatchInjection(){if(this._contentScriptLoaded$.closed)throw new Error("Already triggered patch injection");this.debug("Content script loaded, triggering patch injection"),this._contentScriptLoaded$.next(!0),this._contentScriptLoaded$.complete()}enableDebugging(){this._debuggingEnabled=!0}get patchLoaded$(){return this._patchLoaded$.pipe(filter(v=>v),map(()=>{}))}get canvasPrioritizedEventsReady(){return this._canvasPrioritizedEventsReady}};__name(_Interceptor,"Interceptor");let Interceptor=_Interceptor;function handle_promise(promise,info){const token=info.token={};function update(type,index,key,value){if(info.token!==token)return;info.resolved=value;let child_ctx=info.ctx;key!==void 0&&(child_ctx=child_ctx.slice(),child_ctx[key]=value);const block=type&&(info.current=type)(child_ctx);let needs_flush=!1;info.block&&(info.blocks?info.blocks.forEach((block2,i)=>{i!==index&&block2&&(group_outros(),transition_out(block2,1,1,()=>{info.blocks[i]===block2&&(info.blocks[i]=null)}),check_outros())}):info.block.d(1),block.c(),transition_in(block,1),block.m(info.mount(),info.anchor),needs_flush=!0),info.block=block,info.blocks&&(info.blocks[index]=block),needs_flush&&flush()}if(__name(update,"update"),is_promise(promise)){const current_component=get_current_component();if(promise.then(value=>{set_current_component(current_component),update(info.then,1,info.value,value),set_current_component(null)},error=>{if(set_current_component(current_component),update(info.catch,2,info.error,error),set_current_component(null),!info.hasCatch)throw error}),info.current!==info.pending)return update(info.pending,0),!0}else{if(info.current!==info.then)return update(info.then,1,info.value,promise),!0;info.resolved=promise}}__name(handle_promise,"handle_promise");function update_await_block_branch(info,ctx,dirty){const child_ctx=ctx.slice(),{resolved}=info;info.current===info.then&&(child_ctx[info.value]=resolved),info.current===info.catch&&(child_ctx[info.error]=resolved),info.block.p(child_ctx,dirty)}__name(update_await_block_branch,"update_await_block_branch");function ensure_array_like(array_like_or_iterator){return(array_like_or_iterator==null?void 0:array_like_or_iterator.length)!==void 0?array_like_or_iterator:Array.from(array_like_or_iterator)}__name(ensure_array_like,"ensure_array_like");function get_spread_update(levels,updates){const update={},to_null_out={},accounted_for={$$scope:1};let i=levels.length;for(;i--;){const o=levels[i],n=updates[i];if(n){for(const key in o)key in n||(to_null_out[key]=1);for(const key in n)accounted_for[key]||(update[key]=n[key],accounted_for[key]=1);levels[i]=n}else for(const key in o)accounted_for[key]=1}for(const key in to_null_out)key in update||(update[key]=void 0);return update}__name(get_spread_update,"get_spread_update");function get_spread_object(spread_props){return typeof spread_props=="object"&&spread_props!==null?spread_props:{}}__name(get_spread_object,"get_spread_object");const subscriber_queue=[];function writable(value,start=noop$1){let stop;const subscribers=new Set;function set(new_value){if(safe_not_equal(value,new_value)&&(value=new_value,stop)){const run_queue=!subscriber_queue.length;for(const subscriber of subscribers)subscriber[1](),subscriber_queue.push(subscriber,value);if(run_queue){for(let i=0;i<subscriber_queue.length;i+=2)subscriber_queue[i][0](subscriber_queue[i+1]);subscriber_queue.length=0}}}__name(set,"set");function update(fn){set(fn(value))}__name(update,"update");function subscribe2(run,invalidate=noop$1){const subscriber=[run,invalidate];return subscribers.add(subscriber),subscribers.size===1&&(stop=start(set,update)||noop$1),run(value),()=>{subscribers.delete(subscriber),subscribers.size===0&&stop&&(stop(),stop=null)}}return __name(subscribe2,"subscribe"),{set,update,subscribe:subscribe2}}__name(writable,"writable");function fromObservable(observable2,initialValue,onWrite,allowWriteBeforeEmit=!0){const store=writable(initialValue);let hasEmitted=allowWriteBeforeEmit;const subscription=observable2.subscribe({next:__name(value=>{store.set(value),hasEmitted=!0},"next"),error:__name(err=>console.error("Error from observable:",err),"error")});return{subscribe:store.subscribe,unsubscribe:__name(()=>subscription.unsubscribe(),"unsubscribe"),set:__name(value=>{store.set(value),hasEmitted&&(onWrite==null||onWrite(value))},"set")}}__name(fromObservable,"fromObservable");function create_if_block$D(ctx){let span,t;return{c(){span=element$1("span"),t=text(ctx[2]),attr(span,"class","svelte-kfudwd")},m(target,anchor){insert(target,span,anchor),append(span,t)},p(ctx2,dirty){dirty&4&&set_data(t,ctx2[2])},d(detaching){detaching&&detach(span)}}}__name(create_if_block$D,"create_if_block$D");function create_fragment$1b(ctx){let div,img,img_src_value,t,mounted,dispose,if_block=ctx[2]&&create_if_block$D(ctx);return{c(){div=element$1("div"),img=element$1("img"),t=space(),if_block&&if_block.c(),src_url_equal(img.src,img_src_value="")||attr(img,"src",img_src_value),attr(img,"alt","icon"),set_style(img,"content","var(--"+(ctx[0]?"file-img-enabled-gif":"file-img-disabled-gif")+")"),attr(img,"class","svelte-kfudwd"),attr(div,"role","checkbox"),attr(div,"tabindex","0"),attr(div,"aria-checked",ctx[0]),attr(div,"class","svelte-kfudwd"),toggle_class(div,"disabled",ctx[1])},m(target,anchor){insert(target,div,anchor),append(div,img),append(div,t),if_block&&if_block.m(div,null),mounted||(dispose=[listen(div,"click",ctx[4]),listen(div,"click",ctx[5]),listen(div,"keypress",ctx[6])],mounted=!0)},p(ctx2,[dirty]){dirty&1&&set_style(img,"content","var(--"+(ctx2[0]?"file-img-enabled-gif":"file-img-disabled-gif")+")"),ctx2[2]?if_block?if_block.p(ctx2,dirty):(if_block=create_if_block$D(ctx2),if_block.c(),if_block.m(div,null)):if_block&&(if_block.d(1),if_block=null),dirty&1&&attr(div,"aria-checked",ctx2[0]),dirty&2&&toggle_class(div,"disabled",ctx2[1])},i:noop$1,o:noop$1,d(detaching){detaching&&detach(div),if_block&&if_block.d(),mounted=!1,run_all(dispose)}}}__name(create_fragment$1b,"create_fragment$1b");function instance$14($$self,$$props,$$invalidate){let{checked=!1}=$$props,{disabled=!1}=$$props,{description=""}=$$props;const dispatch=createEventDispatcher();function click_handler2(event){bubble.call(this,$$self,event)}__name(click_handler2,"click_handler");const click_handler_1=__name(()=>{$$invalidate(0,checked=!checked),dispatch("change",checked)},"click_handler_1"),keypress_handler=__name(key=>{key.key==="Enter"&&$$invalidate(0,checked=!checked),dispatch("change",checked)},"keypress_handler");return $$self.$$set=$$props2=>{"checked"in $$props2&&$$invalidate(0,checked=$$props2.checked),"disabled"in $$props2&&$$invalidate(1,disabled=$$props2.disabled),"description"in $$props2&&$$invalidate(2,description=$$props2.description)},[checked,disabled,description,dispatch,click_handler2,click_handler_1,keypress_handler]}__name(instance$14,"instance$14");const _Checkbox=class _Checkbox extends SvelteComponent{constructor(options){super(),init(this,options,instance$14,create_fragment$1b,safe_not_equal,{checked:0,disabled:1,description:2})}};__name(_Checkbox,"Checkbox");let Checkbox=_Checkbox;function create_if_block$C(ctx){let b,checkbox,updating_checked,t0,div,t1_value=ctx[0].description+"",t1,current;function checkbox_checked_binding(value){ctx[3](value)}__name(checkbox_checked_binding,"checkbox_checked_binding");let checkbox_props={description:ctx[0].name};return ctx[2]!==void 0&&(checkbox_props.checked=ctx[2]),checkbox=new Checkbox({props:checkbox_props}),binding_callbacks.push(()=>bind$1(checkbox,"checked",checkbox_checked_binding)),{c(){b=element$1("b"),create_component(checkbox.$$.fragment),t0=space(),div=element$1("div"),t1=text(t1_value),attr(b,"class","svelte-rvotkt")},m(target,anchor){insert(target,b,anchor),mount_component(checkbox,b,null),insert(target,t0,anchor),insert(target,div,anchor),append(div,t1),current=!0},p(ctx2,dirty){const checkbox_changes={};dirty&1&&(checkbox_changes.description=ctx2[0].name),!updating_checked&&dirty&4&&(updating_checked=!0,checkbox_changes.checked=ctx2[2],add_flush_callback(()=>updating_checked=!1)),checkbox.$set(checkbox_changes),(!current||dirty&1)&&t1_value!==(t1_value=ctx2[0].description+"")&&set_data(t1,t1_value)},i(local){current||(transition_in(checkbox.$$.fragment,local),current=!0)},o(local){transition_out(checkbox.$$.fragment,local),current=!1},d(detaching){detaching&&(detach(b),detach(t0),detach(div)),destroy_component(checkbox)}}}__name(create_if_block$C,"create_if_block$C");function create_fragment$1a(ctx){let if_block_anchor,current,if_block=ctx[1]&&create_if_block$C(ctx);return{c(){if_block&&if_block.c(),if_block_anchor=empty()},m(target,anchor){if_block&&if_block.m(target,anchor),insert(target,if_block_anchor,anchor),current=!0},p(ctx2,[dirty]){ctx2[1]?if_block?(if_block.p(ctx2,dirty),dirty&2&&transition_in(if_block,1)):(if_block=create_if_block$C(ctx2),if_block.c(),transition_in(if_block,1),if_block.m(if_block_anchor.parentNode,if_block_anchor)):if_block&&(group_outros(),transition_out(if_block,1,1,()=>{if_block=null}),check_outros())},i(local){current||(transition_in(if_block),current=!0)},o(local){transition_out(if_block),current=!1},d(detaching){detaching&&detach(if_block_anchor),if_block&&if_block.d(detaching)}}}__name(create_fragment$1a,"create_fragment$1a");function instance$13($$self,$$props,$$invalidate){let $settingStore,$$unsubscribe_settingStore=noop$1,$$subscribe_settingStore=__name(()=>($$unsubscribe_settingStore(),$$unsubscribe_settingStore=subscribe(settingStore,$$value=>$$invalidate(2,$settingStore=$$value)),settingStore),"$$subscribe_settingStore");$$self.$$.on_destroy.push(()=>$$unsubscribe_settingStore());let{setting}=$$props,settingStore;function checkbox_checked_binding(value){$settingStore=value,settingStore.set($settingStore)}return __name(checkbox_checked_binding,"checkbox_checked_binding"),$$self.$$set=$$props2=>{"setting"in $$props2&&$$invalidate(0,setting=$$props2.setting)},$$self.$$.update=()=>{$$self.$$.dirty&1&&$$subscribe_settingStore($$invalidate(1,settingStore=setting.store))},[setting,settingStore,$settingStore,checkbox_checked_binding]}__name(instance$13,"instance$13");const _Boolean_setting_input=class _Boolean_setting_input extends SvelteComponent{constructor(options){super(),init(this,options,instance$13,create_fragment$1a,safe_not_equal,{setting:0})}};__name(_Boolean_setting_input,"Boolean_setting_input");let Boolean_setting_input=_Boolean_setting_input;function create_if_block$B(ctx){let div1,b,t0_value=ctx[0].name+"",t0,t1,input,input_min_value,input_max_value,t2,t3,div0,t4_value=ctx[0].description+"",t4,mounted,dispose,if_block=ctx[2]!==void 0&&ctx[1]&&create_if_block_1$j(ctx);return{c(){var _a81,_b;div1=element$1("div"),b=element$1("b"),t0=text(t0_value),t1=space(),input=element$1("input"),t2=space(),if_block&&if_block.c(),t3=space(),div0=element$1("div"),t4=text(t4_value),attr(b,"class","svelte-i0zktq"),attr(input,"type","number"),attr(input,"min",input_min_value=(_a81=ctx[1])==null?void 0:_a81.min),attr(input,"max",input_max_value=(_b=ctx[1])==null?void 0:_b.max),attr(input,"class","svelte-i0zktq"),attr(div1,"class","typo-numeric-setting svelte-i0zktq")},m(target,anchor){insert(target,div1,anchor),append(div1,b),append(b,t0),append(div1,t1),append(div1,input),set_input_value(input,ctx[4]),append(div1,t2),if_block&&if_block.m(div1,null),append(div1,t3),append(div1,div0),append(div0,t4),mounted||(dispose=listen(input,"input",ctx[5]),mounted=!0)},p(ctx2,dirty){var _a81,_b;dirty&1&&t0_value!==(t0_value=ctx2[0].name+"")&&set_data(t0,t0_value),dirty&2&&input_min_value!==(input_min_value=(_a81=ctx2[1])==null?void 0:_a81.min)&&attr(input,"min",input_min_value),dirty&2&&input_max_value!==(input_max_value=(_b=ctx2[1])==null?void 0:_b.max)&&attr(input,"max",input_max_value),dirty&16&&to_number(input.value)!==ctx2[4]&&set_input_value(input,ctx2[4]),ctx2[2]!==void 0&&ctx2[1]?if_block?if_block.p(ctx2,dirty):(if_block=create_if_block_1$j(ctx2),if_block.c(),if_block.m(div1,t3)):if_block&&(if_block.d(1),if_block=null),dirty&1&&t4_value!==(t4_value=ctx2[0].description+"")&&set_data(t4,t4_value)},d(detaching){detaching&&detach(div1),if_block&&if_block.d(),mounted=!1,dispose()}}}__name(create_if_block$B,"create_if_block$B");function create_if_block_1$j(ctx){let input,input_min_value,input_max_value,mounted,dispose;return{c(){input=element$1("input"),attr(input,"type","range"),attr(input,"min",input_min_value=ctx[1].min),attr(input,"max",input_max_value=ctx[1].max),attr(input,"step",ctx[2]),attr(input,"class","svelte-i0zktq")},m(target,anchor){insert(target,input,anchor),set_input_value(input,ctx[4]),mounted||(dispose=[listen(input,"change",ctx[6]),listen(input,"input",ctx[6])],mounted=!0)},p(ctx2,dirty){dirty&2&&input_min_value!==(input_min_value=ctx2[1].min)&&attr(input,"min",input_min_value),dirty&2&&input_max_value!==(input_max_value=ctx2[1].max)&&attr(input,"max",input_max_value),dirty&4&&attr(input,"step",ctx2[2]),dirty&16&&set_input_value(input,ctx2[4])},d(detaching){detaching&&detach(input),mounted=!1,run_all(dispose)}}}__name(create_if_block_1$j,"create_if_block_1$j");function create_fragment$19(ctx){let if_block_anchor,if_block=ctx[3]&&create_if_block$B(ctx);return{c(){if_block&&if_block.c(),if_block_anchor=empty()},m(target,anchor){if_block&&if_block.m(target,anchor),insert(target,if_block_anchor,anchor)},p(ctx2,[dirty]){ctx2[3]?if_block?if_block.p(ctx2,dirty):(if_block=create_if_block$B(ctx2),if_block.c(),if_block.m(if_block_anchor.parentNode,if_block_anchor)):if_block&&(if_block.d(1),if_block=null)},i:noop$1,o:noop$1,d(detaching){detaching&&detach(if_block_anchor),if_block&&if_block.d(detaching)}}}__name(create_fragment$19,"create_fragment$19");function instance$12($$self,$$props,$$invalidate){let $settingStore,$$unsubscribe_settingStore=noop$1,$$subscribe_settingStore=__name(()=>($$unsubscribe_settingStore(),$$unsubscribe_settingStore=subscribe(settingStore,$$value=>$$invalidate(4,$settingStore=$$value)),settingStore),"$$subscribe_settingStore");$$self.$$.on_destroy.push(()=>$$unsubscribe_settingStore());let{setting}=$$props,{bounds}=$$props,{withSliderAndSteps}=$$props,settingStore;function input_input_handler(){$settingStore=to_number(this.value),settingStore.set($settingStore)}__name(input_input_handler,"input_input_handler");function input_change_input_handler(){$settingStore=to_number(this.value),settingStore.set($settingStore)}return __name(input_change_input_handler,"input_change_input_handler"),$$self.$$set=$$props2=>{"setting"in $$props2&&$$invalidate(0,setting=$$props2.setting),"bounds"in $$props2&&$$invalidate(1,bounds=$$props2.bounds),"withSliderAndSteps"in $$props2&&$$invalidate(2,withSliderAndSteps=$$props2.withSliderAndSteps)},$$self.$$.update=()=>{$$self.$$.dirty&1&&$$subscribe_settingStore($$invalidate(3,settingStore=setting.store))},[setting,bounds,withSliderAndSteps,settingStore,$settingStore,input_input_handler,input_change_input_handler]}__name(instance$12,"instance$12");const _Numeric_setting_input=class _Numeric_setting_input extends SvelteComponent{constructor(options){super(),init(this,options,instance$12,create_fragment$19,safe_not_equal,{setting:0,bounds:1,withSliderAndSteps:2})}};__name(_Numeric_setting_input,"Numeric_setting_input");let Numeric_setting_input=_Numeric_setting_input;function get_each_context$w(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[5]=list[i].choice,child_ctx[6]=list[i].name,child_ctx}__name(get_each_context$w,"get_each_context$w");function create_if_block$A(ctx){let div1,b,t0_value=ctx[0].name+"",t0,t1,select,t2,div0,t3_value=ctx[0].description+"",t3,mounted,dispose,each_value=ensure_array_like(ctx[1]),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$w(get_each_context$w(ctx,each_value,i));return{c(){div1=element$1("div"),b=element$1("b"),t0=text(t0_value),t1=space(),select=element$1("select");for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();t2=space(),div0=element$1("div"),t3=text(t3_value),attr(b,"class","svelte-zlhfg4"),ctx[3]===void 0&&add_render_callback(()=>ctx[4].call(select)),attr(div1,"class","typo-numeric-setting svelte-zlhfg4")},m(target,anchor){insert(target,div1,anchor),append(div1,b),append(b,t0),append(div1,t1),append(div1,select);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(select,null);select_option(select,ctx[3],!0),append(div1,t2),append(div1,div0),append(div0,t3),mounted||(dispose=listen(select,"change",ctx[4]),mounted=!0)},p(ctx2,dirty){if(dirty&1&&t0_value!==(t0_value=ctx2[0].name+"")&&set_data(t0,t0_value),dirty&2){each_value=ensure_array_like(ctx2[1]);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$w(ctx2,each_value,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block$w(child_ctx),each_blocks[i].c(),each_blocks[i].m(select,null))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value.length}dirty&10&&select_option(select,ctx2[3]),dirty&1&&t3_value!==(t3_value=ctx2[0].description+"")&&set_data(t3,t3_value)},d(detaching){detaching&&detach(div1),destroy_each(each_blocks,detaching),mounted=!1,dispose()}}}__name(create_if_block$A,"create_if_block$A");function create_each_block$w(ctx){let option,t_value=ctx[6]+"",t,option_value_value;return{c(){option=element$1("option"),t=text(t_value),option.__value=option_value_value=ctx[5],set_input_value(option,option.__value)},m(target,anchor){insert(target,option,anchor),append(option,t)},p(ctx2,dirty){dirty&2&&t_value!==(t_value=ctx2[6]+"")&&set_data(t,t_value),dirty&2&&option_value_value!==(option_value_value=ctx2[5])&&(option.__value=option_value_value,set_input_value(option,option.__value))},d(detaching){detaching&&detach(option)}}}__name(create_each_block$w,"create_each_block$w");function create_fragment$18(ctx){let if_block_anchor,if_block=ctx[2]&&create_if_block$A(ctx);return{c(){if_block&&if_block.c(),if_block_anchor=empty()},m(target,anchor){if_block&&if_block.m(target,anchor),insert(target,if_block_anchor,anchor)},p(ctx2,[dirty]){ctx2[2]?if_block?if_block.p(ctx2,dirty):(if_block=create_if_block$A(ctx2),if_block.c(),if_block.m(if_block_anchor.parentNode,if_block_anchor)):if_block&&(if_block.d(1),if_block=null)},i:noop$1,o:noop$1,d(detaching){detaching&&detach(if_block_anchor),if_block&&if_block.d(detaching)}}}__name(create_fragment$18,"create_fragment$18");function instance$11($$self,$$props,$$invalidate){let $settingStore,$$unsubscribe_settingStore=noop$1,$$subscribe_settingStore=__name(()=>($$unsubscribe_settingStore(),$$unsubscribe_settingStore=subscribe(settingStore,$$value=>$$invalidate(3,$settingStore=$$value)),settingStore),"$$subscribe_settingStore");$$self.$$.on_destroy.push(()=>$$unsubscribe_settingStore());let{setting}=$$props,{choices}=$$props,settingStore;function select_change_handler(){$settingStore=select_value(this),settingStore.set($settingStore),$$invalidate(1,choices)}return __name(select_change_handler,"select_change_handler"),$$self.$$set=$$props2=>{"setting"in $$props2&&$$invalidate(0,setting=$$props2.setting),"choices"in $$props2&&$$invalidate(1,choices=$$props2.choices)},$$self.$$.update=()=>{$$self.$$.dirty&1&&$$subscribe_settingStore($$invalidate(2,settingStore=setting.store))},[setting,choices,settingStore,$settingStore,select_change_handler]}__name(instance$11,"instance$11");const _Choice_setting_input=class _Choice_setting_input extends SvelteComponent{constructor(options){super(),init(this,options,instance$11,create_fragment$18,safe_not_equal,{setting:0,choices:1})}};__name(_Choice_setting_input,"Choice_setting_input");let Choice_setting_input=_Choice_setting_input;function create_if_block$z(ctx){let div1,b,t0_value=ctx[0].name+"",t0,t1,input,t2,div0,t3_value=ctx[0].description+"",t3,mounted,dispose;return{c(){div1=element$1("div"),b=element$1("b"),t0=text(t0_value),t1=space(),input=element$1("input"),t2=space(),div0=element$1("div"),t3=text(t3_value),attr(b,"class","svelte-xq58hp"),attr(input,"type","text"),attr(input,"class","svelte-xq58hp"),attr(div1,"class","typo-text-setting svelte-xq58hp")},m(target,anchor){insert(target,div1,anchor),append(div1,b),append(b,t0),append(div1,t1),append(div1,input),set_input_value(input,ctx[2]),append(div1,t2),append(div1,div0),append(div0,t3),mounted||(dispose=listen(input,"input",ctx[3]),mounted=!0)},p(ctx2,dirty){dirty&1&&t0_value!==(t0_value=ctx2[0].name+"")&&set_data(t0,t0_value),dirty&4&&input.value!==ctx2[2]&&set_input_value(input,ctx2[2]),dirty&1&&t3_value!==(t3_value=ctx2[0].description+"")&&set_data(t3,t3_value)},d(detaching){detaching&&detach(div1),mounted=!1,dispose()}}}__name(create_if_block$z,"create_if_block$z");function create_fragment$17(ctx){let if_block_anchor,if_block=ctx[1]&&create_if_block$z(ctx);return{c(){if_block&&if_block.c(),if_block_anchor=empty()},m(target,anchor){if_block&&if_block.m(target,anchor),insert(target,if_block_anchor,anchor)},p(ctx2,[dirty]){ctx2[1]?if_block?if_block.p(ctx2,dirty):(if_block=create_if_block$z(ctx2),if_block.c(),if_block.m(if_block_anchor.parentNode,if_block_anchor)):if_block&&(if_block.d(1),if_block=null)},i:noop$1,o:noop$1,d(detaching){detaching&&detach(if_block_anchor),if_block&&if_block.d(detaching)}}}__name(create_fragment$17,"create_fragment$17");function instance$10($$self,$$props,$$invalidate){let $settingStore,$$unsubscribe_settingStore=noop$1,$$subscribe_settingStore=__name(()=>($$unsubscribe_settingStore(),$$unsubscribe_settingStore=subscribe(settingStore,$$value=>$$invalidate(2,$settingStore=$$value)),settingStore),"$$subscribe_settingStore");$$self.$$.on_destroy.push(()=>$$unsubscribe_settingStore());let{setting}=$$props,settingStore;function input_input_handler(){$settingStore=this.value,settingStore.set($settingStore)}return __name(input_input_handler,"input_input_handler"),$$self.$$set=$$props2=>{"setting"in $$props2&&$$invalidate(0,setting=$$props2.setting)},$$self.$$.update=()=>{$$self.$$.dirty&1&&$$subscribe_settingStore($$invalidate(1,settingStore=setting.store))},[setting,settingStore,$settingStore,input_input_handler]}__name(instance$10,"instance$10");const _Text_setting_input=class _Text_setting_input extends SvelteComponent{constructor(options){super(),init(this,options,instance$10,create_fragment$17,safe_not_equal,{setting:0})}};__name(_Text_setting_input,"Text_setting_input");let Text_setting_input=_Text_setting_input;const _ExtensionSetting=class _ExtensionSetting{constructor(key,defaultValue,feature){__publicField(this,"_name");__publicField(this,"_description");__publicField(this,"_changes",new BehaviorSubject(null));this.key=key,this.defaultValue=defaultValue,this.feature=feature,this.feature=feature}get globalKey(){const sanitized=this.key.replace(/[^a-zA-Z0-9.]/g,"_");return this.feature?`feature_${this.feature.featureId}.${sanitized}`:`global.${sanitized}`}async getValue(){const string=await chrome.runtime.sendMessage({type:"get setting",key:this.globalKey});if(string==null)return this.defaultValue;const value=JSON.parse(string);return this._changes.next(value),value}async setValue(value){const json=JSON.stringify(value);await chrome.runtime.sendMessage({type:"set setting",key:this.globalKey,value:json}),this._changes.next(value)}get name(){return this._name}get description(){return this._description}setDefaultValue(value){this.defaultValue=value}withName(name){return this._name=name,this}withDescription(description){return this._description=description,this}get changes$(){return this._changes.pipe(switchMap(data=>data===null?this.getValue():of(data)))}get store(){return fromObservable(this.changes$,this.defaultValue,value=>this.setValue(value),!1)}get asFrozen(){return this}};__name(_ExtensionSetting,"ExtensionSetting");let ExtensionSetting=_ExtensionSetting;const _SettingWithInput=class _SettingWithInput extends ExtensionSetting{};__name(_SettingWithInput,"SettingWithInput");let SettingWithInput=_SettingWithInput;const _BooleanExtensionSetting=class _BooleanExtensionSetting extends SettingWithInput{get componentData(){return{componentType:Boolean_setting_input,props:{setting:this}}}};__name(_BooleanExtensionSetting,"BooleanExtensionSetting");let BooleanExtensionSetting=_BooleanExtensionSetting;const _TextExtensionSetting=class _TextExtensionSetting extends SettingWithInput{get componentData(){return{componentType:Text_setting_input,props:{setting:this}}}};__name(_TextExtensionSetting,"TextExtensionSetting");let TextExtensionSetting=_TextExtensionSetting;const _NumericExtensionSetting=class _NumericExtensionSetting extends SettingWithInput{constructor(){super(...arguments);__publicField(this,"_min");__publicField(this,"_max");__publicField(this,"_sliderWithSteps")}get componentData(){return{componentType:Numeric_setting_input,props:{setting:this,withSliderAndSteps:this._sliderWithSteps,bounds:this._min!==void 0&&this._max!==void 0?{min:this._min,max:this._max}:void 0}}}withBounds(min,max){return this._min=min,this._max=max,this}withSlider(steps=1){return this._sliderWithSteps=steps,this}};__name(_NumericExtensionSetting,"NumericExtensionSetting");let NumericExtensionSetting=_NumericExtensionSetting;const _ChoiceExtensionSetting=class _ChoiceExtensionSetting extends SettingWithInput{constructor(){super(...arguments);__publicField(this,"_choices",[])}get componentData(){return{componentType:Choice_setting_input,props:{setting:this,choices:this._choices}}}withChoices(choices){return this._choices=choices,this}};__name(_ChoiceExtensionSetting,"ChoiceExtensionSetting");let ChoiceExtensionSetting=_ChoiceExtensionSetting;var NAMED_TAG="named",NAME_TAG="name",UNMANAGED_TAG="unmanaged",OPTIONAL_TAG="optional",INJECT_TAG="inject",MULTI_INJECT_TAG="multi_inject",TAGGED="inversify:tagged",TAGGED_PROP="inversify:tagged_props",PARAM_TYPES="inversify:paramtypes",DESIGN_PARAM_TYPES="design:paramtypes",POST_CONSTRUCT="post_construct",PRE_DESTROY="pre_destroy";function getNonCustomTagKeys(){return[INJECT_TAG,MULTI_INJECT_TAG,NAME_TAG,UNMANAGED_TAG,NAMED_TAG,OPTIONAL_TAG]}__name(getNonCustomTagKeys,"getNonCustomTagKeys");var NON_CUSTOM_TAG_KEYS=getNonCustomTagKeys(),BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"},BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"},idCounter=0;function id(){return idCounter++}__name(id,"id");var Binding=function(){function Binding2(serviceIdentifier,scope){this.id=id(),this.activated=!1,this.serviceIdentifier=serviceIdentifier,this.scope=scope,this.type=BindingTypeEnum.Invalid,this.constraint=function(request){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.onDeactivation=null,this.dynamicValue=null}return __name(Binding2,"Binding"),Binding2.prototype.clone=function(){var clone=new Binding2(this.serviceIdentifier,this.scope);return clone.activated=clone.scope===BindingScopeEnum.Singleton?this.activated:!1,clone.implementationType=this.implementationType,clone.dynamicValue=this.dynamicValue,clone.scope=this.scope,clone.type=this.type,clone.factory=this.factory,clone.provider=this.provider,clone.constraint=this.constraint,clone.onActivation=this.onActivation,clone.onDeactivation=this.onDeactivation,clone.cache=this.cache,clone},Binding2}(),DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",NULL_ARGUMENT="NULL argument",KEY_NOT_FOUND="Key Not Found",AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",CANNOT_UNBIND="Could not unbind serviceIdentifier:",NOT_REGISTERED="No matching bindings found for serviceIdentifier:",MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:",UNDEFINED_INJECT_ANNOTATION=__name(function(name){return"@inject called with undefined this could mean that the class "+name+" has a circular dependency problem. You can use a LazyServiceIdentifier to  overcome this limitation."},"UNDEFINED_INJECT_ANNOTATION"),CIRCULAR_DEPENDENCY="Circular dependency found:",INVALID_BINDING_TYPE="Invalid binding type:",NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",LAZY_IN_SYNC=__name(function(key){return"You are attempting to construct '"+key+`' in a synchronous way
 but it has asynchronous dependencies.`},"LAZY_IN_SYNC"),INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",ARGUMENTS_LENGTH_MISMATCH=__name(function(){for(var values=[],_i=0;_i<arguments.length;_i++)values[_i]=arguments[_i];return"The number of constructor arguments in the derived class "+(values[0]+" must be >= than the number of constructor arguments of its base class.")},"ARGUMENTS_LENGTH_MISMATCH"),CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE='Invalid Container option. Default scope must be a string ("singleton" or "transient").',CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class",ASYNC_UNBIND_REQUIRED="Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)",POST_CONSTRUCT_ERROR=__name(function(clazz,errorMessage){return"@postConstruct error in class "+clazz+": "+errorMessage},"POST_CONSTRUCT_ERROR"),PRE_DESTROY_ERROR=__name(function(clazz,errorMessage){return"@preDestroy error in class "+clazz+": "+errorMessage},"PRE_DESTROY_ERROR"),ON_DEACTIVATION_ERROR=__name(function(clazz,errorMessage){return"onDeactivation() error in class "+clazz+": "+errorMessage},"ON_DEACTIVATION_ERROR"),CIRCULAR_DEPENDENCY_IN_FACTORY=__name(function(factoryType,serviceIdentifier){return"It looks like there is a circular dependency in one of the '"+factoryType+"' bindings. Please investigate bindings with "+("service identifier '"+serviceIdentifier+"'.")},"CIRCULAR_DEPENDENCY_IN_FACTORY"),STACK_OVERFLOW="Maximum call stack size exceeded",MetadataReader=function(){function MetadataReader2(){}return __name(MetadataReader2,"MetadataReader"),MetadataReader2.prototype.getConstructorMetadata=function(constructorFunc){var compilerGeneratedMetadata=Reflect.getMetadata(PARAM_TYPES,constructorFunc),userGeneratedMetadata=Reflect.getMetadata(TAGGED,constructorFunc);return{compilerGeneratedMetadata,userGeneratedMetadata:userGeneratedMetadata||{}}},MetadataReader2.prototype.getPropertiesMetadata=function(constructorFunc){var userGeneratedMetadata=Reflect.getMetadata(TAGGED_PROP,constructorFunc)||[];return userGeneratedMetadata},MetadataReader2}(),BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};function isStackOverflowExeption(error){return error instanceof RangeError||error.message===STACK_OVERFLOW}__name(isStackOverflowExeption,"isStackOverflowExeption");var tryAndThrowErrorIfStackOverflow=__name(function(fn,errorCallback){try{return fn()}catch(error){throw isStackOverflowExeption(error)&&(error=errorCallback()),error}},"tryAndThrowErrorIfStackOverflow");function getServiceIdentifierAsString(serviceIdentifier){if(typeof serviceIdentifier=="function"){var _serviceIdentifier=serviceIdentifier;return _serviceIdentifier.name}else{if(typeof serviceIdentifier=="symbol")return serviceIdentifier.toString();var _serviceIdentifier=serviceIdentifier;return _serviceIdentifier}}__name(getServiceIdentifierAsString,"getServiceIdentifierAsString");function listRegisteredBindingsForServiceIdentifier(container,serviceIdentifier,getBindings2){var registeredBindingsList="",registeredBindings=getBindings2(container,serviceIdentifier);return registeredBindings.length!==0&&(registeredBindingsList=`
Registered bindings:`,registeredBindings.forEach(function(binding){var name="Object";binding.implementationType!==null&&(name=getFunctionName(binding.implementationType)),registeredBindingsList=registeredBindingsList+`
 `+name,binding.constraint.metaData&&(registeredBindingsList=registeredBindingsList+" - "+binding.constraint.metaData)})),registeredBindingsList}__name(listRegisteredBindingsForServiceIdentifier,"listRegisteredBindingsForServiceIdentifier");function alreadyDependencyChain(request,serviceIdentifier){return request.parentRequest===null?!1:request.parentRequest.serviceIdentifier===serviceIdentifier?!0:alreadyDependencyChain(request.parentRequest,serviceIdentifier)}__name(alreadyDependencyChain,"alreadyDependencyChain");function dependencyChainToString(request){function _createStringArr(req,result){result===void 0&&(result=[]);var serviceIdentifier=getServiceIdentifierAsString(req.serviceIdentifier);return result.push(serviceIdentifier),req.parentRequest!==null?_createStringArr(req.parentRequest,result):result}__name(_createStringArr,"_createStringArr");var stringArr=_createStringArr(request);return stringArr.reverse().join(" --> ")}__name(dependencyChainToString,"dependencyChainToString");function circularDependencyToException(request){request.childRequests.forEach(function(childRequest){if(alreadyDependencyChain(childRequest,childRequest.serviceIdentifier)){var services=dependencyChainToString(childRequest);throw new Error(CIRCULAR_DEPENDENCY+" "+services)}else circularDependencyToException(childRequest)})}__name(circularDependencyToException,"circularDependencyToException");function listMetadataForTarget(serviceIdentifierString,target){if(target.isTagged()||target.isNamed()){var m_1="",namedTag=target.getNamedTag(),otherTags=target.getCustomTags();return namedTag!==null&&(m_1+=namedTag.toString()+`
`),otherTags!==null&&otherTags.forEach(function(tag){m_1+=tag.toString()+`
`})," "+serviceIdentifierString+`
 `+serviceIdentifierString+" - "+m_1}else return" "+serviceIdentifierString}__name(listMetadataForTarget,"listMetadataForTarget");function getFunctionName(func2){if(func2.name)return func2.name;var name_1=func2.toString(),match=name_1.match(/^function\s*([^\s(]+)/);return match?match[1]:"Anonymous function: "+name_1}__name(getFunctionName,"getFunctionName");function getSymbolDescription(symbol){return symbol.toString().slice(7,-1)}__name(getSymbolDescription,"getSymbolDescription");var Context=function(){function Context2(container){this.id=id(),this.container=container}return __name(Context2,"Context"),Context2.prototype.addPlan=function(plan2){this.plan=plan2},Context2.prototype.setCurrentRequest=function(currentRequest){this.currentRequest=currentRequest},Context2}(),Metadata=function(){function Metadata2(key,value){this.key=key,this.value=value}return __name(Metadata2,"Metadata"),Metadata2.prototype.toString=function(){return this.key===NAMED_TAG?"named: "+String(this.value).toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+String(this.value)+" }"},Metadata2}(),Plan=function(){function Plan2(parentContext,rootRequest){this.parentContext=parentContext,this.rootRequest=rootRequest}return __name(Plan2,"Plan"),Plan2}(),LazyServiceIdentifier=function(){function LazyServiceIdentifier2(cb){this._cb=cb}return __name(LazyServiceIdentifier2,"LazyServiceIdentifier"),LazyServiceIdentifier2.prototype.unwrap=function(){return this._cb()},LazyServiceIdentifier2}(),QueryableString=function(){function QueryableString2(str){this.str=str}return __name(QueryableString2,"QueryableString"),QueryableString2.prototype.startsWith=function(searchString){return this.str.indexOf(searchString)===0},QueryableString2.prototype.endsWith=function(searchString){var reverseString="",reverseSearchString=searchString.split("").reverse().join("");return reverseString=this.str.split("").reverse().join(""),this.startsWith.call({str:reverseString},reverseSearchString)},QueryableString2.prototype.contains=function(searchString){return this.str.indexOf(searchString)!==-1},QueryableString2.prototype.equals=function(compareString){return this.str===compareString},QueryableString2.prototype.value=function(){return this.str},QueryableString2}(),Target=function(){function Target2(type,identifier,serviceIdentifier,namedOrTagged){this.id=id(),this.type=type,this.serviceIdentifier=serviceIdentifier;var queryableName=typeof identifier=="symbol"?getSymbolDescription(identifier):identifier;this.name=new QueryableString(queryableName||""),this.identifier=identifier,this.metadata=new Array;var metadataItem=null;typeof namedOrTagged=="string"?metadataItem=new Metadata(NAMED_TAG,namedOrTagged):namedOrTagged instanceof Metadata&&(metadataItem=namedOrTagged),metadataItem!==null&&this.metadata.push(metadataItem)}return __name(Target2,"Target"),Target2.prototype.hasTag=function(key){for(var _i=0,_a81=this.metadata;_i<_a81.length;_i++){var m=_a81[_i];if(m.key===key)return!0}return!1},Target2.prototype.isArray=function(){return this.hasTag(MULTI_INJECT_TAG)},Target2.prototype.matchesArray=function(name){return this.matchesTag(MULTI_INJECT_TAG)(name)},Target2.prototype.isNamed=function(){return this.hasTag(NAMED_TAG)},Target2.prototype.isTagged=function(){return this.metadata.some(function(metadata2){return NON_CUSTOM_TAG_KEYS.every(function(key){return metadata2.key!==key})})},Target2.prototype.isOptional=function(){return this.matchesTag(OPTIONAL_TAG)(!0)},Target2.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(m){return m.key===NAMED_TAG})[0]:null},Target2.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(metadata2){return NON_CUSTOM_TAG_KEYS.every(function(key){return metadata2.key!==key})}):null},Target2.prototype.matchesNamedTag=function(name){return this.matchesTag(NAMED_TAG)(name)},Target2.prototype.matchesTag=function(key){var _this=this;return function(value){for(var _i=0,_a81=_this.metadata;_i<_a81.length;_i++){var m=_a81[_i];if(m.key===key&&m.value===value)return!0}return!1}},Target2}(),__spreadArray$2=function(to,from2,pack){if(pack||arguments.length===2)for(var i=0,l=from2.length,ar;i<l;i++)(ar||!(i in from2))&&(ar||(ar=Array.prototype.slice.call(from2,0,i)),ar[i]=from2[i]);return to.concat(ar||Array.prototype.slice.call(from2))};function getDependencies(metadataReader,func2){var constructorName=getFunctionName(func2);return getTargets(metadataReader,constructorName,func2,!1)}__name(getDependencies,"getDependencies");function getTargets(metadataReader,constructorName,func2,isBaseClass){var metadata2=metadataReader.getConstructorMetadata(func2),serviceIdentifiers=metadata2.compilerGeneratedMetadata;if(serviceIdentifiers===void 0){var msg=MISSING_INJECTABLE_ANNOTATION+" "+constructorName+".";throw new Error(msg)}var constructorArgsMetadata=metadata2.userGeneratedMetadata,keys=Object.keys(constructorArgsMetadata),hasUserDeclaredUnknownInjections=func2.length===0&&keys.length>0,hasOptionalParameters=keys.length>func2.length,iterations=hasUserDeclaredUnknownInjections||hasOptionalParameters?keys.length:func2.length,constructorTargets=getConstructorArgsAsTargets(isBaseClass,constructorName,serviceIdentifiers,constructorArgsMetadata,iterations),propertyTargets=getClassPropsAsTargets(metadataReader,func2,constructorName),targets=__spreadArray$2(__spreadArray$2([],constructorTargets,!0),propertyTargets,!0);return targets}__name(getTargets,"getTargets");function getConstructorArgsAsTarget(index,isBaseClass,constructorName,serviceIdentifiers,constructorArgsMetadata){var targetMetadata=constructorArgsMetadata[index.toString()]||[],metadata2=formatTargetMetadata(targetMetadata),isManaged=metadata2.unmanaged!==!0,serviceIdentifier=serviceIdentifiers[index],injectIdentifier=metadata2.inject||metadata2.multiInject;if(serviceIdentifier=injectIdentifier||serviceIdentifier,serviceIdentifier instanceof LazyServiceIdentifier&&(serviceIdentifier=serviceIdentifier.unwrap()),isManaged){var isObject=serviceIdentifier===Object,isFunction2=serviceIdentifier===Function,isUndefined=serviceIdentifier===void 0,isUnknownType=isObject||isFunction2||isUndefined;if(!isBaseClass&&isUnknownType){var msg=MISSING_INJECT_ANNOTATION+" argument "+index+" in class "+constructorName+".";throw new Error(msg)}var target=new Target(TargetTypeEnum.ConstructorArgument,metadata2.targetName,serviceIdentifier);return target.metadata=targetMetadata,target}return null}__name(getConstructorArgsAsTarget,"getConstructorArgsAsTarget");function getConstructorArgsAsTargets(isBaseClass,constructorName,serviceIdentifiers,constructorArgsMetadata,iterations){for(var targets=[],i=0;i<iterations;i++){var index=i,target=getConstructorArgsAsTarget(index,isBaseClass,constructorName,serviceIdentifiers,constructorArgsMetadata);target!==null&&targets.push(target)}return targets}__name(getConstructorArgsAsTargets,"getConstructorArgsAsTargets");function _getServiceIdentifierForProperty(inject2,multiInject,propertyName,className){var serviceIdentifier=inject2||multiInject;if(serviceIdentifier===void 0){var msg=MISSING_INJECTABLE_ANNOTATION+" for property "+String(propertyName)+" in class "+className+".";throw new Error(msg)}return serviceIdentifier}__name(_getServiceIdentifierForProperty,"_getServiceIdentifierForProperty");function getClassPropsAsTargets(metadataReader,constructorFunc,constructorName){for(var classPropsMetadata=metadataReader.getPropertiesMetadata(constructorFunc),targets=[],symbolKeys=Object.getOwnPropertySymbols(classPropsMetadata),stringKeys=Object.keys(classPropsMetadata),keys=stringKeys.concat(symbolKeys),_i=0,keys_1=keys;_i<keys_1.length;_i++){var key=keys_1[_i],targetMetadata=classPropsMetadata[key],metadata2=formatTargetMetadata(targetMetadata),identifier=metadata2.targetName||key,serviceIdentifier=_getServiceIdentifierForProperty(metadata2.inject,metadata2.multiInject,key,constructorName),target=new Target(TargetTypeEnum.ClassProperty,identifier,serviceIdentifier);target.metadata=targetMetadata,targets.push(target)}var baseConstructor=Object.getPrototypeOf(constructorFunc.prototype).constructor;if(baseConstructor!==Object){var baseTargets=getClassPropsAsTargets(metadataReader,baseConstructor,constructorName);targets=__spreadArray$2(__spreadArray$2([],targets,!0),baseTargets,!0)}return targets}__name(getClassPropsAsTargets,"getClassPropsAsTargets");function getBaseClassDependencyCount(metadataReader,func2){var baseConstructor=Object.getPrototypeOf(func2.prototype).constructor;if(baseConstructor!==Object){var baseConstructorName=getFunctionName(baseConstructor),targets=getTargets(metadataReader,baseConstructorName,baseConstructor,!0),metadata2=targets.map(function(t){return t.metadata.filter(function(m){return m.key===UNMANAGED_TAG})}),unmanagedCount=[].concat.apply([],metadata2).length,dependencyCount=targets.length-unmanagedCount;return dependencyCount>0?dependencyCount:getBaseClassDependencyCount(metadataReader,baseConstructor)}else return 0}__name(getBaseClassDependencyCount,"getBaseClassDependencyCount");function formatTargetMetadata(targetMetadata){var targetMetadataMap={};return targetMetadata.forEach(function(m){targetMetadataMap[m.key.toString()]=m.value}),{inject:targetMetadataMap[INJECT_TAG],multiInject:targetMetadataMap[MULTI_INJECT_TAG],targetName:targetMetadataMap[NAME_TAG],unmanaged:targetMetadataMap[UNMANAGED_TAG]}}__name(formatTargetMetadata,"formatTargetMetadata");var Request=function(){function Request2(serviceIdentifier,parentContext,parentRequest,bindings,target){this.id=id(),this.serviceIdentifier=serviceIdentifier,this.parentContext=parentContext,this.parentRequest=parentRequest,this.target=target,this.childRequests=[],this.bindings=Array.isArray(bindings)?bindings:[bindings],this.requestScope=parentRequest===null?new Map:null}return __name(Request2,"Request"),Request2.prototype.addChildRequest=function(serviceIdentifier,bindings,target){var child=new Request2(serviceIdentifier,this.parentContext,this,bindings,target);return this.childRequests.push(child),child},Request2}();function getBindingDictionary(cntnr){return cntnr._bindingDictionary}__name(getBindingDictionary,"getBindingDictionary");function _createTarget(isMultiInject,targetType,serviceIdentifier,name,key,value){var metadataKey=isMultiInject?MULTI_INJECT_TAG:INJECT_TAG,injectMetadata=new Metadata(metadataKey,serviceIdentifier),target=new Target(targetType,name,serviceIdentifier,injectMetadata);if(key!==void 0){var tagMetadata=new Metadata(key,value);target.metadata.push(tagMetadata)}return target}__name(_createTarget,"_createTarget");function _getActiveBindings(metadataReader,avoidConstraints,context,parentRequest,target){var bindings=getBindings(context.container,target.serviceIdentifier),activeBindings=[];return bindings.length===BindingCount.NoBindingsAvailable&&context.container.options.autoBindInjectable&&typeof target.serviceIdentifier=="function"&&metadataReader.getConstructorMetadata(target.serviceIdentifier).compilerGeneratedMetadata&&(context.container.bind(target.serviceIdentifier).toSelf(),bindings=getBindings(context.container,target.serviceIdentifier)),avoidConstraints?activeBindings=bindings:activeBindings=bindings.filter(function(binding){var request=new Request(binding.serviceIdentifier,context,parentRequest,binding,target);return binding.constraint(request)}),_validateActiveBindingCount(target.serviceIdentifier,activeBindings,target,context.container),activeBindings}__name(_getActiveBindings,"_getActiveBindings");function _validateActiveBindingCount(serviceIdentifier,bindings,target,container){switch(bindings.length){case BindingCount.NoBindingsAvailable:if(target.isOptional())return bindings;var serviceIdentifierString=getServiceIdentifierAsString(serviceIdentifier),msg=NOT_REGISTERED;throw msg+=listMetadataForTarget(serviceIdentifierString,target),msg+=listRegisteredBindingsForServiceIdentifier(container,serviceIdentifierString,getBindings),new Error(msg);case BindingCount.OnlyOneBindingAvailable:return bindings;case BindingCount.MultipleBindingsAvailable:default:if(target.isArray())return bindings;var serviceIdentifierString=getServiceIdentifierAsString(serviceIdentifier),msg=AMBIGUOUS_MATCH+" "+serviceIdentifierString;throw msg+=listRegisteredBindingsForServiceIdentifier(container,serviceIdentifierString,getBindings),new Error(msg)}}__name(_validateActiveBindingCount,"_validateActiveBindingCount");function _createSubRequests(metadataReader,avoidConstraints,serviceIdentifier,context,parentRequest,target){var activeBindings,childRequest;if(parentRequest===null){activeBindings=_getActiveBindings(metadataReader,avoidConstraints,context,null,target),childRequest=new Request(serviceIdentifier,context,null,activeBindings,target);var thePlan=new Plan(context,childRequest);context.addPlan(thePlan)}else activeBindings=_getActiveBindings(metadataReader,avoidConstraints,context,parentRequest,target),childRequest=parentRequest.addChildRequest(target.serviceIdentifier,activeBindings,target);activeBindings.forEach(function(binding){var subChildRequest=null;if(target.isArray())subChildRequest=childRequest.addChildRequest(binding.serviceIdentifier,binding,target);else{if(binding.cache)return;subChildRequest=childRequest}if(binding.type===BindingTypeEnum.Instance&&binding.implementationType!==null){var dependencies=getDependencies(metadataReader,binding.implementationType);if(!context.container.options.skipBaseClassChecks){var baseClassDependencyCount=getBaseClassDependencyCount(metadataReader,binding.implementationType);if(dependencies.length<baseClassDependencyCount){var error=ARGUMENTS_LENGTH_MISMATCH(getFunctionName(binding.implementationType));throw new Error(error)}}dependencies.forEach(function(dependency){_createSubRequests(metadataReader,!1,dependency.serviceIdentifier,context,subChildRequest,dependency)})}})}__name(_createSubRequests,"_createSubRequests");function getBindings(container,serviceIdentifier){var bindings=[],bindingDictionary=getBindingDictionary(container);return bindingDictionary.hasKey(serviceIdentifier)?bindings=bindingDictionary.get(serviceIdentifier):container.parent!==null&&(bindings=getBindings(container.parent,serviceIdentifier)),bindings}__name(getBindings,"getBindings");function plan(metadataReader,container,isMultiInject,targetType,serviceIdentifier,key,value,avoidConstraints){avoidConstraints===void 0&&(avoidConstraints=!1);var context=new Context(container),target=_createTarget(isMultiInject,targetType,serviceIdentifier,"",key,value);try{return _createSubRequests(metadataReader,avoidConstraints,serviceIdentifier,context,null,target),context}catch(error){throw isStackOverflowExeption(error)&&circularDependencyToException(context.plan.rootRequest),error}}__name(plan,"plan");function createMockRequest(container,serviceIdentifier,key,value){var target=new Target(TargetTypeEnum.Variable,"",serviceIdentifier,new Metadata(key,value)),context=new Context(container),request=new Request(serviceIdentifier,context,null,[],target);return request}__name(createMockRequest,"createMockRequest");function isPromise(object){var isObjectOrFunction=typeof object=="object"&&object!==null||typeof object=="function";return isObjectOrFunction&&typeof object.then=="function"}__name(isPromise,"isPromise");function isPromiseOrContainsPromise(object){return isPromise(object)?!0:Array.isArray(object)&&object.some(isPromise)}__name(isPromiseOrContainsPromise,"isPromiseOrContainsPromise");var __awaiter$3=function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve2){resolve2(value)})}return __name(adopt,"adopt"),new(P||(P=Promise))(function(resolve2,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}__name(fulfilled,"fulfilled");function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}__name(rejected,"rejected");function step(result){result.done?resolve2(result.value):adopt(result.value).then(fulfilled,rejected)}__name(step,"step"),step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator$3=function(thisArg,body){var _={label:0,sent:__name(function(){if(t[0]&1)throw t[1];return t[1]},"sent"),trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=op[0]&2?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[op[0]&2,t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}},tryGetFromScope=__name(function(requestScope,binding){return binding.scope===BindingScopeEnum.Singleton&&binding.activated?binding.cache:binding.scope===BindingScopeEnum.Request&&requestScope.has(binding.id)?requestScope.get(binding.id):null},"tryGetFromScope"),saveToScope=__name(function(requestScope,binding,result){binding.scope===BindingScopeEnum.Singleton&&_saveToSingletonScope(binding,result),binding.scope===BindingScopeEnum.Request&&_saveToRequestScope(requestScope,binding,result)},"saveToScope"),_saveToRequestScope=__name(function(requestScope,binding,result){requestScope.has(binding.id)||requestScope.set(binding.id,result)},"_saveToRequestScope"),_saveToSingletonScope=__name(function(binding,result){binding.cache=result,binding.activated=!0,isPromise(result)&&_saveAsyncResultToSingletonScope(binding,result)},"_saveToSingletonScope"),_saveAsyncResultToSingletonScope=__name(function(binding,asyncResult){return __awaiter$3(void 0,void 0,void 0,function(){var result,ex_1;return __generator$3(this,function(_a81){switch(_a81.label){case 0:return _a81.trys.push([0,2,,3]),[4,asyncResult];case 1:return result=_a81.sent(),binding.cache=result,[3,3];case 2:throw ex_1=_a81.sent(),binding.cache=null,binding.activated=!1,ex_1;case 3:return[2]}})})},"_saveAsyncResultToSingletonScope"),FactoryType;(function(FactoryType2){FactoryType2.DynamicValue="toDynamicValue",FactoryType2.Factory="toFactory",FactoryType2.Provider="toProvider"})(FactoryType||(FactoryType={}));var ensureFullyBound=__name(function(binding){var boundValue=null;switch(binding.type){case BindingTypeEnum.ConstantValue:case BindingTypeEnum.Function:boundValue=binding.cache;break;case BindingTypeEnum.Constructor:case BindingTypeEnum.Instance:boundValue=binding.implementationType;break;case BindingTypeEnum.DynamicValue:boundValue=binding.dynamicValue;break;case BindingTypeEnum.Provider:boundValue=binding.provider;break;case BindingTypeEnum.Factory:boundValue=binding.factory;break}if(boundValue===null){var serviceIdentifierAsString=getServiceIdentifierAsString(binding.serviceIdentifier);throw new Error(INVALID_BINDING_TYPE+" "+serviceIdentifierAsString)}},"ensureFullyBound"),getFactoryDetails=__name(function(binding){switch(binding.type){case BindingTypeEnum.Factory:return{factory:binding.factory,factoryType:FactoryType.Factory};case BindingTypeEnum.Provider:return{factory:binding.provider,factoryType:FactoryType.Provider};case BindingTypeEnum.DynamicValue:return{factory:binding.dynamicValue,factoryType:FactoryType.DynamicValue};default:throw new Error("Unexpected factory type "+binding.type)}},"getFactoryDetails"),__assign$1=function(){return __assign$1=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t},__assign$1.apply(this,arguments)},__awaiter$2=function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve2){resolve2(value)})}return __name(adopt,"adopt"),new(P||(P=Promise))(function(resolve2,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}__name(fulfilled,"fulfilled");function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}__name(rejected,"rejected");function step(result){result.done?resolve2(result.value):adopt(result.value).then(fulfilled,rejected)}__name(step,"step"),step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator$2=function(thisArg,body){var _={label:0,sent:__name(function(){if(t[0]&1)throw t[1];return t[1]},"sent"),trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=op[0]&2?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[op[0]&2,t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}},__spreadArray$1=function(to,from2,pack){if(pack||arguments.length===2)for(var i=0,l=from2.length,ar;i<l;i++)(ar||!(i in from2))&&(ar||(ar=Array.prototype.slice.call(from2,0,i)),ar[i]=from2[i]);return to.concat(ar||Array.prototype.slice.call(from2))};function _resolveRequests(childRequests,resolveRequest){return childRequests.reduce(function(resolvedRequests,childRequest){var injection=resolveRequest(childRequest),targetType=childRequest.target.type;return targetType===TargetTypeEnum.ConstructorArgument?resolvedRequests.constructorInjections.push(injection):(resolvedRequests.propertyRequests.push(childRequest),resolvedRequests.propertyInjections.push(injection)),resolvedRequests.isAsync||(resolvedRequests.isAsync=isPromiseOrContainsPromise(injection)),resolvedRequests},{constructorInjections:[],propertyInjections:[],propertyRequests:[],isAsync:!1})}__name(_resolveRequests,"_resolveRequests");function _createInstance(constr,childRequests,resolveRequest){var result;if(childRequests.length>0){var resolved=_resolveRequests(childRequests,resolveRequest),createInstanceWithInjectionsArg=__assign$1(__assign$1({},resolved),{constr});resolved.isAsync?result=createInstanceWithInjectionsAsync(createInstanceWithInjectionsArg):result=createInstanceWithInjections(createInstanceWithInjectionsArg)}else result=new constr;return result}__name(_createInstance,"_createInstance");function createInstanceWithInjections(args){var _a81,instance2=new((_a81=args.constr).bind.apply(_a81,__spreadArray$1([void 0],args.constructorInjections,!1)));return args.propertyRequests.forEach(function(r,index){var property=r.target.identifier,injection=args.propertyInjections[index];(!r.target.isOptional()||injection!==void 0)&&(instance2[property]=injection)}),instance2}__name(createInstanceWithInjections,"createInstanceWithInjections");function createInstanceWithInjectionsAsync(args){return __awaiter$2(this,void 0,void 0,function(){var constructorInjections,propertyInjections;return __generator$2(this,function(_a81){switch(_a81.label){case 0:return[4,possiblyWaitInjections(args.constructorInjections)];case 1:return constructorInjections=_a81.sent(),[4,possiblyWaitInjections(args.propertyInjections)];case 2:return propertyInjections=_a81.sent(),[2,createInstanceWithInjections(__assign$1(__assign$1({},args),{constructorInjections,propertyInjections}))]}})})}__name(createInstanceWithInjectionsAsync,"createInstanceWithInjectionsAsync");function possiblyWaitInjections(possiblePromiseinjections){return __awaiter$2(this,void 0,void 0,function(){var injections,_i,possiblePromiseinjections_1,injection;return __generator$2(this,function(_a81){for(injections=[],_i=0,possiblePromiseinjections_1=possiblePromiseinjections;_i<possiblePromiseinjections_1.length;_i++)injection=possiblePromiseinjections_1[_i],Array.isArray(injection)?injections.push(Promise.all(injection)):injections.push(injection);return[2,Promise.all(injections)]})})}__name(possiblyWaitInjections,"possiblyWaitInjections");function _getInstanceAfterPostConstruct(constr,result){var postConstructResult=_postConstruct(constr,result);return isPromise(postConstructResult)?postConstructResult.then(function(){return result}):result}__name(_getInstanceAfterPostConstruct,"_getInstanceAfterPostConstruct");function _postConstruct(constr,instance2){var _a81,_b;if(Reflect.hasMetadata(POST_CONSTRUCT,constr)){var data=Reflect.getMetadata(POST_CONSTRUCT,constr);try{return(_b=(_a81=instance2)[data.value])===null||_b===void 0?void 0:_b.call(_a81)}catch(e){if(e instanceof Error)throw new Error(POST_CONSTRUCT_ERROR(constr.name,e.message))}}}__name(_postConstruct,"_postConstruct");function _validateInstanceResolution(binding,constr){binding.scope!==BindingScopeEnum.Singleton&&_throwIfHandlingDeactivation(binding,constr)}__name(_validateInstanceResolution,"_validateInstanceResolution");function _throwIfHandlingDeactivation(binding,constr){var scopeErrorMessage="Class cannot be instantiated in "+(binding.scope===BindingScopeEnum.Request?"request":"transient")+" scope.";if(typeof binding.onDeactivation=="function")throw new Error(ON_DEACTIVATION_ERROR(constr.name,scopeErrorMessage));if(Reflect.hasMetadata(PRE_DESTROY,constr))throw new Error(PRE_DESTROY_ERROR(constr.name,scopeErrorMessage))}__name(_throwIfHandlingDeactivation,"_throwIfHandlingDeactivation");function resolveInstance(binding,constr,childRequests,resolveRequest){_validateInstanceResolution(binding,constr);var result=_createInstance(constr,childRequests,resolveRequest);return isPromise(result)?result.then(function(resolvedResult){return _getInstanceAfterPostConstruct(constr,resolvedResult)}):_getInstanceAfterPostConstruct(constr,result)}__name(resolveInstance,"resolveInstance");var __awaiter$1=function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve2){resolve2(value)})}return __name(adopt,"adopt"),new(P||(P=Promise))(function(resolve2,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}__name(fulfilled,"fulfilled");function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}__name(rejected,"rejected");function step(result){result.done?resolve2(result.value):adopt(result.value).then(fulfilled,rejected)}__name(step,"step"),step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator$1=function(thisArg,body){var _={label:0,sent:__name(function(){if(t[0]&1)throw t[1];return t[1]},"sent"),trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=op[0]&2?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[op[0]&2,t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}},_resolveRequest=__name(function(requestScope){return function(request){request.parentContext.setCurrentRequest(request);var bindings=request.bindings,childRequests=request.childRequests,targetIsAnArray=request.target&&request.target.isArray(),targetParentIsNotAnArray=!request.parentRequest||!request.parentRequest.target||!request.target||!request.parentRequest.target.matchesArray(request.target.serviceIdentifier);if(targetIsAnArray&&targetParentIsNotAnArray)return childRequests.map(function(childRequest){var _f=_resolveRequest(requestScope);return _f(childRequest)});if(request.target.isOptional()&&bindings.length===0)return;var binding=bindings[0];return _resolveBinding(requestScope,request,binding)}},"_resolveRequest"),_resolveFactoryFromBinding=__name(function(binding,context){var factoryDetails=getFactoryDetails(binding);return tryAndThrowErrorIfStackOverflow(function(){return factoryDetails.factory.bind(binding)(context)},function(){return new Error(CIRCULAR_DEPENDENCY_IN_FACTORY(factoryDetails.factoryType,context.currentRequest.serviceIdentifier.toString()))})},"_resolveFactoryFromBinding"),_getResolvedFromBinding=__name(function(requestScope,request,binding){var result,childRequests=request.childRequests;switch(ensureFullyBound(binding),binding.type){case BindingTypeEnum.ConstantValue:case BindingTypeEnum.Function:result=binding.cache;break;case BindingTypeEnum.Constructor:result=binding.implementationType;break;case BindingTypeEnum.Instance:result=resolveInstance(binding,binding.implementationType,childRequests,_resolveRequest(requestScope));break;default:result=_resolveFactoryFromBinding(binding,request.parentContext)}return result},"_getResolvedFromBinding"),_resolveInScope=__name(function(requestScope,binding,resolveFromBinding){var result=tryGetFromScope(requestScope,binding);return result!==null||(result=resolveFromBinding(),saveToScope(requestScope,binding,result)),result},"_resolveInScope"),_resolveBinding=__name(function(requestScope,request,binding){return _resolveInScope(requestScope,binding,function(){var result=_getResolvedFromBinding(requestScope,request,binding);return isPromise(result)?result=result.then(function(resolved){return _onActivation(request,binding,resolved)}):result=_onActivation(request,binding,result),result})},"_resolveBinding");function _onActivation(request,binding,resolved){var result=_bindingActivation(request.parentContext,binding,resolved),containersIterator=_getContainersIterator(request.parentContext.container),container,containersIteratorResult=containersIterator.next();do{container=containersIteratorResult.value;var context_1=request.parentContext,serviceIdentifier=request.serviceIdentifier,activationsIterator=_getContainerActivationsForService(container,serviceIdentifier);isPromise(result)?result=_activateContainerAsync(activationsIterator,context_1,result):result=_activateContainer(activationsIterator,context_1,result),containersIteratorResult=containersIterator.next()}while(containersIteratorResult.done!==!0&&!getBindingDictionary(container).hasKey(request.serviceIdentifier));return result}__name(_onActivation,"_onActivation");var _bindingActivation=__name(function(context,binding,previousResult){var result;return typeof binding.onActivation=="function"?result=binding.onActivation(context,previousResult):result=previousResult,result},"_bindingActivation"),_activateContainer=__name(function(activationsIterator,context,result){for(var activation=activationsIterator.next();!activation.done;){if(result=activation.value(context,result),isPromise(result))return _activateContainerAsync(activationsIterator,context,result);activation=activationsIterator.next()}return result},"_activateContainer"),_activateContainerAsync=__name(function(activationsIterator,context,resultPromise){return __awaiter$1(void 0,void 0,void 0,function(){var result,activation;return __generator$1(this,function(_a81){switch(_a81.label){case 0:return[4,resultPromise];case 1:result=_a81.sent(),activation=activationsIterator.next(),_a81.label=2;case 2:return activation.done?[3,4]:[4,activation.value(context,result)];case 3:return result=_a81.sent(),activation=activationsIterator.next(),[3,2];case 4:return[2,result]}})})},"_activateContainerAsync"),_getContainerActivationsForService=__name(function(container,serviceIdentifier){var activations=container._activations;return activations.hasKey(serviceIdentifier)?activations.get(serviceIdentifier).values():[].values()},"_getContainerActivationsForService"),_getContainersIterator=__name(function(container){for(var containersStack=[container],parent=container.parent;parent!==null;)containersStack.push(parent),parent=parent.parent;var getNextContainer=__name(function(){var nextContainer=containersStack.pop();return nextContainer!==void 0?{done:!1,value:nextContainer}:{done:!0,value:void 0}},"getNextContainer"),containersIterator={next:getNextContainer};return containersIterator},"_getContainersIterator");function resolve(context){var _f=_resolveRequest(context.plan.rootRequest.requestScope);return _f(context.plan.rootRequest)}__name(resolve,"resolve");var traverseAncerstors=__name(function(request,constraint){var parent=request.parentRequest;return parent!==null?constraint(parent)?!0:traverseAncerstors(parent,constraint):!1},"traverseAncerstors"),taggedConstraint=__name(function(key){return function(value){var constraint=__name(function(request){return request!==null&&request.target!==null&&request.target.matchesTag(key)(value)},"constraint");return constraint.metaData=new Metadata(key,value),constraint}},"taggedConstraint"),namedConstraint=taggedConstraint(NAMED_TAG),typeConstraint=__name(function(type){return function(request){var binding=null;if(request!==null)if(binding=request.bindings[0],typeof type=="string"){var serviceIdentifier=binding.serviceIdentifier;return serviceIdentifier===type}else{var constructor=request.bindings[0].implementationType;return type===constructor}return!1}},"typeConstraint"),BindingWhenSyntax=function(){function BindingWhenSyntax2(binding){this._binding=binding}return __name(BindingWhenSyntax2,"BindingWhenSyntax"),BindingWhenSyntax2.prototype.when=function(constraint){return this._binding.constraint=constraint,new BindingOnSyntax(this._binding)},BindingWhenSyntax2.prototype.whenTargetNamed=function(name){return this._binding.constraint=namedConstraint(name),new BindingOnSyntax(this._binding)},BindingWhenSyntax2.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(request){if(request===null)return!1;var targetIsDefault=request.target!==null&&!request.target.isNamed()&&!request.target.isTagged();return targetIsDefault},new BindingOnSyntax(this._binding)},BindingWhenSyntax2.prototype.whenTargetTagged=function(tag,value){return this._binding.constraint=taggedConstraint(tag)(value),new BindingOnSyntax(this._binding)},BindingWhenSyntax2.prototype.whenInjectedInto=function(parent){return this._binding.constraint=function(request){return request!==null&&typeConstraint(parent)(request.parentRequest)},new BindingOnSyntax(this._binding)},BindingWhenSyntax2.prototype.whenParentNamed=function(name){return this._binding.constraint=function(request){return request!==null&&namedConstraint(name)(request.parentRequest)},new BindingOnSyntax(this._binding)},BindingWhenSyntax2.prototype.whenParentTagged=function(tag,value){return this._binding.constraint=function(request){return request!==null&&taggedConstraint(tag)(value)(request.parentRequest)},new BindingOnSyntax(this._binding)},BindingWhenSyntax2.prototype.whenAnyAncestorIs=function(ancestor){return this._binding.constraint=function(request){return request!==null&&traverseAncerstors(request,typeConstraint(ancestor))},new BindingOnSyntax(this._binding)},BindingWhenSyntax2.prototype.whenNoAncestorIs=function(ancestor){return this._binding.constraint=function(request){return request!==null&&!traverseAncerstors(request,typeConstraint(ancestor))},new BindingOnSyntax(this._binding)},BindingWhenSyntax2.prototype.whenAnyAncestorNamed=function(name){return this._binding.constraint=function(request){return request!==null&&traverseAncerstors(request,namedConstraint(name))},new BindingOnSyntax(this._binding)},BindingWhenSyntax2.prototype.whenNoAncestorNamed=function(name){return this._binding.constraint=function(request){return request!==null&&!traverseAncerstors(request,namedConstraint(name))},new BindingOnSyntax(this._binding)},BindingWhenSyntax2.prototype.whenAnyAncestorTagged=function(tag,value){return this._binding.constraint=function(request){return request!==null&&traverseAncerstors(request,taggedConstraint(tag)(value))},new BindingOnSyntax(this._binding)},BindingWhenSyntax2.prototype.whenNoAncestorTagged=function(tag,value){return this._binding.constraint=function(request){return request!==null&&!traverseAncerstors(request,taggedConstraint(tag)(value))},new BindingOnSyntax(this._binding)},BindingWhenSyntax2.prototype.whenAnyAncestorMatches=function(constraint){return this._binding.constraint=function(request){return request!==null&&traverseAncerstors(request,constraint)},new BindingOnSyntax(this._binding)},BindingWhenSyntax2.prototype.whenNoAncestorMatches=function(constraint){return this._binding.constraint=function(request){return request!==null&&!traverseAncerstors(request,constraint)},new BindingOnSyntax(this._binding)},BindingWhenSyntax2}(),BindingOnSyntax=function(){function BindingOnSyntax2(binding){this._binding=binding}return __name(BindingOnSyntax2,"BindingOnSyntax"),BindingOnSyntax2.prototype.onActivation=function(handler){return this._binding.onActivation=handler,new BindingWhenSyntax(this._binding)},BindingOnSyntax2.prototype.onDeactivation=function(handler){return this._binding.onDeactivation=handler,new BindingWhenSyntax(this._binding)},BindingOnSyntax2}(),BindingWhenOnSyntax=function(){function BindingWhenOnSyntax2(binding){this._binding=binding,this._bindingWhenSyntax=new BindingWhenSyntax(this._binding),this._bindingOnSyntax=new BindingOnSyntax(this._binding)}return __name(BindingWhenOnSyntax2,"BindingWhenOnSyntax"),BindingWhenOnSyntax2.prototype.when=function(constraint){return this._bindingWhenSyntax.when(constraint)},BindingWhenOnSyntax2.prototype.whenTargetNamed=function(name){return this._bindingWhenSyntax.whenTargetNamed(name)},BindingWhenOnSyntax2.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},BindingWhenOnSyntax2.prototype.whenTargetTagged=function(tag,value){return this._bindingWhenSyntax.whenTargetTagged(tag,value)},BindingWhenOnSyntax2.prototype.whenInjectedInto=function(parent){return this._bindingWhenSyntax.whenInjectedInto(parent)},BindingWhenOnSyntax2.prototype.whenParentNamed=function(name){return this._bindingWhenSyntax.whenParentNamed(name)},BindingWhenOnSyntax2.prototype.whenParentTagged=function(tag,value){return this._bindingWhenSyntax.whenParentTagged(tag,value)},BindingWhenOnSyntax2.prototype.whenAnyAncestorIs=function(ancestor){return this._bindingWhenSyntax.whenAnyAncestorIs(ancestor)},BindingWhenOnSyntax2.prototype.whenNoAncestorIs=function(ancestor){return this._bindingWhenSyntax.whenNoAncestorIs(ancestor)},BindingWhenOnSyntax2.prototype.whenAnyAncestorNamed=function(name){return this._bindingWhenSyntax.whenAnyAncestorNamed(name)},BindingWhenOnSyntax2.prototype.whenAnyAncestorTagged=function(tag,value){return this._bindingWhenSyntax.whenAnyAncestorTagged(tag,value)},BindingWhenOnSyntax2.prototype.whenNoAncestorNamed=function(name){return this._bindingWhenSyntax.whenNoAncestorNamed(name)},BindingWhenOnSyntax2.prototype.whenNoAncestorTagged=function(tag,value){return this._bindingWhenSyntax.whenNoAncestorTagged(tag,value)},BindingWhenOnSyntax2.prototype.whenAnyAncestorMatches=function(constraint){return this._bindingWhenSyntax.whenAnyAncestorMatches(constraint)},BindingWhenOnSyntax2.prototype.whenNoAncestorMatches=function(constraint){return this._bindingWhenSyntax.whenNoAncestorMatches(constraint)},BindingWhenOnSyntax2.prototype.onActivation=function(handler){return this._bindingOnSyntax.onActivation(handler)},BindingWhenOnSyntax2.prototype.onDeactivation=function(handler){return this._bindingOnSyntax.onDeactivation(handler)},BindingWhenOnSyntax2}(),BindingInSyntax=function(){function BindingInSyntax2(binding){this._binding=binding}return __name(BindingInSyntax2,"BindingInSyntax"),BindingInSyntax2.prototype.inRequestScope=function(){return this._binding.scope=BindingScopeEnum.Request,new BindingWhenOnSyntax(this._binding)},BindingInSyntax2.prototype.inSingletonScope=function(){return this._binding.scope=BindingScopeEnum.Singleton,new BindingWhenOnSyntax(this._binding)},BindingInSyntax2.prototype.inTransientScope=function(){return this._binding.scope=BindingScopeEnum.Transient,new BindingWhenOnSyntax(this._binding)},BindingInSyntax2}(),BindingInWhenOnSyntax=function(){function BindingInWhenOnSyntax2(binding){this._binding=binding,this._bindingWhenSyntax=new BindingWhenSyntax(this._binding),this._bindingOnSyntax=new BindingOnSyntax(this._binding),this._bindingInSyntax=new BindingInSyntax(binding)}return __name(BindingInWhenOnSyntax2,"BindingInWhenOnSyntax"),BindingInWhenOnSyntax2.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},BindingInWhenOnSyntax2.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},BindingInWhenOnSyntax2.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},BindingInWhenOnSyntax2.prototype.when=function(constraint){return this._bindingWhenSyntax.when(constraint)},BindingInWhenOnSyntax2.prototype.whenTargetNamed=function(name){return this._bindingWhenSyntax.whenTargetNamed(name)},BindingInWhenOnSyntax2.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},BindingInWhenOnSyntax2.prototype.whenTargetTagged=function(tag,value){return this._bindingWhenSyntax.whenTargetTagged(tag,value)},BindingInWhenOnSyntax2.prototype.whenInjectedInto=function(parent){return this._bindingWhenSyntax.whenInjectedInto(parent)},BindingInWhenOnSyntax2.prototype.whenParentNamed=function(name){return this._bindingWhenSyntax.whenParentNamed(name)},BindingInWhenOnSyntax2.prototype.whenParentTagged=function(tag,value){return this._bindingWhenSyntax.whenParentTagged(tag,value)},BindingInWhenOnSyntax2.prototype.whenAnyAncestorIs=function(ancestor){return this._bindingWhenSyntax.whenAnyAncestorIs(ancestor)},BindingInWhenOnSyntax2.prototype.whenNoAncestorIs=function(ancestor){return this._bindingWhenSyntax.whenNoAncestorIs(ancestor)},BindingInWhenOnSyntax2.prototype.whenAnyAncestorNamed=function(name){return this._bindingWhenSyntax.whenAnyAncestorNamed(name)},BindingInWhenOnSyntax2.prototype.whenAnyAncestorTagged=function(tag,value){return this._bindingWhenSyntax.whenAnyAncestorTagged(tag,value)},BindingInWhenOnSyntax2.prototype.whenNoAncestorNamed=function(name){return this._bindingWhenSyntax.whenNoAncestorNamed(name)},BindingInWhenOnSyntax2.prototype.whenNoAncestorTagged=function(tag,value){return this._bindingWhenSyntax.whenNoAncestorTagged(tag,value)},BindingInWhenOnSyntax2.prototype.whenAnyAncestorMatches=function(constraint){return this._bindingWhenSyntax.whenAnyAncestorMatches(constraint)},BindingInWhenOnSyntax2.prototype.whenNoAncestorMatches=function(constraint){return this._bindingWhenSyntax.whenNoAncestorMatches(constraint)},BindingInWhenOnSyntax2.prototype.onActivation=function(handler){return this._bindingOnSyntax.onActivation(handler)},BindingInWhenOnSyntax2.prototype.onDeactivation=function(handler){return this._bindingOnSyntax.onDeactivation(handler)},BindingInWhenOnSyntax2}(),BindingToSyntax=function(){function BindingToSyntax2(binding){this._binding=binding}return __name(BindingToSyntax2,"BindingToSyntax"),BindingToSyntax2.prototype.to=function(constructor){return this._binding.type=BindingTypeEnum.Instance,this._binding.implementationType=constructor,new BindingInWhenOnSyntax(this._binding)},BindingToSyntax2.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+INVALID_TO_SELF_VALUE);var self2=this._binding.serviceIdentifier;return this.to(self2)},BindingToSyntax2.prototype.toConstantValue=function(value){return this._binding.type=BindingTypeEnum.ConstantValue,this._binding.cache=value,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=BindingScopeEnum.Singleton,new BindingWhenOnSyntax(this._binding)},BindingToSyntax2.prototype.toDynamicValue=function(func2){return this._binding.type=BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=func2,this._binding.implementationType=null,new BindingInWhenOnSyntax(this._binding)},BindingToSyntax2.prototype.toConstructor=function(constructor){return this._binding.type=BindingTypeEnum.Constructor,this._binding.implementationType=constructor,this._binding.scope=BindingScopeEnum.Singleton,new BindingWhenOnSyntax(this._binding)},BindingToSyntax2.prototype.toFactory=function(factory){return this._binding.type=BindingTypeEnum.Factory,this._binding.factory=factory,this._binding.scope=BindingScopeEnum.Singleton,new BindingWhenOnSyntax(this._binding)},BindingToSyntax2.prototype.toFunction=function(func2){if(typeof func2!="function")throw new Error(INVALID_FUNCTION_BINDING);var bindingWhenOnSyntax=this.toConstantValue(func2);return this._binding.type=BindingTypeEnum.Function,this._binding.scope=BindingScopeEnum.Singleton,bindingWhenOnSyntax},BindingToSyntax2.prototype.toAutoFactory=function(serviceIdentifier){return this._binding.type=BindingTypeEnum.Factory,this._binding.factory=function(context){var autofactory=__name(function(){return context.container.get(serviceIdentifier)},"autofactory");return autofactory},this._binding.scope=BindingScopeEnum.Singleton,new BindingWhenOnSyntax(this._binding)},BindingToSyntax2.prototype.toAutoNamedFactory=function(serviceIdentifier){return this._binding.type=BindingTypeEnum.Factory,this._binding.factory=function(context){return function(named){return context.container.getNamed(serviceIdentifier,named)}},new BindingWhenOnSyntax(this._binding)},BindingToSyntax2.prototype.toProvider=function(provider){return this._binding.type=BindingTypeEnum.Provider,this._binding.provider=provider,this._binding.scope=BindingScopeEnum.Singleton,new BindingWhenOnSyntax(this._binding)},BindingToSyntax2.prototype.toService=function(service){this.toDynamicValue(function(context){return context.container.get(service)})},BindingToSyntax2}(),ContainerSnapshot=function(){function ContainerSnapshot2(){}return __name(ContainerSnapshot2,"ContainerSnapshot"),ContainerSnapshot2.of=function(bindings,middleware,activations,deactivations,moduleActivationStore){var snapshot=new ContainerSnapshot2;return snapshot.bindings=bindings,snapshot.middleware=middleware,snapshot.deactivations=deactivations,snapshot.activations=activations,snapshot.moduleActivationStore=moduleActivationStore,snapshot},ContainerSnapshot2}();function isClonable(obj){return typeof obj=="object"&&obj!==null&&"clone"in obj&&typeof obj.clone=="function"}__name(isClonable,"isClonable");var Lookup=function(){function Lookup2(){this._map=new Map}return __name(Lookup2,"Lookup"),Lookup2.prototype.getMap=function(){return this._map},Lookup2.prototype.add=function(serviceIdentifier,value){if(serviceIdentifier==null)throw new Error(NULL_ARGUMENT);if(value==null)throw new Error(NULL_ARGUMENT);var entry=this._map.get(serviceIdentifier);entry!==void 0?entry.push(value):this._map.set(serviceIdentifier,[value])},Lookup2.prototype.get=function(serviceIdentifier){if(serviceIdentifier==null)throw new Error(NULL_ARGUMENT);var entry=this._map.get(serviceIdentifier);if(entry!==void 0)return entry;throw new Error(KEY_NOT_FOUND)},Lookup2.prototype.remove=function(serviceIdentifier){if(serviceIdentifier==null)throw new Error(NULL_ARGUMENT);if(!this._map.delete(serviceIdentifier))throw new Error(KEY_NOT_FOUND)},Lookup2.prototype.removeIntersection=function(lookup){var _this=this;this.traverse(function(serviceIdentifier,value){var lookupActivations=lookup.hasKey(serviceIdentifier)?lookup.get(serviceIdentifier):void 0;if(lookupActivations!==void 0){var filteredValues=value.filter(function(lookupValue){return!lookupActivations.some(function(moduleActivation){return lookupValue===moduleActivation})});_this._setValue(serviceIdentifier,filteredValues)}})},Lookup2.prototype.removeByCondition=function(condition){var _this=this,removals=[];return this._map.forEach(function(entries,key){for(var updatedEntries=[],_i=0,entries_1=entries;_i<entries_1.length;_i++){var entry=entries_1[_i],remove=condition(entry);remove?removals.push(entry):updatedEntries.push(entry)}_this._setValue(key,updatedEntries)}),removals},Lookup2.prototype.hasKey=function(serviceIdentifier){if(serviceIdentifier==null)throw new Error(NULL_ARGUMENT);return this._map.has(serviceIdentifier)},Lookup2.prototype.clone=function(){var copy=new Lookup2;return this._map.forEach(function(value,key){value.forEach(function(b){return copy.add(key,isClonable(b)?b.clone():b)})}),copy},Lookup2.prototype.traverse=function(func2){this._map.forEach(function(value,key){func2(key,value)})},Lookup2.prototype._setValue=function(serviceIdentifier,value){value.length>0?this._map.set(serviceIdentifier,value):this._map.delete(serviceIdentifier)},Lookup2}(),ModuleActivationStore=function(){function ModuleActivationStore2(){this._map=new Map}return __name(ModuleActivationStore2,"ModuleActivationStore"),ModuleActivationStore2.prototype.remove=function(moduleId){if(this._map.has(moduleId)){var handlers=this._map.get(moduleId);return this._map.delete(moduleId),handlers}return this._getEmptyHandlersStore()},ModuleActivationStore2.prototype.addDeactivation=function(moduleId,serviceIdentifier,onDeactivation){this._getModuleActivationHandlers(moduleId).onDeactivations.add(serviceIdentifier,onDeactivation)},ModuleActivationStore2.prototype.addActivation=function(moduleId,serviceIdentifier,onActivation){this._getModuleActivationHandlers(moduleId).onActivations.add(serviceIdentifier,onActivation)},ModuleActivationStore2.prototype.clone=function(){var clone=new ModuleActivationStore2;return this._map.forEach(function(handlersStore,moduleId){clone._map.set(moduleId,{onActivations:handlersStore.onActivations.clone(),onDeactivations:handlersStore.onDeactivations.clone()})}),clone},ModuleActivationStore2.prototype._getModuleActivationHandlers=function(moduleId){var moduleActivationHandlers=this._map.get(moduleId);return moduleActivationHandlers===void 0&&(moduleActivationHandlers=this._getEmptyHandlersStore(),this._map.set(moduleId,moduleActivationHandlers)),moduleActivationHandlers},ModuleActivationStore2.prototype._getEmptyHandlersStore=function(){var handlersStore={onActivations:new Lookup,onDeactivations:new Lookup};return handlersStore},ModuleActivationStore2}(),__assign=function(){return __assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t},__assign.apply(this,arguments)},__awaiter=function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve2){resolve2(value)})}return __name(adopt,"adopt"),new(P||(P=Promise))(function(resolve2,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}__name(fulfilled,"fulfilled");function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}__name(rejected,"rejected");function step(result){result.done?resolve2(result.value):adopt(result.value).then(fulfilled,rejected)}__name(step,"step"),step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=function(thisArg,body){var _={label:0,sent:__name(function(){if(t[0]&1)throw t[1];return t[1]},"sent"),trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol=="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=op[0]&2?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[op[0]&2,t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}},__spreadArray=function(to,from2,pack){if(pack||arguments.length===2)for(var i=0,l=from2.length,ar;i<l;i++)(ar||!(i in from2))&&(ar||(ar=Array.prototype.slice.call(from2,0,i)),ar[i]=from2[i]);return to.concat(ar||Array.prototype.slice.call(from2))},Container=function(){function Container2(containerOptions){var options=containerOptions||{};if(typeof options!="object")throw new Error(""+CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(options.defaultScope===void 0)options.defaultScope=BindingScopeEnum.Transient;else if(options.defaultScope!==BindingScopeEnum.Singleton&&options.defaultScope!==BindingScopeEnum.Transient&&options.defaultScope!==BindingScopeEnum.Request)throw new Error(""+CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(options.autoBindInjectable===void 0)options.autoBindInjectable=!1;else if(typeof options.autoBindInjectable!="boolean")throw new Error(""+CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(options.skipBaseClassChecks===void 0)options.skipBaseClassChecks=!1;else if(typeof options.skipBaseClassChecks!="boolean")throw new Error(""+CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:options.autoBindInjectable,defaultScope:options.defaultScope,skipBaseClassChecks:options.skipBaseClassChecks},this.id=id(),this._bindingDictionary=new Lookup,this._snapshots=[],this._middleware=null,this._activations=new Lookup,this._deactivations=new Lookup,this.parent=null,this._metadataReader=new MetadataReader,this._moduleActivationStore=new ModuleActivationStore}return __name(Container2,"Container"),Container2.merge=function(container1,container2){for(var containers=[],_i=2;_i<arguments.length;_i++)containers[_i-2]=arguments[_i];var container=new Container2,targetContainers=__spreadArray([container1,container2],containers,!0).map(function(targetContainer){return getBindingDictionary(targetContainer)}),bindingDictionary=getBindingDictionary(container);function copyDictionary(origin,destination){origin.traverse(function(_key,value){value.forEach(function(binding){destination.add(binding.serviceIdentifier,binding.clone())})})}return __name(copyDictionary,"copyDictionary"),targetContainers.forEach(function(targetBindingDictionary){copyDictionary(targetBindingDictionary,bindingDictionary)}),container},Container2.prototype.load=function(){for(var modules=[],_i=0;_i<arguments.length;_i++)modules[_i]=arguments[_i];for(var getHelpers=this._getContainerModuleHelpersFactory(),_a81=0,modules_1=modules;_a81<modules_1.length;_a81++){var currentModule=modules_1[_a81],containerModuleHelpers=getHelpers(currentModule.id);currentModule.registry(containerModuleHelpers.bindFunction,containerModuleHelpers.unbindFunction,containerModuleHelpers.isboundFunction,containerModuleHelpers.rebindFunction,containerModuleHelpers.unbindAsyncFunction,containerModuleHelpers.onActivationFunction,containerModuleHelpers.onDeactivationFunction)}},Container2.prototype.loadAsync=function(){for(var modules=[],_i=0;_i<arguments.length;_i++)modules[_i]=arguments[_i];return __awaiter(this,void 0,void 0,function(){var getHelpers,_a81,modules_2,currentModule,containerModuleHelpers;return __generator(this,function(_b){switch(_b.label){case 0:getHelpers=this._getContainerModuleHelpersFactory(),_a81=0,modules_2=modules,_b.label=1;case 1:return _a81<modules_2.length?(currentModule=modules_2[_a81],containerModuleHelpers=getHelpers(currentModule.id),[4,currentModule.registry(containerModuleHelpers.bindFunction,containerModuleHelpers.unbindFunction,containerModuleHelpers.isboundFunction,containerModuleHelpers.rebindFunction,containerModuleHelpers.unbindAsyncFunction,containerModuleHelpers.onActivationFunction,containerModuleHelpers.onDeactivationFunction)]):[3,4];case 2:_b.sent(),_b.label=3;case 3:return _a81++,[3,1];case 4:return[2]}})})},Container2.prototype.unload=function(){for(var _this=this,modules=[],_i=0;_i<arguments.length;_i++)modules[_i]=arguments[_i];modules.forEach(function(module){var deactivations=_this._removeModuleBindings(module.id);_this._deactivateSingletons(deactivations),_this._removeModuleHandlers(module.id)})},Container2.prototype.unloadAsync=function(){for(var modules=[],_i=0;_i<arguments.length;_i++)modules[_i]=arguments[_i];return __awaiter(this,void 0,void 0,function(){var _a81,modules_3,module_1,deactivations;return __generator(this,function(_b){switch(_b.label){case 0:_a81=0,modules_3=modules,_b.label=1;case 1:return _a81<modules_3.length?(module_1=modules_3[_a81],deactivations=this._removeModuleBindings(module_1.id),[4,this._deactivateSingletonsAsync(deactivations)]):[3,4];case 2:_b.sent(),this._removeModuleHandlers(module_1.id),_b.label=3;case 3:return _a81++,[3,1];case 4:return[2]}})})},Container2.prototype.bind=function(serviceIdentifier){var scope=this.options.defaultScope||BindingScopeEnum.Transient,binding=new Binding(serviceIdentifier,scope);return this._bindingDictionary.add(serviceIdentifier,binding),new BindingToSyntax(binding)},Container2.prototype.rebind=function(serviceIdentifier){return this.unbind(serviceIdentifier),this.bind(serviceIdentifier)},Container2.prototype.rebindAsync=function(serviceIdentifier){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a81){switch(_a81.label){case 0:return[4,this.unbindAsync(serviceIdentifier)];case 1:return _a81.sent(),[2,this.bind(serviceIdentifier)]}})})},Container2.prototype.unbind=function(serviceIdentifier){if(this._bindingDictionary.hasKey(serviceIdentifier)){var bindings=this._bindingDictionary.get(serviceIdentifier);this._deactivateSingletons(bindings)}this._removeServiceFromDictionary(serviceIdentifier)},Container2.prototype.unbindAsync=function(serviceIdentifier){return __awaiter(this,void 0,void 0,function(){var bindings;return __generator(this,function(_a81){switch(_a81.label){case 0:return this._bindingDictionary.hasKey(serviceIdentifier)?(bindings=this._bindingDictionary.get(serviceIdentifier),[4,this._deactivateSingletonsAsync(bindings)]):[3,2];case 1:_a81.sent(),_a81.label=2;case 2:return this._removeServiceFromDictionary(serviceIdentifier),[2]}})})},Container2.prototype.unbindAll=function(){var _this=this;this._bindingDictionary.traverse(function(_key,value){_this._deactivateSingletons(value)}),this._bindingDictionary=new Lookup},Container2.prototype.unbindAllAsync=function(){return __awaiter(this,void 0,void 0,function(){var promises,_this=this;return __generator(this,function(_a81){switch(_a81.label){case 0:return promises=[],this._bindingDictionary.traverse(function(_key,value){promises.push(_this._deactivateSingletonsAsync(value))}),[4,Promise.all(promises)];case 1:return _a81.sent(),this._bindingDictionary=new Lookup,[2]}})})},Container2.prototype.onActivation=function(serviceIdentifier,onActivation){this._activations.add(serviceIdentifier,onActivation)},Container2.prototype.onDeactivation=function(serviceIdentifier,onDeactivation){this._deactivations.add(serviceIdentifier,onDeactivation)},Container2.prototype.isBound=function(serviceIdentifier){var bound=this._bindingDictionary.hasKey(serviceIdentifier);return!bound&&this.parent&&(bound=this.parent.isBound(serviceIdentifier)),bound},Container2.prototype.isCurrentBound=function(serviceIdentifier){return this._bindingDictionary.hasKey(serviceIdentifier)},Container2.prototype.isBoundNamed=function(serviceIdentifier,named){return this.isBoundTagged(serviceIdentifier,NAMED_TAG,named)},Container2.prototype.isBoundTagged=function(serviceIdentifier,key,value){var bound=!1;if(this._bindingDictionary.hasKey(serviceIdentifier)){var bindings=this._bindingDictionary.get(serviceIdentifier),request_1=createMockRequest(this,serviceIdentifier,key,value);bound=bindings.some(function(b){return b.constraint(request_1)})}return!bound&&this.parent&&(bound=this.parent.isBoundTagged(serviceIdentifier,key,value)),bound},Container2.prototype.snapshot=function(){this._snapshots.push(ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware,this._activations.clone(),this._deactivations.clone(),this._moduleActivationStore.clone()))},Container2.prototype.restore=function(){var snapshot=this._snapshots.pop();if(snapshot===void 0)throw new Error(NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=snapshot.bindings,this._activations=snapshot.activations,this._deactivations=snapshot.deactivations,this._middleware=snapshot.middleware,this._moduleActivationStore=snapshot.moduleActivationStore},Container2.prototype.createChild=function(containerOptions){var child=new Container2(containerOptions||this.options);return child.parent=this,child},Container2.prototype.applyMiddleware=function(){for(var middlewares=[],_i=0;_i<arguments.length;_i++)middlewares[_i]=arguments[_i];var initial=this._middleware?this._middleware:this._planAndResolve();this._middleware=middlewares.reduce(function(prev,curr){return curr(prev)},initial)},Container2.prototype.applyCustomMetadataReader=function(metadataReader){this._metadataReader=metadataReader},Container2.prototype.get=function(serviceIdentifier){var getArgs=this._getNotAllArgs(serviceIdentifier,!1);return this._getButThrowIfAsync(getArgs)},Container2.prototype.getAsync=function(serviceIdentifier){return __awaiter(this,void 0,void 0,function(){var getArgs;return __generator(this,function(_a81){return getArgs=this._getNotAllArgs(serviceIdentifier,!1),[2,this._get(getArgs)]})})},Container2.prototype.getTagged=function(serviceIdentifier,key,value){var getArgs=this._getNotAllArgs(serviceIdentifier,!1,key,value);return this._getButThrowIfAsync(getArgs)},Container2.prototype.getTaggedAsync=function(serviceIdentifier,key,value){return __awaiter(this,void 0,void 0,function(){var getArgs;return __generator(this,function(_a81){return getArgs=this._getNotAllArgs(serviceIdentifier,!1,key,value),[2,this._get(getArgs)]})})},Container2.prototype.getNamed=function(serviceIdentifier,named){return this.getTagged(serviceIdentifier,NAMED_TAG,named)},Container2.prototype.getNamedAsync=function(serviceIdentifier,named){return this.getTaggedAsync(serviceIdentifier,NAMED_TAG,named)},Container2.prototype.getAll=function(serviceIdentifier){var getArgs=this._getAllArgs(serviceIdentifier);return this._getButThrowIfAsync(getArgs)},Container2.prototype.getAllAsync=function(serviceIdentifier){var getArgs=this._getAllArgs(serviceIdentifier);return this._getAll(getArgs)},Container2.prototype.getAllTagged=function(serviceIdentifier,key,value){var getArgs=this._getNotAllArgs(serviceIdentifier,!0,key,value);return this._getButThrowIfAsync(getArgs)},Container2.prototype.getAllTaggedAsync=function(serviceIdentifier,key,value){var getArgs=this._getNotAllArgs(serviceIdentifier,!0,key,value);return this._getAll(getArgs)},Container2.prototype.getAllNamed=function(serviceIdentifier,named){return this.getAllTagged(serviceIdentifier,NAMED_TAG,named)},Container2.prototype.getAllNamedAsync=function(serviceIdentifier,named){return this.getAllTaggedAsync(serviceIdentifier,NAMED_TAG,named)},Container2.prototype.resolve=function(constructorFunction){var isBound=this.isBound(constructorFunction);isBound||this.bind(constructorFunction).toSelf();var resolved=this.get(constructorFunction);return isBound||this.unbind(constructorFunction),resolved},Container2.prototype._preDestroy=function(constructor,instance2){var _a81,_b;if(Reflect.hasMetadata(PRE_DESTROY,constructor)){var data=Reflect.getMetadata(PRE_DESTROY,constructor);return(_b=(_a81=instance2)[data.value])===null||_b===void 0?void 0:_b.call(_a81)}},Container2.prototype._removeModuleHandlers=function(moduleId){var moduleActivationsHandlers=this._moduleActivationStore.remove(moduleId);this._activations.removeIntersection(moduleActivationsHandlers.onActivations),this._deactivations.removeIntersection(moduleActivationsHandlers.onDeactivations)},Container2.prototype._removeModuleBindings=function(moduleId){return this._bindingDictionary.removeByCondition(function(binding){return binding.moduleId===moduleId})},Container2.prototype._deactivate=function(binding,instance2){var _this=this,constructor=Object.getPrototypeOf(instance2).constructor;try{if(this._deactivations.hasKey(binding.serviceIdentifier)){var result=this._deactivateContainer(instance2,this._deactivations.get(binding.serviceIdentifier).values());if(isPromise(result))return this._handleDeactivationError(result.then(function(){return _this._propagateContainerDeactivationThenBindingAndPreDestroyAsync(binding,instance2,constructor)}),constructor)}var propagateDeactivationResult=this._propagateContainerDeactivationThenBindingAndPreDestroy(binding,instance2,constructor);if(isPromise(propagateDeactivationResult))return this._handleDeactivationError(propagateDeactivationResult,constructor)}catch(ex){if(ex instanceof Error)throw new Error(ON_DEACTIVATION_ERROR(constructor.name,ex.message))}},Container2.prototype._handleDeactivationError=function(asyncResult,constructor){return __awaiter(this,void 0,void 0,function(){var ex_1;return __generator(this,function(_a81){switch(_a81.label){case 0:return _a81.trys.push([0,2,,3]),[4,asyncResult];case 1:return _a81.sent(),[3,3];case 2:if(ex_1=_a81.sent(),ex_1 instanceof Error)throw new Error(ON_DEACTIVATION_ERROR(constructor.name,ex_1.message));return[3,3];case 3:return[2]}})})},Container2.prototype._deactivateContainer=function(instance2,deactivationsIterator){for(var _this=this,deactivation=deactivationsIterator.next();deactivation.value;){var result=deactivation.value(instance2);if(isPromise(result))return result.then(function(){return _this._deactivateContainerAsync(instance2,deactivationsIterator)});deactivation=deactivationsIterator.next()}},Container2.prototype._deactivateContainerAsync=function(instance2,deactivationsIterator){return __awaiter(this,void 0,void 0,function(){var deactivation;return __generator(this,function(_a81){switch(_a81.label){case 0:deactivation=deactivationsIterator.next(),_a81.label=1;case 1:return deactivation.value?[4,deactivation.value(instance2)]:[3,3];case 2:return _a81.sent(),deactivation=deactivationsIterator.next(),[3,1];case 3:return[2]}})})},Container2.prototype._getContainerModuleHelpersFactory=function(){var _this=this,setModuleId=__name(function(bindingToSyntax,moduleId){bindingToSyntax._binding.moduleId=moduleId},"setModuleId"),getBindFunction=__name(function(moduleId){return function(serviceIdentifier){var bindingToSyntax=_this.bind(serviceIdentifier);return setModuleId(bindingToSyntax,moduleId),bindingToSyntax}},"getBindFunction"),getUnbindFunction=__name(function(){return function(serviceIdentifier){return _this.unbind(serviceIdentifier)}},"getUnbindFunction"),getUnbindAsyncFunction=__name(function(){return function(serviceIdentifier){return _this.unbindAsync(serviceIdentifier)}},"getUnbindAsyncFunction"),getIsboundFunction=__name(function(){return function(serviceIdentifier){return _this.isBound(serviceIdentifier)}},"getIsboundFunction"),getRebindFunction=__name(function(moduleId){return function(serviceIdentifier){var bindingToSyntax=_this.rebind(serviceIdentifier);return setModuleId(bindingToSyntax,moduleId),bindingToSyntax}},"getRebindFunction"),getOnActivationFunction=__name(function(moduleId){return function(serviceIdentifier,onActivation){_this._moduleActivationStore.addActivation(moduleId,serviceIdentifier,onActivation),_this.onActivation(serviceIdentifier,onActivation)}},"getOnActivationFunction"),getOnDeactivationFunction=__name(function(moduleId){return function(serviceIdentifier,onDeactivation){_this._moduleActivationStore.addDeactivation(moduleId,serviceIdentifier,onDeactivation),_this.onDeactivation(serviceIdentifier,onDeactivation)}},"getOnDeactivationFunction");return function(mId){return{bindFunction:getBindFunction(mId),isboundFunction:getIsboundFunction(),onActivationFunction:getOnActivationFunction(mId),onDeactivationFunction:getOnDeactivationFunction(mId),rebindFunction:getRebindFunction(mId),unbindFunction:getUnbindFunction(),unbindAsyncFunction:getUnbindAsyncFunction()}}},Container2.prototype._getAll=function(getArgs){return Promise.all(this._get(getArgs))},Container2.prototype._get=function(getArgs){var planAndResolveArgs=__assign(__assign({},getArgs),{contextInterceptor:__name(function(context){return context},"contextInterceptor"),targetType:TargetTypeEnum.Variable});if(this._middleware){var middlewareResult=this._middleware(planAndResolveArgs);if(middlewareResult==null)throw new Error(INVALID_MIDDLEWARE_RETURN);return middlewareResult}return this._planAndResolve()(planAndResolveArgs)},Container2.prototype._getButThrowIfAsync=function(getArgs){var result=this._get(getArgs);if(isPromiseOrContainsPromise(result))throw new Error(LAZY_IN_SYNC(getArgs.serviceIdentifier));return result},Container2.prototype._getAllArgs=function(serviceIdentifier){var getAllArgs={avoidConstraints:!0,isMultiInject:!0,serviceIdentifier};return getAllArgs},Container2.prototype._getNotAllArgs=function(serviceIdentifier,isMultiInject,key,value){var getNotAllArgs={avoidConstraints:!1,isMultiInject,serviceIdentifier,key,value};return getNotAllArgs},Container2.prototype._planAndResolve=function(){var _this=this;return function(args){var context=plan(_this._metadataReader,_this,args.isMultiInject,args.targetType,args.serviceIdentifier,args.key,args.value,args.avoidConstraints);context=args.contextInterceptor(context);var result=resolve(context);return result}},Container2.prototype._deactivateIfSingleton=function(binding){var _this=this;if(binding.activated)return isPromise(binding.cache)?binding.cache.then(function(resolved){return _this._deactivate(binding,resolved)}):this._deactivate(binding,binding.cache)},Container2.prototype._deactivateSingletons=function(bindings){for(var _i=0,bindings_1=bindings;_i<bindings_1.length;_i++){var binding=bindings_1[_i],result=this._deactivateIfSingleton(binding);if(isPromise(result))throw new Error(ASYNC_UNBIND_REQUIRED)}},Container2.prototype._deactivateSingletonsAsync=function(bindings){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a81){switch(_a81.label){case 0:return[4,Promise.all(bindings.map(function(b){return _this._deactivateIfSingleton(b)}))];case 1:return _a81.sent(),[2]}})})},Container2.prototype._propagateContainerDeactivationThenBindingAndPreDestroy=function(binding,instance2,constructor){return this.parent?this._deactivate.bind(this.parent)(binding,instance2):this._bindingDeactivationAndPreDestroy(binding,instance2,constructor)},Container2.prototype._propagateContainerDeactivationThenBindingAndPreDestroyAsync=function(binding,instance2,constructor){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a81){switch(_a81.label){case 0:return this.parent?[4,this._deactivate.bind(this.parent)(binding,instance2)]:[3,2];case 1:return _a81.sent(),[3,4];case 2:return[4,this._bindingDeactivationAndPreDestroyAsync(binding,instance2,constructor)];case 3:_a81.sent(),_a81.label=4;case 4:return[2]}})})},Container2.prototype._removeServiceFromDictionary=function(serviceIdentifier){try{this._bindingDictionary.remove(serviceIdentifier)}catch{throw new Error(CANNOT_UNBIND+" "+getServiceIdentifierAsString(serviceIdentifier))}},Container2.prototype._bindingDeactivationAndPreDestroy=function(binding,instance2,constructor){var _this=this;if(typeof binding.onDeactivation=="function"){var result=binding.onDeactivation(instance2);if(isPromise(result))return result.then(function(){return _this._preDestroy(constructor,instance2)})}return this._preDestroy(constructor,instance2)},Container2.prototype._bindingDeactivationAndPreDestroyAsync=function(binding,instance2,constructor){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a81){switch(_a81.label){case 0:return typeof binding.onDeactivation!="function"?[3,2]:[4,binding.onDeactivation(instance2)];case 1:_a81.sent(),_a81.label=2;case 2:return[4,this._preDestroy(constructor,instance2)];case 3:return _a81.sent(),[2]}})})},Container2}();function getFirstArrayDuplicate(array){for(var seenValues=new Set,_i=0,array_1=array;_i<array_1.length;_i++){var entry=array_1[_i];if(seenValues.has(entry))return entry;seenValues.add(entry)}}__name(getFirstArrayDuplicate,"getFirstArrayDuplicate");function targetIsConstructorFunction(target){return target.prototype!==void 0}__name(targetIsConstructorFunction,"targetIsConstructorFunction");function _throwIfMethodParameter(parameterName){if(parameterName!==void 0)throw new Error(INVALID_DECORATOR_OPERATION)}__name(_throwIfMethodParameter,"_throwIfMethodParameter");function tagParameter(annotationTarget,parameterName,parameterIndex,metadata2){_throwIfMethodParameter(parameterName),_tagParameterOrProperty(TAGGED,annotationTarget,parameterIndex.toString(),metadata2)}__name(tagParameter,"tagParameter");function tagProperty(annotationTarget,propertyName,metadata2){if(targetIsConstructorFunction(annotationTarget))throw new Error(INVALID_DECORATOR_OPERATION);_tagParameterOrProperty(TAGGED_PROP,annotationTarget.constructor,propertyName,metadata2)}__name(tagProperty,"tagProperty");function _ensureNoMetadataKeyDuplicates(metadata2){var metadatas=[];if(Array.isArray(metadata2)){metadatas=metadata2;var duplicate=getFirstArrayDuplicate(metadatas.map(function(md){return md.key}));if(duplicate!==void 0)throw new Error(DUPLICATED_METADATA+" "+duplicate.toString())}else metadatas=[metadata2];return metadatas}__name(_ensureNoMetadataKeyDuplicates,"_ensureNoMetadataKeyDuplicates");function _tagParameterOrProperty(metadataKey,annotationTarget,key,metadata2){var metadatas=_ensureNoMetadataKeyDuplicates(metadata2),paramsOrPropertiesMetadata={};Reflect.hasOwnMetadata(metadataKey,annotationTarget)&&(paramsOrPropertiesMetadata=Reflect.getMetadata(metadataKey,annotationTarget));var paramOrPropertyMetadata=paramsOrPropertiesMetadata[key];if(paramOrPropertyMetadata===void 0)paramOrPropertyMetadata=[];else for(var _loop_1=__name(function(m2){if(metadatas.some(function(md){return md.key===m2.key}))throw new Error(DUPLICATED_METADATA+" "+m2.key.toString())},"_loop_1"),_i=0,paramOrPropertyMetadata_1=paramOrPropertyMetadata;_i<paramOrPropertyMetadata_1.length;_i++){var m=paramOrPropertyMetadata_1[_i];_loop_1(m)}paramOrPropertyMetadata.push.apply(paramOrPropertyMetadata,metadatas),paramsOrPropertiesMetadata[key]=paramOrPropertyMetadata,Reflect.defineMetadata(metadataKey,paramsOrPropertiesMetadata,annotationTarget)}__name(_tagParameterOrProperty,"_tagParameterOrProperty");function createTaggedDecorator(metadata2){return function(target,targetKey,indexOrPropertyDescriptor){typeof indexOrPropertyDescriptor=="number"?tagParameter(target,targetKey,indexOrPropertyDescriptor,metadata2):tagProperty(target,targetKey,metadata2)}}__name(createTaggedDecorator,"createTaggedDecorator");function injectable(){return function(target){if(Reflect.hasOwnMetadata(PARAM_TYPES,target))throw new Error(DUPLICATED_INJECTABLE_DECORATOR);var types=Reflect.getMetadata(DESIGN_PARAM_TYPES,target)||[];return Reflect.defineMetadata(PARAM_TYPES,types,target),target}}__name(injectable,"injectable");function injectBase(metadataKey){return function(serviceIdentifier){return function(target,targetKey,indexOrPropertyDescriptor){if(serviceIdentifier===void 0){var className=typeof target=="function"?target.name:target.constructor.name;throw new Error(UNDEFINED_INJECT_ANNOTATION(className))}return createTaggedDecorator(new Metadata(metadataKey,serviceIdentifier))(target,targetKey,indexOrPropertyDescriptor)}}}__name(injectBase,"injectBase");var inject=injectBase(INJECT_TAG);function propertyEventDecorator(eventKey,errorMessage){return function(){return function(target,propertyKey){var metadata2=new Metadata(eventKey,propertyKey);if(Reflect.hasOwnMetadata(eventKey,target.constructor))throw new Error(errorMessage);Reflect.defineMetadata(eventKey,metadata2,target.constructor)}}}__name(propertyEventDecorator,"propertyEventDecorator");var postConstruct=propertyEventDecorator(POST_CONSTRUCT,MULTIPLE_POST_CONSTRUCT_METHODS),__defProp$1N=Object.defineProperty,__getOwnPropDesc$W=Object.getOwnPropertyDescriptor,__defNormalProp2=__name((obj,key,value)=>key in obj?__defProp$1N(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,"__defNormalProp"),__decorateClass$1N=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$W(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1N(target,key,result),result},"__decorateClass$1N"),__publicField2=__name((obj,key,value)=>__defNormalProp2(obj,typeof key!="symbol"?key+"":key,value),"__publicField"),_a;let LoggingService=(_a=class{constructor(){__publicField(this,"_prefix","skribbltypo");__publicField(this,"_printEnabledSetting",new BooleanExtensionSetting("logging.printLogEnabled",!0).withName("Print Logs").withDescription("Print extension event logs to the browser console"));__publicField(this,"_loggers",[]);__publicField(this,"_logLevelSettings",new Map);__publicField(this,"_events$",new Subject$1);__publicField(this,"_recordedEvents",[]);this._events$.subscribe(event=>{this.printEvent(event),this._recordedEvents.push(event)})}trackLoggerInstance(logger){const setting=new ExtensionSetting(`logging.logLevel.${logger.boundTo}`,LoggingService.defaultLogLevel).withName(`Log level for ${logger.boundTo}`).withDescription(`The minimum log level filter for the logger bound to ${logger.boundTo}`);setting.changes$.subscribe(level=>logger.level=level),this._logLevelSettings.set(logger,setting),this._loggers.push(logger),logger.events$.pipe(withLatestFrom(this._printEnabledSetting.changes$)).subscribe(([event,printEnabled])=>{printEnabled&&this._events$.next(event)})}getTimestamp(date){return`${date.getHours()}:${date.getMinutes()}:${date.getSeconds()}.${date.getMilliseconds()}`}getLevelString(level){switch(level){case"debug":return"DEB ";case"info":return"INFO";case"warn":return"WARN";case"error":return"ERR "}}printEvent(event){console.log(`%c ${this.getTimestamp(event.date)} %c[${this._prefix}] [${this.getLevelString(event.logLevel)}]  (${event.bindingName})`,LoggingService.styles.date,LoggingService.styles[event.logLevel],event.message,...event.data)}get recordedEvents(){return this._recordedEvents}get loggers(){return this._loggers}get printEnabledSetting(){return this._printEnabledSetting}getLogLevelSetting(logger){const setting=this._logLevelSettings.get(logger);if(!setting)throw new Error(`Logger settings for ${logger.boundTo} not found`);return setting.asFrozen}},__name(_a,"LoggingService"),_a);__publicField2(LoggingService,"defaultLogLevel","debug");__publicField2(LoggingService,"styles",{debug:"color: lightGray; font-weight: bold;",info:"color: lightBlue; font-weight: bold;",warn:"color: orange; font-weight: bold;",error:"color: red; font-weight: bold;",date:"color: darkGrey; font-weight: light;"});LoggingService=__decorateClass$1N([injectable()],LoggingService);const _ApplicationEvent=class _ApplicationEvent{};__name(_ApplicationEvent,"ApplicationEvent");let ApplicationEvent=_ApplicationEvent;const loggerFactory=Symbol("loggerFactory");var __defProp$1M=Object.defineProperty,__getOwnPropDesc$V=Object.getOwnPropertyDescriptor,__decorateClass$1M=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$V(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1M(target,key,result),result},"__decorateClass$1M"),__decorateParam$s=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$s"),_a2;let EventsService=(_a2=class{constructor(loggerFactory2){__publicField(this,"_logger");__publicField(this,"_events$",new Subject$1);this._logger=loggerFactory2(this)}get events$(){return this._events$.asObservable()}publishEvent(event){this._events$.next(event)}},__name(_a2,"EventsService"),_a2);EventsService=__decorateClass$1M([injectable(),__decorateParam$s(0,inject(loggerFactory))],EventsService);var __defProp$1L=Object.defineProperty,__getOwnPropDesc$U=Object.getOwnPropertyDescriptor,__decorateClass$1L=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$U(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1L(target,key,result),result},"__decorateClass$1L"),__decorateParam$r=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$r"),_a3;let EventProcessor=(_a3=class{constructor(loggerFactory2,_eventsService){__publicField(this,"_logger");this._eventsService=_eventsService,this._logger=loggerFactory2(this)}start(){this._logger.info("Starting event processor");const events=this.streamEvents();events instanceof Promise?events.then(stream=>this.publishEvents(stream)):this.publishEvents(events)}publishEvents(events$){events$.subscribe(event=>{this._eventsService.publishEvent(event)})}isProcessorEvent(event){return event instanceof this.eventType}},__name(_a3,"EventProcessor"),_a3);__decorateClass$1L([postConstruct()],EventProcessor.prototype,"start",1);EventProcessor=__decorateClass$1L([injectable(),__decorateParam$r(0,inject(loggerFactory)),__decorateParam$r(1,inject(EventsService))],EventProcessor);var __defProp$1K=Object.defineProperty,__getOwnPropDesc$T=Object.getOwnPropertyDescriptor,__decorateClass$1K=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$T(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1K(target,key,result),result},"__decorateClass$1K"),__decorateParam$q=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$q"),_a4;let EventListener=(_a4=class{constructor(_eventsService,loggerFactory2){__publicField(this,"_events$");__publicField(this,"_logger");this._eventsService=_eventsService,this._logger=loggerFactory2(this),this._events$=_eventsService.events$.pipe(filter(event=>this._processor.isProcessorEvent(event)))}get events$(){return this._events$}},__name(_a4,"EventListener"),_a4);EventListener=__decorateClass$1K([injectable(),__decorateParam$q(0,inject(EventsService)),__decorateParam$q(1,inject(loggerFactory))],EventListener);var __defProp$1J=Object.defineProperty,__getOwnPropDesc$S=Object.getOwnPropertyDescriptor,__decorateClass$1J=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$S(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1J(target,key,result),result},"__decorateClass$1J");const _CanvasClearedEvent=class _CanvasClearedEvent extends ApplicationEvent{constructor(data){super(),this.data=data}};__name(_CanvasClearedEvent,"CanvasClearedEvent");let CanvasClearedEvent=_CanvasClearedEvent;var _a5;let CanvasClearedEventProcessor=(_a5=class extends EventProcessor{constructor(){super(...arguments);__publicField(this,"eventType",CanvasClearedEvent)}async streamEvents(){const events=new Subject$1;return document.addEventListener("logCanvasClear",event=>{const data=event.detail;events.next(new CanvasClearedEvent(data))}),events}},__name(_a5,"CanvasClearedEventProcessor"),_a5);CanvasClearedEventProcessor=__decorateClass$1J([injectable()],CanvasClearedEventProcessor);var _a6;let CanvasClearedEventListener=(_a6=class extends EventListener{constructor(){super(...arguments);__publicField(this,"_processor")}},__name(_a6,"CanvasClearedEventListener"),_a6);__decorateClass$1J([inject(CanvasClearedEventProcessor)],CanvasClearedEventListener.prototype,"_processor",2);CanvasClearedEventListener=__decorateClass$1J([injectable()],CanvasClearedEventListener);const canvasClearedEventRegistration={listenerType:CanvasClearedEventListener,processorType:CanvasClearedEventProcessor},_Chat_controls=class _Chat_controls extends SvelteComponent{constructor(options){super(),init(this,options,null,null,safe_not_equal,{})}};__name(_Chat_controls,"Chat_controls");let Chat_controls=_Chat_controls;const _InterpretableResult=class _InterpretableResult{constructor(interpretable,message){this.interpretable=interpretable,this.message=message}};__name(_InterpretableResult,"InterpretableResult");let InterpretableResult=_InterpretableResult;const _InterpretableSuccess=class _InterpretableSuccess extends InterpretableResult{};__name(_InterpretableSuccess,"InterpretableSuccess");let InterpretableSuccess=_InterpretableSuccess;const _DeferredInterpretableBuilder=class _DeferredInterpretableBuilder{constructor(_interpretableBuilder){__publicField(this,"_execute");__publicField(this,"_builtInterpretable");this._interpretableBuilder=_interpretableBuilder}chainInterpretable(nextInterpretableBuilder){const builder=new _DeferredInterpretableBuilder(nextInterpretableBuilder);return this.setExecute(async(result,context)=>({next:builder.build(),result:new InterpretableSuccess(this.interpretable)})),builder}setExecute(execute){return this._execute=execute,this}build(){if(!this._execute||!this._interpretableBuilder)throw new Error("Cannot build interpretable without execute function");const execute=this._execute;return this._builtInterpretable=this._interpretableBuilder((result,context)=>execute(result,context)),this._builtInterpretable}get interpretable(){if(!this._builtInterpretable)throw new Error("Interpretable has not yet been built");return this._builtInterpretable}};__name(_DeferredInterpretableBuilder,"DeferredInterpretableBuilder");let DeferredInterpretableBuilder=_DeferredInterpretableBuilder;const _InterpretableDeferResult=class _InterpretableDeferResult extends InterpretableSuccess{constructor(interpretable,message,run){super(interpretable,message),this.run=run}};__name(_InterpretableDeferResult,"InterpretableDeferResult");let InterpretableDeferResult=_InterpretableDeferResult;const _CommandParamsBuilder=class _CommandParamsBuilder{constructor(_interpretableDeferred,_precedingParams=[]){this._interpretableDeferred=_interpretableDeferred,this._precedingParams=_precedingParams}static forCommand(command){const deferredBuilder=new DeferredInterpretableBuilder(execute=>command.setExecute(execute));return new _CommandParamsBuilder(deferredBuilder)}addParam(param){const nextDeferredBuilder=this._interpretableDeferred.chainInterpretable(execute=>param.withAction(execute));return new _CommandParamsBuilder(nextDeferredBuilder,[...this._precedingParams,param])}run(run){return this._interpretableDeferred.setExecute(async result=>{const interpretable=this._interpretableDeferred.interpretable;return{result:new InterpretableDeferResult(interpretable,void 0,()=>run(result,interpretable))}}),this._precedingParams}build(){this._interpretableDeferred.build()}};__name(_CommandParamsBuilder,"CommandParamsBuilder");let CommandParamsBuilder=_CommandParamsBuilder;const _InterpretableError=class _InterpretableError extends InterpretableResult{};__name(_InterpretableError,"InterpretableError");let InterpretableError=_InterpretableError;const _InterpretableCommandPartialMatch=class _InterpretableCommandPartialMatch extends InterpretableError{};__name(_InterpretableCommandPartialMatch,"InterpretableCommandPartialMatch");let InterpretableCommandPartialMatch=_InterpretableCommandPartialMatch;const _ExtensionCommand=class _ExtensionCommand{constructor(_defaultId,_feature,_name,_description,_defaultEnabled=!0){__publicField(this,"_id");__publicField(this,"_enabledSetting");__publicField(this,"_execute");__publicField(this,"_params",[]);this._defaultId=_defaultId,this._feature=_feature,this._name=_name,this._description=_description,this._defaultEnabled=_defaultEnabled,this._id=new ExtensionSetting(`command.${this._defaultId}.name`,this._defaultId,this._feature),this._enabledSetting=new ExtensionSetting(`command.${this._defaultId}.enabled`,this._defaultEnabled,this._feature)}get name(){return this._name}get defaultId(){return this._defaultId}get description(){return this._description}get idSetting(){return this._id.asFrozen}get enabledSetting(){return this._enabledSetting.asFrozen}get params(){return this._params}async interpret(args,source,context){const interpreterName=await firstValueFrom(this._id.changes$);if(args.startsWith(interpreterName)){const remainder=args.substring(interpreterName.length);return{context,remainder,result:{}}}if(args.length>0&&interpreterName.startsWith(args))throw new InterpretableCommandPartialMatch(this);return null}execute(result,context){var _a81;return((_a81=this._execute)==null?void 0:_a81.call(this,result,context))??Promise.resolve({result:new InterpretableSuccess(this)})}setExecute(execute){return this._execute=execute,this}run(run){return this.setExecute(async()=>({result:new InterpretableDeferResult(this,void 0,()=>run(this))})),this}withParameters(builderAction){const builder=CommandParamsBuilder.forCommand(this);return this._params=builderAction(builder),builder.build(),this}};__name(_ExtensionCommand,"ExtensionCommand");let ExtensionCommand=_ExtensionCommand;var __defProp$1I=Object.defineProperty,__getOwnPropDesc$R=Object.getOwnPropertyDescriptor,__decorateClass$1I=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$R(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1I(target,key,result),result},"__decorateClass$1I"),__decorateParam$p=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$p"),_a7;let CommandsService=(_a7=class{constructor(loggerFactory2){__publicField(this,"_logger");__publicField(this,"_registeredCommands",[]);__publicField(this,"_activeCommands$",new BehaviorSubject([]));this._logger=loggerFactory2(this)}registerCommand(command){this._registeredCommands.push(command),this._activeCommands$.next(this._registeredCommands)}removeCommand(command){this._registeredCommands=this._registeredCommands.filter(c=>c!==command),this._activeCommands$.next(this._registeredCommands)}get commands$(){return this._activeCommands$.pipe(switchMap(commands=>{const values=commands.map(command=>command.enabledSetting.changes$.pipe(map(enabled=>({command,enabled}))));return combineLatest$1(...values)}),map(commands=>commands.filter(c=>c.enabled).map(command=>command.command)))}async executeCommand(command,args){const context={parameters:command.params,command};return{result:await this.executeInterpretable(command,args,{},context),context}}async executeInterpretable(interpretable,args,source,context){let interpretation;try{interpretation=await interpretable.interpret(args,source,context)}catch(e){if(e instanceof InterpretableError)return e;throw e}if(interpretation===null)return null;let result;try{result=await interpretable.execute(interpretation.result,context)}catch(e){if(e instanceof InterpretableError)return e;throw e}return this._logger.debug("Interpretable execution result",interpretable,result),result.next!==void 0?await this.executeInterpretable(result.next,interpretation.remainder,interpretation.result,context):result.result}},__name(_a7,"CommandsService"),_a7);CommandsService=__decorateClass$1I([injectable(),__decorateParam$p(0,inject(loggerFactory))],CommandsService);var __defProp$1H=Object.defineProperty,__getOwnPropDesc$Q=Object.getOwnPropertyDescriptor,__decorateClass$1H=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$Q(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1H(target,key,result),result},"__decorateClass$1H"),__decorateParam$o=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$o"),_a8;let HotkeysService=(_a8=class{constructor(loggerFactory2){__publicField(this,"_logger");__publicField(this,"_registeredHotkeys",[]);this._logger=loggerFactory2(this)}registerHotkey(hotkey){if(this._registeredHotkeys.includes(hotkey)){this._logger.warn("Attempted to register a hotkey that was already registered",hotkey);return}this._registeredHotkeys.push(hotkey),this._logger.debug("Registered hotkey",hotkey)}removeHotkey(hotkey){const lengthBefore=this._registeredHotkeys.length;this._registeredHotkeys=this._registeredHotkeys.filter(h=>h!==hotkey),lengthBefore===this._registeredHotkeys.length&&this._logger.warn("Attempted to remove a hotkey that was not registered",hotkey),this._logger.debug("Removed hotkey",hotkey)}get registeredHotkeys(){return[...this._registeredHotkeys]}async setHotkeyCombo(hotkey,value){try{value.length===0&&(this._logger.debug("Saving empty hotkey combo; disabling hotkey"),await hotkey.enabledSetting.setValue(!1)),await hotkey.comboSetting.setValue(value)}catch(e){throw this._logger.error("Error updating hotkey combo",e),e}this._logger.info("Updated hotkey combo",hotkey.name,value)}async resetHotkeyCombo(hotkey){try{await hotkey.comboSetting.setValue([...hotkey.defaultCombo??[]]),(hotkey.defaultCombo===void 0||hotkey.defaultCombo.length===0)&&(this._logger.debug("Resetting hotkey combo to empty; disabling hotkey"),await hotkey.enabledSetting.setValue(!1))}catch(e){throw this._logger.error("Error updating hotkey combo",e),e}return this._logger.info("Reset hotkey combo",hotkey.name),[...hotkey.defaultCombo??[]]}},__name(_a8,"HotkeysService"),_a8);HotkeysService=__decorateClass$1H([injectable(),__decorateParam$o(0,inject(loggerFactory))],HotkeysService);var __defProp$1G=Object.defineProperty,__getOwnPropDesc$P=Object.getOwnPropertyDescriptor,__decorateClass$1G=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$P(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1G(target,key,result),result},"__decorateClass$1G"),__decorateParam$n=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$n"),_a9;let TooltipsService=(_a9=class{constructor(loggerFactory2){__publicField(this,"_logger");__publicField(this,"_registeredTooltips",new Map);__publicField(this,"_changes",new Subject$1);__publicField(this,"_tooltipClass","typo-tooltip-registered");__publicField(this,"_observer",new MutationObserver(mutations=>{let removed=!1;mutations.forEach(mutation=>{mutation.type==="childList"&&mutation.removedNodes.forEach(node=>{node instanceof HTMLElement&&this.getTooltipsOfElement(node).forEach(element2=>{element2 instanceof HTMLElement&&(this._logger.debug("Removing tooltip from element",element2),this._registeredTooltips.delete(element2),removed=!0)})})}),removed&&this._changes.next()}));this._logger=loggerFactory2(this),this._observer.observe(document.body,{childList:!0,subtree:!0})}registerTooltip(element2,params,feature){this._registeredTooltips.has(element2)&&this._logger.debug("Overriding tooltip for element",element2,params,feature);const tooltip={target:element2,...params,feature};this._registeredTooltips.set(element2,tooltip),element2.classList.toggle(this._tooltipClass,!0),this._changes.next(),this._logger.debug("Registered tooltip",tooltip)}get tooltips$(){return this._changes.pipe(startWith(null),map(()=>Array.from(this._registeredTooltips.values())))}getTooltipsOfElement(element2){const isTooltip=element2.classList.contains(this._tooltipClass),childTooltips=[...element2.querySelectorAll(`.${this._tooltipClass}`)].filter(e=>e instanceof HTMLElement);return isTooltip?[element2,...childTooltips]:childTooltips}getTooltipsUntilElement(element2){const tooltips=[];let currentTooltip=element2.closest(`.${this._tooltipClass}`);for(;currentTooltip!=null&&currentTooltip.parentElement instanceof HTMLElement;)tooltips.push(currentTooltip),currentTooltip=currentTooltip.parentElement.closest(`.${this._tooltipClass}`);return tooltips}},__name(_a9,"TooltipsService"),_a9);TooltipsService=__decorateClass$1G([injectable(),__decorateParam$n(0,inject(loggerFactory))],TooltipsService);var __defProp$1F=Object.defineProperty,__getOwnPropDesc$O=Object.getOwnPropertyDescriptor,__decorateClass$1F=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$O(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1F(target,key,result),result},"__decorateClass$1F"),__decorateParam$m=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$m"),_a10;let TypoFeature=(_a10=class{constructor(loggerFactory2,_hotkeysService,_tooltipsService,_commandsService){__publicField(this,"featureEnabledDefault",!0);__publicField(this,"_isActivated",!1);__publicField(this,"_hotkeys",[]);__publicField(this,"_settings",[]);__publicField(this,"_commands",[]);__publicField(this,"toggleEnabled",!0);__publicField(this,"developerFeature",!1);__publicField(this,"_isActivatedSetting",new BooleanExtensionSetting("isActivated",this.featureEnabledDefault,this).withName("Activated").withDescription("Enable or disable the feature. Disabled features will reset and remove every functionality, mods and hotkeys."));__publicField(this,"_logger");this._hotkeysService=_hotkeysService,this._tooltipsService=_tooltipsService,this._commandsService=_commandsService,this._logger=loggerFactory2(this)}get boundServices(){return[]}useHotkey(action){return this._hotkeys.push(action),action}useCommand(command){return this._commands.push(command),command}useSetting(setting){return this._settings.push(setting),setting}get hotkeys(){return this._hotkeys}get settings(){return this._settings}get commands(){return this._commands}get featureManagementComponent(){}get featureInfoComponent(){}get hasDetailComponents(){return this.hotkeys.length>0||this.commands.length>0||this.featureManagementComponent!==void 0||this.featureInfoComponent!==void 0||this._settings.length>0}postConstruct(){this._logger.debug("onConstruct not implemented")}onActivate(){this._logger.debug("onActivate not implemented")}onDestroy(){this._logger.debug("onDestroy not implemented")}init(){this._isActivatedSetting.setDefaultValue(this.featureEnabledDefault);const loadActivation=__name(()=>{this._isActivatedSetting.getValue().then(value=>{this._logger.debug("Feature loaded with activation state",value),value&&this.activate()})},"loadActivation"),postConstruct2=this.postConstruct();postConstruct2 instanceof Promise?postConstruct2.then(loadActivation):loadActivation()}async activate(){if(this._isActivated)throw this._logger.warn("Attempted to activate feature while already activated"),new Error("Feature is already activated");this._logger.info("Activating feature"),await Promise.all(this.boundServices.map(service=>service.onFeatureActivate()));const activate=this.onActivate();activate instanceof Promise&&await activate,this._isActivated=!0,await this._isActivatedSetting.setValue(!0),this._hotkeys.length!==0&&(this._logger.debug("Registering feature hotkeys",this._hotkeys),this._hotkeys.forEach(hotkey=>this._hotkeysService.registerHotkey(hotkey)));for(const command of this._commands)this._commandsService.registerCommand(command)}async destroy(){if(!this._isActivated)throw this._logger.warn("Attempted to destroy feature without activation"),new Error("Feature is not activated");this._logger.info("Destroying feature");const destroy=this.onDestroy();destroy instanceof Promise&&await destroy,this._isActivated=!1,await this._isActivatedSetting.setValue(!1),await Promise.all(this.boundServices.map(service=>service.onFeatureDestroy())),this._hotkeys.length!==0&&(this._logger.debug("Removing feature hotkeys",this._hotkeys),this._hotkeys.forEach(hotkey=>this._hotkeysService.removeHotkey(hotkey)));for(const command of this._commands)this._commandsService.removeCommand(command)}get activated$(){return this._isActivatedSetting.changes$}registerTooltip(node,params){this._logger.debug("Registering tooltip",node,params),this._tooltipsService.registerTooltip(node,params,this)}get createTooltip(){return(node,params)=>(this.registerTooltip(node,params),{update:__name(params2=>{this.registerTooltip(node,params2)},"update")})}},__name(_a10,"TypoFeature"),_a10);__decorateClass$1F([postConstruct()],TypoFeature.prototype,"init",1);TypoFeature=__decorateClass$1F([injectable(),__decorateParam$m(0,inject(loggerFactory)),__decorateParam$m(1,inject(HotkeysService)),__decorateParam$m(2,inject(TooltipsService)),__decorateParam$m(3,inject(CommandsService))],TypoFeature);var __defProp$1E=Object.defineProperty,__getOwnPropDesc$N=Object.getOwnPropertyDescriptor,__decorateClass$1E=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$N(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1E(target,key,result),result},"__decorateClass$1E"),_a11;let LoggerService=(_a11=class{constructor(){__publicField(this,"_level","debug");__publicField(this,"_levels",{debug:1,info:2,warn:3,error:4});__publicField(this,"_boundTo");__publicField(this,"_events$",new Subject$1)}set level(level){this._level=level}get level(){return this._level}bindTo(value){return this._boundTo=value,this}get boundTo(){var _a81;return((_a81=this._boundTo)==null?void 0:_a81.constructor.name)??" / "}get boundType(){return this._boundTo instanceof TypoFeature?"feature":"other"}get events$(){return this._events$.asObservable()}debug(message,...data){this._levels[this.level]>this._levels.debug||this._events$.next({logLevel:"debug",message,data,date:new Date,bindingName:this.boundTo})}info(message,...data){this._levels[this.level]>this._levels.info||this._events$.next({logLevel:"info",message,data,date:new Date,bindingName:this.boundTo})}warn(message,...data){this._levels[this.level]>this._levels.warn||this._events$.next({logLevel:"warn",message,data,date:new Date,bindingName:this.boundTo})}error(message,...data){this._levels[this.level]>this._levels.error||this._events$.next({logLevel:"error",message,data,date:new Date,bindingName:this.boundTo})}},__name(_a11,"LoggerService"),_a11);LoggerService=__decorateClass$1E([injectable()],LoggerService);var __defProp$1D=Object.defineProperty,__getOwnPropDesc$M=Object.getOwnPropertyDescriptor,__decorateClass$1D=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$M(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1D(target,key,result),result},"__decorateClass$1D"),__decorateParam$l=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$l"),_a12;let Setup=(_a12=class{constructor(loggerFactory2){__publicField(this,"_logger");__publicField(this,"_setupPromise");this._logger=loggerFactory2(this)}complete(){return this._setupPromise===void 0&&(this._logger.info("Running setup"),this._setupPromise=this.runSetup(),this._setupPromise.then(()=>{this._logger.info("Setup completed")})),this._setupPromise}},__name(_a12,"Setup"),_a12);Setup=__decorateClass$1D([injectable(),__decorateParam$l(0,inject(loggerFactory))],Setup);const appendElement=__name((sourceElement,position,parentElement)=>(parentElement.insertAdjacentElement(position,sourceElement),sourceElement),"appendElement"),createElement=__name(htmlString=>{const template=document.createElement("template");return template.innerHTML=htmlString.trim(),template.content.firstChild},"createElement"),decoratorSymbol=Symbol("earlySetup");function earlySetup(){return function(target){Reflect.defineMetadata(decoratorSymbol,!0,target)}}__name(earlySetup,"earlySetup");function isEarlySetup(target){return Reflect.getMetadata(decoratorSymbol,target)}__name(isEarlySetup,"isEarlySetup");var __defProp$1C=Object.defineProperty,__getOwnPropDesc$L=Object.getOwnPropertyDescriptor,__decorateClass$1C=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$L(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1C(target,key,result),result},"__decorateClass$1C"),_a13;let GamePatchReadySetup=(_a13=class extends Setup{constructor(){super(...arguments);__publicField(this,"_interceptor")}async runSetup(){return firstValueFrom(this._interceptor.patchLoaded$)}},__name(_a13,"GamePatchReadySetup"),_a13);__decorateClass$1C([inject(Interceptor)],GamePatchReadySetup.prototype,"_interceptor",2);GamePatchReadySetup=__decorateClass$1C([earlySetup()],GamePatchReadySetup);var __defProp$1B=Object.defineProperty,__decorateClass$1B=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$1B(target,key,result),result},"__decorateClass$1B");const _ChatControlsSetup=class _ChatControlsSetup extends Setup{constructor(){super(...arguments);__publicField(this,"_gameReadySetup")}async runSetup(){await this._gameReadySetup.complete();const chatControls=appendElement(createElement("<div class='typo-chat-controls'></div>"),"afterbegin",requireElement("#game-wrapper"));return new Chat_controls({target:chatControls}),chatControls}};__name(_ChatControlsSetup,"ChatControlsSetup");let ChatControlsSetup=_ChatControlsSetup;__decorateClass$1B([inject(GamePatchReadySetup)],ChatControlsSetup.prototype,"_gameReadySetup");var __defProp$1A=Object.defineProperty,__getOwnPropDesc$K=Object.getOwnPropertyDescriptor,__decorateClass$1A=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$K(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1A(target,key,result),result},"__decorateClass$1A"),__decorateParam$k=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$k"),_a14;let GlobalSettingsService=(_a14=class{constructor(loggerFactory2){__publicField(this,"_settings",{devMode:new BooleanExtensionSetting("devMode",!1).withName("Developer Mode").withDescription("Enable some developer features & settings"),controlsPosition:new ChoiceExtensionSetting("controlsPosition","topleft").withName("Control Icons Position").withDescription("The position where the typo controls are displayed").withChoices([{name:"Top Right",choice:"topright"},{name:"Top Left",choice:"topleft"},{name:"Bottom Right",choice:"bottomright"},{name:"Bottom Left",choice:"bottomleft"}]),controlsDirection:new ChoiceExtensionSetting("controlsDirection","vertical").withName("Control Icons Direction").withDescription("The direction where the typo controls are lined up").withChoices([{name:"Horizontal",choice:"horizontal"},{name:"Vertical",choice:"vertical"}])});__publicField(this,"_logger");this._logger=loggerFactory2(this)}get settings(){return this._settings}get settingsList(){return Object.values(this._settings)}},__name(_a14,"GlobalSettingsService"),_a14);GlobalSettingsService=__decorateClass$1A([injectable(),__decorateParam$k(0,inject(loggerFactory))],GlobalSettingsService);function create_fragment$16(ctx){let div,div_class_value;return{c(){div=element$1("div"),attr(div,"class",div_class_value="typo-controls "+ctx[1]+" "+ctx[2]+" svelte-7pthaj")},m(target,anchor){insert(target,div,anchor),ctx[7](div)},p(ctx2,[dirty]){dirty&6&&div_class_value!==(div_class_value="typo-controls "+ctx2[1]+" "+ctx2[2]+" svelte-7pthaj")&&attr(div,"class",div_class_value)},i:noop$1,o:noop$1,d(detaching){detaching&&detach(div),ctx[7](null)}}}__name(create_fragment$16,"create_fragment$16");function instance$$($$self,$$props,$$invalidate){let $position,$direction,elem,resolve2,{globalSettings}=$$props;const element2=new Promise(res=>{resolve2=res});onMount(()=>{resolve2(elem)});const position=globalSettings.settings.controlsPosition.store;component_subscribe($$self,position,value=>$$invalidate(1,$position=value));const direction=globalSettings.settings.controlsDirection.store;component_subscribe($$self,direction,value=>$$invalidate(2,$direction=value));function div_binding($$value){binding_callbacks[$$value?"unshift":"push"](()=>{elem=$$value,$$invalidate(0,elem)})}return __name(div_binding,"div_binding"),$$self.$$set=$$props2=>{"globalSettings"in $$props2&&$$invalidate(5,globalSettings=$$props2.globalSettings)},[elem,$position,$direction,position,direction,globalSettings,element2,div_binding]}__name(instance$$,"instance$$");const _Controls=class _Controls extends SvelteComponent{constructor(options){super(),init(this,options,instance$$,create_fragment$16,safe_not_equal,{globalSettings:5,element:6})}get element(){return this.$$.ctx[6]}};__name(_Controls,"Controls");let Controls=_Controls;var __defProp$1z=Object.defineProperty,__decorateClass$1z=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$1z(target,key,result),result},"__decorateClass$1z");const _ControlsSetup=class _ControlsSetup extends Setup{constructor(){super(...arguments);__publicField(this,"_gameReadySetup");__publicField(this,"_settingsService")}async runSetup(){return await this._gameReadySetup.complete(),await new Controls({target:document.body,props:{globalSettings:this._settingsService}}).element}};__name(_ControlsSetup,"ControlsSetup");let ControlsSetup=_ControlsSetup;__decorateClass$1z([inject(GamePatchReadySetup)],ControlsSetup.prototype,"_gameReadySetup");__decorateClass$1z([inject(GlobalSettingsService)],ControlsSetup.prototype,"_settingsService");var __defProp$1y=Object.defineProperty,__getOwnPropDesc$J=Object.getOwnPropertyDescriptor,__decorateClass$1y=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$J(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1y(target,key,result),result},"__decorateClass$1y"),_a15;let SkribblInitializedSetup=(_a15=class extends Setup{async runSetup(){return new Promise(resolve2=>{document.body.getAttribute("typo-skribbl-loaded")!==null?resolve2():document.addEventListener("skribblInitialized",()=>resolve2())})}},__name(_a15,"SkribblInitializedSetup"),_a15);SkribblInitializedSetup=__decorateClass$1y([earlySetup()],SkribblInitializedSetup);const _Toast_container=class _Toast_container extends SvelteComponent{constructor(options){super(),init(this,options,null,null,safe_not_equal,{})}};__name(_Toast_container,"Toast_container");let Toast_container=_Toast_container;var __defProp$1x=Object.defineProperty,__decorateClass$1x=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$1x(target,key,result),result},"__decorateClass$1x");const _ToastSetup=class _ToastSetup extends Setup{constructor(){super(...arguments);__publicField(this,"_gameReadySetup")}async runSetup(){await this._gameReadySetup.complete();const controls=appendElement(createElement("<div class='typo-toast-container'></div>"),"afterbegin",document.body);return new Toast_container({target:controls}),controls}};__name(_ToastSetup,"ToastSetup");let ToastSetup=_ToastSetup;__decorateClass$1x([inject(GamePatchReadySetup)],ToastSetup.prototype,"_gameReadySetup");function get_each_context$v(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[4]=list[i],child_ctx}__name(get_each_context$v,"get_each_context$v");function get_each_context_1$a(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[4]=list[i],child_ctx}__name(get_each_context_1$a,"get_each_context_1$a");function create_each_block_1$a(ctx){let h2,t_value=ctx[4].name+"",t,mounted,dispose;function keydown_handler(){return ctx[2](ctx[4])}__name(keydown_handler,"keydown_handler");function click_handler2(){return ctx[3](ctx[4])}return __name(click_handler2,"click_handler"),{c(){h2=element$1("h2"),t=text(t_value),attr(h2,"tabindex","0"),attr(h2,"role","button"),attr(h2,"class","svelte-1ooy78o"),toggle_class(h2,"inactive",ctx[4]!==ctx[1])},m(target,anchor){insert(target,h2,anchor),append(h2,t),mounted||(dispose=[listen(h2,"keydown",keydown_handler),listen(h2,"click",click_handler2)],mounted=!0)},p(new_ctx,dirty){ctx=new_ctx,dirty&1&&t_value!==(t_value=ctx[4].name+"")&&set_data(t,t_value),dirty&3&&toggle_class(h2,"inactive",ctx[4]!==ctx[1])},d(detaching){detaching&&detach(h2),mounted=!1,run_all(dispose)}}}__name(create_each_block_1$a,"create_each_block_1$a");function create_each_block$v(ctx){let div,div_class_value,div_hidden_value;return{c(){div=element$1("div"),attr(div,"class",div_class_value="typo-panel-tab color-scrollbar panel-tab-"+ctx[4].id+" svelte-1ooy78o"),div.hidden=div_hidden_value=ctx[4]!==ctx[1]},m(target,anchor){insert(target,div,anchor)},p(ctx2,dirty){dirty&1&&div_class_value!==(div_class_value="typo-panel-tab color-scrollbar panel-tab-"+ctx2[4].id+" svelte-1ooy78o")&&attr(div,"class",div_class_value),dirty&3&&div_hidden_value!==(div_hidden_value=ctx2[4]!==ctx2[1])&&(div.hidden=div_hidden_value)},d(detaching){detaching&&detach(div)}}}__name(create_each_block$v,"create_each_block$v");function create_fragment$15(ctx){let div,t,each1_anchor,each_value_1=ensure_array_like(ctx[0]),each_blocks_1=[];for(let i=0;i<each_value_1.length;i+=1)each_blocks_1[i]=create_each_block_1$a(get_each_context_1$a(ctx,each_value_1,i));let each_value=ensure_array_like(ctx[0]),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$v(get_each_context$v(ctx,each_value,i));return{c(){div=element$1("div");for(let i=0;i<each_blocks_1.length;i+=1)each_blocks_1[i].c();t=space();for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();each1_anchor=empty(),attr(div,"class","panel-header svelte-1ooy78o")},m(target,anchor){insert(target,div,anchor);for(let i=0;i<each_blocks_1.length;i+=1)each_blocks_1[i]&&each_blocks_1[i].m(div,null);insert(target,t,anchor);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(target,anchor);insert(target,each1_anchor,anchor)},p(ctx2,[dirty]){if(dirty&3){each_value_1=ensure_array_like(ctx2[0]);let i;for(i=0;i<each_value_1.length;i+=1){const child_ctx=get_each_context_1$a(ctx2,each_value_1,i);each_blocks_1[i]?each_blocks_1[i].p(child_ctx,dirty):(each_blocks_1[i]=create_each_block_1$a(child_ctx),each_blocks_1[i].c(),each_blocks_1[i].m(div,null))}for(;i<each_blocks_1.length;i+=1)each_blocks_1[i].d(1);each_blocks_1.length=each_value_1.length}if(dirty&3){each_value=ensure_array_like(ctx2[0]);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$v(ctx2,each_value,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block$v(child_ctx),each_blocks[i].c(),each_blocks[i].m(each1_anchor.parentNode,each1_anchor))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value.length}},i:noop$1,o:noop$1,d(detaching){detaching&&(detach(div),detach(t),detach(each1_anchor)),destroy_each(each_blocks_1,detaching),destroy_each(each_blocks,detaching)}}}__name(create_fragment$15,"create_fragment$15");function instance$_($$self,$$props,$$invalidate){let{tabs=[]}=$$props,activeTab=tabs[0];const keydown_handler=__name(tab=>$$invalidate(1,activeTab=tab),"keydown_handler"),click_handler2=__name(tab=>$$invalidate(1,activeTab=tab),"click_handler");return $$self.$$set=$$props2=>{"tabs"in $$props2&&$$invalidate(0,tabs=$$props2.tabs)},[tabs,activeTab,keydown_handler,click_handler2]}__name(instance$_,"instance$_");const _Panel_tabs=class _Panel_tabs extends SvelteComponent{constructor(options){super(),init(this,options,instance$_,create_fragment$15,safe_not_equal,{tabs:0})}};__name(_Panel_tabs,"Panel_tabs");let Panel_tabs=_Panel_tabs;var __defProp$1w=Object.defineProperty,__decorateClass$1w=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$1w(target,key,result),result},"__decorateClass$1w");const _PanelSetup=class _PanelSetup extends Setup{constructor(){super(...arguments);__publicField(this,"_gameReadySetup")}async runSetup(){await this._gameReadySetup.complete();const panels={rightPanel:appendElement(createElement("<div class='panel panel-right typo-panel'></div>"),"afterend",requireElement(".panel")),leftPanel:appendElement(createElement("<div class='panel panel-left typo-panel'></div>"),"beforebegin",requireElement(".panel"))};return new Panel_tabs({target:panels.leftPanel,props:{tabs:[{name:"Typo News",id:"news"},{name:"Changelog",id:"changelog"}]}}),new Panel_tabs({target:panels.rightPanel,props:{tabs:[{name:"Lobbies",id:"lobbies"},{name:"Filters",id:"filter"},{name:"Outfit",id:"cabin"}]}}),panels}};__name(_PanelSetup,"PanelSetup");let PanelSetup=_PanelSetup;__decorateClass$1w([inject(GamePatchReadySetup)],PanelSetup.prototype,"_gameReadySetup");const _Toolbar=class _Toolbar extends SvelteComponent{constructor(options){super(),init(this,options,null,null,safe_not_equal,{})}};__name(_Toolbar,"Toolbar");let Toolbar=_Toolbar;var __defProp$1v=Object.defineProperty,__decorateClass$1v=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$1v(target,key,result),result},"__decorateClass$1v");const _ToolbarSetup=class _ToolbarSetup extends Setup{constructor(){super(...arguments);__publicField(this,"_gameReadySetup")}async runSetup(){await this._gameReadySetup.complete();const toolbar=appendElement(createElement("<div class='typo-toolbar'></div>"),"afterbegin",requireElement("#game-wrapper"));return new Toolbar({target:toolbar}),toolbar}};__name(_ToolbarSetup,"ToolbarSetup");let ToolbarSetup=_ToolbarSetup;__decorateClass$1v([inject(GamePatchReadySetup)],ToolbarSetup.prototype,"_gameReadySetup");var __defProp$1u=Object.defineProperty,__decorateClass$1u=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$1u(target,key,result),result},"__decorateClass$1u");function getElements$1(panels,toolbar,controls,toastContainer,chatControls){return{panelContainer:requireElement(".panels"),avatarPanel:requireElement(".panel:not(.typo-panel)"),newsTab:requireElement(".panel-tab-news"),changelogTab:requireElement(".panel-tab-changelog"),lobbiesTab:requireElement(".panel-tab-lobbies"),cabinTab:requireElement(".panel-tab-cabin"),filterTab:requireElement(".panel-tab-filter"),playButton:requireElement(".panel:not(.typo-panel) .button-play"),gameBar:requireElement("#game-bar"),gameSettings:requireElement("#game-settings"),home:requireElement("#home"),game:requireElement("#game"),gameWrapper:requireElement("#game-wrapper"),load:requireElement("#load"),chatInput:requireElement("#game-chat form.chat-form input"),chatForm:requireElement("#game-chat form.chat-form"),chatArea:requireElement("#game-chat"),chatContent:requireElement("#game-chat .chat-content"),hints:requireElement("#game-word .hints"),canvasWrapper:requireElement("#game-canvas"),canvas:requireElement("#game-canvas canvas"),landingAvatarContainer:requireElement(".avatar-customizer .avatar"),landingCustomizeContainer:requireElement(".avatar-customizer"),skribblTools:requireElement(".toolbar-group-tools"),skribblActions:requireElement(".toolbar-group-actions"),skribblToolbar:requireElement("#game-toolbar"),skribblBrushTools:requireElement('.toolbar-group-tools .tool[data-tooltip="Brush"]'),colorContainer:requireElement("#game-toolbar .colors"),scoreboardResults:requireElement("#game-canvas .overlay-content .result"),playerPopup:requireElement("#modal .modal-content .modal-container-player"),skribblModal:requireElement("#modal"),canvasOverlay:requireElement("#game-canvas .overlay-content"),textOverlay:requireElement("#game-canvas .overlay-content > .text"),gameRate:requireElement("#game-rate"),inputName:requireElement("input.input-name"),chatControls,...panels,toolbar,controls,toastContainer}}__name(getElements$1,"getElements$1");const _ElementsSetup=class _ElementsSetup extends Setup{constructor(){super(...arguments);__publicField(this,"_panelSetup");__publicField(this,"_toolbarSetup");__publicField(this,"_controlsSetup");__publicField(this,"_chatControlsSetup");__publicField(this,"_toastSetup");__publicField(this,"_gameReadySetup")}async runSetup(){await this._gameReadySetup.complete();const panels=await this._panelSetup.complete(),toolbar=await this._toolbarSetup.complete(),controls=await this._controlsSetup.complete(),chatControls=await this._chatControlsSetup.complete(),toastContainer=await this._toastSetup.complete();return getElements$1(panels,toolbar,controls,toastContainer,chatControls)}};__name(_ElementsSetup,"ElementsSetup");let ElementsSetup=_ElementsSetup;__decorateClass$1u([inject(PanelSetup)],ElementsSetup.prototype,"_panelSetup");__decorateClass$1u([inject(ToolbarSetup)],ElementsSetup.prototype,"_toolbarSetup");__decorateClass$1u([inject(ControlsSetup)],ElementsSetup.prototype,"_controlsSetup");__decorateClass$1u([inject(ChatControlsSetup)],ElementsSetup.prototype,"_chatControlsSetup");__decorateClass$1u([inject(ToastSetup)],ElementsSetup.prototype,"_toastSetup");__decorateClass$1u([inject(SkribblInitializedSetup)],ElementsSetup.prototype,"_gameReadySetup");var __defProp$1t=Object.defineProperty,__getOwnPropDesc$I=Object.getOwnPropertyDescriptor,__decorateClass$1t=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$I(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1t(target,key,result),result},"__decorateClass$1t");const _ChatTypedEvent=class _ChatTypedEvent extends ApplicationEvent{constructor(data){super(),this.data=data}};__name(_ChatTypedEvent,"ChatTypedEvent");let ChatTypedEvent=_ChatTypedEvent;var _a16;let ChatTypedEventProcessor=(_a16=class extends EventProcessor{constructor(){super(...arguments);__publicField(this,"_elementsSetup");__publicField(this,"eventType",ChatTypedEvent)}async streamEvents(){const events=new Subject$1,{chatInput,chatForm}=await this._elementsSetup.complete();return chatInput.addEventListener("input",()=>{const value=chatInput.value;events.next(new ChatTypedEvent(value))}),chatForm.addEventListener("submit",()=>{events.next(new ChatTypedEvent(""))}),events.pipe(distinctUntilChanged((a,b)=>a.data===b.data),tap(data=>this._logger.debug("Chat typed event",data)))}},__name(_a16,"ChatTypedEventProcessor"),_a16);__decorateClass$1t([inject(ElementsSetup)],ChatTypedEventProcessor.prototype,"_elementsSetup",2);ChatTypedEventProcessor=__decorateClass$1t([injectable()],ChatTypedEventProcessor);var _a17;let ChatTypedEventListener=(_a17=class extends EventListener{constructor(){super(...arguments);__publicField(this,"_processor")}},__name(_a17,"ChatTypedEventListener"),_a17);__decorateClass$1t([inject(ChatTypedEventProcessor)],ChatTypedEventListener.prototype,"_processor",2);ChatTypedEventListener=__decorateClass$1t([injectable()],ChatTypedEventListener);const chatTypedEventRegistration={listenerType:ChatTypedEventListener,processorType:ChatTypedEventProcessor},_Color=class _Color{constructor(_r,_g,_b,_a81){this._r=_r,this._g=_g,this._b=_b,this._a=_a81}get r(){return this._r}get g(){return this._g}get b(){return this._b}get rgbString(){return"rgb("+[this._r,this._g,this._b,this._a].filter(v=>v!==void 0).join(",")+")"}get rgbArray(){return this._a?[this._r,this._g,this._b,this._a]:[this._r,this._g,this._b]}get rgb(){return{r:this._r,g:this._g,b:this._b,a:this._a}}get hex(){return"#"+this._r.toString(16).padStart(2,"0")+this._g.toString(16).padStart(2,"0")+this._b.toString(16).padStart(2,"0")+(this._a?Math.floor(255*this._a).toString(16).padStart(2,"0"):"")}set hex(hex){const color=_Color.fromHex(hex);this._r=color._r,this._g=color._g,this._b=color._b,this._a=color._a}get skribblCode(){const skribblIndex=_Color.skribblColors.findIndex(c=>c[0]===this._r&&c[1]===this._g&&c[2]===this._b);return skribblIndex!==-1?skribblIndex:this.typoCode}get typoCode(){const hexString=(this._r<<16|this._g<<8|this._b).toString(16).toUpperCase();return parseInt(hexString,16)+1e4}get hsl(){const r=this.r/255,g=this.g/255,b=this.b/255,max=Math.max(r,g,b),min=Math.min(r,g,b);let h=0,s=0;const l=(max+min)/2;if(max==min)h=s=0;else{const d=max-min;switch(s=l>.5?d/(2-max-min):d/(max+min),max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break}h/=6}return this._a!==void 0?[h*360,s*100,l*100,this._a]:[h*360,s*100,l*100]}get hsv(){const r=this.r/255,g=this.g/255,b=this.b/255,max=Math.max(r,g,b),min=Math.min(r,g,b),delta=max-min;let h=0,s=0;const v=max;if(max!==0?s=delta/max:(h=0,s=0),max!==min){switch(max){case r:h=(g-b)/delta+(g<b?6:0);break;case g:h=(b-r)/delta+2;break;case b:h=(r-g)/delta+4;break}h/=6}return[h*360,s*100,v*100,this._a]}static fromRgb(r,g,b,a){return new _Color(Math.round(r),Math.round(g),Math.round(b),a?Math.round(a*100)/100:void 0)}static fromHex(hex){hex[0]=="#"&&(hex=hex.substring(1));const r=Math.round(parseInt("0x"+hex.substring(0,2))),g=Math.round(parseInt("0x"+hex.substring(2,4))),b=Math.round(parseInt("0x"+hex.substring(4,6))),a=hex.length>6?Math.round(parseInt("0x"+hex.substring(6,8))):void 0;return new _Color(r,g,b,a)}static fromRgbString(rgb){const rgbs=rgb.trim().replace(" ","").split(","),r=parseInt(rgbs[0].replace(/[^\d]/g,""),10),g=parseInt(rgbs[1].replace(/[^\d]/g,""),10),b=parseInt(rgbs[2].replace(/[^\d]/g,""),10),a=rgbs.length>3?parseInt(rgbs[4].replace(/[^\d]/g,""),10):void 0;return new _Color(r,g,b,a)}static fromTypoCode(code){if(code<1e4)throw new Error("Invalid color code, cannot parse native skribbl index");const hex=(code-1e4).toString(16).padStart(6,"0");return _Color.fromHex(hex)}static fromHsl(h,s,l,alpha){s/=100,l/=100;const k=__name(n=>(n+h/30)%12,"k"),a=s*Math.min(l,1-l),f=__name(n=>l-a*Math.max(-1,Math.min(k(n)-3,Math.min(9-k(n),1))),"f"),r=Math.round(f(0)*255),g=Math.round(f(8)*255),b=Math.round(f(4)*255);return new _Color(r,g,b,alpha)}static fromHsv(h,s,v,a){s/=100,v/=100;const c=v*s,x=c*(1-Math.abs(h/60%2-1)),m=v-c;let r=0,g=0,b=0;return 0<=h&&h<60?(r=c,g=x,b=0):60<=h&&h<120?(r=x,g=c,b=0):120<=h&&h<180?(r=0,g=c,b=x):180<=h&&h<240?(r=0,g=x,b=c):240<=h&&h<300?(r=x,g=0,b=c):300<=h&&h<360&&(r=c,g=0,b=x),r=Math.round((r+m)*255),g=Math.round((g+m)*255),b=Math.round((b+m)*255),new _Color(r,g,b,a)}copy(){return new _Color(this._r,this._g,this._b,this._a)}withAlpha(a){return this._a=a,this}};__name(_Color,"Color"),__publicField(_Color,"skribblColors",[[255,255,255],[0,0,0],[193,193,193],[80,80,80],[239,19,11],[116,11,7],[255,113,0],[194,56,0],[255,228,0],[232,162,0],[0,204,0],[0,70,25],[0,255,145],[0,120,93],[0,178,255],[0,86,158],[35,31,211],[14,8,101],[163,0,186],[85,0,105],[223,105,167],[135,53,84],[255,172,142],[204,119,77],[160,82,45],[99,48,13]]);let Color=_Color;var __defProp$1s=Object.defineProperty,__getOwnPropDesc$H=Object.getOwnPropertyDescriptor,__decorateClass$1s=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$H(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1s(target,key,result),result},"__decorateClass$1s");const _ColorChangedEvent=class _ColorChangedEvent extends ApplicationEvent{constructor(data){super(),this.data=data}};__name(_ColorChangedEvent,"ColorChangedEvent");let ColorChangedEvent=_ColorChangedEvent;var _a18;let ColorChangedEventProcessor=(_a18=class extends EventProcessor{constructor(){super(...arguments);__publicField(this,"eventType",ColorChangedEvent)}async streamEvents(){const events=new Subject$1;return document.addEventListener("skribblColorChanged",event=>{const rgb=event.detail,color=Color.fromRgbString(rgb);events.next(new ColorChangedEvent(color)),this._logger.info("Color changed",color)}),events}},__name(_a18,"ColorChangedEventProcessor"),_a18);ColorChangedEventProcessor=__decorateClass$1s([injectable()],ColorChangedEventProcessor);var _a19;let ColorChangedEventListener=(_a19=class extends EventListener{constructor(){super(...arguments);__publicField(this,"_processor")}},__name(_a19,"ColorChangedEventListener"),_a19);__decorateClass$1s([inject(ColorChangedEventProcessor)],ColorChangedEventListener.prototype,"_processor",2);ColorChangedEventListener=__decorateClass$1s([injectable()],ColorChangedEventListener);const colorChangedEventRegistration={listenerType:ColorChangedEventListener,processorType:ColorChangedEventProcessor};var __defProp$1r=Object.defineProperty,__getOwnPropDesc$G=Object.getOwnPropertyDescriptor,__decorateClass$1r=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$G(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1r(target,key,result),result},"__decorateClass$1r"),_a20;let SkribblEmitRelaySetup=(_a20=class extends Setup{async runSetup(){return new Promise(resolve2=>{window.addEventListener("message",data=>{if(data.data==="skribblEmitPort"){const ports=data.ports;if(ports.length===0)return;const observable2=new Subject$1;ports[0].onmessage=message=>{observable2.next({event:message.data[0],data:message.data[1]})},resolve2(observable2)}})})}},__name(_a20,"SkribblEmitRelaySetup"),_a20);SkribblEmitRelaySetup=__decorateClass$1r([earlySetup()],SkribblEmitRelaySetup);var __defProp$1q=Object.defineProperty,__getOwnPropDesc$F=Object.getOwnPropertyDescriptor,__decorateClass$1q=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$F(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1q(target,key,result),result},"__decorateClass$1q"),_a21;let SkribblMessageRelaySetup=(_a21=class extends Setup{async runSetup(){return new Promise(resolve2=>{window.addEventListener("message",data=>{if(data.data==="skribblMessagePort"){const ports=data.ports;if(ports.length===0)return;const observable2=new Subject$1;ports[0].onmessage=message=>{message.data.id!==19&&this._logger.debug("Received message",message.data),observable2.next(message.data)},resolve2({serverMessages$:observable2,insertMessage:__name(message=>ports[0].postMessage(message),"insertMessage")})}})})}},__name(_a21,"SkribblMessageRelaySetup"),_a21);SkribblMessageRelaySetup=__decorateClass$1q([earlySetup()],SkribblMessageRelaySetup);var __defProp$1p=Object.defineProperty,__getOwnPropDesc$E=Object.getOwnPropertyDescriptor,__decorateClass$1p=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$E(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1p(target,key,result),result},"__decorateClass$1p");const _DrawEvent=class _DrawEvent extends ApplicationEvent{constructor(data){super(),this.data=data}};__name(_DrawEvent,"DrawEvent");let DrawEvent=_DrawEvent;var _a22;let DrawEventProcessor=(_a22=class extends EventProcessor{constructor(){super(...arguments);__publicField(this,"_skribblMessageRelaySetup");__publicField(this,"_skribblEmitRelaySetup");__publicField(this,"eventType",DrawEvent)}async streamEvents(){const events=new Subject$1,skribblMessages=await this._skribblMessageRelaySetup.complete(),skribblEmit=await this._skribblEmitRelaySetup.complete();return merge$1(skribblEmit.pipe(filter(data=>data.event==="data"),map(data=>data.data)),skribblMessages.serverMessages$).pipe(map(event=>event.id===19?typeof event.data[0]=="number"?[event.data]:event.data:event.id===10&&event.data.state.id===4&&event.data.state.data.drawCommands?event.data.state.data.drawCommands:null),filter(data=>data!==null),bufferTime(100),filter(data=>data.length>0)).subscribe(data=>{const flat=data.flat(1);events.next(new DrawEvent(flat))}),events}},__name(_a22,"DrawEventProcessor"),_a22);__decorateClass$1p([inject(SkribblMessageRelaySetup)],DrawEventProcessor.prototype,"_skribblMessageRelaySetup",2);__decorateClass$1p([inject(SkribblEmitRelaySetup)],DrawEventProcessor.prototype,"_skribblEmitRelaySetup",2);DrawEventProcessor=__decorateClass$1p([injectable()],DrawEventProcessor);var _a23;let DrawEventListener=(_a23=class extends EventListener{constructor(){super(...arguments);__publicField(this,"_processor")}},__name(_a23,"DrawEventListener"),_a23);__decorateClass$1p([inject(DrawEventProcessor)],DrawEventListener.prototype,"_processor",2);DrawEventListener=__decorateClass$1p([injectable()],DrawEventListener);const drawEventRegistration={listenerType:DrawEventListener,processorType:DrawEventProcessor};var __defProp$1o=Object.defineProperty,__getOwnPropDesc$D=Object.getOwnPropertyDescriptor,__decorateClass$1o=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$D(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1o(target,key,result),result},"__decorateClass$1o");const _HintsAddedEvent=class _HintsAddedEvent extends ApplicationEvent{constructor(data){super(),this.data=data}};__name(_HintsAddedEvent,"HintsAddedEvent");let HintsAddedEvent=_HintsAddedEvent;var _a24;let HintsAddedEventProcessor=(_a24=class extends EventProcessor{constructor(){super(...arguments);__publicField(this,"_skribblMessageRelaySetup");__publicField(this,"eventType",HintsAddedEvent)}async streamEvents(){const events=new Subject$1;return(await this._skribblMessageRelaySetup.complete()).serverMessages$.subscribe(event=>{if(event.id===10&&event.data.state.id===4&&event.data.state.data.hints){const hints=event.data.state.data.hints;this._logger.info("Lobby joined",hints),events.next(new HintsAddedEvent(hints))}else if(event.id===13){const hints=event.data??[];this._logger.info("Hints added",hints),events.next(new HintsAddedEvent(hints))}}),events}},__name(_a24,"HintsAddedEventProcessor"),_a24);__decorateClass$1o([inject(SkribblMessageRelaySetup)],HintsAddedEventProcessor.prototype,"_skribblMessageRelaySetup",2);HintsAddedEventProcessor=__decorateClass$1o([injectable()],HintsAddedEventProcessor);var _a25;let HintsAddedEventListener=(_a25=class extends EventListener{constructor(){super(...arguments);__publicField(this,"_processor")}},__name(_a25,"HintsAddedEventListener"),_a25);__decorateClass$1o([inject(HintsAddedEventProcessor)],HintsAddedEventListener.prototype,"_processor",2);HintsAddedEventListener=__decorateClass$1o([injectable()],HintsAddedEventListener);const hintsAddedEventRegistration={listenerType:HintsAddedEventListener,processorType:HintsAddedEventProcessor};var __defProp$1n=Object.defineProperty,__getOwnPropDesc$C=Object.getOwnPropertyDescriptor,__decorateClass$1n=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$C(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1n(target,key,result),result},"__decorateClass$1n");const _ImageResetEvent=class _ImageResetEvent extends ApplicationEvent{constructor(data){super(),this.data=data}};__name(_ImageResetEvent,"ImageResetEvent");let ImageResetEvent=_ImageResetEvent;var _a26;let ImageResetEventProcessor=(_a26=class extends EventProcessor{constructor(){super(...arguments);__publicField(this,"_skribblMessageRelaySetup");__publicField(this,"_skribblEmitRelaySetup");__publicField(this,"eventType",ImageResetEvent)}async streamEvents(){const events=new Subject$1,skribblMessages=await this._skribblMessageRelaySetup.complete(),skribblEmit=await this._skribblEmitRelaySetup.complete();return merge$1(skribblEmit.pipe(filter(data=>data.event==="data"),map(data=>data.data)),skribblMessages.serverMessages$).subscribe(event=>{event.id===20&&(this._logger.info("Image cleared"),events.next(new ImageResetEvent(0))),event.id===21&&(this._logger.info("Undo action",event.data),events.next(new ImageResetEvent(event.data)))}),events}},__name(_a26,"ImageResetEventProcessor"),_a26);__decorateClass$1n([inject(SkribblMessageRelaySetup)],ImageResetEventProcessor.prototype,"_skribblMessageRelaySetup",2);__decorateClass$1n([inject(SkribblEmitRelaySetup)],ImageResetEventProcessor.prototype,"_skribblEmitRelaySetup",2);ImageResetEventProcessor=__decorateClass$1n([injectable()],ImageResetEventProcessor);var _a27;let ImageResetEventListener=(_a27=class extends EventListener{constructor(){super(...arguments);__publicField(this,"_processor")}},__name(_a27,"ImageResetEventListener"),_a27);__decorateClass$1n([inject(ImageResetEventProcessor)],ImageResetEventListener.prototype,"_processor",2);ImageResetEventListener=__decorateClass$1n([injectable()],ImageResetEventListener);const imageResetEventRegistration={listenerType:ImageResetEventListener,processorType:ImageResetEventProcessor},parseSkribblLobbyInteractedEvent=__name(data=>{switch(data.id){case 8:return data.data.vote===1?{likeInteraction:{sourcePlayerId:data.data.id}}:{dislikeInteraction:{sourcePlayerId:data.data.id}};case 5:return{votekickInteraction:{targetPlayerId:data.data[1],sourcePlayerId:data.data[0],totalVotes:data.data[2],requiredVotes:data.data[3]}}}},"parseSkribblLobbyInteractedEvent");var __defProp$1m=Object.defineProperty,__getOwnPropDesc$B=Object.getOwnPropertyDescriptor,__decorateClass$1m=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$B(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1m(target,key,result),result},"__decorateClass$1m");const _LobbyInteractedEvent=class _LobbyInteractedEvent extends ApplicationEvent{constructor(data){super(),this.data=data}};__name(_LobbyInteractedEvent,"LobbyInteractedEvent");let LobbyInteractedEvent=_LobbyInteractedEvent;var _a28;let LobbyInteractedEventProcessor=(_a28=class extends EventProcessor{constructor(){super(...arguments);__publicField(this,"_skribblMessageRelaySetup");__publicField(this,"eventType",LobbyInteractedEvent)}async streamEvents(){return(await this._skribblMessageRelaySetup.complete()).serverMessages$.pipe(map(message=>parseSkribblLobbyInteractedEvent(message)),filter(event=>event!==void 0),map(event=>new LobbyInteractedEvent(event)),tap(data=>this._logger.debug("Lobby interacted",data)))}},__name(_a28,"LobbyInteractedEventProcessor"),_a28);__decorateClass$1m([inject(SkribblMessageRelaySetup)],LobbyInteractedEventProcessor.prototype,"_skribblMessageRelaySetup",2);LobbyInteractedEventProcessor=__decorateClass$1m([injectable()],LobbyInteractedEventProcessor);var _a29;let LobbyInteractedEventListener=(_a29=class extends EventListener{constructor(){super(...arguments);__publicField(this,"_processor")}},__name(_a29,"LobbyInteractedEventListener"),_a29);__decorateClass$1m([inject(LobbyInteractedEventProcessor)],LobbyInteractedEventListener.prototype,"_processor",2);LobbyInteractedEventListener=__decorateClass$1m([injectable()],LobbyInteractedEventListener);const lobbyInteractedEventRegistration={listenerType:LobbyInteractedEventListener,processorType:LobbyInteractedEventProcessor};var __defProp$1l=Object.defineProperty,__getOwnPropDesc$A=Object.getOwnPropertyDescriptor,__decorateClass$1l=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$A(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1l(target,key,result),result},"__decorateClass$1l");const _LobbyPlayerChangedEvent=class _LobbyPlayerChangedEvent extends ApplicationEvent{constructor(data){super(),this.data=data}};__name(_LobbyPlayerChangedEvent,"LobbyPlayerChangedEvent");let LobbyPlayerChangedEvent=_LobbyPlayerChangedEvent;var _a30;let LobbyPlayerChangedEventProcessor=(_a30=class extends EventProcessor{constructor(){super(...arguments);__publicField(this,"_skribblMessageRelaySetup");__publicField(this,"eventType",LobbyPlayerChangedEvent)}async streamEvents(){const events=new Subject$1;return(await this._skribblMessageRelaySetup.complete()).serverMessages$.subscribe(event=>{if(event.id===1){const data={joined:event.data};this._logger.info("Player joined",data),events.next(new LobbyPlayerChangedEvent(data))}else if(event.id===2){const data={left:{id:event.data.id,reason:event.data.id===1?"left":"kicked"}};this._logger.info("Player left",data),events.next(new LobbyPlayerChangedEvent(data))}}),events}},__name(_a30,"LobbyPlayerChangedEventProcessor"),_a30);__decorateClass$1l([inject(SkribblMessageRelaySetup)],LobbyPlayerChangedEventProcessor.prototype,"_skribblMessageRelaySetup",2);LobbyPlayerChangedEventProcessor=__decorateClass$1l([injectable()],LobbyPlayerChangedEventProcessor);var _a31;let LobbyPlayerChangedEventListener=(_a31=class extends EventListener{constructor(){super(...arguments);__publicField(this,"_processor")}},__name(_a31,"LobbyPlayerChangedEventListener"),_a31);__decorateClass$1l([inject(LobbyPlayerChangedEventProcessor)],LobbyPlayerChangedEventListener.prototype,"_processor",2);LobbyPlayerChangedEventListener=__decorateClass$1l([injectable()],LobbyPlayerChangedEventListener);const lobbyPlayerChangedEventRegistration={listenerType:LobbyPlayerChangedEventListener,processorType:LobbyPlayerChangedEventProcessor};function arrayChunk(array,size){return array.reduce((acc,_,i)=>i%size?acc:[...acc,array.slice(i,i+size)],[])}__name(arrayChunk,"arrayChunk");const parseLobbyStateUpdate=__name(data=>{switch(data.id){case 2:return{roundStarted:{round:data.data,startsIn:data.time}};case 3:return{drawerChoosingWord:{maxTime:data.time,drawerId:data.data.id}};case 4:return{drawingStarted:{word:typeof data.data.word=="string"?data.data.word:void 0,characters:typeof data.data.word=="string"?data.data.word.length:data.data.word,maxTime:data.time,drawerId:data.data.id}};case 5:return{drawingRevealed:{reason:data.data.reason===1?"outOfTime":"allGuessed",word:data.data.word,time:data.time,scores:arrayChunk(data.data.scores,3).map(([playerId,score,rewarded])=>({playerId,score,rewarded}))}};case 6:return{gameEnded:{ranking:data.data.map(([playerId,rank])=>({playerId,rank})),displayTime:data.time}};default:return}},"parseLobbyStateUpdate");function getElements(){return{languageSettings:new Map(requireElements("#home .container-name-lang > select option").map(item=>[Number(item.value),item.textContent??""]))}}__name(getElements,"getElements");const _GameSettingsSetup=class _GameSettingsSetup extends Setup{async runSetup(){return getElements()}};__name(_GameSettingsSetup,"GameSettingsSetup");let GameSettingsSetup=_GameSettingsSetup;var __defProp$1k=Object.defineProperty,__getOwnPropDesc$z=Object.getOwnPropertyDescriptor,__decorateClass$1k=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$z(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1k(target,key,result),result},"__decorateClass$1k");const _LobbyStateChangedEvent=class _LobbyStateChangedEvent extends ApplicationEvent{constructor(data){super(),this.data=data}};__name(_LobbyStateChangedEvent,"LobbyStateChangedEvent");let LobbyStateChangedEvent=_LobbyStateChangedEvent;var _a32;let LobbyStateChangedEventProcessor=(_a32=class extends EventProcessor{constructor(){super(...arguments);__publicField(this,"_gameSettingsSetup");__publicField(this,"_skribblMessageRelaySetup");__publicField(this,"eventType",LobbyStateChangedEvent)}async streamEvents(){const events=new Subject$1;return(await this._skribblMessageRelaySetup.complete()).serverMessages$.subscribe(event=>{if(event.id===11){const update=parseLobbyStateUpdate(event.data);if(update===void 0){this._logger.warn("Unknown event",event.data);return}this._logger.info("Lobby updated",update),events.next(new LobbyStateChangedEvent(update))}if(event.id===10){const update=parseLobbyStateUpdate(event.data.state);if(update===void 0){this._logger.warn("Unknown event",event.data.state);return}this._logger.info("Lobby joined",update),events.next(new LobbyStateChangedEvent(update))}}),events}},__name(_a32,"LobbyStateChangedEventProcessor"),_a32);__decorateClass$1k([inject(GameSettingsSetup)],LobbyStateChangedEventProcessor.prototype,"_gameSettingsSetup",2);__decorateClass$1k([inject(SkribblMessageRelaySetup)],LobbyStateChangedEventProcessor.prototype,"_skribblMessageRelaySetup",2);LobbyStateChangedEventProcessor=__decorateClass$1k([injectable()],LobbyStateChangedEventProcessor);var _a33;let LobbyStateChangedEventListener=(_a33=class extends EventListener{constructor(){super(...arguments);__publicField(this,"_processor")}},__name(_a33,"LobbyStateChangedEventListener"),_a33);__decorateClass$1k([inject(LobbyStateChangedEventProcessor)],LobbyStateChangedEventListener.prototype,"_processor",2);LobbyStateChangedEventListener=__decorateClass$1k([injectable()],LobbyStateChangedEventListener);const lobbyStateChangedEventRegistration={listenerType:LobbyStateChangedEventListener,processorType:LobbyStateChangedEventProcessor};var __defProp$1j=Object.defineProperty,__getOwnPropDesc$y=Object.getOwnPropertyDescriptor,__decorateClass$1j=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$y(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1j(target,key,result),result},"__decorateClass$1j");const _MessageReceivedEvent=class _MessageReceivedEvent extends ApplicationEvent{constructor(data){super(),this.data=data}};__name(_MessageReceivedEvent,"MessageReceivedEvent");let MessageReceivedEvent=_MessageReceivedEvent;var _a34;let MessageReceivedEventProcessor=(_a34=class extends EventProcessor{constructor(){super(...arguments);__publicField(this,"_skribblMessageRelaySetup");__publicField(this,"eventType",MessageReceivedEvent)}async streamEvents(){return(await this._skribblMessageRelaySetup.complete()).serverMessages$.pipe(filter(event=>event.id==30),map(event=>new MessageReceivedEvent({message:event.data.msg,senderId:event.data.id})),tap(data=>this._logger.debug("Message received",data)))}},__name(_a34,"MessageReceivedEventProcessor"),_a34);__decorateClass$1j([inject(SkribblMessageRelaySetup)],MessageReceivedEventProcessor.prototype,"_skribblMessageRelaySetup",2);MessageReceivedEventProcessor=__decorateClass$1j([injectable()],MessageReceivedEventProcessor);var _a35;let MessageReceivedEventListener=(_a35=class extends EventListener{constructor(){super(...arguments);__publicField(this,"_processor")}},__name(_a35,"MessageReceivedEventListener"),_a35);__decorateClass$1j([inject(MessageReceivedEventProcessor)],MessageReceivedEventListener.prototype,"_processor",2);MessageReceivedEventListener=__decorateClass$1j([injectable()],MessageReceivedEventListener);const messageReceivedEventRegistration={listenerType:MessageReceivedEventListener,processorType:MessageReceivedEventProcessor};var __defProp$1i=Object.defineProperty,__getOwnPropDesc$x=Object.getOwnPropertyDescriptor,__decorateClass$1i=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$x(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1i(target,key,result),result},"__decorateClass$1i");const _MessageSentEvent=class _MessageSentEvent extends ApplicationEvent{constructor(data){super(),this.data=data}};__name(_MessageSentEvent,"MessageSentEvent");let MessageSentEvent=_MessageSentEvent;var _a36;let MessageSentEventProcessor=(_a36=class extends EventProcessor{constructor(){super(...arguments);__publicField(this,"_skribblEmitRelaySetup");__publicField(this,"eventType",MessageSentEvent)}async streamEvents(){return(await this._skribblEmitRelaySetup.complete()).pipe(filter(event=>event.event==="data"&&event.data.id==30),map(emit=>new MessageSentEvent(emit.data.data)))}},__name(_a36,"MessageSentEventProcessor"),_a36);__decorateClass$1i([inject(SkribblEmitRelaySetup)],MessageSentEventProcessor.prototype,"_skribblEmitRelaySetup",2);MessageSentEventProcessor=__decorateClass$1i([injectable()],MessageSentEventProcessor);var _a37;let MessageSentEventListener=(_a37=class extends EventListener{constructor(){super(...arguments);__publicField(this,"_processor")}},__name(_a37,"MessageSentEventListener"),_a37);__decorateClass$1i([inject(MessageSentEventProcessor)],MessageSentEventListener.prototype,"_processor",2);MessageSentEventListener=__decorateClass$1i([injectable()],MessageSentEventListener);const messageSentEventRegistration={listenerType:MessageSentEventListener,processorType:MessageSentEventProcessor};var __defProp$1h=Object.defineProperty,__getOwnPropDesc$w=Object.getOwnPropertyDescriptor,__decorateClass$1h=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$w(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1h(target,key,result),result},"__decorateClass$1h");const _PlayerPopupVisibilityChangedEvent=class _PlayerPopupVisibilityChangedEvent extends ApplicationEvent{constructor(data){super(),this.data=data}};__name(_PlayerPopupVisibilityChangedEvent,"PlayerPopupVisibilityChangedEvent");let PlayerPopupVisibilityChangedEvent=_PlayerPopupVisibilityChangedEvent;var _a38;let PlayerPopupVisibilityChangedEventProcessor=(_a38=class extends EventProcessor{constructor(){super(...arguments);__publicField(this,"_elementsSetup");__publicField(this,"eventType",PlayerPopupVisibilityChangedEvent)}async streamEvents(){const events=new Subject$1,elements2=await this._elementsSetup.complete();return new MutationObserver(()=>{elements2.skribblModal.style.display!=="none"&&elements2.playerPopup.style.display==="flex"?events.next(new PlayerPopupVisibilityChangedEvent(!0)):events.next(new PlayerPopupVisibilityChangedEvent(!1))}).observe(elements2.playerPopup,{attributes:!0}),events.pipe(distinctUntilChanged(),debounceTime(50))}},__name(_a38,"PlayerPopupVisibilityChangedEventProcessor"),_a38);__decorateClass$1h([inject(ElementsSetup)],PlayerPopupVisibilityChangedEventProcessor.prototype,"_elementsSetup",2);PlayerPopupVisibilityChangedEventProcessor=__decorateClass$1h([injectable()],PlayerPopupVisibilityChangedEventProcessor);var _a39;let PlayerPopupVisibilityChangedEventListener=(_a39=class extends EventListener{constructor(){super(...arguments);__publicField(this,"_processor")}},__name(_a39,"PlayerPopupVisibilityChangedEventListener"),_a39);__decorateClass$1h([inject(PlayerPopupVisibilityChangedEventProcessor)],PlayerPopupVisibilityChangedEventListener.prototype,"_processor",2);PlayerPopupVisibilityChangedEventListener=__decorateClass$1h([injectable()],PlayerPopupVisibilityChangedEventListener);const playerPopupVisibilityChangedEventRegistration={listenerType:PlayerPopupVisibilityChangedEventListener,processorType:PlayerPopupVisibilityChangedEventProcessor};var __defProp$1g=Object.defineProperty,__getOwnPropDesc$v=Object.getOwnPropertyDescriptor,__decorateClass$1g=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$v(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1g(target,key,result),result},"__decorateClass$1g");const _RoundStartedEvent=class _RoundStartedEvent extends ApplicationEvent{constructor(data){super(),this.data=data}};__name(_RoundStartedEvent,"RoundStartedEvent");let RoundStartedEvent=_RoundStartedEvent;var _a40;let RoundStartedEventProcessor=(_a40=class extends EventProcessor{constructor(){super(...arguments);__publicField(this,"_skribblMessageRelaySetup");__publicField(this,"eventType",RoundStartedEvent)}async streamEvents(){const events=new Subject$1;return(await this._skribblMessageRelaySetup.complete()).serverMessages$.subscribe(event=>{if(event.id===11&&event.data.id==2){const round=event.data.data+1;this._logger.info("Round started",round),events.next(new RoundStartedEvent(round))}}),events}},__name(_a40,"RoundStartedEventProcessor"),_a40);__decorateClass$1g([inject(SkribblMessageRelaySetup)],RoundStartedEventProcessor.prototype,"_skribblMessageRelaySetup",2);RoundStartedEventProcessor=__decorateClass$1g([injectable()],RoundStartedEventProcessor);var _a41;let RoundStartedEventListener=(_a41=class extends EventListener{constructor(){super(...arguments);__publicField(this,"_processor")}},__name(_a41,"RoundStartedEventListener"),_a41);__decorateClass$1g([inject(RoundStartedEventProcessor)],RoundStartedEventListener.prototype,"_processor",2);RoundStartedEventListener=__decorateClass$1g([injectable()],RoundStartedEventListener);const roundStartedEventRegistration={listenerType:RoundStartedEventListener,processorType:RoundStartedEventProcessor};var __defProp$1f=Object.defineProperty,__getOwnPropDesc$u=Object.getOwnPropertyDescriptor,__decorateClass$1f=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$u(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1f(target,key,result),result},"__decorateClass$1f");const _ScoreboardVisibilityChangedEvent=class _ScoreboardVisibilityChangedEvent extends ApplicationEvent{constructor(data){super(),this.data=data}};__name(_ScoreboardVisibilityChangedEvent,"ScoreboardVisibilityChangedEvent");let ScoreboardVisibilityChangedEvent=_ScoreboardVisibilityChangedEvent;var _a42;let ScoreboardVisibilityChangedEventProcessor=(_a42=class extends EventProcessor{constructor(){super(...arguments);__publicField(this,"_elementsSetup");__publicField(this,"eventType",ScoreboardVisibilityChangedEvent)}async streamEvents(){const events=new Subject$1,elements2=await this._elementsSetup.complete();return new MutationObserver(()=>{elements2.scoreboardResults.classList.contains("show")?events.next(new ScoreboardVisibilityChangedEvent(!0)):events.next(new ScoreboardVisibilityChangedEvent(!1))}).observe(elements2.scoreboardResults,{attributes:!0}),events.pipe(distinctUntilChanged(),debounceTime(50))}},__name(_a42,"ScoreboardVisibilityChangedEventProcessor"),_a42);__decorateClass$1f([inject(ElementsSetup)],ScoreboardVisibilityChangedEventProcessor.prototype,"_elementsSetup",2);ScoreboardVisibilityChangedEventProcessor=__decorateClass$1f([injectable()],ScoreboardVisibilityChangedEventProcessor);var _a43;let ScoreboardVisibilityChangedEventListener=(_a43=class extends EventListener{constructor(){super(...arguments);__publicField(this,"_processor")}},__name(_a43,"ScoreboardVisibilityChangedEventListener"),_a43);__decorateClass$1f([inject(ScoreboardVisibilityChangedEventProcessor)],ScoreboardVisibilityChangedEventListener.prototype,"_processor",2);ScoreboardVisibilityChangedEventListener=__decorateClass$1f([injectable()],ScoreboardVisibilityChangedEventListener);const scoreboardVisibilityChangedEventRegistration={listenerType:ScoreboardVisibilityChangedEventListener,processorType:ScoreboardVisibilityChangedEventProcessor};var __defProp$1e=Object.defineProperty,__getOwnPropDesc$t=Object.getOwnPropertyDescriptor,__decorateClass$1e=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$t(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1e(target,key,result),result},"__decorateClass$1e");const _SizeChangedEvent=class _SizeChangedEvent extends ApplicationEvent{constructor(data){super(),this.data=data}};__name(_SizeChangedEvent,"SizeChangedEvent");let SizeChangedEvent=_SizeChangedEvent;var _a44;let SizeChangedEventProcessor=(_a44=class extends EventProcessor{constructor(){super(...arguments);__publicField(this,"eventType",SizeChangedEvent)}async streamEvents(){const events=new Subject$1;return document.addEventListener("skribblSizeChanged",event=>{const size=Number(event.detail);events.next(new SizeChangedEvent(size)),this._logger.info("Size changed",size)}),events}},__name(_a44,"SizeChangedEventProcessor"),_a44);SizeChangedEventProcessor=__decorateClass$1e([injectable()],SizeChangedEventProcessor);var _a45;let SizeChangedEventListener=(_a45=class extends EventListener{constructor(){super(...arguments);__publicField(this,"_processor")}},__name(_a45,"SizeChangedEventListener"),_a45);__decorateClass$1e([inject(SizeChangedEventProcessor)],SizeChangedEventListener.prototype,"_processor",2);SizeChangedEventListener=__decorateClass$1e([injectable()],SizeChangedEventListener);const sizeChangedEventRegistration={listenerType:SizeChangedEventListener,processorType:SizeChangedEventProcessor};var __defProp$1d=Object.defineProperty,__getOwnPropDesc$s=Object.getOwnPropertyDescriptor,__decorateClass$1d=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$s(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1d(target,key,result),result},"__decorateClass$1d");const _TextOverlayVisibilityChangedEvent=class _TextOverlayVisibilityChangedEvent extends ApplicationEvent{constructor(data){super(),this.data=data}};__name(_TextOverlayVisibilityChangedEvent,"TextOverlayVisibilityChangedEvent");let TextOverlayVisibilityChangedEvent=_TextOverlayVisibilityChangedEvent;var _a46;let TextOverlayVisibilityChangedEventProcessor=(_a46=class extends EventProcessor{constructor(){super(...arguments);__publicField(this,"_elementsSetup");__publicField(this,"eventType",TextOverlayVisibilityChangedEvent)}async streamEvents(){const events=new Subject$1,elements2=await this._elementsSetup.complete();return new MutationObserver(()=>{elements2.canvasOverlay.style.top!=="100%"&&elements2.textOverlay.classList.contains("show")?events.next(new TextOverlayVisibilityChangedEvent(!0)):events.next(new TextOverlayVisibilityChangedEvent(!1))}).observe(elements2.textOverlay,{attributes:!0}),events.pipe(distinctUntilChanged(),debounceTime(50))}},__name(_a46,"TextOverlayVisibilityChangedEventProcessor"),_a46);__decorateClass$1d([inject(ElementsSetup)],TextOverlayVisibilityChangedEventProcessor.prototype,"_elementsSetup",2);TextOverlayVisibilityChangedEventProcessor=__decorateClass$1d([injectable()],TextOverlayVisibilityChangedEventProcessor);var _a47;let TextOverlayVisibilityChangedEventListener=(_a47=class extends EventListener{constructor(){super(...arguments);__publicField(this,"_processor")}},__name(_a47,"TextOverlayVisibilityChangedEventListener"),_a47);__decorateClass$1d([inject(TextOverlayVisibilityChangedEventProcessor)],TextOverlayVisibilityChangedEventListener.prototype,"_processor",2);TextOverlayVisibilityChangedEventListener=__decorateClass$1d([injectable()],TextOverlayVisibilityChangedEventListener);const textOverlayVisibilityChangedEventRegistration={listenerType:TextOverlayVisibilityChangedEventListener,processorType:TextOverlayVisibilityChangedEventProcessor};var __defProp$1c=Object.defineProperty,__getOwnPropDesc$r=Object.getOwnPropertyDescriptor,__decorateClass$1c=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$r(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1c(target,key,result),result},"__decorateClass$1c"),skribblTool=(skribblTool2=>(skribblTool2[skribblTool2.brush=0]="brush",skribblTool2[skribblTool2.fill=1]="fill",skribblTool2[skribblTool2.deselected=-1]="deselected",skribblTool2[skribblTool2.other=2]="other",skribblTool2))(skribblTool||{});const _ToolChangedEvent=class _ToolChangedEvent extends ApplicationEvent{constructor(data){super(),this.data=data}};__name(_ToolChangedEvent,"ToolChangedEvent");let ToolChangedEvent=_ToolChangedEvent;var _a48;let ToolChangedEventProcessor=(_a48=class extends EventProcessor{constructor(){super(...arguments);__publicField(this,"eventType",ToolChangedEvent)}async streamEvents(){const events=new Subject$1;return document.addEventListener("skribblToolChanged",event=>{const tool=event.detail,toolEnum=tool>2?2:tool;events.next(new ToolChangedEvent(toolEnum)),this._logger.info("Tool changed",toolEnum)}),events}},__name(_a48,"ToolChangedEventProcessor"),_a48);ToolChangedEventProcessor=__decorateClass$1c([injectable()],ToolChangedEventProcessor);var _a49;let ToolChangedEventListener=(_a49=class extends EventListener{constructor(){super(...arguments);__publicField(this,"_processor")}},__name(_a49,"ToolChangedEventListener"),_a49);__decorateClass$1c([inject(ToolChangedEventProcessor)],ToolChangedEventListener.prototype,"_processor",2);ToolChangedEventListener=__decorateClass$1c([injectable()],ToolChangedEventListener);const toolChangedEventRegistration={listenerType:ToolChangedEventListener,processorType:ToolChangedEventProcessor};var __defProp$1b=Object.defineProperty,__getOwnPropDesc$q=Object.getOwnPropertyDescriptor,__decorateClass$1b=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$q(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1b(target,key,result),result},"__decorateClass$1b");const _WordGuessedEvent=class _WordGuessedEvent extends ApplicationEvent{constructor(data){super(),this.data=data}};__name(_WordGuessedEvent,"WordGuessedEvent");let WordGuessedEvent=_WordGuessedEvent;var _a50;let WordGuessedEventProcessor=(_a50=class extends EventProcessor{constructor(){super(...arguments);__publicField(this,"_skribblMessageRelaySetup");__publicField(this,"eventType",WordGuessedEvent)}async streamEvents(){const events=new Subject$1;return(await this._skribblMessageRelaySetup.complete()).serverMessages$.subscribe(event=>{if(event.id===15){const guessed={playerId:event.data.id,word:event.data.word??void 0};this._logger.info("Word guessed",guessed),events.next(new WordGuessedEvent(guessed))}}),events}},__name(_a50,"WordGuessedEventProcessor"),_a50);__decorateClass$1b([inject(SkribblMessageRelaySetup)],WordGuessedEventProcessor.prototype,"_skribblMessageRelaySetup",2);WordGuessedEventProcessor=__decorateClass$1b([injectable()],WordGuessedEventProcessor);var _a51;let WordGuessedEventListener=(_a51=class extends EventListener{constructor(){super(...arguments);__publicField(this,"_processor")}},__name(_a51,"WordGuessedEventListener"),_a51);__decorateClass$1b([inject(WordGuessedEventProcessor)],WordGuessedEventListener.prototype,"_processor",2);WordGuessedEventListener=__decorateClass$1b([injectable()],WordGuessedEventListener);const wordGuessedEventRegistration={listenerType:WordGuessedEventListener,processorType:WordGuessedEventProcessor},_HotkeyAction=class _HotkeyAction{constructor(_key,_name,_description,_feature,_action,defaultEnabled,_defaultCombo,_releaseAction,_preventWhenInputActive=!0){__publicField(this,"_enabledSetting");__publicField(this,"_comboSetting");this._key=_key,this._name=_name,this._description=_description,this._feature=_feature,this._action=_action,this._defaultCombo=_defaultCombo,this._releaseAction=_releaseAction,this._preventWhenInputActive=_preventWhenInputActive,this._enabledSetting=new ExtensionSetting(`
    hotkey.${this._key}.enabled`,defaultEnabled===!0&&this._defaultCombo!==void 0&&this._defaultCombo.length>0,this._feature),this._comboSetting=new ExtensionSetting(`hotkey.${this._key}.combo`,this._defaultCombo??[],this._feature)}get disabledOnInputs(){return this._preventWhenInputActive}get name(){return this._name}get description(){return this._description}get enabledSetting(){return this._enabledSetting.asFrozen}get comboSetting(){return this._comboSetting.asFrozen}get defaultCombo(){return this._defaultCombo}executeIfMatches(keys,inputActive){return this._enabledSetting.changes$.pipe(take(1),withLatestFrom(this._comboSetting.changes$),map(([enabled,combo])=>enabled&&!(this._preventWhenInputActive&&inputActive)&&combo.length>0?combo:null),map(combo=>combo?combo.length===keys.length&&combo.every(key=>keys.includes(key)):!1),switchMap(matches=>{if(!matches)return of(!1);const result=this._action();return result instanceof Promise?fromPromise(result).pipe(map(()=>!0)):of(!0)}))}releaseIfNotMatches(keys){return this._comboSetting.changes$.pipe(take(1),map(combo=>combo?combo.length===keys.length&&combo.every(key=>keys.includes(key)):!1),switchMap(matches=>{if(matches)return of(!1);if(this._releaseAction){const result=this._releaseAction();return result instanceof Promise?fromPromise(result).pipe(map(()=>!0)):of(!0)}return of(!0)}))}};__name(_HotkeyAction,"HotkeyAction");let HotkeyAction=_HotkeyAction;const parseSkribblLobbyDataEvent=__name((data,languages)=>({id:data.id??null,private:data.type===1,meId:data.me,ownerId:data.owner==-1?null:data.owner,drawerId:null,round:data.round+1,settings:{language:languages.get(data.settings[0])??"Unknown",players:data.settings[1],drawTime:data.settings[2],rounds:data.settings[3]},players:data.users}),"parseSkribblLobbyDataEvent");var __defProp$1a=Object.defineProperty,__getOwnPropDesc$p=Object.getOwnPropertyDescriptor,__decorateClass$1a=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$p(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$1a(target,key,result),result},"__decorateClass$1a");const _LobbyJoinedEvent=class _LobbyJoinedEvent extends ApplicationEvent{constructor(data){super(),this.data=data}};__name(_LobbyJoinedEvent,"LobbyJoinedEvent");let LobbyJoinedEvent=_LobbyJoinedEvent;var _a52;let LobbyJoinedEventProcessor=(_a52=class extends EventProcessor{constructor(){super(...arguments);__publicField(this,"_gameSettingsSetup");__publicField(this,"_skribblMessageRelaySetup");__publicField(this,"eventType",LobbyJoinedEvent)}async streamEvents(){const events=new Subject$1,skribblMessages=await this._skribblMessageRelaySetup.complete(),gameSettings=await this._gameSettingsSetup.complete();return skribblMessages.serverMessages$.subscribe(event=>{var _a81;if(event.id===10){const lobby=parseSkribblLobbyDataEvent(event.data,gameSettings.languageSettings),initialUpdate=parseLobbyStateUpdate(event.data.state);lobby.drawerId=((_a81=initialUpdate==null?void 0:initialUpdate.drawingStarted)==null?void 0:_a81.drawerId)??null,this._logger.info("Lobby joined",lobby),events.next(new LobbyJoinedEvent(lobby))}}),document.addEventListener("practiceJoined",async data=>{const gameSettings2=await this._gameSettingsSetup.complete(),lobby=parseSkribblLobbyDataEvent(data.detail,gameSettings2.languageSettings);this._logger.info("Practice lobby joined",lobby),events.next(new LobbyJoinedEvent(lobby))}),events}},__name(_a52,"LobbyJoinedEventProcessor"),_a52);__decorateClass$1a([inject(GameSettingsSetup)],LobbyJoinedEventProcessor.prototype,"_gameSettingsSetup",2);__decorateClass$1a([inject(SkribblMessageRelaySetup)],LobbyJoinedEventProcessor.prototype,"_skribblMessageRelaySetup",2);LobbyJoinedEventProcessor=__decorateClass$1a([injectable()],LobbyJoinedEventProcessor);var _a53;let LobbyJoinedEventListener=(_a53=class extends EventListener{constructor(){super(...arguments);__publicField(this,"_processor")}},__name(_a53,"LobbyJoinedEventListener"),_a53);__decorateClass$1a([inject(LobbyJoinedEventProcessor)],LobbyJoinedEventListener.prototype,"_processor",2);LobbyJoinedEventListener=__decorateClass$1a([injectable()],LobbyJoinedEventListener);const lobbyJoinedEventRegistration={listenerType:LobbyJoinedEventListener,processorType:LobbyJoinedEventProcessor};var __defProp$19=Object.defineProperty,__getOwnPropDesc$o=Object.getOwnPropertyDescriptor,__decorateClass$19=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$o(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$19(target,key,result),result},"__decorateClass$19");const _LobbyLeftEvent=class _LobbyLeftEvent extends ApplicationEvent{constructor(data){super(),this.data=data}};__name(_LobbyLeftEvent,"LobbyLeftEvent");let LobbyLeftEvent=_LobbyLeftEvent;var _a54;let LobbyLeftEventProcessor=(_a54=class extends EventProcessor{constructor(){super(...arguments);__publicField(this,"eventType",LobbyLeftEvent)}streamEvents(){const events=new Subject$1;return document.addEventListener("leftLobby",async()=>{this._logger.info("Lobby left"),events.next(new LobbyLeftEvent(null))}),events}},__name(_a54,"LobbyLeftEventProcessor"),_a54);LobbyLeftEventProcessor=__decorateClass$19([injectable()],LobbyLeftEventProcessor);var _a55;let LobbyLeftEventListener=(_a55=class extends EventListener{constructor(){super(...arguments);__publicField(this,"_processor")}},__name(_a55,"LobbyLeftEventListener"),_a55);__decorateClass$19([inject(LobbyLeftEventProcessor)],LobbyLeftEventListener.prototype,"_processor",2);LobbyLeftEventListener=__decorateClass$19([injectable()],LobbyLeftEventListener);const lobbyLeftEventRegistration={listenerType:LobbyLeftEventListener,processorType:LobbyLeftEventProcessor};var __defProp$18=Object.defineProperty,__getOwnPropDesc$n=Object.getOwnPropertyDescriptor,__decorateClass$18=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$n(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$18(target,key,result),result},"__decorateClass$18"),__decorateParam$j=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$j"),_a56;let LobbyService=(_a56=class{constructor(loggerFactory2,lobbyJoined,lobbyLeft,lobbyPlayerChanged,lobbyStateChanged,roundStarted,wordGuessed,elementsSetup){__publicField(this,"_logger");__publicField(this,"_currentLobby$",new BehaviorSubject(null));__publicField(this,"_currentLobbyDebounced$",new BehaviorSubject(null));__publicField(this,"_discoveredLobbies$",new BehaviorSubject(new Map));this.lobbyJoined=lobbyJoined,this.lobbyLeft=lobbyLeft,this.lobbyPlayerChanged=lobbyPlayerChanged,this.lobbyStateChanged=lobbyStateChanged,this.roundStarted=roundStarted,this.wordGuessed=wordGuessed,this.elementsSetup=elementsSetup,this._logger=loggerFactory2(this),merge$1(lobbyLeft.events$,lobbyJoined.events$,lobbyPlayerChanged.events$,lobbyStateChanged.events$,roundStarted.events$,wordGuessed.events$).pipe(withLatestFrom(this._currentLobby$),map(data=>({update:data[0],currentLobby:data[1]})),map(({update,currentLobby})=>{if(this._logger.debug("Lobby update",update,currentLobby),currentLobby=currentLobby===null?null:structuredClone(currentLobby),update instanceof LobbyLeftEvent)currentLobby=null;else if(update instanceof LobbyJoinedEvent)currentLobby=update.data;else if(currentLobby!==null&&update instanceof RoundStartedEvent)currentLobby.round=update.data;else if(currentLobby!==null&&update instanceof WordGuessedEvent){const guessed=update.data;currentLobby.players.forEach(player=>{player.id===guessed.playerId&&(player.guessed=!0)})}else if(currentLobby!==null&&update instanceof LobbyStateChangedEvent){const data=update.data;if(data.drawingRevealed){const scores=new Map(data.drawingRevealed.scores.map(score=>[score.playerId,score.score]));currentLobby.players.forEach(player=>{player.guessed=!1,player.score=scores.get(player.id)??player.score}),currentLobby.drawerId=null}data.drawingStarted!==void 0&&(currentLobby.drawerId=data.drawingStarted.drawerId)}else if(currentLobby!==null&&update instanceof LobbyPlayerChangedEvent){const data=update.data;if(data.left){const left=data.left;currentLobby.players=currentLobby.players.filter(user=>user.id!==left.id)}else data.joined&&currentLobby.players.push(data.joined)}return this._logger.debug("Lobby update processed",currentLobby),currentLobby}),tap(lobby=>this._currentLobby$.next(lobby)),debounceTime(100),distinctUntilChanged((curr,prev)=>JSON.stringify(curr)===JSON.stringify(prev))).subscribe(data=>this._currentLobbyDebounced$.next(data)),this.lobby$.subscribe(data=>{this._logger.info("Lobby changed",data);const map2=this._discoveredLobbies$.value;data!==null&&data.id!==null&&map2.set(data.id,{...data,seenAt:Date.now()}),this._discoveredLobbies$.next(map2)})}async joinLobby(id2){if(this._currentLobby$.value!==null)throw this._logger.warn("Attempted to join a lobby while already in one"),new Error("Already in a lobby");const elements2=await this.elementsSetup.complete();elements2.load.style.display="block",elements2.home.style.display="none",document.dispatchEvent(new CustomEvent("joinLobby",{detail:id2}))}leaveLobby(){if(this._currentLobby$.value===null)throw this._logger.warn("Attempted to leave a lobby while not in one"),new Error("Not in a lobby");document.dispatchEvent(new CustomEvent("leaveLobby"))}get lobby$(){return this._currentLobbyDebounced$.asObservable()}get discoveredLobbies$(){return this._discoveredLobbies$.pipe(map(map2=>Array.from(map2.values())))}},__name(_a56,"LobbyService"),_a56);LobbyService=__decorateClass$18([injectable(),__decorateParam$j(0,inject(loggerFactory)),__decorateParam$j(1,inject(LobbyJoinedEventListener)),__decorateParam$j(2,inject(LobbyLeftEventListener)),__decorateParam$j(3,inject(LobbyPlayerChangedEventListener)),__decorateParam$j(4,inject(LobbyStateChangedEventListener)),__decorateParam$j(5,inject(RoundStartedEventListener)),__decorateParam$j(6,inject(WordGuessedEventListener)),__decorateParam$j(7,inject(ElementsSetup))],LobbyService);function create_fragment$14(ctx){let div1,div0,t0,span,t1;return{c(){div1=element$1("div"),div0=element$1("div"),t0=space(),span=element$1("span"),t1=text(ctx[0]),attr(div0,"class","icon svelte-c1csua"),attr(span,"class","svelte-c1csua"),attr(div1,"class","svelte-c1csua")},m(target,anchor){insert(target,div1,anchor),append(div1,div0),append(div1,t0),append(div1,span),append(span,t1)},p(ctx2,[dirty]){dirty&1&&set_data(t1,ctx2[0])},i:noop$1,o:noop$1,d(detaching){detaching&&detach(div1)}}}__name(create_fragment$14,"create_fragment$14");function instance$Z($$self,$$props,$$invalidate){let{content="Loading..."}=$$props;return $$self.$$set=$$props2=>{"content"in $$props2&&$$invalidate(0,content=$$props2.content)},[content]}__name(instance$Z,"instance$Z");const _Bounceload=class _Bounceload extends SvelteComponent{constructor(options){super(),init(this,options,instance$Z,create_fragment$14,safe_not_equal,{content:0})}};__name(_Bounceload,"Bounceload");let Bounceload=_Bounceload;function create_if_block_3$7(ctx){let h3,t;return{c(){h3=element$1("h3"),t=text(ctx[1]),attr(h3,"class","svelte-1oknvt7")},m(target,anchor){insert(target,h3,anchor),append(h3,t)},p(ctx2,dirty){dirty&2&&set_data(t,ctx2[1])},d(detaching){detaching&&detach(h3)}}}__name(create_if_block_3$7,"create_if_block_3$7");function create_else_block$f(ctx){let t,if_block1_anchor,if_block0=ctx[3]&&create_if_block_2$c(ctx),if_block1=ctx[0]!==void 0&&create_if_block_1$i(ctx);return{c(){if_block0&&if_block0.c(),t=space(),if_block1&&if_block1.c(),if_block1_anchor=empty()},m(target,anchor){if_block0&&if_block0.m(target,anchor),insert(target,t,anchor),if_block1&&if_block1.m(target,anchor),insert(target,if_block1_anchor,anchor)},p(ctx2,dirty){ctx2[3]?if_block0?if_block0.p(ctx2,dirty):(if_block0=create_if_block_2$c(ctx2),if_block0.c(),if_block0.m(t.parentNode,t)):if_block0&&(if_block0.d(1),if_block0=null),ctx2[0]!==void 0?if_block1?if_block1.p(ctx2,dirty):(if_block1=create_if_block_1$i(ctx2),if_block1.c(),if_block1.m(if_block1_anchor.parentNode,if_block1_anchor)):if_block1&&(if_block1.d(1),if_block1=null)},i:noop$1,o:noop$1,d(detaching){detaching&&(detach(t),detach(if_block1_anchor)),if_block0&&if_block0.d(detaching),if_block1&&if_block1.d(detaching)}}}__name(create_else_block$f,"create_else_block$f");function create_if_block$y(ctx){let bounceload,current;return bounceload=new Bounceload({props:{content:ctx[0]}}),{c(){create_component(bounceload.$$.fragment)},m(target,anchor){mount_component(bounceload,target,anchor),current=!0},p(ctx2,dirty){const bounceload_changes={};dirty&1&&(bounceload_changes.content=ctx2[0]),bounceload.$set(bounceload_changes)},i(local){current||(transition_in(bounceload.$$.fragment,local),current=!0)},o(local){transition_out(bounceload.$$.fragment,local),current=!1},d(detaching){destroy_component(bounceload,detaching)}}}__name(create_if_block$y,"create_if_block$y");function create_if_block_2$c(ctx){let span,mounted,dispose;return{c(){span=element$1("span"),span.textContent="×",attr(span,"class","close-toast svelte-1oknvt7")},m(target,anchor){insert(target,span,anchor),mounted||(dispose=listen(span,"click",ctx[7]),mounted=!0)},p:noop$1,d(detaching){detaching&&detach(span),mounted=!1,dispose()}}}__name(create_if_block_2$c,"create_if_block_2$c");function create_if_block_1$i(ctx){let span,t;return{c(){span=element$1("span"),t=text(ctx[0])},m(target,anchor){insert(target,span,anchor),append(span,t)},p(ctx2,dirty){dirty&1&&set_data(t,ctx2[0])},d(detaching){detaching&&detach(span)}}}__name(create_if_block_1$i,"create_if_block_1$i");function create_fragment$13(ctx){let div,t,current_block_type_index,if_block1,current,if_block0=ctx[1]!==void 0&&create_if_block_3$7(ctx);const if_block_creators=[create_if_block$y,create_else_block$f],if_blocks=[];function select_block_type(ctx2,dirty){return ctx2[2]?0:1}return __name(select_block_type,"select_block_type"),current_block_type_index=select_block_type(ctx),if_block1=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx),{c(){div=element$1("div"),if_block0&&if_block0.c(),t=space(),if_block1.c(),attr(div,"class","typo-toast svelte-1oknvt7"),toggle_class(div,"closing",ctx[5]),toggle_class(div,"loading",ctx[2])},m(target,anchor){insert(target,div,anchor),if_block0&&if_block0.m(div,null),append(div,t),if_blocks[current_block_type_index].m(div,null),current=!0},p(ctx2,[dirty]){ctx2[1]!==void 0?if_block0?if_block0.p(ctx2,dirty):(if_block0=create_if_block_3$7(ctx2),if_block0.c(),if_block0.m(div,t)):if_block0&&(if_block0.d(1),if_block0=null);let previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx2),current_block_type_index===previous_block_index?if_blocks[current_block_type_index].p(ctx2,dirty):(group_outros(),transition_out(if_blocks[previous_block_index],1,1,()=>{if_blocks[previous_block_index]=null}),check_outros(),if_block1=if_blocks[current_block_type_index],if_block1?if_block1.p(ctx2,dirty):(if_block1=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx2),if_block1.c()),transition_in(if_block1,1),if_block1.m(div,null)),(!current||dirty&32)&&toggle_class(div,"closing",ctx2[5]),(!current||dirty&4)&&toggle_class(div,"loading",ctx2[2])},i(local){current||(transition_in(if_block1),current=!0)},o(local){transition_out(if_block1),current=!1},d(detaching){detaching&&detach(div),if_block0&&if_block0.d(),if_blocks[current_block_type_index].d()}}}__name(create_fragment$13,"create_fragment$13");function instance$Y($$self,$$props,$$invalidate){let{content}=$$props,{title}=$$props,{closeHandler}=$$props,{showLoading=!1}=$$props,{allowClose=!0}=$$props,closing=!1;const close=__name(()=>{setTimeout(()=>closeHandler(),150),$$invalidate(5,closing=!0)},"close"),click_handler2=__name(()=>close(),"click_handler");return $$self.$$set=$$props2=>{"content"in $$props2&&$$invalidate(0,content=$$props2.content),"title"in $$props2&&$$invalidate(1,title=$$props2.title),"closeHandler"in $$props2&&$$invalidate(6,closeHandler=$$props2.closeHandler),"showLoading"in $$props2&&$$invalidate(2,showLoading=$$props2.showLoading),"allowClose"in $$props2&&$$invalidate(3,allowClose=$$props2.allowClose)},[content,title,showLoading,allowClose,close,closing,closeHandler,click_handler2]}__name(instance$Y,"instance$Y");const _Toast=class _Toast extends SvelteComponent{constructor(options){super(),init(this,options,instance$Y,create_fragment$13,safe_not_equal,{content:0,title:1,closeHandler:6,showLoading:2,allowClose:3,close:4})}get close(){return this.$$.ctx[4]}};__name(_Toast,"Toast");let Toast=_Toast;var __defProp$17=Object.defineProperty,__getOwnPropDesc$m=Object.getOwnPropertyDescriptor,__decorateClass$17=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$m(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$17(target,key,result),result},"__decorateClass$17"),__decorateParam$i=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$i"),_a57;let ToastService=(_a57=class{constructor(loggerFactory2,_elementsSetup){__publicField(this,"_logger");this._elementsSetup=_elementsSetup,this._logger=loggerFactory2(this)}async showToast(title,content,timeout2){const elements2=await this._elementsSetup.complete(),toast=new Toast({target:elements2.toastContainer,props:{closeHandler:__name(()=>{toast.$destroy()},"closeHandler"),title,content,showLoading:!1}});setTimeout(()=>toast.close(),timeout2??3e3)}async showStickyToast(title,content,allowClose){const elements2=await this._elementsSetup.complete(),closed=new Subject$1,toast=new Toast({target:elements2.toastContainer,props:{closeHandler:__name(()=>{toast.$destroy(),closed.next()},"closeHandler"),title,content,showLoading:!1,allowClose:allowClose===void 0?!1:allowClose}});return{close:__name(()=>toast.close(),"close"),update:__name((title2,content2)=>{toast.$set({title:title2,content:content2})},"update"),closed$:closed.asObservable()}}async showLoadingToast(content){const elements2=await this._elementsSetup.complete(),toast=new Toast({target:elements2.toastContainer,props:{closeHandler:__name(()=>{toast.$destroy()},"closeHandler"),title:void 0,content,showLoading:!0}});return{close:__name(()=>toast.close(),"close"),resolve:__name((message,timeout2)=>{toast.$set({showLoading:!1,title:message??"Done"}),setTimeout(()=>toast.close(),timeout2??3e3)},"resolve"),reject:__name((message,title,timeout2)=>{toast.$set({showLoading:!1,title:title??"Error"}),message!==void 0&&toast.$set({content:message}),setTimeout(()=>toast.close(),timeout2??3e3)},"reject")}}},__name(_a57,"ToastService"),_a57);ToastService=__decorateClass$17([injectable(),__decorateParam$i(0,inject(loggerFactory)),__decorateParam$i(1,inject(ElementsSetup))],ToastService);var __defProp$16=Object.defineProperty,__getOwnPropDesc$l=Object.getOwnPropertyDescriptor,__decorateClass$16=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$l(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$16(target,key,result),result},"__decorateClass$16"),_a58;let PrioritizedCanvasEventsSetup=(_a58=class extends Setup{constructor(){super(...arguments);__publicField(this,"_interceptor")}async runSetup(){return this._interceptor.canvasPrioritizedEventsReady}},__name(_a58,"PrioritizedCanvasEventsSetup"),_a58);__decorateClass$16([inject(Interceptor)],PrioritizedCanvasEventsSetup.prototype,"_interceptor",2);PrioritizedCanvasEventsSetup=__decorateClass$16([earlySetup()],PrioritizedCanvasEventsSetup);function create_fragment$12(ctx){let t0,br0,t1,br1,t2,br2,br3,t3,br4,t4,br5;return{c(){t0=text("Canvas Zoom lets you zoom the drawing canvas, so you can work on details more easily. "),br0=element$1("br"),t1=text(`
To start zooming, press the "Zoom Start" hotkey and click somewhere on the canvas while holding the hotkey. `),br1=element$1("br"),t2=text(`
The center of the zoomed area will be where you clicked. `),br2=element$1("br"),br3=element$1("br"),t3=text(`
To adjust the zoom level, you can press the Zoom Level hotkeys.`),br4=element$1("br"),t4=text(`
You can exit the zoom like you entered it, by pressing the "Zoom Start" hotkey and clicking somewhere on the canvas. `),br5=element$1("br")},m(target,anchor){insert(target,t0,anchor),insert(target,br0,anchor),insert(target,t1,anchor),insert(target,br1,anchor),insert(target,t2,anchor),insert(target,br2,anchor),insert(target,br3,anchor),insert(target,t3,anchor),insert(target,br4,anchor),insert(target,t4,anchor),insert(target,br5,anchor)},p:noop$1,i:noop$1,o:noop$1,d(detaching){detaching&&(detach(t0),detach(br0),detach(t1),detach(br1),detach(t2),detach(br2),detach(br3),detach(t3),detach(br4),detach(t4),detach(br5))}}}__name(create_fragment$12,"create_fragment$12");const _Canvas_zoom_info=class _Canvas_zoom_info extends SvelteComponent{constructor(options){super(),init(this,options,null,create_fragment$12,safe_not_equal,{})}};__name(_Canvas_zoom_info,"Canvas_zoom_info");let Canvas_zoom_info=_Canvas_zoom_info;var __defProp$15=Object.defineProperty,__decorateClass$15=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$15(target,key,result),result},"__decorateClass$15");const _CanvasZoomFeature=class _CanvasZoomFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_toastService");__publicField(this,"_prioritizedCanvasEventsSetup");__publicField(this,"_lobbyStateChangedEventListener");__publicField(this,"_imageResetEventListener");__publicField(this,"_lobbyService");__publicField(this,"name","Canvas Zoom");__publicField(this,"description","Lets you zoom a section of the canvas when you're drawing");__publicField(this,"featureId",26);__publicField(this,"_enableOnlyWhenDrawingSetting",this.useSetting(new BooleanExtensionSetting("trigger_require_drawing",!0,this).withName("Zoom Only When Drawing").withDescription("Only allow start zooming with the hotkey when you're currently drawing")));__publicField(this,"_startZoomHotkey",this.useHotkey(new HotkeyAction("start_zoom","Start Zoom","While pressed, a click on the canvas will start zooming",this,()=>this._zoomListenToggle$.next(!0),!0,["ControlLeft"],()=>this._zoomListenToggle$.next(!1))));__publicField(this,"_zoomLevelHotkeys",[1,2,3,4,5].map(level=>this.useHotkey(new HotkeyAction(`zoom_level_${level}`,`Zoom Level ${level}`,`Set the zoom level to ${level}`,this,()=>this._zoomLevel$.next(level),!0,[`Digit${level}`]))));__publicField(this,"_zoomListenToggle$",new BehaviorSubject(!1));__publicField(this,"_zoomActive$",new BehaviorSubject(!1));__publicField(this,"_zoomLevel$",new BehaviorSubject(1));__publicField(this,"_toastHandle");__publicField(this,"_zoomStateSubscription");__publicField(this,"_zoomStyle");__publicField(this,"_canvasClickListener",this.onCanvasClick.bind(this))}get featureInfoComponent(){return{componentType:Canvas_zoom_info,props:{}}}async onActivate(){const{add}=await this._prioritizedCanvasEventsSetup.complete();add("preDraw")("pointerdown",this._canvasClickListener),this._zoomStyle=new CSSStyleSheet,document.adoptedStyleSheets=[...document.adoptedStyleSheets,this._zoomStyle];const zoomTogglePipe$=this._zoomListenToggle$.pipe(withLatestFrom(this._lobbyService.lobby$,this._enableOnlyWhenDrawingSetting.changes$),filter(([active,lobby,onlyWhenDrawing])=>!active||!onlyWhenDrawing||lobby!==null&&lobby.drawerId===lobby.meId),map(([active])=>active),distinctUntilChanged(),tap(active=>this._logger.info("Zoom activation",active))),zoomActivePipe$=this._zoomActive$.pipe(withLatestFrom(zoomTogglePipe$),filter(([active,listening])=>!active||listening),map(([active])=>active),mergeWith(this._lobbyStateChangedEventListener.events$.pipe(filter(event=>event.data.drawingRevealed!==void 0||event.data.drawingStarted!==void 0),map(()=>"reset")),this._imageResetEventListener.events$.pipe(filter(event=>event.data===0),map(()=>"reset"))),tap(data=>{data==="reset"&&(this._zoomActive$.next(!1),this._logger.info("Resetting zoom state"))}),filter(data=>data!=="reset"),distinctUntilChanged(),tap(active=>this._logger.info("Zoom active state",active)));this._zoomStateSubscription=zoomTogglePipe$.pipe(combineLatestWith(zoomActivePipe$,this._zoomLevel$),pairwise()).subscribe(state=>this.processZoomStateUpdate(state))}async onDestroy(){var _a81,_b;const{remove}=await this._prioritizedCanvasEventsSetup.complete();remove("pointerdown",this._canvasClickListener),document.adoptedStyleSheets=document.adoptedStyleSheets.filter(s=>s!==this._zoomStyle),this._zoomStyle=void 0,(_a81=this._toastHandle)==null||_a81.close(),(_b=this._zoomStateSubscription)==null||_b.unsubscribe(),this._zoomStateSubscription=void 0,this._toastHandle=void 0,this._zoomActive$.next(!1),this._zoomListenToggle$.next(!1)}async setZoom(level,position){this._logger.debug("Setting zoom level",level);const sheet=this._zoomStyle;if(!sheet){this._logger.error("Zoom style element not found");return}if(level===void 0||position===void 0){await sheet.replace("");return}await sheet.replace(`
      #game-canvas {
        width: 800px;
        aspect-ratio: 8/6;
      }
   
      #game-canvas canvas {
        position: absolute;
        width: calc(${level*2} * 100%);
        top: calc(-100% * (${position[1]} / 600 * ${level*2-1}));
        left: calc(-100% * (${position[0]} / 800 * ${level*2-1}));
      }
    `)}onCanvasClick(event){if(this._logger.debug("Canvas clicked",event),this._zoomListenToggle$.value){event.preventDefault(),event.stopImmediatePropagation();const next=this._zoomActive$.value===!1;return next&&this._zoomLevel$.next(1),this._zoomActive$.next(next?[event.offsetX,event.offsetY]:!1),!1}}async processZoomStateUpdate([[prevListening,prevActive,prevLevel],[listening,active,level]]){var _a81;if(this._logger.debug("Zoom state processing",{prevListening,prevActive,prevLevel},{listening,active,level},this._toastHandle),await this.setZoom(active!==!1?level:void 0,active!==!1?active:void 0),active===!1&&prevActive===!1&&listening&&!prevListening)this._toastHandle!==void 0&&(this._logger.warn("Toast handle unexpected existing when not active and listening"),this._toastHandle.close()),this._toastHandle=await this._toastService.showStickyToast("Starting Zoom","Click on the canvas to start zooming");else if(!listening&&prevListening&&active===!1&&prevActive===!1||active===!1&&prevActive!==!1)!this._toastHandle&&!active&&prevActive!==!1&&this._logger.warn("Toast handle unexpected not existing when ended active",{listening,active,level}),(_a81=this._toastHandle)==null||_a81.close(),this._toastHandle=void 0;else if(active!==!1&&prevActive!==!1&&listening&&!prevListening){if(this._toastHandle===void 0){this._logger.error("Toast handle unexpected not existing when active and listening");return}this._toastHandle.update("Stopping Zoom","Click on the canvas to exit zooming")}else active!==!1?(this._toastHandle===void 0&&(this._toastHandle=await this._toastService.showStickyToast("Starting Zoom","Click on the canvas to start zooming")),this._toastHandle.update("Canvas Zoom Active",`Current zoom level: ${level}`)):!listening&&this._toastHandle!==void 0&&(this._logger.warn("Toast handle unexpected existing when in inactive catch-all state"),this._toastHandle.close(),this._toastHandle=void 0)}get onlyWhenDrawingStore(){return this._enableOnlyWhenDrawingSetting.store}};__name(_CanvasZoomFeature,"CanvasZoomFeature");let CanvasZoomFeature=_CanvasZoomFeature;__decorateClass$15([inject(ToastService)],CanvasZoomFeature.prototype,"_toastService");__decorateClass$15([inject(PrioritizedCanvasEventsSetup)],CanvasZoomFeature.prototype,"_prioritizedCanvasEventsSetup");__decorateClass$15([inject(LobbyStateChangedEventListener)],CanvasZoomFeature.prototype,"_lobbyStateChangedEventListener");__decorateClass$15([inject(ImageResetEventListener)],CanvasZoomFeature.prototype,"_imageResetEventListener");__decorateClass$15([inject(LobbyService)],CanvasZoomFeature.prototype,"_lobbyService");const _InterpretableEmptyRemainder=class _InterpretableEmptyRemainder extends InterpretableError{};__name(_InterpretableEmptyRemainder,"InterpretableEmptyRemainder");let InterpretableEmptyRemainder=_InterpretableEmptyRemainder;const _ExtensionCommandParameter=class _ExtensionCommandParameter{constructor(_name,_description){__publicField(this,"_execute");this._name=_name,this._description=_description}get name(){return this._name}get description(){return this._description}withAction(action){return this._execute=action,this}interpret(args,source,context){let skipMarkAsInterpreting=!1;try{const{argument,remainder}=this.readArg(args,()=>skipMarkAsInterpreting=!0);return skipMarkAsInterpreting||(context.currentInterpretedParameter=this),Promise.resolve({result:{...source,...argument},context,remainder})}catch(e){throw e instanceof InterpretableEmptyRemainder||(context.currentInterpretedParameter=this),e}}execute(result,context){var _a81;return((_a81=this._execute)==null?void 0:_a81.call(this,result,context))??Promise.resolve({result:new InterpretableSuccess(this)})}};__name(_ExtensionCommandParameter,"ExtensionCommandParameter");let ExtensionCommandParameter=_ExtensionCommandParameter;const _InterpretableArgumentParsingError=class _InterpretableArgumentParsingError extends InterpretableError{};__name(_InterpretableArgumentParsingError,"InterpretableArgumentParsingError");let InterpretableArgumentParsingError=_InterpretableArgumentParsingError;const _InterpretableSilentSuccess=class _InterpretableSilentSuccess extends InterpretableResult{constructor(interpretable){super(interpretable,void 0)}};__name(_InterpretableSilentSuccess,"InterpretableSilentSuccess");let InterpretableSilentSuccess=_InterpretableSilentSuccess;function create_if_block_1$h(ctx){let h3,t0,span,t1,if_block=ctx[7]&&create_if_block_2$b(ctx);return{c(){h3=element$1("h3"),if_block&&if_block.c(),t0=space(),span=element$1("span"),t1=text(ctx[6]),attr(h3,"class","svelte-1mc834d")},m(target,anchor){insert(target,h3,anchor),if_block&&if_block.m(h3,null),append(h3,t0),append(h3,span),append(span,t1)},p(ctx2,dirty){ctx2[7]?if_block?if_block.p(ctx2,dirty):(if_block=create_if_block_2$b(ctx2),if_block.c(),if_block.m(h3,t0)):if_block&&(if_block.d(1),if_block=null),dirty&64&&set_data(t1,ctx2[6])},d(detaching){detaching&&detach(h3),if_block&&if_block.d()}}}__name(create_if_block_1$h,"create_if_block_1$h");function create_if_block_2$b(ctx){let img,img_src_value;return{c(){img=element$1("img"),src_url_equal(img.src,img_src_value="")||attr(img,"src",img_src_value),attr(img,"alt","Icon"),set_style(img,"content","var(--"+ctx[7]+")"),attr(img,"class","svelte-1mc834d")},m(target,anchor){insert(target,img,anchor)},p(ctx2,dirty){dirty&128&&set_style(img,"content","var(--"+ctx2[7]+")")},d(detaching){detaching&&detach(img)}}}__name(create_if_block_2$b,"create_if_block_2$b");function create_if_block$x(ctx){let span,mounted,dispose;return{c(){span=element$1("span"),span.textContent="×",attr(span,"class","close-explicit svelte-1mc834d")},m(target,anchor){insert(target,span,anchor),mounted||(dispose=listen(span,"click",ctx[16]),mounted=!0)},p:noop$1,d(detaching){detaching&&detach(span),mounted=!1,dispose()}}}__name(create_if_block$x,"create_if_block$x");function create_fragment$11(ctx){let div1,t0,div0,switch_instance,t1,current,if_block0=ctx[6]&&create_if_block_1$h(ctx);const switch_instance_spread_levels=[ctx[5].props];var switch_value=ctx[5].componentType;function switch_props(ctx2,dirty){let switch_instance_props={};for(let i=0;i<switch_instance_spread_levels.length;i+=1)switch_instance_props=assign(switch_instance_props,switch_instance_spread_levels[i]);return dirty!==void 0&&dirty&32&&(switch_instance_props=assign(switch_instance_props,get_spread_update(switch_instance_spread_levels,[get_spread_object(ctx2[5].props)]))),{props:switch_instance_props}}__name(switch_props,"switch_props"),switch_value&&(switch_instance=construct_svelte_component(switch_value,switch_props(ctx)));let if_block1=ctx[0]==="explicit"&&create_if_block$x(ctx);return{c(){div1=element$1("div"),if_block0&&if_block0.c(),t0=space(),div0=element$1("div"),switch_instance&&create_component(switch_instance.$$.fragment),t1=space(),if_block1&&if_block1.c(),attr(div0,"class","content svelte-1mc834d"),attr(div1,"class","typo-area-flyout color-scrollbar svelte-1mc834d"),set_style(div1,"max-height",ctx[11]()),set_style(div1,"max-width",ctx[12]()),set_style(div1,"grid-area",ctx[4]),set_style(div1,"margin",ctx[2]+" "+ctx[3]),toggle_class(div1,"closing",ctx[10]),toggle_class(div1,"align-top",ctx[1]==="top"),toggle_class(div1,"align-bottom",ctx[1]==="bottom")},m(target,anchor){insert(target,div1,anchor),if_block0&&if_block0.m(div1,null),append(div1,t0),append(div1,div0),switch_instance&&mount_component(switch_instance,div0,null),append(div1,t1),if_block1&&if_block1.m(div1,null),ctx[17](div1),current=!0},p(ctx2,[dirty]){if(ctx2[6]?if_block0?if_block0.p(ctx2,dirty):(if_block0=create_if_block_1$h(ctx2),if_block0.c(),if_block0.m(div1,t0)):if_block0&&(if_block0.d(1),if_block0=null),dirty&32&&switch_value!==(switch_value=ctx2[5].componentType)){if(switch_instance){group_outros();const old_component=switch_instance;transition_out(old_component.$$.fragment,1,0,()=>{destroy_component(old_component,1)}),check_outros()}switch_value?(switch_instance=construct_svelte_component(switch_value,switch_props(ctx2,dirty)),create_component(switch_instance.$$.fragment),transition_in(switch_instance.$$.fragment,1),mount_component(switch_instance,div0,null)):switch_instance=null}else if(switch_value){const switch_instance_changes=dirty&32?get_spread_update(switch_instance_spread_levels,[get_spread_object(ctx2[5].props)]):{};switch_instance.$set(switch_instance_changes)}ctx2[0]==="explicit"?if_block1?if_block1.p(ctx2,dirty):(if_block1=create_if_block$x(ctx2),if_block1.c(),if_block1.m(div1,null)):if_block1&&(if_block1.d(1),if_block1=null),(!current||dirty&16)&&set_style(div1,"grid-area",ctx2[4]),(!current||dirty&12)&&set_style(div1,"margin",ctx2[2]+" "+ctx2[3]),(!current||dirty&1024)&&toggle_class(div1,"closing",ctx2[10]),(!current||dirty&2)&&toggle_class(div1,"align-top",ctx2[1]==="top"),(!current||dirty&2)&&toggle_class(div1,"align-bottom",ctx2[1]==="bottom")},i(local){current||(switch_instance&&transition_in(switch_instance.$$.fragment,local),current=!0)},o(local){switch_instance&&transition_out(switch_instance.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div1),if_block0&&if_block0.d(),switch_instance&&destroy_component(switch_instance),if_block1&&if_block1.d(),ctx[17](null)}}}__name(create_fragment$11,"create_fragment$11");function instance$X($$self,$$props,$$invalidate){let{closeStrategy="implicit"}=$$props,{alignment="bottom"}=$$props,{marginY=".5em"}=$$props,{marginX="1em"}=$$props,{areaName}=$$props,{maxHeight=void 0}=$$props,{maxWidth=void 0}=$$props,{componentData}=$$props,{title=void 0}=$$props,{iconName=void 0}=$$props;const clickedOutside=new Subject$1,closed$=clickedOutside.asObservable();let self2,closing=!1;const clickListener=__name(event=>{if(!self2||closeStrategy!=="implicit")return;const target=event.target;self2!==target&&!self2.contains(target)&&close()},"clickListener"),close=__name(()=>{$$invalidate(10,closing=!0),setTimeout(()=>{clickedOutside.next()},80)},"close");onDestroy(()=>{document.removeEventListener("click",clickListener)}),onMount(()=>{setTimeout(()=>document.addEventListener("click",clickListener),1)});const getMaxHeightCss=__name(()=>maxHeight?`calc(${maxHeight} - (2 * ${marginY}))`:"auto","getMaxHeightCss"),getMaxWidthCss=__name(()=>maxWidth?`calc(${maxWidth} - (2 * ${marginX}))`:"auto","getMaxWidthCss"),click_handler2=__name(()=>close(),"click_handler");function div1_binding($$value){binding_callbacks[$$value?"unshift":"push"](()=>{self2=$$value,$$invalidate(9,self2)})}return __name(div1_binding,"div1_binding"),$$self.$$set=$$props2=>{"closeStrategy"in $$props2&&$$invalidate(0,closeStrategy=$$props2.closeStrategy),"alignment"in $$props2&&$$invalidate(1,alignment=$$props2.alignment),"marginY"in $$props2&&$$invalidate(2,marginY=$$props2.marginY),"marginX"in $$props2&&$$invalidate(3,marginX=$$props2.marginX),"areaName"in $$props2&&$$invalidate(4,areaName=$$props2.areaName),"maxHeight"in $$props2&&$$invalidate(13,maxHeight=$$props2.maxHeight),"maxWidth"in $$props2&&$$invalidate(14,maxWidth=$$props2.maxWidth),"componentData"in $$props2&&$$invalidate(5,componentData=$$props2.componentData),"title"in $$props2&&$$invalidate(6,title=$$props2.title),"iconName"in $$props2&&$$invalidate(7,iconName=$$props2.iconName)},[closeStrategy,alignment,marginY,marginX,areaName,componentData,title,iconName,close,self2,closing,getMaxHeightCss,getMaxWidthCss,maxHeight,maxWidth,closed$,click_handler2,div1_binding]}__name(instance$X,"instance$X");const _Area_flyout=class _Area_flyout extends SvelteComponent{constructor(options){super(),init(this,options,instance$X,create_fragment$11,safe_not_equal,{closeStrategy:0,alignment:1,marginY:2,marginX:3,areaName:4,maxHeight:13,maxWidth:14,componentData:5,title:6,iconName:7,closed$:15,close:8})}get closed$(){return this.$$.ctx[15]}get close(){return this.$$.ctx[8]}};__name(_Area_flyout,"Area_flyout");let Area_flyout=_Area_flyout;function get_each_context$u(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[5]=list[i],child_ctx}__name(get_each_context$u,"get_each_context$u");function get_each_context_1$9(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[5]=list[i],child_ctx}__name(get_each_context_1$9,"get_each_context_1$9");function get_each_context_2$3(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[11]=list[i],child_ctx}__name(get_each_context_2$3,"get_each_context_2$3");function create_if_block_1$g(ctx){let div3,div1,div0,t0,promise,t1,t2,div2,t3,info={ctx,current:null,token:null,hasCatch:!1,pending:create_pending_block_1,then:create_then_block_1,catch:create_catch_block_1,value:8};handle_promise(promise=firstValueFrom(ctx[5].context.command.idSetting.changes$),info);let each_value_2=ensure_array_like(ctx[5].context.parameters),each_blocks=[];for(let i=0;i<each_value_2.length;i+=1)each_blocks[i]=create_each_block_2$3(get_each_context_2$3(ctx,each_value_2,i));function select_block_type(ctx2,dirty){return ctx2[5].context.currentInterpretedParameter===void 0?create_if_block_3$6:create_else_block$e}__name(select_block_type,"select_block_type");let current_block_type=select_block_type(ctx),if_block0=current_block_type(ctx),if_block1=!(ctx[5].result instanceof InterpretableCommandPartialMatch)&&create_if_block_2$a(ctx);return{c(){div3=element$1("div"),div1=element$1("div"),div0=element$1("div"),t0=text(`/
            `),info.block.c(),t1=space();for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();t2=space(),div2=element$1("div"),if_block0.c(),t3=space(),if_block1&&if_block1.c(),attr(div0,"class","typo-command-result-id svelte-1bs3so"),toggle_class(div0,"current",ctx[0].isActiveTypingId(ctx[5])),attr(div1,"class","typo-command-result-synopsis svelte-1bs3so"),attr(div2,"class","typo-command-result-description"),attr(div3,"class","typo-command-result svelte-1bs3so")},m(target,anchor){insert(target,div3,anchor),append(div3,div1),append(div1,div0),append(div0,t0),info.block.m(div0,info.anchor=null),info.mount=()=>div0,info.anchor=null,append(div1,t1);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div1,null);append(div3,t2),append(div3,div2),if_block0.m(div2,null),append(div3,t3),if_block1&&if_block1.m(div3,null)},p(new_ctx,dirty){if(ctx=new_ctx,info.ctx=ctx,dirty&2&&promise!==(promise=firstValueFrom(ctx[5].context.command.idSetting.changes$))&&handle_promise(promise,info)||update_await_block_branch(info,ctx,dirty),dirty&3&&toggle_class(div0,"current",ctx[0].isActiveTypingId(ctx[5])),dirty&3){each_value_2=ensure_array_like(ctx[5].context.parameters);let i;for(i=0;i<each_value_2.length;i+=1){const child_ctx=get_each_context_2$3(ctx,each_value_2,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block_2$3(child_ctx),each_blocks[i].c(),each_blocks[i].m(div1,null))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value_2.length}current_block_type===(current_block_type=select_block_type(ctx))&&if_block0?if_block0.p(ctx,dirty):(if_block0.d(1),if_block0=current_block_type(ctx),if_block0&&(if_block0.c(),if_block0.m(div2,null))),ctx[5].result instanceof InterpretableCommandPartialMatch?if_block1&&(if_block1.d(1),if_block1=null):if_block1?if_block1.p(ctx,dirty):(if_block1=create_if_block_2$a(ctx),if_block1.c(),if_block1.m(div3,null))},d(detaching){detaching&&detach(div3),info.block.d(),info.token=null,info=null,destroy_each(each_blocks,detaching),if_block0.d(),if_block1&&if_block1.d()}}}__name(create_if_block_1$g,"create_if_block_1$g");function create_catch_block_1(ctx){return{c:noop$1,m:noop$1,p:noop$1,d:noop$1}}__name(create_catch_block_1,"create_catch_block_1");function create_then_block_1(ctx){let t_value=ctx[8]+"",t;return{c(){t=text(t_value)},m(target,anchor){insert(target,t,anchor)},p(ctx2,dirty){dirty&2&&t_value!==(t_value=ctx2[8]+"")&&set_data(t,t_value)},d(detaching){detaching&&detach(t)}}}__name(create_then_block_1,"create_then_block_1");function create_pending_block_1(ctx){return{c:noop$1,m:noop$1,p:noop$1,d:noop$1}}__name(create_pending_block_1,"create_pending_block_1");function create_each_block_2$3(ctx){let div,t0_value=ctx[11].typeName+"",t0,t1;return{c(){div=element$1("div"),t0=text(t0_value),t1=space(),attr(div,"class","typo-command-result-arg svelte-1bs3so"),toggle_class(div,"current",ctx[0].isActiveTypingParam(ctx[5],ctx[11]))},m(target,anchor){insert(target,div,anchor),append(div,t0),append(div,t1)},p(ctx2,dirty){dirty&2&&t0_value!==(t0_value=ctx2[11].typeName+"")&&set_data(t0,t0_value),dirty&3&&toggle_class(div,"current",ctx2[0].isActiveTypingParam(ctx2[5],ctx2[11]))},d(detaching){detaching&&detach(div)}}}__name(create_each_block_2$3,"create_each_block_2$3");function create_else_block$e(ctx){let b,t0_value=ctx[5].context.currentInterpretedParameter.name+"",t0,t1,t2,t3_value=ctx[5].context.currentInterpretedParameter.description+"",t3;return{c(){b=element$1("b"),t0=text(t0_value),t1=text(":"),t2=space(),t3=text(t3_value)},m(target,anchor){insert(target,b,anchor),append(b,t0),append(b,t1),insert(target,t2,anchor),insert(target,t3,anchor)},p(ctx2,dirty){dirty&2&&t0_value!==(t0_value=ctx2[5].context.currentInterpretedParameter.name+"")&&set_data(t0,t0_value),dirty&2&&t3_value!==(t3_value=ctx2[5].context.currentInterpretedParameter.description+"")&&set_data(t3,t3_value)},d(detaching){detaching&&(detach(b),detach(t2),detach(t3))}}}__name(create_else_block$e,"create_else_block$e");function create_if_block_3$6(ctx){let t_value=ctx[5].context.command.description+"",t;return{c(){t=text(t_value)},m(target,anchor){insert(target,t,anchor)},p(ctx2,dirty){dirty&2&&t_value!==(t_value=ctx2[5].context.command.description+"")&&set_data(t,t_value)},d(detaching){detaching&&detach(t)}}}__name(create_if_block_3$6,"create_if_block_3$6");function create_if_block_2$a(ctx){let div,img,img_src_value,t0,span,t1_value=ctx[0].getResultStateMessage(ctx[5],ctx[2])+"",t1;return{c(){div=element$1("div"),img=element$1("img"),t0=space(),span=element$1("span"),t1=text(t1_value),src_url_equal(img.src,img_src_value="")||attr(img,"src",img_src_value),attr(img,"alt","icon"),set_style(img,"content","var(--"+(ctx[0].isValidCommand(ctx[5])?"file-img-enabled-gif":"file-img-disabled-gif")+")"),attr(img,"class","svelte-1bs3so"),attr(div,"class","typo-command-result-state svelte-1bs3so")},m(target,anchor){insert(target,div,anchor),append(div,img),append(div,t0),append(div,span),append(span,t1)},p(ctx2,dirty){dirty&3&&set_style(img,"content","var(--"+(ctx2[0].isValidCommand(ctx2[5])?"file-img-enabled-gif":"file-img-disabled-gif")+")"),dirty&7&&t1_value!==(t1_value=ctx2[0].getResultStateMessage(ctx2[5],ctx2[2])+"")&&set_data(t1,t1_value)},d(detaching){detaching&&detach(div)}}}__name(create_if_block_2$a,"create_if_block_2$a");function create_each_block_1$9(ctx){let if_block_anchor,if_block=ctx[5].result!==null&&create_if_block_1$g(ctx);return{c(){if_block&&if_block.c(),if_block_anchor=empty()},m(target,anchor){if_block&&if_block.m(target,anchor),insert(target,if_block_anchor,anchor)},p(ctx2,dirty){ctx2[5].result!==null?if_block?if_block.p(ctx2,dirty):(if_block=create_if_block_1$g(ctx2),if_block.c(),if_block.m(if_block_anchor.parentNode,if_block_anchor)):if_block&&(if_block.d(1),if_block=null)},d(detaching){detaching&&detach(if_block_anchor),if_block&&if_block.d(detaching)}}}__name(create_each_block_1$9,"create_each_block_1$9");function create_if_block$w(ctx){let div,t1,each_1_anchor,each_value=ensure_array_like(ctx[1]),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$u(get_each_context$u(ctx,each_value,i));return{c(){div=element$1("div"),div.textContent="Type a command id..",t1=space();for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();each_1_anchor=empty()},m(target,anchor){insert(target,div,anchor),insert(target,t1,anchor);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(target,anchor);insert(target,each_1_anchor,anchor)},p(ctx2,dirty){if(dirty&2){each_value=ensure_array_like(ctx2[1]);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$u(ctx2,each_value,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block$u(child_ctx),each_blocks[i].c(),each_blocks[i].m(each_1_anchor.parentNode,each_1_anchor))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value.length}},d(detaching){detaching&&(detach(div),detach(t1),detach(each_1_anchor)),destroy_each(each_blocks,detaching)}}}__name(create_if_block$w,"create_if_block$w");function create_catch_block$3(ctx){return{c:noop$1,m:noop$1,p:noop$1,d:noop$1}}__name(create_catch_block$3,"create_catch_block$3");function create_then_block$3(ctx){let t_value=ctx[8]+"",t;return{c(){t=text(t_value)},m(target,anchor){insert(target,t,anchor)},p(ctx2,dirty){dirty&2&&t_value!==(t_value=ctx2[8]+"")&&set_data(t,t_value)},d(detaching){detaching&&detach(t)}}}__name(create_then_block$3,"create_then_block$3");function create_pending_block$3(ctx){return{c:noop$1,m:noop$1,p:noop$1,d:noop$1}}__name(create_pending_block$3,"create_pending_block$3");function create_each_block$u(ctx){let b,t0,promise,t1,info={ctx,current:null,token:null,hasCatch:!1,pending:create_pending_block$3,then:create_then_block$3,catch:create_catch_block$3,value:8};return handle_promise(promise=firstValueFrom(ctx[5].context.command.idSetting.changes$),info),{c(){b=element$1("b"),t0=text(`/
        `),info.block.c(),t1=space()},m(target,anchor){insert(target,b,anchor),append(b,t0),info.block.m(b,info.anchor=null),info.mount=()=>b,info.anchor=t1,append(b,t1)},p(new_ctx,dirty){ctx=new_ctx,info.ctx=ctx,dirty&2&&promise!==(promise=firstValueFrom(ctx[5].context.command.idSetting.changes$))&&handle_promise(promise,info)||update_await_block_branch(info,ctx,dirty)},d(detaching){detaching&&detach(b),info.block.d(),info.token=null,info=null}}}__name(create_each_block$u,"create_each_block$u");function create_fragment$10(ctx){let div,t,show_if=ctx[1].every(func$2),each_value_1=ensure_array_like(ctx[1]),each_blocks=[];for(let i=0;i<each_value_1.length;i+=1)each_blocks[i]=create_each_block_1$9(get_each_context_1$9(ctx,each_value_1,i));let if_block=show_if&&create_if_block$w(ctx);return{c(){div=element$1("div");for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();t=space(),if_block&&if_block.c(),attr(div,"class","typo-command-preview svelte-1bs3so")},m(target,anchor){insert(target,div,anchor);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div,null);append(div,t),if_block&&if_block.m(div,null)},p(ctx2,[dirty]){if(dirty&7){each_value_1=ensure_array_like(ctx2[1]);let i;for(i=0;i<each_value_1.length;i+=1){const child_ctx=get_each_context_1$9(ctx2,each_value_1,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block_1$9(child_ctx),each_blocks[i].c(),each_blocks[i].m(div,t))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value_1.length}dirty&2&&(show_if=ctx2[1].every(func$2)),show_if?if_block?if_block.p(ctx2,dirty):(if_block=create_if_block$w(ctx2),if_block.c(),if_block.m(div,null)):if_block&&(if_block.d(1),if_block=null)},i:noop$1,o:noop$1,d(detaching){detaching&&detach(div),destroy_each(each_blocks,detaching),if_block&&if_block.d()}}}__name(create_fragment$10,"create_fragment$10");const func$2=__name(result=>result.result===null,"func$2");function instance$W($$self,$$props,$$invalidate){let $currentCommands,$combo,{feature}=$$props;const currentCommands=feature.commandResultStore;component_subscribe($$self,currentCommands,value=>$$invalidate(1,$currentCommands=value));const combo=feature.submitHotkeyStore;return component_subscribe($$self,combo,value=>$$invalidate(2,$combo=value)),$$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},[feature,$currentCommands,$combo,currentCommands,combo]}__name(instance$W,"instance$W");const _Command_preview=class _Command_preview extends SvelteComponent{constructor(options){super(),init(this,options,instance$W,create_fragment$10,safe_not_equal,{feature:0})}};__name(_Command_preview,"Command_preview");let Command_preview=_Command_preview;function create_fragment$$(ctx){let input,mounted,dispose;return{c(){input=element$1("input"),attr(input,"id","typo-command-input"),input.autofocus=!0,attr(input,"type","text"),input.value="/",attr(input,"placeholder","Type your command here..")},m(target,anchor){insert(target,input,anchor),input.focus(),mounted||(dispose=[listen(input,"input",ctx[1]),listen(input,"submit",submit_handler)],mounted=!0)},p:noop$1,i:noop$1,o:noop$1,d(detaching){detaching&&detach(input),mounted=!1,run_all(dispose)}}}__name(create_fragment$$,"create_fragment$$");const submit_handler=__name(e=>{e.preventDefault(),e.stopImmediatePropagation()},"submit_handler");function instance$V($$self,$$props,$$invalidate){let{onInput}=$$props;const input_handler=__name(e=>{onInput(e.currentTarget.value)},"input_handler");return $$self.$$set=$$props2=>{"onInput"in $$props2&&$$invalidate(0,onInput=$$props2.onInput)},[onInput,input_handler]}__name(instance$V,"instance$V");const _Command_input=class _Command_input extends SvelteComponent{constructor(options){super(),init(this,options,instance$V,create_fragment$$,safe_not_equal,{onInput:0})}};__name(_Command_input,"Command_input");let Command_input=_Command_input;var __defProp$14=Object.defineProperty,__decorateClass$14=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$14(target,key,result),result},"__decorateClass$14");const _ChatCommandsFeature=class _ChatCommandsFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elements");__publicField(this,"_toastService");__publicField(this,"name","Chat Commands");__publicField(this,"description","Execute actions of other features with chat commands");__publicField(this,"featureId",38);__publicField(this,"_interpreterSubscription");__publicField(this,"_submitSubscription");__publicField(this,"_commandArgs$",new Subject$1);__publicField(this,"_hotkeySubmitted$",new Subject$1);__publicField(this,"_commandResults$",new Subject$1);__publicField(this,"_flyoutComponent");__publicField(this,"_flyoutSubscription");__publicField(this,"_commandInput");__publicField(this,"_inputChangeListener",this.handleInputEvent.bind(this));__publicField(this,"_submitCommandHotkey",this.useHotkey(new HotkeyAction("submit_command","Submit Command","When pressed, the currently typed command will be submitted",this,async()=>{const elements2=await this._elements.complete();elements2.chatInput.value="",this._hotkeySubmitted$.next(void 0)},!0,["Enter"],void 0,!1)));__publicField(this,"_customPrefixSetting",this.useSetting(new TextExtensionSetting("custom_prefix","",this).withName("Custom Command Prefix").withDescription("Set a custom prefix for chat commands that will trigger the command prompt, additionally to ' / '")))}async onActivate(){const elements2=await this._elements.complete();elements2.chatInput.addEventListener("input",this._inputChangeListener),this._interpreterSubscription=this._commandArgs$.pipe(withLatestFrom(this._commandsService.commands$),switchMap(async([args,commands])=>{var _a81;return args.startsWith("/")?(args=args.substring(1),Promise.all(commands.map(async command=>this._commandsService.executeCommand(command,args)))):((_a81=this._commandInput)==null||_a81.$destroy(),this._commandInput=void 0,elements2.chatInput.focus(),[])})).subscribe(results=>{this._logger.debug("Command results changed",results),this.setFlyoutState(results.length>0,elements2),this._commandResults$.next(results)}),this._submitSubscription=this._hotkeySubmitted$.pipe(withLatestFrom(this._commandResults$,this._commandArgs$),filter(([,,args])=>args.startsWith("/"))).subscribe(async([,results])=>this.commandSubmitted(results))}async onDestroy(){var _a81,_b,_c;const elements2=await this._elements.complete();elements2.chatInput.removeEventListener("input",this._inputChangeListener),(_a81=this._interpreterSubscription)==null||_a81.unsubscribe(),this._interpreterSubscription=void 0,(_b=this._submitSubscription)==null||_b.unsubscribe(),this._submitSubscription=void 0,(_c=this._commandInput)==null||_c.$destroy(),this._commandInput=void 0,this.setFlyoutState(!1,elements2)}get commandResultStore(){return fromObservable(this._commandResults$,[])}get submitHotkeyStore(){return this._submitCommandHotkey.comboSetting.store}async handleInputEvent(event){const target=event.currentTarget,customPrefix=await this._customPrefixSetting.getValue();target!==null&&(target.value==="/"||customPrefix!==""&&target.value===customPrefix)&&await this.switchToCommandMode()}async switchToCommandMode(){const elements2=await this._elements.complete();elements2.chatInput.value="",elements2.chatInput.dispatchEvent(new Event("input")),this._commandInput||(this._commandInput=new Command_input({target:elements2.chatForm,props:{onInput:__name(args=>this._commandArgs$.next(args),"onInput")}}),this._commandArgs$.next("/"))}async commandSubmitted(interpretationResults){var _a81;this._logger.info("Commands submitted",interpretationResults),(_a81=this._commandInput)==null||_a81.$destroy(),this._commandArgs$.next("");const match=interpretationResults.find(result=>result.result instanceof InterpretableSuccess);if(match!==void 0&&match.result instanceof InterpretableSuccess)if(match.result instanceof InterpretableDeferResult){const toast=await this._toastService.showLoadingToast(`Command: ${match.context.command.name}`),result=await match.result.run();result instanceof InterpretableSilentSuccess?toast.close():toast.resolve(result.message)}else match.result.message?await this._toastService.showToast(`${match.result.message}`):match.result instanceof InterpretableSilentSuccess||await this._toastService.showToast(`${match.context.command.name}`);else await this._toastService.showToast("No valid command entered")}setFlyoutState(state,elements2){if(state&&this._flyoutComponent===void 0){const flyoutContent={componentType:Command_preview,props:{feature:this}};this._flyoutComponent=new Area_flyout({target:elements2.gameWrapper,props:{componentData:flyoutContent,areaName:"chat",maxHeight:"600px",maxWidth:"300px",marginY:"2.5rem",title:"Command Preview",closeStrategy:"implicit"}}),this._flyoutSubscription=this._flyoutComponent.closed$.subscribe(()=>{var _a81,_b;this._logger.info("Destroyed flyout"),(_a81=this._flyoutComponent)==null||_a81.$destroy(),(_b=this._flyoutSubscription)==null||_b.unsubscribe(),this._flyoutComponent=void 0})}else this._flyoutComponent!==void 0&&!state&&this._flyoutComponent.close()}isActiveTypingParam(result,param){return this._logger.debug("Checking if param is active",result,param),result.context.currentInterpretedParameter===param}isActiveTypingId(result){return result.result===void 0}isValidCommand(result){return result.result instanceof InterpretableSuccess}getResultStateMessage(result,hotkeys){if(result.result instanceof InterpretableSuccess)return`Press ${hotkeys.join(" + ")} to submit`;if(result.result instanceof InterpretableArgumentParsingError)return"The current argument is invalid";if(result.result instanceof InterpretableCommandPartialMatch)return"The command id is incomplete";if(result.result instanceof InterpretableEmptyRemainder)return"Some arguments are missing";if(result.result instanceof InterpretableError)return result.result.message}};__name(_ChatCommandsFeature,"ChatCommandsFeature");let ChatCommandsFeature=_ChatCommandsFeature;__decorateClass$14([inject(ElementsSetup)],ChatCommandsFeature.prototype,"_elements");__decorateClass$14([inject(ToastService)],ChatCommandsFeature.prototype,"_toastService");function create_fragment$_(ctx){let div,img,img_src_value,tooltipAction_action,mounted,dispose;return{c(){div=element$1("div"),img=element$1("img"),attr(img,"class","typo-icon-button-graphic svelte-b0w31n"),src_url_equal(img.src,img_src_value="")||attr(img,"src",img_src_value),set_style(img,"content","var(--"+ctx[1]+")"),set_style(img,"width",ctx[5]),attr(img,"alt",ctx[2]),toggle_class(img,"effect",ctx[3]),attr(div,"class","typo-icon-button svelte-b0w31n"),set_style(div,"order",ctx[6]??"auto"),attr(div,"role","button"),attr(div,"data-name",ctx[2]),attr(div,"tabindex","0"),toggle_class(div,"greyscale",ctx[4]),toggle_class(div,"disabled",ctx[0])},m(target,anchor){insert(target,div,anchor),append(div,img),mounted||(dispose=[action_destroyer(tooltipAction_action=ctx[7].call(null,div,{title:ctx[2],lock:ctx[8]})),listen(div,"click",ctx[11]),listen(div,"click",ctx[12]),listen(div,"keypress",ctx[13])],mounted=!0)},p(ctx2,[dirty]){dirty&2&&set_style(img,"content","var(--"+ctx2[1]+")"),dirty&32&&set_style(img,"width",ctx2[5]),dirty&4&&attr(img,"alt",ctx2[2]),dirty&8&&toggle_class(img,"effect",ctx2[3]),dirty&64&&set_style(div,"order",ctx2[6]??"auto"),dirty&4&&attr(div,"data-name",ctx2[2]),tooltipAction_action&&is_function(tooltipAction_action.update)&&dirty&260&&tooltipAction_action.update.call(null,{title:ctx2[2],lock:ctx2[8]}),dirty&16&&toggle_class(div,"greyscale",ctx2[4]),dirty&1&&toggle_class(div,"disabled",ctx2[0])},i:noop$1,o:noop$1,d(detaching){detaching&&detach(div),mounted=!1,run_all(dispose)}}}__name(create_fragment$_,"create_fragment$_");function instance$U($$self,$$props,$$invalidate){let{disabled=!1}=$$props,{icon}=$$props,{name}=$$props,{hoverMove=!0}=$$props,{greyscaleInactive=!1}=$$props,{size="37px"}=$$props,{order=void 0}=$$props,{tooltipAction=__name(()=>{},"tooltipAction")}=$$props,{lockTooltip=void 0}=$$props;const click=new Subject$1,click$=click.asObservable();function click_handler2(event){bubble.call(this,$$self,event)}__name(click_handler2,"click_handler");const click_handler_1=__name(()=>click.next(void 0),"click_handler_1"),keypress_handler=__name(evt=>evt.code==="Enter"&&click.next(void 0),"keypress_handler");return $$self.$$set=$$props2=>{"disabled"in $$props2&&$$invalidate(0,disabled=$$props2.disabled),"icon"in $$props2&&$$invalidate(1,icon=$$props2.icon),"name"in $$props2&&$$invalidate(2,name=$$props2.name),"hoverMove"in $$props2&&$$invalidate(3,hoverMove=$$props2.hoverMove),"greyscaleInactive"in $$props2&&$$invalidate(4,greyscaleInactive=$$props2.greyscaleInactive),"size"in $$props2&&$$invalidate(5,size=$$props2.size),"order"in $$props2&&$$invalidate(6,order=$$props2.order),"tooltipAction"in $$props2&&$$invalidate(7,tooltipAction=$$props2.tooltipAction),"lockTooltip"in $$props2&&$$invalidate(8,lockTooltip=$$props2.lockTooltip)},[disabled,icon,name,hoverMove,greyscaleInactive,size,order,tooltipAction,lockTooltip,click,click$,click_handler2,click_handler_1,keypress_handler]}__name(instance$U,"instance$U");const _Icon_button=class _Icon_button extends SvelteComponent{constructor(options){super(),init(this,options,instance$U,create_fragment$_,safe_not_equal,{disabled:0,icon:1,name:2,hoverMove:3,greyscaleInactive:4,size:5,order:6,tooltipAction:7,lockTooltip:8,click$:10})}get click$(){return this.$$.ctx[10]}};__name(_Icon_button,"Icon_button");let Icon_button=_Icon_button;var __defProp$13=Object.defineProperty,__decorateClass$13=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$13(target,key,result),result},"__decorateClass$13");const _ChatCopyFormattedFeature=class _ChatCopyFormattedFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elementsSetup");__publicField(this,"_toastService");__publicField(this,"_iconElement");__publicField(this,"name","Copy Chat Formatted");__publicField(this,"description","Enables to copy selected chat messages formatted for discord messages");__publicField(this,"featureId",36);__publicField(this,"selectedText$",new BehaviorSubject(null));__publicField(this,"_selectionChangeListener",this.onSelectionChange.bind(this));__publicField(this,"_selectedTextSubscription");__publicField(this,"_iconClickSubscription")}async onActivate(){document.addEventListener("selectionchange",this._selectionChangeListener),this._selectedTextSubscription=this.selectedText$.pipe(distinctUntilChanged()).subscribe(text2=>{this.processChangedChatSelection(text2)})}onDestroy(){var _a81,_b,_c;document.removeEventListener("selectionchange",this._selectionChangeListener),(_a81=this._selectedTextSubscription)==null||_a81.unsubscribe(),(_b=this._iconClickSubscription)==null||_b.unsubscribe(),this._iconClickSubscription=void 0,(_c=this._iconElement)==null||_c.$destroy(),this._iconElement=void 0}async onSelectionChange(){this._logger.debug("Selection changed");const elements2=await this._elementsSetup.complete(),selection=document.getSelection();if(!selection||selection.rangeCount===0){this.selectedText$.next(null);return}const range=selection.getRangeAt(0);if(range.commonAncestorContainer instanceof HTMLElement&&range.commonAncestorContainer===elements2.chatContent){let start=range.startContainer.nodeName==="#text"?range.startContainer.parentElement:range.startContainer,end=range.endContainer.nodeName==="#text"?range.endContainer.parentElement:range.endContainer;if(!(end instanceof HTMLElement&&start instanceof HTMLElement)){this._logger.warn("Could not find start or end element",start,end),this.selectedText$.next(null);return}if(start=start.closest("p"),end=end.closest("p"),!(start instanceof HTMLElement&&end instanceof HTMLElement)){this._logger.warn("Could not find start or end paragraph",start,end),this.selectedText$.next(null);return}const ps=[...document.querySelectorAll(".chat-content p")],elems=ps.slice(ps.indexOf(start),ps.indexOf(end)+1);console.log(elems.length);const text2=elems.map(e=>e.textContent).join(`
`);this.selectedText$.next(text2)}else this.selectedText$.next(null)}async processChangedChatSelection(text2){var _a81,_b;this._logger.info("Selected text changed",text2);const elements2=await this._elementsSetup.complete();this._iconElement&&text2===null&&((_a81=this._iconElement)==null||_a81.$destroy(),this._iconElement=void 0,(_b=this._iconClickSubscription)==null||_b.unsubscribe(),this._iconClickSubscription=void 0),text2!==null&&!this._iconElement&&(this._iconElement=new Icon_button({target:elements2.chatControls,props:{icon:"file-img-discord-gif",name:"Copy Chat for Discord",order:3,size:"2rem",hoverMove:!1,greyscaleInactive:!0,tooltipAction:this.createTooltip}}),this._iconClickSubscription=this._iconElement.click$.subscribe(async()=>{var _a82;const currentText=this.selectedText$.value;if(currentText===null){this._logger.warn("No text selected, but copy button clicked - illegal state");return}const formatted=this.formatChatForDiscord(currentText);this._logger.info("Copy button clicked for selection",formatted),await navigator.clipboard.writeText(formatted),await this._toastService.showToast("Chat copied to clipboard"),(_a82=document.getSelection())==null||_a82.removeAllRanges()}))}formatChatForDiscord(text2){return"```diff\n"+text2.replace(/(\n)(?=.*? guessed the word!)/g,`
+ `).replace(/(\n)(?=.*? joined.)/g,`
+ `).replace(/(\n)(?=The word was)/g,`
+ `).replace(/(\n)(?=.*? is drawing now!)/g,`
+ `).replace(/(\n)(?=.*? is now the room owner!)/g,`
+ `).replace(/(\n)(?=.*? left.)/g,`
- `).replace(/(\n)(?=.*? is voting to kick.)/g,`
- `).replace(/(\n)(?=.*? was kicked.)/g,`
- `).replace(/(\n)(?=Whoops.*? caught the drop before you.)/g,`
--- `).replace(/(\n)(?=Yeee.*? and caught the drop!)/g,`
--- `)+"\n```"}};__name(_ChatCopyFormattedFeature,"ChatCopyFormattedFeature");let ChatCopyFormattedFeature=_ChatCopyFormattedFeature;__decorateClass$13([inject(ElementsSetup)],ChatCopyFormattedFeature.prototype,"_elementsSetup");__decorateClass$13([inject(ToastService)],ChatCopyFormattedFeature.prototype,"_toastService");const replaceOrAddCssRule=__name((styleSheet,cssText,index)=>{var _a81,_b,_c;if(cssText===void 0){index!==void 0&&((_a81=styleSheet.sheet)==null||_a81.deleteRule(index));return}if(index!==void 0){const rule=(_b=styleSheet.sheet)==null?void 0:_b.cssRules[index];return rule&&(rule.cssText=cssText),index}return(_c=styleSheet.sheet)==null?void 0:_c.insertRule(cssText)},"replaceOrAddCssRule"),_SkribblLandingPlayer=class _SkribblLandingPlayer{constructor(_login,_customizerContainer,_avatarContainer){__publicField(this,"_playerHideAvatarRuleIndex");__publicField(this,"_playerStyle");__publicField(this,"_containerId","typo-customize-player-display");__publicField(this,"iconsContainer",null);this._login=_login,this._customizerContainer=_customizerContainer,this._avatarContainer=_avatarContainer,this._customizerContainer.classList.add(this._containerId),this._playerStyle=document.createElement("style"),this._customizerContainer.appendChild(this._playerStyle)}get typoId(){return{login:this._login}}get avatarContainer(){return this._avatarContainer}get backgroundContainer(){return this._customizerContainer}get container(){return this._customizerContainer}set useBackground(value){this._customizerContainer.style.backgroundColor=value?"":"transparent",this._customizerContainer.style.zIndex=value?"":"1"}set useSafeColor(value){}set resizeToFitAvatar(value){}set viewPlayerId(value){}set hideAvatar(value){this._playerHideAvatarRuleIndex=replaceOrAddCssRule(this._playerStyle,value?`
      .${this._containerId} .avatar > :is(.eyes, .mouth, .color) { display: ${value?"none":"block"}
      }`:void 0,this._playerHideAvatarRuleIndex)}};__name(_SkribblLandingPlayer,"SkribblLandingPlayer");let SkribblLandingPlayer=_SkribblLandingPlayer;const _SkribblLobbyPlayer=class _SkribblLobbyPlayer{constructor(_player,_lobbyKey,_playerLogin){__publicField(this,"_elementId");__publicField(this,"_playerContainer");__publicField(this,"_avatarContainer");__publicField(this,"_backgroundContainer");__publicField(this,"_iconsContainer");__publicField(this,"_playerStyle");__publicField(this,"_backgroundRuleIndex");__publicField(this,"_fontColorRuleIndex");__publicField(this,"_fontColorGuessedRuleIndex");__publicField(this,"_fontShadowRuleIndex");__publicField(this,"_resizeRuleIndex");__publicField(this,"_alignRuleIndex");__publicField(this,"_playerIdRuleIndex");__publicField(this,"_playerInfoRuleIndex");__publicField(this,"_playerHideAvatarRuleIndex");if(this._player=_player,this._lobbyKey=_lobbyKey,this._playerLogin=_playerLogin,_lobbyKey===void 0&&_playerLogin===void 0)throw new Error("No identification provided");this._playerContainer=requireElement(`#game-players .player[playerid='${this._player.id}']`),this._avatarContainer=requireElement(".avatar",this._playerContainer),this._backgroundContainer=requireElement(".player-background",this._playerContainer),this._iconsContainer=requireElement(".player-icons",this._playerContainer),this._elementId="typo-lobby-player-"+_SkribblLobbyPlayer.idCounter++,this._playerStyle=document.createElement("style"),this._playerContainer.classList.add(this._elementId),this._playerContainer.appendChild(this._playerStyle)}get typoId(){if(this._playerLogin!==void 0)return{login:this._playerLogin};if(this._lobbyKey!==void 0)return{lobbyKey:this._lobbyKey,lobbyPlayerId:this._player.id};throw new Error("No identification provided")}get lobbyPlayerId(){return this._player.id}get name(){return this._player.name}get container(){return this._playerContainer}get avatarContainer(){return this._avatarContainer}get backgroundContainer(){return this._backgroundContainer}get iconsContainer(){return this._iconsContainer}set useBackground(value){this._backgroundRuleIndex=replaceOrAddCssRule(this._playerStyle,value?void 0:`.${this._elementId} .player-background { background-color: transparent !important; }`,this._backgroundRuleIndex)}set useSafeColor(value){this._fontColorRuleIndex=replaceOrAddCssRule(this._playerStyle,value?`
      .${this._elementId}:not(.guessed) > :not(.player-bubble) *, .${this._elementId}:is(.guessed) > :not(.player-bubble) *:not(.player-name) { 
        color: White !important; 
      }`:void 0,this._fontColorRuleIndex),this._fontColorGuessedRuleIndex=replaceOrAddCssRule(this._playerStyle,value?`
      .${this._elementId}:is(.guessed) .player-name { 
        color: #56ce27 !important;
      }`:void 0,this._fontColorGuessedRuleIndex),this._fontShadowRuleIndex=replaceOrAddCssRule(this._playerStyle,value?`
      .${this._elementId} > :not(.player-bubble) * { 
        text-shadow: 0px 0px 25px black, 0px 0px 10px black, 0px 0px 5px black !important;
      }`:void 0,this._fontShadowRuleIndex)}set resizeToFitAvatar(value){this._resizeRuleIndex=replaceOrAddCssRule(this._playerStyle,value?`.${this._elementId} { height: 56px !important; }`:void 0,this._resizeRuleIndex),this._alignRuleIndex=replaceOrAddCssRule(this._playerStyle,value?`.${this._elementId} .player-avatar-container { top: calc((100% - var(--UNIT)) / 2) !important; }`:void 0,this._alignRuleIndex)}set viewPlayerId(value){this._playerIdRuleIndex=replaceOrAddCssRule(this._playerStyle,value?`
       .${this._elementId} .player-score { 
          display: none; 
       }`:void 0,this._playerIdRuleIndex),this._playerInfoRuleIndex=replaceOrAddCssRule(this._playerStyle,value?`
       .${this._elementId} .player-info:after { 
          content: "#${this._player.id}"; 
       }`:void 0,this._playerInfoRuleIndex)}set hideAvatar(value){this._playerHideAvatarRuleIndex=replaceOrAddCssRule(this._playerStyle,value?`
      .${this._elementId} .avatar > :is(.eyes, .mouth, .color) { display: ${value?"none":"block"}
      }`:void 0,this._playerHideAvatarRuleIndex)}};__name(_SkribblLobbyPlayer,"SkribblLobbyPlayer"),__publicField(_SkribblLobbyPlayer,"idCounter",0);let SkribblLobbyPlayer=_SkribblLobbyPlayer;const BASE_PATH="http://localhost".replace(/\/+$/,""),_Configuration=class _Configuration{constructor(configuration={}){this.configuration=configuration}set config(configuration){this.configuration=configuration}get basePath(){return this.configuration.basePath!=null?this.configuration.basePath:BASE_PATH}get fetchApi(){return this.configuration.fetchApi}get middleware(){return this.configuration.middleware||[]}get queryParamsStringify(){return this.configuration.queryParamsStringify||querystring}get username(){return this.configuration.username}get password(){return this.configuration.password}get apiKey(){const apiKey=this.configuration.apiKey;if(apiKey)return typeof apiKey=="function"?apiKey:()=>apiKey}get accessToken(){const accessToken=this.configuration.accessToken;if(accessToken)return typeof accessToken=="function"?accessToken:async()=>accessToken}get headers(){return this.configuration.headers}get credentials(){return this.configuration.credentials}};__name(_Configuration,"Configuration");let Configuration=_Configuration;const DefaultConfig=new Configuration,_BaseAPI=class _BaseAPI{constructor(configuration=DefaultConfig){__publicField(this,"middleware");__publicField(this,"fetchApi",__name(async(url,init2)=>{let fetchParams={url,init:init2};for(const middleware of this.middleware)middleware.pre&&(fetchParams=await middleware.pre({fetch:this.fetchApi,...fetchParams})||fetchParams);let response;try{response=await(this.configuration.fetchApi||fetch)(fetchParams.url,fetchParams.init)}catch(e){for(const middleware of this.middleware)middleware.onError&&(response=await middleware.onError({fetch:this.fetchApi,url:fetchParams.url,init:fetchParams.init,error:e,response:response?response.clone():void 0})||response);if(response===void 0)throw e instanceof Error?new FetchError(e,"The request failed and the interceptors did not return an alternative response"):e}for(const middleware of this.middleware)middleware.post&&(response=await middleware.post({fetch:this.fetchApi,url:fetchParams.url,init:fetchParams.init,response:response.clone()})||response);return response},"fetchApi"));this.configuration=configuration,this.middleware=configuration.middleware}withMiddleware(...middlewares){const next=this.clone();return next.middleware=next.middleware.concat(...middlewares),next}withPreMiddleware(...preMiddlewares){const middlewares=preMiddlewares.map(pre=>({pre}));return this.withMiddleware(...middlewares)}withPostMiddleware(...postMiddlewares){const middlewares=postMiddlewares.map(post=>({post}));return this.withMiddleware(...middlewares)}isJsonMime(mime){return mime?_BaseAPI.jsonRegex.test(mime):!1}async request(context,initOverrides){const{url,init:init2}=await this.createFetchParams(context,initOverrides),response=await this.fetchApi(url,init2);if(response&&response.status>=200&&response.status<300)return response;throw new ResponseError(response,"Response returned an error code")}async createFetchParams(context,initOverrides){let url=this.configuration.basePath+context.path;context.query!==void 0&&Object.keys(context.query).length!==0&&(url+="?"+this.configuration.queryParamsStringify(context.query));const headers=Object.assign({},this.configuration.headers,context.headers);Object.keys(headers).forEach(key=>headers[key]===void 0?delete headers[key]:{});const initOverrideFn=typeof initOverrides=="function"?initOverrides:async()=>initOverrides,initParams={method:context.method,headers,body:context.body,credentials:this.configuration.credentials},overriddenInit={...initParams,...await initOverrideFn({init:initParams,context})};let body;isFormData(overriddenInit.body)||overriddenInit.body instanceof URLSearchParams||isBlob(overriddenInit.body)?body=overriddenInit.body:this.isJsonMime(headers["Content-Type"])?body=JSON.stringify(overriddenInit.body):body=overriddenInit.body;const init2={...overriddenInit,body};return{url,init:init2}}clone(){const constructor=this.constructor,next=new constructor(this.configuration);return next.middleware=this.middleware.slice(),next}};__name(_BaseAPI,"BaseAPI"),__publicField(_BaseAPI,"jsonRegex",new RegExp("^(:?application/json|[^;/ 	]+/[^;/ 	]+[+]json)[ 	]*(:?;.*)?$","i"));let BaseAPI=_BaseAPI;function isBlob(value){return typeof Blob<"u"&&value instanceof Blob}__name(isBlob,"isBlob");function isFormData(value){return typeof FormData<"u"&&value instanceof FormData}__name(isFormData,"isFormData");const _ResponseError=class _ResponseError extends Error{constructor(response,msg){super(msg);__publicField(this,"name","ResponseError");this.response=response}};__name(_ResponseError,"ResponseError");let ResponseError=_ResponseError;const _FetchError=class _FetchError extends Error{constructor(cause,msg){super(msg);__publicField(this,"name","FetchError");this.cause=cause}};__name(_FetchError,"FetchError");let FetchError=_FetchError;const _RequiredError=class _RequiredError extends Error{constructor(field,msg){super(msg);__publicField(this,"name","RequiredError");this.field=field}};__name(_RequiredError,"RequiredError");let RequiredError=_RequiredError;function querystring(params,prefix=""){return Object.keys(params).map(key=>querystringSingleKey(key,params[key],prefix)).filter(part=>part.length>0).join("&")}__name(querystring,"querystring");function querystringSingleKey(key,value,keyPrefix=""){const fullKey=keyPrefix+(keyPrefix.length?`[${key}]`:key);if(value instanceof Array){const multiValue=value.map(singleValue=>encodeURIComponent(String(singleValue))).join(`&${encodeURIComponent(fullKey)}=`);return`${encodeURIComponent(fullKey)}=${multiValue}`}if(value instanceof Set){const valueAsArray=Array.from(value);return querystringSingleKey(key,valueAsArray,keyPrefix)}return value instanceof Date?`${encodeURIComponent(fullKey)}=${encodeURIComponent(value.toISOString())}`:value instanceof Object?querystring(value,fullKey):`${encodeURIComponent(fullKey)}=${encodeURIComponent(String(value))}`}__name(querystringSingleKey,"querystringSingleKey");const _JSONApiResponse=class _JSONApiResponse{constructor(raw,transformer=jsonValue=>jsonValue){this.raw=raw,this.transformer=transformer}async value(){return this.transformer(await this.raw.json())}};__name(_JSONApiResponse,"JSONApiResponse");let JSONApiResponse=_JSONApiResponse;const _VoidApiResponse=class _VoidApiResponse{constructor(raw){this.raw=raw}async value(){}};__name(_VoidApiResponse,"VoidApiResponse");let VoidApiResponse=_VoidApiResponse;function AccessTokenDtoFromJSON(json){return AccessTokenDtoFromJSONTyped(json)}__name(AccessTokenDtoFromJSON,"AccessTokenDtoFromJSON");function AccessTokenDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{token:json.Token}}__name(AccessTokenDtoFromJSONTyped,"AccessTokenDtoFromJSONTyped");const AnnouncementDtoTypeEnum={Announcement:"Announcement",Changelog:"Changelog"};function AnnouncementDtoFromJSON(json){return AnnouncementDtoFromJSONTyped(json)}__name(AnnouncementDtoFromJSON,"AnnouncementDtoFromJSON");function AnnouncementDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{title:json.title,content:json.content,affectedTypoVersion:json.affectedTypoVersion==null?void 0:json.affectedTypoVersion,date:json.date,type:json.type}}__name(AnnouncementDtoFromJSONTyped,"AnnouncementDtoFromJSONTyped");function AwardDtoFromJSON(json){return AwardDtoFromJSONTyped(json)}__name(AwardDtoFromJSON,"AwardDtoFromJSON");function AwardDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{name:json.name,id:json.id,description:json.description,url:json.url,rarity:json.rarity}}__name(AwardDtoFromJSONTyped,"AwardDtoFromJSONTyped");function AwardInventoryDtoFromJSON(json){return AwardInventoryDtoFromJSONTyped(json)}__name(AwardInventoryDtoFromJSON,"AwardInventoryDtoFromJSON");function AwardInventoryDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{award:AwardDtoFromJSON(json.award),inventoryIds:json.inventoryIds}}__name(AwardInventoryDtoFromJSONTyped,"AwardInventoryDtoFromJSONTyped");function CloudDeleteDtoToJSON(value){return value==null?value:{ids:value.ids}}__name(CloudDeleteDtoToJSON,"CloudDeleteDtoToJSON");function CloudImageDtoFromJSON(json){return CloudImageDtoFromJSONTyped(json)}__name(CloudImageDtoFromJSON,"CloudImageDtoFromJSON");function CloudImageDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{name:json.name,author:json.author,createdAt:json.createdAt,id:json.id,metaUrl:json.metaUrl,commandsUrl:json.commandsUrl,imageUrl:json.imageUrl}}__name(CloudImageDtoFromJSONTyped,"CloudImageDtoFromJSONTyped");function CloudSearchDtoToJSON(value){return value==null?value:{pageSize:value.pageSize,page:value.page,authorQuery:value.authorQuery,languageQuery:value.languageQuery,createdBeforeQuery:value.createdBeforeQuery,createdAfterQuery:value.createdAfterQuery,createdInPrivateLobbyQuery:value.createdInPrivateLobbyQuery,isOwnQuery:value.isOwnQuery,titleQuery:value.titleQuery}}__name(CloudSearchDtoToJSON,"CloudSearchDtoToJSON");function CloudUploadDtoToJSON(value){return value==null?value:{name:value.name,author:value.author,inPrivate:value.inPrivate,isOwn:value.isOwn,language:value.language,commands:value.commands,imageBase64:value.imageBase64}}__name(CloudUploadDtoToJSON,"CloudUploadDtoToJSON");function CloudUploadedDtoFromJSON(json){return CloudUploadedDtoFromJSONTyped(json)}__name(CloudUploadedDtoFromJSON,"CloudUploadedDtoFromJSON");function CloudUploadedDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{id:json.id}}__name(CloudUploadedDtoFromJSONTyped,"CloudUploadedDtoFromJSONTyped");function EmojiCandidateDtoToJSON(value){return value==null?value:{name:value.name,url:value.url,animated:value.animated}}__name(EmojiCandidateDtoToJSON,"EmojiCandidateDtoToJSON");function EmojiDtoFromJSON(json){return EmojiDtoFromJSONTyped(json)}__name(EmojiDtoFromJSON,"EmojiDtoFromJSON");function EmojiDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{name:json.name,url:json.url,animated:json.animated,nameId:json.nameId}}__name(EmojiDtoFromJSONTyped,"EmojiDtoFromJSONTyped");function EventDtoFromJSON(json){return EventDtoFromJSONTyped(json)}__name(EventDtoFromJSON,"EventDtoFromJSON");function EventDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{name:json.name,id:json.id,description:json.description,eventStart:json.eventStart,eventLength:json.eventLength}}__name(EventDtoFromJSONTyped,"EventDtoFromJSONTyped");function EventDropDtoFromJSON(json){return EventDropDtoFromJSONTyped(json)}__name(EventDropDtoFromJSON,"EventDropDtoFromJSON");function EventDropDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{id:json.id,name:json.name,url:json.url,event:EventDtoFromJSON(json.event)}}__name(EventDropDtoFromJSONTyped,"EventDropDtoFromJSONTyped");function GuildDtoFromJSON(json){return GuildDtoFromJSONTyped(json)}__name(GuildDtoFromJSON,"GuildDtoFromJSON");function GuildDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{guildID:json.GuildID,invite:json.Invite,guildName:json.GuildName}}__name(GuildDtoFromJSONTyped,"GuildDtoFromJSONTyped");function GuildInviteDtoFromJSON(json){return GuildInviteDtoFromJSONTyped(json)}__name(GuildInviteDtoFromJSON,"GuildInviteDtoFromJSON");function GuildInviteDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{name:json.name,token:json.token,iconUrl:json.iconUrl,connectedMembers:json.connectedMembers}}__name(GuildInviteDtoFromJSONTyped,"GuildInviteDtoFromJSONTyped");function MemberDtoFromJSON(json){return MemberDtoFromJSONTyped(json)}__name(MemberDtoFromJSON,"MemberDtoFromJSON");function MemberDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{bubbles:json.bubbles,drops:json.drops,sprites:json.sprites,scenes:json.scenes,flags:json.flags,rainbowSprites:json.rainbowSprites,discordID:json.discordID,userName:json.userName,userLogin:json.userLogin,guilds:json.guilds.map(GuildDtoFromJSON),rawMember:json.rawMember,memberFlags:json.memberFlags}}__name(MemberDtoFromJSONTyped,"MemberDtoFromJSONTyped");function MemberSearchDtoFromJSON(json){return MemberSearchDtoFromJSONTyped(json)}__name(MemberSearchDtoFromJSON,"MemberSearchDtoFromJSON");function MemberSearchDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{userName:json.userName,userLogin:json.userLogin,rawMember:json.rawMember}}__name(MemberSearchDtoFromJSONTyped,"MemberSearchDtoFromJSONTyped");function MemberWebhookDtoFromJSON(json){return MemberWebhookDtoFromJSONTyped(json)}__name(MemberWebhookDtoFromJSON,"MemberWebhookDtoFromJSON");function MemberWebhookDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{name:json.Name,guild:GuildDtoFromJSON(json.Guild)}}__name(MemberWebhookDtoFromJSONTyped,"MemberWebhookDtoFromJSONTyped");function PostImageDtoToJSON(value){return value==null?value:{title:value.title,author:value.author,posterName:value.posterName,onlyImage:value.onlyImage,imageBase64:value.imageBase64}}__name(PostImageDtoToJSON,"PostImageDtoToJSON");function SceneThemeDtoFromJSON(json){return SceneThemeDtoFromJSONTyped(json)}__name(SceneThemeDtoFromJSON,"SceneThemeDtoFromJSON");function SceneThemeDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{name:json.name,shift:json.shift}}__name(SceneThemeDtoFromJSONTyped,"SceneThemeDtoFromJSONTyped");function SceneDtoFromJSON(json){return SceneDtoFromJSONTyped(json)}__name(SceneDtoFromJSON,"SceneDtoFromJSON");function SceneDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{name:json.name,id:json.id,url:json.url,exclusive:json.exclusive,event:json.event==null?void 0:EventDtoFromJSON(json.event),primaryColor:json.primaryColor==null?void 0:json.primaryColor,guessedColor:json.guessedColor==null?void 0:json.guessedColor,artist:json.artist==null?void 0:json.artist,themes:json.themes.map(SceneThemeDtoFromJSON)}}__name(SceneDtoFromJSONTyped,"SceneDtoFromJSONTyped");function SceneInventoryItemDtoFromJSON(json){return SceneInventoryItemDtoFromJSONTyped(json)}__name(SceneInventoryItemDtoFromJSON,"SceneInventoryItemDtoFromJSON");function SceneInventoryItemDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{sceneId:json.sceneId,sceneShift:json.sceneShift==null?void 0:json.sceneShift}}__name(SceneInventoryItemDtoFromJSONTyped,"SceneInventoryItemDtoFromJSONTyped");function SceneInventoryItemDtoToJSON(value){return value==null?value:{sceneId:value.sceneId,sceneShift:value.sceneShift}}__name(SceneInventoryItemDtoToJSON,"SceneInventoryItemDtoToJSON");function SceneInventoryDtoFromJSON(json){return SceneInventoryDtoFromJSONTyped(json)}__name(SceneInventoryDtoFromJSON,"SceneInventoryDtoFromJSON");function SceneInventoryDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{activeId:json.activeId==null?void 0:json.activeId,activeShift:json.activeShift==null?void 0:json.activeShift,scenes:json.scenes.map(SceneInventoryItemDtoFromJSON)}}__name(SceneInventoryDtoFromJSONTyped,"SceneInventoryDtoFromJSONTyped");function SetActiveSceneDtoToJSON(value){return value==null?value:{scene:SceneInventoryItemDtoToJSON(value.scene)}}__name(SetActiveSceneDtoToJSON,"SetActiveSceneDtoToJSON");function SpriteSlotDtoToJSON(value){return value==null?value:{slotId:value.slotId,spriteId:value.spriteId}}__name(SpriteSlotDtoToJSON,"SpriteSlotDtoToJSON");function SpriteComboDtoToJSON(value){return value==null?value:{slots:value.slots.map(SpriteSlotDtoToJSON)}}__name(SpriteComboDtoToJSON,"SpriteComboDtoToJSON");function SpriteDtoFromJSON(json){return SpriteDtoFromJSONTyped(json)}__name(SpriteDtoFromJSON,"SpriteDtoFromJSON");function SpriteDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{name:json.name,id:json.id,cost:json.cost,url:json.url,eventDrop:json.eventDrop==null?void 0:EventDropDtoFromJSON(json.eventDrop),isRainbowAllowed:json.isRainbowAllowed,isSpecial:json.isSpecial,artist:json.artist==null?void 0:json.artist,requiredFlags:json.requiredFlags}}__name(SpriteDtoFromJSONTyped,"SpriteDtoFromJSONTyped");function SpriteInventoryDtoFromJSON(json){return SpriteInventoryDtoFromJSONTyped(json)}__name(SpriteInventoryDtoFromJSON,"SpriteInventoryDtoFromJSON");function SpriteInventoryDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{slot:json.slot==null?void 0:json.slot,spriteId:json.spriteId,colorShift:json.colorShift==null?void 0:json.colorShift}}__name(SpriteInventoryDtoFromJSONTyped,"SpriteInventoryDtoFromJSONTyped");function SpriteSlotCountDtoFromJSON(json){return SpriteSlotCountDtoFromJSONTyped(json)}__name(SpriteSlotCountDtoFromJSON,"SpriteSlotCountDtoFromJSON");function SpriteSlotCountDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{unlockedSlots:json.unlockedSlots}}__name(SpriteSlotCountDtoFromJSONTyped,"SpriteSlotCountDtoFromJSONTyped");function ThemeMetaDtoFromJSON(json){return ThemeMetaDtoFromJSONTyped(json)}__name(ThemeMetaDtoFromJSON,"ThemeMetaDtoFromJSON");function ThemeMetaDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{author:json.author,created:json.created,type:json.type,id:json.id,name:json.name}}__name(ThemeMetaDtoFromJSONTyped,"ThemeMetaDtoFromJSONTyped");function ThemeMetaDtoToJSON(value){return value==null?value:{author:value.author,created:value.created,type:value.type,id:value.id,name:value.name}}__name(ThemeMetaDtoToJSON,"ThemeMetaDtoToJSON");function ThemeDtoFromJSON(json){return ThemeDtoFromJSONTyped(json)}__name(ThemeDtoFromJSON,"ThemeDtoFromJSON");function ThemeDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{colors:json.colors,hooks:json.hooks,images:json.images,misc:json.misc,meta:ThemeMetaDtoFromJSON(json.meta)}}__name(ThemeDtoFromJSONTyped,"ThemeDtoFromJSONTyped");function ThemeDtoToJSON(value){return value==null?value:{colors:value.colors,hooks:value.hooks,images:value.images,misc:value.misc,meta:ThemeMetaDtoToJSON(value.meta)}}__name(ThemeDtoToJSON,"ThemeDtoToJSON");function ThemeListingDtoFromJSON(json){return ThemeListingDtoFromJSONTyped(json)}__name(ThemeListingDtoFromJSON,"ThemeListingDtoFromJSON");function ThemeListingDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{id:json.id,downloads:json.downloads,version:json.version,name:json.name,author:json.author}}__name(ThemeListingDtoFromJSONTyped,"ThemeListingDtoFromJSONTyped");function ThemePublishRequestDtoToJSON(value){return value==null?value:{owner:value.owner}}__name(ThemePublishRequestDtoToJSON,"ThemePublishRequestDtoToJSON");function ThemeShareDtoFromJSON(json){return ThemeShareDtoFromJSONTyped(json)}__name(ThemeShareDtoFromJSON,"ThemeShareDtoFromJSON");function ThemeShareDtoFromJSONTyped(json,ignoreDiscriminator){return json==null?json:{id:json.id}}__name(ThemeShareDtoFromJSONTyped,"ThemeShareDtoFromJSONTyped");function ThemeUpdateRequestDtoToJSON(value){return value==null?value:{newId:value.newId}}__name(ThemeUpdateRequestDtoToJSON,"ThemeUpdateRequestDtoToJSON");function UpdateDiscordIDToJSON(value){return value==null?value:{id:value.id}}__name(UpdateDiscordIDToJSON,"UpdateDiscordIDToJSON");const _AnnouncementsApi=class _AnnouncementsApi extends BaseAPI{async getAnnouncementsRaw(initOverrides){const queryParameters={},headerParameters={},response=await this.request({path:"/announcements",method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>jsonValue.map(AnnouncementDtoFromJSON))}async getAnnouncements(initOverrides){return await(await this.getAnnouncementsRaw(initOverrides)).value()}};__name(_AnnouncementsApi,"AnnouncementsApi");let AnnouncementsApi=_AnnouncementsApi;const _AwardsApi=class _AwardsApi extends BaseAPI{async getAllAwardsRaw(initOverrides){const queryParameters={},headerParameters={},response=await this.request({path:"/awards",method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>jsonValue.map(AwardDtoFromJSON))}async getAllAwards(initOverrides){return await(await this.getAllAwardsRaw(initOverrides)).value()}};__name(_AwardsApi,"AwardsApi");let AwardsApi=_AwardsApi;const _CloudApi=class _CloudApi extends BaseAPI{async bulkDeleteFromUserCloudRaw(requestParameters,initOverrides){if(requestParameters.login==null)throw new RequiredError("login",'Required parameter "login" was null or undefined when calling bulkDeleteFromUserCloud().');if(requestParameters.cloudDeleteDto==null)throw new RequiredError("cloudDeleteDto",'Required parameter "cloudDeleteDto" was null or undefined when calling bulkDeleteFromUserCloud().');const queryParameters={},headerParameters={};if(headerParameters["Content-Type"]="application/json",this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/cloud/{login}/delete".replace("{login}",encodeURIComponent(String(requestParameters.login))),method:"POST",headers:headerParameters,query:queryParameters,body:CloudDeleteDtoToJSON(requestParameters.cloudDeleteDto)},initOverrides);return new VoidApiResponse(response)}async bulkDeleteFromUserCloud(requestParameters,initOverrides){await this.bulkDeleteFromUserCloudRaw(requestParameters,initOverrides)}async deleteImageFromUserCloudRaw(requestParameters,initOverrides){if(requestParameters.login==null)throw new RequiredError("login",'Required parameter "login" was null or undefined when calling deleteImageFromUserCloud().');if(requestParameters.id==null)throw new RequiredError("id",'Required parameter "id" was null or undefined when calling deleteImageFromUserCloud().');const queryParameters={},headerParameters={};if(this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/cloud/{login}/{id}".replace("{login}",encodeURIComponent(String(requestParameters.login))).replace("{id}",encodeURIComponent(String(requestParameters.id))),method:"DELETE",headers:headerParameters,query:queryParameters},initOverrides);return new VoidApiResponse(response)}async deleteImageFromUserCloud(requestParameters,initOverrides){await this.deleteImageFromUserCloudRaw(requestParameters,initOverrides)}async getImageFromUserCloudRaw(requestParameters,initOverrides){if(requestParameters.login==null)throw new RequiredError("login",'Required parameter "login" was null or undefined when calling getImageFromUserCloud().');if(requestParameters.id==null)throw new RequiredError("id",'Required parameter "id" was null or undefined when calling getImageFromUserCloud().');const queryParameters={},headerParameters={};if(this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/cloud/{login}/{id}".replace("{login}",encodeURIComponent(String(requestParameters.login))).replace("{id}",encodeURIComponent(String(requestParameters.id))),method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>CloudImageDtoFromJSON(jsonValue))}async getImageFromUserCloud(requestParameters,initOverrides){return await(await this.getImageFromUserCloudRaw(requestParameters,initOverrides)).value()}async linkImageToAwardRaw(requestParameters,initOverrides){if(requestParameters.login==null)throw new RequiredError("login",'Required parameter "login" was null or undefined when calling linkImageToAward().');if(requestParameters.id==null)throw new RequiredError("id",'Required parameter "id" was null or undefined when calling linkImageToAward().');if(requestParameters.token==null)throw new RequiredError("token",'Required parameter "token" was null or undefined when calling linkImageToAward().');const queryParameters={},headerParameters={};if(this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/cloud/{login}/{id}/award/{token}".replace("{login}",encodeURIComponent(String(requestParameters.login))).replace("{id}",encodeURIComponent(String(requestParameters.id))).replace("{token}",encodeURIComponent(String(requestParameters.token))),method:"PATCH",headers:headerParameters,query:queryParameters},initOverrides);return new VoidApiResponse(response)}async linkImageToAward(requestParameters,initOverrides){await this.linkImageToAwardRaw(requestParameters,initOverrides)}async searchUserCloudRaw(requestParameters,initOverrides){if(requestParameters.login==null)throw new RequiredError("login",'Required parameter "login" was null or undefined when calling searchUserCloud().');if(requestParameters.cloudSearchDto==null)throw new RequiredError("cloudSearchDto",'Required parameter "cloudSearchDto" was null or undefined when calling searchUserCloud().');const queryParameters={},headerParameters={};if(headerParameters["Content-Type"]="application/json",this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/cloud/{login}/search".replace("{login}",encodeURIComponent(String(requestParameters.login))),method:"POST",headers:headerParameters,query:queryParameters,body:CloudSearchDtoToJSON(requestParameters.cloudSearchDto)},initOverrides);return new JSONApiResponse(response,jsonValue=>jsonValue.map(CloudImageDtoFromJSON))}async searchUserCloud(requestParameters,initOverrides){return await(await this.searchUserCloudRaw(requestParameters,initOverrides)).value()}async uploadToUserCloudRaw(requestParameters,initOverrides){if(requestParameters.login==null)throw new RequiredError("login",'Required parameter "login" was null or undefined when calling uploadToUserCloud().');if(requestParameters.cloudUploadDto==null)throw new RequiredError("cloudUploadDto",'Required parameter "cloudUploadDto" was null or undefined when calling uploadToUserCloud().');const queryParameters={},headerParameters={};if(headerParameters["Content-Type"]="application/json",this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/cloud/{login}".replace("{login}",encodeURIComponent(String(requestParameters.login))),method:"POST",headers:headerParameters,query:queryParameters,body:CloudUploadDtoToJSON(requestParameters.cloudUploadDto)},initOverrides);return new JSONApiResponse(response,jsonValue=>CloudUploadedDtoFromJSON(jsonValue))}async uploadToUserCloud(requestParameters,initOverrides){return await(await this.uploadToUserCloudRaw(requestParameters,initOverrides)).value()}};__name(_CloudApi,"CloudApi");let CloudApi=_CloudApi;const _EmojisApi=class _EmojisApi extends BaseAPI{async addEmojiRaw(requestParameters,initOverrides){if(requestParameters.emojiCandidateDto==null)throw new RequiredError("emojiCandidateDto",'Required parameter "emojiCandidateDto" was null or undefined when calling addEmoji().');const queryParameters={},headerParameters={};if(headerParameters["Content-Type"]="application/json",this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/emojis",method:"POST",headers:headerParameters,query:queryParameters,body:EmojiCandidateDtoToJSON(requestParameters.emojiCandidateDto)},initOverrides);return new JSONApiResponse(response,jsonValue=>EmojiDtoFromJSON(jsonValue))}async addEmoji(requestParameters,initOverrides){return await(await this.addEmojiRaw(requestParameters,initOverrides)).value()}async deleteEmojiRaw(requestParameters,initOverrides){if(requestParameters.id==null)throw new RequiredError("id",'Required parameter "id" was null or undefined when calling deleteEmoji().');const queryParameters={};requestParameters.nameId!=null&&(queryParameters.nameId=requestParameters.nameId);const headerParameters={};if(this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/emojis/{id}".replace("{id}",encodeURIComponent(String(requestParameters.id))),method:"DELETE",headers:headerParameters,query:queryParameters},initOverrides);return new VoidApiResponse(response)}async deleteEmoji(requestParameters,initOverrides){await this.deleteEmojiRaw(requestParameters,initOverrides)}async getAllEmojisRaw(requestParameters,initOverrides){if(requestParameters.limit==null)throw new RequiredError("limit",'Required parameter "limit" was null or undefined when calling getAllEmojis().');if(requestParameters.animated==null)throw new RequiredError("animated",'Required parameter "animated" was null or undefined when calling getAllEmojis().');if(requestParameters.statics==null)throw new RequiredError("statics",'Required parameter "statics" was null or undefined when calling getAllEmojis().');const queryParameters={};requestParameters.query!=null&&(queryParameters.query=requestParameters.query),requestParameters.limit!=null&&(queryParameters.limit=requestParameters.limit),requestParameters.animated!=null&&(queryParameters.animated=requestParameters.animated),requestParameters.statics!=null&&(queryParameters.statics=requestParameters.statics);const headerParameters={},response=await this.request({path:"/emojis",method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>jsonValue.map(EmojiDtoFromJSON))}async getAllEmojis(requestParameters,initOverrides){return await(await this.getAllEmojisRaw(requestParameters,initOverrides)).value()}async getAllEmojisCachedRaw(requestParameters,initOverrides){if(requestParameters.limit==null)throw new RequiredError("limit",'Required parameter "limit" was null or undefined when calling getAllEmojisCached().');if(requestParameters.animated==null)throw new RequiredError("animated",'Required parameter "animated" was null or undefined when calling getAllEmojisCached().');if(requestParameters.statics==null)throw new RequiredError("statics",'Required parameter "statics" was null or undefined when calling getAllEmojisCached().');const queryParameters={};requestParameters.query!=null&&(queryParameters.query=requestParameters.query),requestParameters.limit!=null&&(queryParameters.limit=requestParameters.limit),requestParameters.animated!=null&&(queryParameters.animated=requestParameters.animated),requestParameters.statics!=null&&(queryParameters.statics=requestParameters.statics);const headerParameters={},response=await this.request({path:"/emojis/cache",method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>jsonValue.map(EmojiDtoFromJSON))}async getAllEmojisCached(requestParameters,initOverrides){return await(await this.getAllEmojisCachedRaw(requestParameters,initOverrides)).value()}async getEmojiRaw(requestParameters,initOverrides){if(requestParameters.id==null)throw new RequiredError("id",'Required parameter "id" was null or undefined when calling getEmoji().');const queryParameters={};requestParameters.nameId!=null&&(queryParameters.nameId=requestParameters.nameId);const headerParameters={},response=await this.request({path:"/emojis/{id}".replace("{id}",encodeURIComponent(String(requestParameters.id))),method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>EmojiDtoFromJSON(jsonValue))}async getEmoji(requestParameters,initOverrides){return await(await this.getEmojiRaw(requestParameters,initOverrides)).value()}async getNewEmojisRaw(requestParameters,initOverrides){if(requestParameters.limit==null)throw new RequiredError("limit",'Required parameter "limit" was null or undefined when calling getNewEmojis().');if(requestParameters.animated==null)throw new RequiredError("animated",'Required parameter "animated" was null or undefined when calling getNewEmojis().');if(requestParameters.statics==null)throw new RequiredError("statics",'Required parameter "statics" was null or undefined when calling getNewEmojis().');const queryParameters={};requestParameters.query!=null&&(queryParameters.query=requestParameters.query),requestParameters.limit!=null&&(queryParameters.limit=requestParameters.limit),requestParameters.animated!=null&&(queryParameters.animated=requestParameters.animated),requestParameters.statics!=null&&(queryParameters.statics=requestParameters.statics);const headerParameters={};if(this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/emojis/discover",method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>jsonValue.map(EmojiDtoFromJSON))}async getNewEmojis(requestParameters,initOverrides){return await(await this.getNewEmojisRaw(requestParameters,initOverrides)).value()}};__name(_EmojisApi,"EmojisApi");let EmojisApi=_EmojisApi;const _EventsApi=class _EventsApi extends BaseAPI{async getAllEventDropsRaw(initOverrides){const queryParameters={},headerParameters={},response=await this.request({path:"/events/drops",method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>jsonValue.map(EventDropDtoFromJSON))}async getAllEventDrops(initOverrides){return await(await this.getAllEventDropsRaw(initOverrides)).value()}async getAllEventsRaw(initOverrides){const queryParameters={},headerParameters={},response=await this.request({path:"/events",method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>jsonValue.map(EventDtoFromJSON))}async getAllEvents(initOverrides){return await(await this.getAllEventsRaw(initOverrides)).value()}async getEventByIdRaw(requestParameters,initOverrides){if(requestParameters.id==null)throw new RequiredError("id",'Required parameter "id" was null or undefined when calling getEventById().');const queryParameters={},headerParameters={},response=await this.request({path:"/events/{id}".replace("{id}",encodeURIComponent(String(requestParameters.id))),method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>EventDtoFromJSON(jsonValue))}async getEventById(requestParameters,initOverrides){return await(await this.getEventByIdRaw(requestParameters,initOverrides)).value()}async getEventDropRaw(requestParameters,initOverrides){if(requestParameters.id==null)throw new RequiredError("id",'Required parameter "id" was null or undefined when calling getEventDrop().');const queryParameters={},headerParameters={},response=await this.request({path:"/events/drops/{id}".replace("{id}",encodeURIComponent(String(requestParameters.id))),method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>EventDropDtoFromJSON(jsonValue))}async getEventDrop(requestParameters,initOverrides){return await(await this.getEventDropRaw(requestParameters,initOverrides)).value()}async getEventDropsOfEventRaw(requestParameters,initOverrides){if(requestParameters.id==null)throw new RequiredError("id",'Required parameter "id" was null or undefined when calling getEventDropsOfEvent().');const queryParameters={},headerParameters={},response=await this.request({path:"/events/{id}/drops".replace("{id}",encodeURIComponent(String(requestParameters.id))),method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>jsonValue.map(EventDropDtoFromJSON))}async getEventDropsOfEvent(requestParameters,initOverrides){return await(await this.getEventDropsOfEventRaw(requestParameters,initOverrides)).value()}};__name(_EventsApi,"EventsApi");let EventsApi=_EventsApi;const _GuildsApi=class _GuildsApi extends BaseAPI{async getGuildInviteRaw(requestParameters,initOverrides){if(requestParameters.token==null)throw new RequiredError("token",'Required parameter "token" was null or undefined when calling getGuildInvite().');const queryParameters={},headerParameters={},response=await this.request({path:"/guilds/{token}/invite".replace("{token}",encodeURIComponent(String(requestParameters.token))),method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>GuildInviteDtoFromJSON(jsonValue))}async getGuildInvite(requestParameters,initOverrides){return await(await this.getGuildInviteRaw(requestParameters,initOverrides)).value()}async postImageToGuildRaw(requestParameters,initOverrides){if(requestParameters.token==null)throw new RequiredError("token",'Required parameter "token" was null or undefined when calling postImageToGuild().');if(requestParameters.id==null)throw new RequiredError("id",'Required parameter "id" was null or undefined when calling postImageToGuild().');if(requestParameters.postImageDto==null)throw new RequiredError("postImageDto",'Required parameter "postImageDto" was null or undefined when calling postImageToGuild().');const queryParameters={},headerParameters={};if(headerParameters["Content-Type"]="application/json",this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/guilds/{token}/imagepost/{id}".replace("{token}",encodeURIComponent(String(requestParameters.token))).replace("{id}",encodeURIComponent(String(requestParameters.id))),method:"POST",headers:headerParameters,query:queryParameters,body:PostImageDtoToJSON(requestParameters.postImageDto)},initOverrides);return new VoidApiResponse(response)}async postImageToGuild(requestParameters,initOverrides){await this.postImageToGuildRaw(requestParameters,initOverrides)}};__name(_GuildsApi,"GuildsApi");let GuildsApi=_GuildsApi;const _InventoryApi=class _InventoryApi extends BaseAPI{async getMemberAvailableAwardInventoryRaw(requestParameters,initOverrides){if(requestParameters.login==null)throw new RequiredError("login",'Required parameter "login" was null or undefined when calling getMemberAvailableAwardInventory().');const queryParameters={},headerParameters={};if(this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/member/{login}/inventory/awards/available".replace("{login}",encodeURIComponent(String(requestParameters.login))),method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>jsonValue.map(AwardInventoryDtoFromJSON))}async getMemberAvailableAwardInventory(requestParameters,initOverrides){return await(await this.getMemberAvailableAwardInventoryRaw(requestParameters,initOverrides)).value()}async getMemberSceneInventoryRaw(requestParameters,initOverrides){if(requestParameters.login==null)throw new RequiredError("login",'Required parameter "login" was null or undefined when calling getMemberSceneInventory().');const queryParameters={},headerParameters={};if(this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/member/{login}/inventory/scenes".replace("{login}",encodeURIComponent(String(requestParameters.login))),method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>SceneInventoryDtoFromJSON(jsonValue))}async getMemberSceneInventory(requestParameters,initOverrides){return await(await this.getMemberSceneInventoryRaw(requestParameters,initOverrides)).value()}async getMemberSpriteInventoryRaw(requestParameters,initOverrides){if(requestParameters.login==null)throw new RequiredError("login",'Required parameter "login" was null or undefined when calling getMemberSpriteInventory().');const queryParameters={},headerParameters={};if(this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/member/{login}/inventory/sprites".replace("{login}",encodeURIComponent(String(requestParameters.login))),method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>jsonValue.map(SpriteInventoryDtoFromJSON))}async getMemberSpriteInventory(requestParameters,initOverrides){return await(await this.getMemberSpriteInventoryRaw(requestParameters,initOverrides)).value()}async getMemberSpriteSlotCountRaw(requestParameters,initOverrides){if(requestParameters.login==null)throw new RequiredError("login",'Required parameter "login" was null or undefined when calling getMemberSpriteSlotCount().');const queryParameters={},headerParameters={};if(this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/member/{login}/inventory/sprites/slots".replace("{login}",encodeURIComponent(String(requestParameters.login))),method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>SpriteSlotCountDtoFromJSON(jsonValue))}async getMemberSpriteSlotCount(requestParameters,initOverrides){return await(await this.getMemberSpriteSlotCountRaw(requestParameters,initOverrides)).value()}async setMemberSceneRaw(requestParameters,initOverrides){if(requestParameters.login==null)throw new RequiredError("login",'Required parameter "login" was null or undefined when calling setMemberScene().');if(requestParameters.setActiveSceneDto==null)throw new RequiredError("setActiveSceneDto",'Required parameter "setActiveSceneDto" was null or undefined when calling setMemberScene().');const queryParameters={},headerParameters={};if(headerParameters["Content-Type"]="application/json",this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/member/{login}/inventory/scenes".replace("{login}",encodeURIComponent(String(requestParameters.login))),method:"PATCH",headers:headerParameters,query:queryParameters,body:SetActiveSceneDtoToJSON(requestParameters.setActiveSceneDto)},initOverrides);return new VoidApiResponse(response)}async setMemberScene(requestParameters,initOverrides){await this.setMemberSceneRaw(requestParameters,initOverrides)}async setMemberSpriteComboRaw(requestParameters,initOverrides){if(requestParameters.login==null)throw new RequiredError("login",'Required parameter "login" was null or undefined when calling setMemberSpriteCombo().');if(requestParameters.spriteComboDto==null)throw new RequiredError("spriteComboDto",'Required parameter "spriteComboDto" was null or undefined when calling setMemberSpriteCombo().');const queryParameters={},headerParameters={};if(headerParameters["Content-Type"]="application/json",this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/member/{login}/inventory/sprites/combo".replace("{login}",encodeURIComponent(String(requestParameters.login))),method:"PATCH",headers:headerParameters,query:queryParameters,body:SpriteComboDtoToJSON(requestParameters.spriteComboDto)},initOverrides);return new VoidApiResponse(response)}async setMemberSpriteCombo(requestParameters,initOverrides){await this.setMemberSpriteComboRaw(requestParameters,initOverrides)}async setMemberSpriteSlotRaw(requestParameters,initOverrides){if(requestParameters.login==null)throw new RequiredError("login",'Required parameter "login" was null or undefined when calling setMemberSpriteSlot().');if(requestParameters.spriteSlotDto==null)throw new RequiredError("spriteSlotDto",'Required parameter "spriteSlotDto" was null or undefined when calling setMemberSpriteSlot().');const queryParameters={},headerParameters={};if(headerParameters["Content-Type"]="application/json",this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/member/{login}/inventory/sprites/slot".replace("{login}",encodeURIComponent(String(requestParameters.login))),method:"PATCH",headers:headerParameters,query:queryParameters,body:SpriteSlotDtoToJSON(requestParameters.spriteSlotDto)},initOverrides);return new VoidApiResponse(response)}async setMemberSpriteSlot(requestParameters,initOverrides){await this.setMemberSpriteSlotRaw(requestParameters,initOverrides)}};__name(_InventoryApi,"InventoryApi");let InventoryApi=_InventoryApi;const _MembersApi=class _MembersApi extends BaseAPI{async clearMemberDropboostRaw(requestParameters,initOverrides){if(requestParameters.login==null)throw new RequiredError("login",'Required parameter "login" was null or undefined when calling clearMemberDropboost().');const queryParameters={},headerParameters={};if(this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/members/{login}/dropboost".replace("{login}",encodeURIComponent(String(requestParameters.login))),method:"DELETE",headers:headerParameters,query:queryParameters},initOverrides);return new VoidApiResponse(response)}async clearMemberDropboost(requestParameters,initOverrides){await this.clearMemberDropboostRaw(requestParameters,initOverrides)}async connectMemberToGuildRaw(requestParameters,initOverrides){if(requestParameters.login==null)throw new RequiredError("login",'Required parameter "login" was null or undefined when calling connectMemberToGuild().');if(requestParameters.token==null)throw new RequiredError("token",'Required parameter "token" was null or undefined when calling connectMemberToGuild().');const queryParameters={},headerParameters={};if(this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/members/{login}/guilds/{token}".replace("{login}",encodeURIComponent(String(requestParameters.login))).replace("{token}",encodeURIComponent(String(requestParameters.token))),method:"PATCH",headers:headerParameters,query:queryParameters},initOverrides);return new VoidApiResponse(response)}async connectMemberToGuild(requestParameters,initOverrides){await this.connectMemberToGuildRaw(requestParameters,initOverrides)}async findMembersWildcardSearchRaw(requestParameters,initOverrides){if(requestParameters.content==null)throw new RequiredError("content",'Required parameter "content" was null or undefined when calling findMembersWildcardSearch().');const queryParameters={};requestParameters.content!=null&&(queryParameters.content=requestParameters.content);const headerParameters={};if(this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/members/search",method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>jsonValue.map(MemberSearchDtoFromJSON))}async findMembersWildcardSearch(requestParameters,initOverrides){return await(await this.findMembersWildcardSearchRaw(requestParameters,initOverrides)).value()}async getAuthenticatedMemberRaw(initOverrides){const queryParameters={},headerParameters={};if(this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/members/me",method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>MemberDtoFromJSON(jsonValue))}async getAuthenticatedMember(initOverrides){return await(await this.getAuthenticatedMemberRaw(initOverrides)).value()}async getMemberAccessTokenRaw(requestParameters,initOverrides){if(requestParameters.login==null)throw new RequiredError("login",'Required parameter "login" was null or undefined when calling getMemberAccessToken().');const queryParameters={},headerParameters={};if(this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/members/{login}/token".replace("{login}",encodeURIComponent(String(requestParameters.login))),method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>AccessTokenDtoFromJSON(jsonValue))}async getMemberAccessToken(requestParameters,initOverrides){return await(await this.getMemberAccessTokenRaw(requestParameters,initOverrides)).value()}async getMemberByDiscordIDRaw(requestParameters,initOverrides){if(requestParameters.id==null)throw new RequiredError("id",'Required parameter "id" was null or undefined when calling getMemberByDiscordID().');const queryParameters={},headerParameters={};if(this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/members/discord/{id}".replace("{id}",encodeURIComponent(String(requestParameters.id))),method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>MemberDtoFromJSON(jsonValue))}async getMemberByDiscordID(requestParameters,initOverrides){return await(await this.getMemberByDiscordIDRaw(requestParameters,initOverrides)).value()}async getMemberByLoginRaw(requestParameters,initOverrides){if(requestParameters.login==null)throw new RequiredError("login",'Required parameter "login" was null or undefined when calling getMemberByLogin().');const queryParameters={},headerParameters={};if(this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/members/{login}".replace("{login}",encodeURIComponent(String(requestParameters.login))),method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>MemberDtoFromJSON(jsonValue))}async getMemberByLogin(requestParameters,initOverrides){return await(await this.getMemberByLoginRaw(requestParameters,initOverrides)).value()}async getMemberGuildWebhooksRaw(requestParameters,initOverrides){if(requestParameters.login==null)throw new RequiredError("login",'Required parameter "login" was null or undefined when calling getMemberGuildWebhooks().');const queryParameters={},headerParameters={};if(this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/members/{login}/webhooks".replace("{login}",encodeURIComponent(String(requestParameters.login))),method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>jsonValue.map(MemberWebhookDtoFromJSON))}async getMemberGuildWebhooks(requestParameters,initOverrides){return await(await this.getMemberGuildWebhooksRaw(requestParameters,initOverrides)).value()}async removeConnectedGuildRaw(requestParameters,initOverrides){if(requestParameters.login==null)throw new RequiredError("login",'Required parameter "login" was null or undefined when calling removeConnectedGuild().');if(requestParameters.token==null)throw new RequiredError("token",'Required parameter "token" was null or undefined when calling removeConnectedGuild().');const queryParameters={},headerParameters={};if(this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/members/{login}/guilds/{token}".replace("{login}",encodeURIComponent(String(requestParameters.login))).replace("{token}",encodeURIComponent(String(requestParameters.token))),method:"DELETE",headers:headerParameters,query:queryParameters},initOverrides);return new VoidApiResponse(response)}async removeConnectedGuild(requestParameters,initOverrides){await this.removeConnectedGuildRaw(requestParameters,initOverrides)}async updateMemberDiscordIDRaw(requestParameters,initOverrides){if(requestParameters.login==null)throw new RequiredError("login",'Required parameter "login" was null or undefined when calling updateMemberDiscordID().');if(requestParameters.updateDiscordID==null)throw new RequiredError("updateDiscordID",'Required parameter "updateDiscordID" was null or undefined when calling updateMemberDiscordID().');const queryParameters={},headerParameters={};if(headerParameters["Content-Type"]="application/json",this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/members/{login}/discord".replace("{login}",encodeURIComponent(String(requestParameters.login))),method:"PATCH",headers:headerParameters,query:queryParameters,body:UpdateDiscordIDToJSON(requestParameters.updateDiscordID)},initOverrides);return new JSONApiResponse(response,jsonValue=>MemberDtoFromJSON(jsonValue))}async updateMemberDiscordID(requestParameters,initOverrides){return await(await this.updateMemberDiscordIDRaw(requestParameters,initOverrides)).value()}};__name(_MembersApi,"MembersApi");let MembersApi=_MembersApi;const _ScenesApi=class _ScenesApi extends BaseAPI{async getAllScenesRaw(initOverrides){const queryParameters={},headerParameters={},response=await this.request({path:"/scenes",method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>jsonValue.map(SceneDtoFromJSON))}async getAllScenes(initOverrides){return await(await this.getAllScenesRaw(initOverrides)).value()}async getSceneByIdRaw(requestParameters,initOverrides){if(requestParameters.id==null)throw new RequiredError("id",'Required parameter "id" was null or undefined when calling getSceneById().');const queryParameters={},headerParameters={},response=await this.request({path:"/scenes/{id}".replace("{id}",encodeURIComponent(String(requestParameters.id))),method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>SceneDtoFromJSON(jsonValue))}async getSceneById(requestParameters,initOverrides){return await(await this.getSceneByIdRaw(requestParameters,initOverrides)).value()}};__name(_ScenesApi,"ScenesApi");let ScenesApi=_ScenesApi;const _SpritesApi=class _SpritesApi extends BaseAPI{async getAllSpritesRaw(initOverrides){const queryParameters={},headerParameters={},response=await this.request({path:"/sprites",method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>jsonValue.map(SpriteDtoFromJSON))}async getAllSprites(initOverrides){return await(await this.getAllSpritesRaw(initOverrides)).value()}async getSpriteByIdRaw(requestParameters,initOverrides){if(requestParameters.id==null)throw new RequiredError("id",'Required parameter "id" was null or undefined when calling getSpriteById().');const queryParameters={},headerParameters={},response=await this.request({path:"/sprites/{id}".replace("{id}",encodeURIComponent(String(requestParameters.id))),method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>SpriteDtoFromJSON(jsonValue))}async getSpriteById(requestParameters,initOverrides){return await(await this.getSpriteByIdRaw(requestParameters,initOverrides)).value()}};__name(_SpritesApi,"SpritesApi");let SpritesApi=_SpritesApi;const _ThemesApi=class _ThemesApi extends BaseAPI{async getAllThemesRaw(initOverrides){const queryParameters={},headerParameters={},response=await this.request({path:"/themes",method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>jsonValue.map(ThemeListingDtoFromJSON))}async getAllThemes(initOverrides){return await(await this.getAllThemesRaw(initOverrides)).value()}async getThemeByIdRaw(requestParameters,initOverrides){if(requestParameters.id==null)throw new RequiredError("id",'Required parameter "id" was null or undefined when calling getThemeById().');const queryParameters={},headerParameters={},response=await this.request({path:"/themes/{id}".replace("{id}",encodeURIComponent(String(requestParameters.id))),method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>ThemeDtoFromJSON(jsonValue))}async getThemeById(requestParameters,initOverrides){return await(await this.getThemeByIdRaw(requestParameters,initOverrides)).value()}async publishThemeRaw(requestParameters,initOverrides){if(requestParameters.id==null)throw new RequiredError("id",'Required parameter "id" was null or undefined when calling publishTheme().');if(requestParameters.themePublishRequestDto==null)throw new RequiredError("themePublishRequestDto",'Required parameter "themePublishRequestDto" was null or undefined when calling publishTheme().');const queryParameters={},headerParameters={};if(headerParameters["Content-Type"]="application/json",this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/themes/{id}/public".replace("{id}",encodeURIComponent(String(requestParameters.id))),method:"POST",headers:headerParameters,query:queryParameters,body:ThemePublishRequestDtoToJSON(requestParameters.themePublishRequestDto)},initOverrides);return new JSONApiResponse(response,jsonValue=>ThemeShareDtoFromJSON(jsonValue))}async publishTheme(requestParameters,initOverrides){return await(await this.publishThemeRaw(requestParameters,initOverrides)).value()}async shareThemeRaw(requestParameters,initOverrides){if(requestParameters.themeDto==null)throw new RequiredError("themeDto",'Required parameter "themeDto" was null or undefined when calling shareTheme().');const queryParameters={},headerParameters={};headerParameters["Content-Type"]="application/json";const response=await this.request({path:"/themes/share",method:"POST",headers:headerParameters,query:queryParameters,body:ThemeDtoToJSON(requestParameters.themeDto)},initOverrides);return new JSONApiResponse(response,jsonValue=>ThemeShareDtoFromJSON(jsonValue))}async shareTheme(requestParameters,initOverrides){return await(await this.shareThemeRaw(requestParameters,initOverrides)).value()}async updateThemeRaw(requestParameters,initOverrides){if(requestParameters.id==null)throw new RequiredError("id",'Required parameter "id" was null or undefined when calling updateTheme().');if(requestParameters.themeUpdateRequestDto==null)throw new RequiredError("themeUpdateRequestDto",'Required parameter "themeUpdateRequestDto" was null or undefined when calling updateTheme().');const queryParameters={},headerParameters={};if(headerParameters["Content-Type"]="application/json",this.configuration&&this.configuration.accessToken){const token=this.configuration.accessToken,tokenString=await token("bearer",[]);tokenString&&(headerParameters.Authorization=`Bearer ${tokenString}`)}const response=await this.request({path:"/themes/{id}/public".replace("{id}",encodeURIComponent(String(requestParameters.id))),method:"PATCH",headers:headerParameters,query:queryParameters,body:ThemeUpdateRequestDtoToJSON(requestParameters.themeUpdateRequestDto)},initOverrides);return new JSONApiResponse(response,jsonValue=>ThemeShareDtoFromJSON(jsonValue))}async updateTheme(requestParameters,initOverrides){return await(await this.updateThemeRaw(requestParameters,initOverrides)).value()}async useThemeByIdRaw(requestParameters,initOverrides){if(requestParameters.id==null)throw new RequiredError("id",'Required parameter "id" was null or undefined when calling useThemeById().');const queryParameters={},headerParameters={},response=await this.request({path:"/themes/{id}/use".replace("{id}",encodeURIComponent(String(requestParameters.id))),method:"GET",headers:headerParameters,query:queryParameters},initOverrides);return new JSONApiResponse(response,jsonValue=>ThemeDtoFromJSON(jsonValue))}async useThemeById(requestParameters,initOverrides){return await(await this.useThemeByIdRaw(requestParameters,initOverrides)).value()}};__name(_ThemesApi,"ThemesApi");let ThemesApi=_ThemesApi;var __defProp$12=Object.defineProperty,__getOwnPropDesc$k=Object.getOwnPropertyDescriptor,__decorateClass$12=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$k(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$12(target,key,result),result},"__decorateClass$12"),__decorateParam$h=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$h"),_a59;let TokenService=(_a59=class{constructor(loggerFactory2){__publicField(this,"_logger");__publicField(this,"_token",new BehaviorSubject(void 0));this._logger=loggerFactory2(this),this.initToken()}async initToken(){const token=await chrome.runtime.sendMessage({type:"get token"});this._logger.info("Authenticated",token),this._token.next(token)}get token(){return this._token.asObservable()}async removeToken(){await chrome.runtime.sendMessage({type:"set token",token:null}),this._token.next(null)}},__name(_a59,"TokenService"),_a59);TokenService=__decorateClass$12([injectable(),__decorateParam$h(0,inject(loggerFactory))],TokenService);var __defProp$11=Object.defineProperty,__getOwnPropDesc$j=Object.getOwnPropertyDescriptor,__decorateClass$11=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$j(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$11(target,key,result),result},"__decorateClass$11"),__decorateParam$g=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$g"),_a60;let ApiService=(_a60=class{constructor(loggerFactory2,tokenService){__publicField(this,"_logger");__publicField(this,"_baseUrl","https://api.typo.rip");__publicField(this,"_token","");__publicField(this,"instances",new Map);this._logger=loggerFactory2(this),tokenService.token.subscribe(token=>this._token=token??"")}createApiConfig(){return new Configuration({basePath:this._baseUrl,accessToken:__name(()=>this._token,"accessToken")})}getApi(apiClass){let instance2=this.instances.get(apiClass);return instance2===void 0&&(instance2=new apiClass(this.createApiConfig()),this.instances.set(apiClass,instance2)),instance2}set baseUrl(url){this._baseUrl=url}},__name(_a60,"ApiService"),_a60);ApiService=__decorateClass$11([injectable(),__decorateParam$g(0,inject(loggerFactory)),__decorateParam$g(1,inject(TokenService))],ApiService);var __defProp$10=Object.defineProperty,__getOwnPropDesc$i=Object.getOwnPropertyDescriptor,__decorateClass$10=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$i(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$10(target,key,result),result},"__decorateClass$10"),__decorateParam$f=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$f"),_a61;let MemberService=(_a61=class{constructor(loggerFactory2,_apiService,_tokenService){__publicField(this,"_logger");__publicField(this,"_member$",new BehaviorSubject(void 0));__publicField(this,"_memberData$",new BehaviorSubject(void 0));this._apiService=_apiService,this._tokenService=_tokenService,this._logger=loggerFactory2(this),this._tokenService.token.pipe(filter(token=>token!==void 0)).subscribe(token=>this.loadMember(token===null)),this._member$.pipe(switchMap(member=>member==null?of(member):forkJoin({webhooks:fromPromise(_apiService.getApi(MembersApi).getMemberGuildWebhooks({login:Number(member.userLogin)})),member:of(member),slots:fromPromise(_apiService.getApi(InventoryApi).getMemberSpriteSlotCount({login:Number(member.userLogin)})),spriteInventory:fromPromise(_apiService.getApi(InventoryApi).getMemberSpriteInventory({login:Number(member.userLogin)})),sceneInventory:fromPromise(_apiService.getApi(InventoryApi).getMemberSceneInventory({login:Number(member.userLogin)}))}))).subscribe(data=>{this._memberData$.next(data)})}async loadMember(reset=!1){if(reset)return this._member$.next(null),Promise.resolve(null);const promise=this._apiService.getApi(MembersApi).getAuthenticatedMember();return promise.then(member=>{this._member$.next(member)}).catch(()=>{this._member$.value!==null&&this._member$.next(null)}),promise}async refreshInventory(){await firstValueFrom(this.memberData$.pipe(take(1),switchMap(async data=>{if(data!=null){const spriteInv=await this._apiService.getApi(InventoryApi).getMemberSpriteInventory({login:Number(data.member.userLogin)}),sceneInv=await this._apiService.getApi(InventoryApi).getMemberSceneInventory({login:Number(data.member.userLogin)});data.spriteInventory=spriteInv,data.sceneInventory=sceneInv,this._memberData$.next(data)}})))}get member$(){return this._member$.asObservable()}get memberData$(){return this._memberData$.asObservable()}login(){window.location.href="https://www.typo.rip/auth?redirect="+encodeURI(window.location.href)}async logout(){await this._tokenService.removeToken()}async refreshMember(){return this.loadMember()}},__name(_a61,"MemberService"),_a61);MemberService=__decorateClass$10([injectable(),__decorateParam$f(0,inject(loggerFactory)),__decorateParam$f(1,inject(ApiService)),__decorateParam$f(2,inject(TokenService))],MemberService);const _SkribblOverlayPlayer=class _SkribblOverlayPlayer{constructor(_player,_lobbyKey,_overlayContainer){__publicField(this,"_avatarContainer");__publicField(this,"_placeholderBackgroundContainer");__publicField(this,"iconsContainer",null);this._player=_player,this._lobbyKey=_lobbyKey,this._overlayContainer=_overlayContainer,this._avatarContainer=requireElement(".avatar",this._overlayContainer),this._placeholderBackgroundContainer=createElement('<div style="display: none;"></div>'),this._overlayContainer.appendChild(this._placeholderBackgroundContainer)}get typoId(){return{lobbyKey:this._lobbyKey,lobbyPlayerId:this._player.id}}get avatarContainer(){return this._avatarContainer}get backgroundContainer(){return this._placeholderBackgroundContainer}get container(){return this._overlayContainer}set useBackground(value){}set useSafeColor(value){}set resizeToFitAvatar(value){}set viewPlayerId(value){}set hideAvatar(value){value&&elements(":is(.eyes, .mouth, .color)",this._avatarContainer).forEach(element2=>element2.remove())}};__name(_SkribblOverlayPlayer,"SkribblOverlayPlayer");let SkribblOverlayPlayer=_SkribblOverlayPlayer;const _SkribblPopupPlayer=class _SkribblPopupPlayer{constructor(_player,_playerPopup,_lobbyKey,_playerLogin){__publicField(this,"_avatarContainer");__publicField(this,"_placeholderBackgroundContainer");__publicField(this,"iconsContainer",null);if(this._player=_player,this._playerPopup=_playerPopup,this._lobbyKey=_lobbyKey,this._playerLogin=_playerLogin,_lobbyKey===void 0&&_playerLogin===void 0)throw new Error("No identification provided");this._avatarContainer=requireElement(".avatar",this._playerPopup),this._placeholderBackgroundContainer=createElement('<div style="display: none;"></div>'),this._playerPopup.appendChild(this._placeholderBackgroundContainer)}get typoId(){if(this._playerLogin!==void 0)return{login:this._playerLogin};if(this._lobbyKey!==void 0)return{lobbyKey:this._lobbyKey,lobbyPlayerId:this._player.id};throw new Error("No identification provided")}get avatarContainer(){return this._avatarContainer}get backgroundContainer(){return this._placeholderBackgroundContainer}get container(){return this._playerPopup}set useBackground(value){}set useSafeColor(value){}set resizeToFitAvatar(value){}set viewPlayerId(value){}set hideAvatar(value){value&&elements(":is(.eyes, .mouth, .color)",this._avatarContainer).forEach(element2=>element2.remove())}};__name(_SkribblPopupPlayer,"SkribblPopupPlayer");let SkribblPopupPlayer=_SkribblPopupPlayer;const _SkribblScoreboardPodiumPlayer=class _SkribblScoreboardPodiumPlayer{constructor(_player,_lobbyKey){__publicField(this,"_playerContainer");__publicField(this,"_avatarContainer");__publicField(this,"_placeholderBackgroundContainer");__publicField(this,"iconsContainer",null);this._player=_player,this._lobbyKey=_lobbyKey,this._playerContainer=requireElement(`.overlay-content .result.show .podests > div:has(.avatar[playerid='${this._player.id}'])`),this._avatarContainer=requireElement(".avatar",this._playerContainer),this._placeholderBackgroundContainer=createElement('<div style="display: none;"></div>'),this._playerContainer.appendChild(this._placeholderBackgroundContainer)}get typoId(){return{lobbyKey:this._lobbyKey,lobbyPlayerId:this._player.id}}get avatarContainer(){return this._avatarContainer}get backgroundContainer(){return this._placeholderBackgroundContainer}get container(){return this._playerContainer}set useBackground(value){}set useSafeColor(value){}set resizeToFitAvatar(value){}set viewPlayerId(value){}set hideAvatar(value){value&&elements(":is(.eyes, .mouth, .color)",this._avatarContainer).forEach(element2=>element2.remove())}};__name(_SkribblScoreboardPodiumPlayer,"SkribblScoreboardPodiumPlayer");let SkribblScoreboardPodiumPlayer=_SkribblScoreboardPodiumPlayer;const _SkribblScoreboardRegularPlayer=class _SkribblScoreboardRegularPlayer{constructor(_player,_lobbyKey){__publicField(this,"_playerContainer");__publicField(this,"_avatarContainer");__publicField(this,"_placeholderBackgroundContainer");__publicField(this,"iconsContainer",null);this._player=_player,this._lobbyKey=_lobbyKey,this._playerContainer=requireElement(`.overlay-content .result.show .ranks .rank[playerid='${this._player.id}']`),this._avatarContainer=requireElement(".avatar",this._playerContainer),this._placeholderBackgroundContainer=createElement('<div style="display: none;"></div>'),this._playerContainer.appendChild(this._placeholderBackgroundContainer)}get typoId(){return{lobbyKey:this._lobbyKey,lobbyPlayerId:this._player.id}}get avatarContainer(){return this._avatarContainer}get backgroundContainer(){return this._placeholderBackgroundContainer}get container(){return this._playerContainer}set useBackground(value){}set useSafeColor(value){}set resizeToFitAvatar(value){}set viewPlayerId(value){}set hideAvatar(value){value&&elements(":is(.eyes, .mouth, .color)",this._avatarContainer).forEach(element2=>element2.remove())}};__name(_SkribblScoreboardRegularPlayer,"SkribblScoreboardRegularPlayer");let SkribblScoreboardRegularPlayer=_SkribblScoreboardRegularPlayer;const calculateLobbyKey=__name(key=>{const sum=[...key].reduce((sum2,char)=>sum2+char.charCodeAt(0),0);return[...key].map(char=>String.fromCharCode(char.charCodeAt(0)+sum)).join("")},"calculateLobbyKey");var __defProp$$=Object.defineProperty,__getOwnPropDesc$h=Object.getOwnPropertyDescriptor,__decorateClass$$=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$h(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$$(target,key,result),result},"__decorateClass$$"),__decorateParam$e=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$e"),_a62;let PlayersService=(_a62=class{constructor(loggerFactory2){__publicField(this,"_elementsSetup");__publicField(this,"_lobbyJoinedEvent");__publicField(this,"_lobbyLeftEvent");__publicField(this,"_lobbyStateChangedEvent");__publicField(this,"_playerChangedEvent");__publicField(this,"_scoreboardVisibleEvent");__publicField(this,"_textOverlayVisibleEvent");__publicField(this,"_popupVisibleEvent");__publicField(this,"_lobbyInteractedEvent");__publicField(this,"_memberService");__publicField(this,"_lobbyService");__publicField(this,"_logger");__publicField(this,"_lobbyPlayers$",new BehaviorSubject([]));__publicField(this,"_landingPlayer$",new BehaviorSubject(void 0));__publicField(this,"_scoreboardPlayers$",new BehaviorSubject([]));__publicField(this,"_popupPlayer$",new BehaviorSubject(void 0));__publicField(this,"_overlayPlayer$",new BehaviorSubject(void 0));this._logger=loggerFactory2(this)}postConstruct(){this.setupLandingPlayer(),this.setupLobbyPlayers(),this.setupScoreboardPlayers(),this.setupPopupPlayer(),this.setupOverlayPlayer()}setupLandingPlayer(){this._memberService.member$.pipe(withLatestFrom(fromPromise(this._elementsSetup.complete())),map(([member,elements2])=>{if(member)return new SkribblLandingPlayer(Number(member.userLogin),elements2.landingCustomizeContainer,elements2.landingAvatarContainer)})).subscribe(player=>{this._landingPlayer$.next(player)})}setupLobbyPlayers(){this._lobbyJoinedEvent.events$.pipe(combineLatestWith(this._memberService.member$)).subscribe(([event,member])=>{const players=event.data.players.map(player=>{try{const key=event.data.id?calculateLobbyKey(event.data.id):void 0;return new SkribblLobbyPlayer(player,key,key===void 0&&member?Number(member.userLogin):void 0)}catch(e){return this._logger.error("Failed to create player",player,e),null}}).filter(player=>player!==null);this._lobbyPlayers$.next(players),this._logger.info("Lobby joined",players)}),this._playerChangedEvent.events$.pipe(withLatestFrom(this._lobbyJoinedEvent.events$.pipe(map(event=>event.data.id),mergeWith(this._lobbyLeftEvent.events$.pipe(map(()=>{}))))),combineLatestWith(this._memberService.member$)).subscribe(([[event,lobbyId],member])=>{if(lobbyId===void 0){this._lobbyPlayers$.next([]);return}if(lobbyId===null&&member===null||member===void 0){this._lobbyPlayers$.next([]);return}if(event.data.joined){const current=this._lobbyPlayers$.value;let newPlayer;try{const key=lobbyId?calculateLobbyKey(lobbyId):void 0;newPlayer=new SkribblLobbyPlayer(event.data.joined,key,key===void 0&&member?Number(member.userLogin):void 0)}catch(e){this._logger.error("Failed to create player",event.data.joined,e);return}current.push(newPlayer),this._lobbyPlayers$.next(current),this._logger.info("Player joined",newPlayer)}if(event.data.left){const id2=event.data.left.id,left=this._lobbyPlayers$.value.find(player=>player.lobbyPlayerId===id2),current=this._lobbyPlayers$.value.filter(player=>player!=left);this._lobbyPlayers$.next(current),this._logger.info("Player left",left)}}),this._lobbyLeftEvent.events$.subscribe(()=>{this._lobbyPlayers$.next([]),this._logger.info("Lobby left")})}setupScoreboardPlayers(){this._lobbyStateChangedEvent.events$.pipe(combineLatestWith(this._lobbyService.lobby$,this._scoreboardVisibleEvent.events$),filter(data=>data[2].data===!0),map(data=>data[1]===null||data[0].data.gameEnded===void 0?void 0:data),distinctUntilChanged()).subscribe(data=>{var _a81;const event=(_a81=data==null?void 0:data[0].data)==null?void 0:_a81.gameEnded,lobby=(data==null?void 0:data[1])??void 0,lobbyId=(lobby==null?void 0:lobby.id)??null;if(event===void 0||lobby===void 0||lobbyId===null){this._logger.info("Lobby changed, no scoreboard data"),this._scoreboardPlayers$.next([]);return}const players=event.ranking.map(player=>({player:lobby.players.find(p=>p.id===player.playerId),rank:player.rank})).filter(player=>player.player!==void 0).map(player=>player.rank<3?new SkribblScoreboardPodiumPlayer(player.player,calculateLobbyKey(lobbyId)):new SkribblScoreboardRegularPlayer(player.player,calculateLobbyKey(lobbyId)));this._logger.info("Scoreboard visible, scoreboard data",players),this._scoreboardPlayers$.next(players)})}setupPopupPlayer(){this._popupVisibleEvent.events$.pipe(withLatestFrom(this._memberService.member$,this._lobbyService.lobby$,this._elementsSetup.complete())).subscribe(([visible,member,lobby,elements2])=>{var _a81;if(!visible||lobby===null){this._logger.info("Popup player hidden"),this._popupPlayer$.next(void 0);return}const playerId=((_a81=element(".player",elements2.playerPopup))==null?void 0:_a81.getAttribute("playerid"))??void 0;if(playerId===void 0){this._logger.error("No player id in popup"),this._popupPlayer$.next(void 0);return}const player=lobby.players.find(p=>p.id===Number(playerId));if(player===void 0){this._logger.error("Player not found in lobby",playerId),this._popupPlayer$.next(void 0);return}const lobbyKey=lobby.id?calculateLobbyKey(lobby.id):void 0,playerDisplay=new SkribblPopupPlayer(player,elements2.playerPopup,lobbyKey,lobbyKey===void 0&&member?Number(member.userLogin):void 0);this._popupPlayer$.next(playerDisplay),this._logger.info("Popup player visible",playerDisplay)})}setupOverlayPlayer(){this._textOverlayVisibleEvent.events$.pipe(withLatestFrom(this._lobbyService.lobby$,this._elementsSetup.complete())).subscribe(([visible,lobby,elements2])=>{if(!visible||lobby===null||lobby.id===null){this._logger.info("Overlay player hidden"),this._overlayPlayer$.next(void 0);return}const playerId=elements2.textOverlay.getAttribute("playerid")??void 0;if(element(".avatar",elements2.textOverlay)===void 0||playerId===void 0){this._logger.info("No player or playerid in overlay, probably not a choosing info"),this._popupPlayer$.next(void 0);return}const player=lobby.players.find(p=>p.id===Number(playerId));if(player===void 0){this._logger.error("Player not found in lobby",playerId),this._popupPlayer$.next(void 0);return}const lobbyKey=calculateLobbyKey(lobby.id),playerDisplay=new SkribblOverlayPlayer(player,lobbyKey,elements2.textOverlay);this._popupPlayer$.next(playerDisplay),this._logger.info("Overlay player visible",playerDisplay)})}get lobbyPlayers$(){return this._lobbyPlayers$.asObservable()}get landingPlayer$(){return this._landingPlayer$.asObservable()}get scoreboardPlayers$(){return this._scoreboardPlayers$.asObservable()}get popupPlayer$(){return this._popupPlayer$.asObservable()}get overlayPlayer$(){return this._overlayPlayer$.asObservable()}get players$(){return this._lobbyPlayers$.pipe(startWith([]),combineLatestWith(this.landingPlayer$,this.scoreboardPlayers$,this.popupPlayer$,this.overlayPlayer$),map(([players,landing,scoreboard,popup,overlay])=>[...players,landing,...scoreboard,popup,overlay].filter(player=>player!==void 0)))}},__name(_a62,"PlayersService"),_a62);__decorateClass$$([inject(ElementsSetup)],PlayersService.prototype,"_elementsSetup",2);__decorateClass$$([inject(LobbyJoinedEventListener)],PlayersService.prototype,"_lobbyJoinedEvent",2);__decorateClass$$([inject(LobbyLeftEventListener)],PlayersService.prototype,"_lobbyLeftEvent",2);__decorateClass$$([inject(LobbyStateChangedEventListener)],PlayersService.prototype,"_lobbyStateChangedEvent",2);__decorateClass$$([inject(LobbyPlayerChangedEventListener)],PlayersService.prototype,"_playerChangedEvent",2);__decorateClass$$([inject(ScoreboardVisibilityChangedEventListener)],PlayersService.prototype,"_scoreboardVisibleEvent",2);__decorateClass$$([inject(TextOverlayVisibilityChangedEventListener)],PlayersService.prototype,"_textOverlayVisibleEvent",2);__decorateClass$$([inject(PlayerPopupVisibilityChangedEventListener)],PlayersService.prototype,"_popupVisibleEvent",2);__decorateClass$$([inject(LobbyInteractedEventListener)],PlayersService.prototype,"_lobbyInteractedEvent",2);__decorateClass$$([inject(MemberService)],PlayersService.prototype,"_memberService",2);__decorateClass$$([inject(LobbyService)],PlayersService.prototype,"_lobbyService",2);__decorateClass$$([postConstruct()],PlayersService.prototype,"postConstruct",1);PlayersService=__decorateClass$$([injectable(),__decorateParam$e(0,inject(loggerFactory))],PlayersService);function create_fragment$Z(ctx){let p,b,t0,b_class_value,t1,span,t2;return{c(){p=element$1("p"),b=element$1("b"),t0=text(ctx[1]),t1=space(),span=element$1("span"),t2=text(ctx[0]),attr(b,"class",b_class_value=null_to_empty(ctx[2])+" svelte-18gwyvz"),attr(span,"class","svelte-18gwyvz"),attr(p,"class","typo-chat-message svelte-18gwyvz")},m(target,anchor){insert(target,p,anchor),append(p,b),append(b,t0),append(p,t1),append(p,span),append(span,t2)},p(ctx2,[dirty]){dirty&2&&set_data(t0,ctx2[1]),dirty&4&&b_class_value!==(b_class_value=null_to_empty(ctx2[2])+" svelte-18gwyvz")&&attr(b,"class",b_class_value),dirty&1&&set_data(t2,ctx2[0])},i:noop$1,o:noop$1,d(detaching){detaching&&detach(p)}}}__name(create_fragment$Z,"create_fragment$Z");function instance$T($$self,$$props,$$invalidate){let{content=""}=$$props,{title=""}=$$props,{style="normal"}=$$props;return $$self.$$set=$$props2=>{"content"in $$props2&&$$invalidate(0,content=$$props2.content),"title"in $$props2&&$$invalidate(1,title=$$props2.title),"style"in $$props2&&$$invalidate(2,style=$$props2.style)},[content,title,style]}__name(instance$T,"instance$T");const _Message=class _Message extends SvelteComponent{constructor(options){super(),init(this,options,instance$T,create_fragment$Z,safe_not_equal,{content:0,title:1,style:2})}};__name(_Message,"Message");let Message=_Message;var __defProp$_=Object.defineProperty,__getOwnPropDesc$g=Object.getOwnPropertyDescriptor,__decorateClass$_=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$g(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$_(target,key,result),result},"__decorateClass$_"),__decorateParam$d=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$d"),_a63;let ChatService=(_a63=class{constructor(loggerFactory2){__publicField(this,"_elementsSetup");__publicField(this,"_lobbyPlayersService");__publicField(this,"_messageReceivedEventListener");__publicField(this,"_logger");__publicField(this,"_elementDiscovered$",new Subject$1);__publicField(this,"_messageDiscovered$",new Subject$1);__publicField(this,"_messageReceived$",new Subject$1);this._logger=loggerFactory2(this)}postConstruct(){this._logger.debug("Initializing chat service"),this.setupMessageObserver()}async setupMessageObserver(){const elements2=await this._elementsSetup.complete();new MutationObserver(mutations=>{mutations.forEach(mutation=>{if(mutation.addedNodes.length>0){const addedNode=mutation.addedNodes[0];if(addedNode.tagName!=="P"||addedNode.children.length!=2)return;const title=addedNode.children[0],content=addedNode.children[1];if(title.tagName!=="B"||content.tagName!=="SPAN")return;this._elementDiscovered$.next({title:title.textContent??"",content:content.textContent??"",element:addedNode,titleElement:addedNode.children[0],contentElement:addedNode.children[1]})}})}).observe(elements2.chatContent,{childList:!0,subtree:!1}),this._messageReceivedEventListener.events$.pipe(withLatestFrom(this._lobbyPlayersService.lobbyPlayers$),map(([event,players])=>{const player=players.find(p=>p.lobbyPlayerId===event.data.senderId);if(!player){this._logger.warn("Player not found for message",event.data);return}return{player,content:event.data.message}}),filter(data=>data!==void 0)).subscribe(data=>this._messageDiscovered$.next(data));const pendingMessages=[],pendingElements=[];this._messageDiscovered$.pipe(map(data=>pendingMessages.push(data)),mergeWith(this._elementDiscovered$.pipe(filter(element2=>element2.content.length!==0),map(data=>pendingElements.push(data))))).subscribe(()=>{const matches=this.findMessageMatches(pendingMessages,pendingElements);for(const match of matches)this._messageReceived$.next(match),this._logger.debug("Message match found",match)})}findMessageMatches(messages,elements2){const matches=[];for(const message of messages)for(const element2 of elements2)if(`${message.player.name}: `===element2.title&&message.content===element2.content){matches.push({...message,...element2}),messages.splice(messages.indexOf(message),1),elements2.splice(elements2.indexOf(element2),1);break}return matches}get messageReceived$(){return this._messageReceived$.asObservable()}async addChatMessage(content,title,style="normal"){const container=(await this._elementsSetup.complete()).chatContent,isScrolledDown=container.scrollHeight-container.scrollTop-container.clientHeight<50,message=new Message({target:container,props:{title:title??"",content,style}});return isScrolledDown&&container.scrollTo({top:container.scrollHeight,behavior:"instant"}),message}},__name(_a63,"ChatService"),_a63);__decorateClass$_([inject(ElementsSetup)],ChatService.prototype,"_elementsSetup",2);__decorateClass$_([inject(PlayersService)],ChatService.prototype,"_lobbyPlayersService",2);__decorateClass$_([inject(MessageReceivedEventListener)],ChatService.prototype,"_messageReceivedEventListener",2);__decorateClass$_([postConstruct()],ChatService.prototype,"postConstruct",1);ChatService=__decorateClass$_([injectable(),__decorateParam$d(0,inject(loggerFactory))],ChatService);function promiseAllObject(obj){return Promise.all(Object.entries(obj).map(async([k,v])=>[k,await v])).then(Object.fromEntries)}__name(promiseAllObject,"promiseAllObject");var __defProp$Z=Object.defineProperty,__decorateClass$Z=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$Z(target,key,result),result},"__decorateClass$Z");function getData(spritesApi,scenesApi,eventsApi,emojisApi,announcementsApi,themesApi,awardsApi){return{sprites:spritesApi.getAllSprites(),scenes:scenesApi.getAllScenes(),emojis:emojisApi.getAllEmojisCached({limit:1e5,animated:!0,statics:!0}),announcements:announcementsApi.getAnnouncements(),themes:themesApi.getAllThemes(),drops:eventsApi.getAllEventDrops(),awards:awardsApi.getAllAwards()}}__name(getData,"getData");const _ApiDataSetup=class _ApiDataSetup extends Setup{constructor(){super(...arguments);__publicField(this,"_apiService");__publicField(this,"_toastService");__publicField(this,"_loggerFactory")}async runSetup(){const logger=this._loggerFactory(this),promise=promiseAllObject(getData(this._apiService.getApi(SpritesApi),this._apiService.getApi(ScenesApi),this._apiService.getApi(EventsApi),this._apiService.getApi(EmojisApi),this._apiService.getApi(AnnouncementsApi),this._apiService.getApi(ThemesApi),this._apiService.getApi(AwardsApi)));return promise.catch(e=>{this._toastService.showToast("Fatal error",`Failed to fetch data from the typo servers. 
Please ask for support on the typo discord server.`),logger.error("Failed to fetch data from the typo servers",e)}),promise}};__name(_ApiDataSetup,"ApiDataSetup");let ApiDataSetup=_ApiDataSetup;__decorateClass$Z([inject(ApiService)],ApiDataSetup.prototype,"_apiService");__decorateClass$Z([inject(ToastService)],ApiDataSetup.prototype,"_toastService");__decorateClass$Z([inject(loggerFactory)],ApiDataSetup.prototype,"_loggerFactory");function create_fragment$Y(ctx){let div;return{c(){div=element$1("div"),attr(div,"class","typo-emojis-enabled")},m(target,anchor){insert(target,div,anchor)},p:noop$1,i:noop$1,o:noop$1,d(detaching){detaching&&detach(div)}}}__name(create_fragment$Y,"create_fragment$Y");function instance$S($$self){return[]}__name(instance$S,"instance$S");const _Chat_emojis=class _Chat_emojis extends SvelteComponent{constructor(options){super(),init(this,options,instance$S,create_fragment$Y,safe_not_equal,{})}};__name(_Chat_emojis,"Chat_emojis");let Chat_emojis=_Chat_emojis;function get_each_context$t(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[8]=list[i],child_ctx}__name(get_each_context$t,"get_each_context$t");function create_else_block$d(ctx){let t;return{c(){t=text("Hover emojis & click to pick")},m(target,anchor){insert(target,t,anchor)},p:noop$1,d(detaching){detaching&&detach(t)}}}__name(create_else_block$d,"create_else_block$d");function create_if_block_1$f(ctx){let t0,t1_value=ctx[1].name+"",t1,t2;return{c(){t0=text(":"),t1=text(t1_value),t2=text(":")},m(target,anchor){insert(target,t0,anchor),insert(target,t1,anchor),insert(target,t2,anchor)},p(ctx2,dirty){dirty&2&&t1_value!==(t1_value=ctx2[1].name+"")&&set_data(t1,t1_value)},d(detaching){detaching&&(detach(t0),detach(t1),detach(t2))}}}__name(create_if_block_1$f,"create_if_block_1$f");function create_if_block$v(ctx){let t0,br,t1;return{c(){t0=text("No matching emojis."),br=element$1("br"),t1=text("Type something else to search again!")},m(target,anchor){insert(target,t0,anchor),insert(target,br,anchor),insert(target,t1,anchor)},p:noop$1,d(detaching){detaching&&(detach(t0),detach(br),detach(t1))}}}__name(create_if_block$v,"create_if_block$v");function create_each_block$t(ctx){let img,img_src_value,img_alt_value,mounted,dispose;function mouseenter_handler(){return ctx[5](ctx[8])}__name(mouseenter_handler,"mouseenter_handler");function click_handler2(){return ctx[6](ctx[8])}return __name(click_handler2,"click_handler"),{c(){img=element$1("img"),attr(img,"class","emoji-picker-candidate svelte-198xt5o"),src_url_equal(img.src,img_src_value=ctx[8].url)||attr(img,"src",img_src_value),attr(img,"alt",img_alt_value=ctx[8].name)},m(target,anchor){insert(target,img,anchor),mounted||(dispose=[listen(img,"mouseenter",mouseenter_handler),listen(img,"click",click_handler2)],mounted=!0)},p(new_ctx,dirty){ctx=new_ctx,dirty&4&&!src_url_equal(img.src,img_src_value=ctx[8].url)&&attr(img,"src",img_src_value),dirty&4&&img_alt_value!==(img_alt_value=ctx[8].name)&&attr(img,"alt",img_alt_value)},d(detaching){detaching&&detach(img),mounted=!1,run_all(dispose)}}}__name(create_each_block$t,"create_each_block$t");function create_fragment$X(ctx){let div0,t,div1,mounted,dispose;function select_block_type(ctx2,dirty){return ctx2[2].length===0?create_if_block$v:ctx2[1]!==void 0?create_if_block_1$f:create_else_block$d}__name(select_block_type,"select_block_type");let current_block_type=select_block_type(ctx),if_block=current_block_type(ctx),each_value=ensure_array_like(ctx[2]),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$t(get_each_context$t(ctx,each_value,i));return{c(){div0=element$1("div"),if_block.c(),t=space(),div1=element$1("div");for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();attr(div0,"class","typo-emoji-picker-hint svelte-198xt5o"),attr(div1,"class","typo-command-preview svelte-198xt5o")},m(target,anchor){insert(target,div0,anchor),if_block.m(div0,null),insert(target,t,anchor),insert(target,div1,anchor);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div1,null);mounted||(dispose=listen(div1,"mouseleave",ctx[7]),mounted=!0)},p(ctx2,[dirty]){if(current_block_type===(current_block_type=select_block_type(ctx2))&&if_block?if_block.p(ctx2,dirty):(if_block.d(1),if_block=current_block_type(ctx2),if_block&&(if_block.c(),if_block.m(div0,null))),dirty&7){each_value=ensure_array_like(ctx2[2]);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$t(ctx2,each_value,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block$t(child_ctx),each_blocks[i].c(),each_blocks[i].m(div1,null))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value.length}},i:noop$1,o:noop$1,d(detaching){detaching&&(detach(div0),detach(t),detach(div1)),if_block.d(),destroy_each(each_blocks,detaching),mounted=!1,dispose()}}}__name(create_fragment$X,"create_fragment$X");function instance$R($$self,$$props,$$invalidate){let $emojiCandidates,{feature}=$$props,{onSelected=void 0}=$$props,hoverEmoji;const emojiCandidates=feature.emojiCandidatesStore;component_subscribe($$self,emojiCandidates,value=>$$invalidate(2,$emojiCandidates=value));const mouseenter_handler=__name(emoji=>$$invalidate(1,hoverEmoji=emoji),"mouseenter_handler"),click_handler2=__name(emoji=>onSelected==null?void 0:onSelected(emoji),"click_handler"),mouseleave_handler=__name(()=>$$invalidate(1,hoverEmoji=void 0),"mouseleave_handler");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(4,feature=$$props2.feature),"onSelected"in $$props2&&$$invalidate(0,onSelected=$$props2.onSelected)},[onSelected,hoverEmoji,$emojiCandidates,emojiCandidates,feature,mouseenter_handler,click_handler2,mouseleave_handler]}__name(instance$R,"instance$R");const _Emoji_picker=class _Emoji_picker extends SvelteComponent{constructor(options){super(),init(this,options,instance$R,create_fragment$X,safe_not_equal,{feature:4,onSelected:0})}};__name(_Emoji_picker,"Emoji_picker");let Emoji_picker=_Emoji_picker;var __defProp$Y=Object.defineProperty,__decorateClass$Y=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$Y(target,key,result),result},"__decorateClass$Y");const _ChatEmojisFeature=class _ChatEmojisFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elements");__publicField(this,"_apiDataSetup");__publicField(this,"_chatService");__publicField(this,"name","Chat Emojis");__publicField(this,"description","Adds support for emojis using ':emoji-name:' format in the chat.");__publicField(this,"featureId",22);__publicField(this,"_inputListener",this.handleInputEvent.bind(this));__publicField(this,"_subscription");__publicField(this,"_component");__publicField(this,"_flyoutComponent");__publicField(this,"_flyoutSubscription");__publicField(this,"_emojiCandidates$",new BehaviorSubject([]))}async onActivate(){const elements2=await this._elements.complete();elements2.chatInput.addEventListener("keyup",this._inputListener);const emojis=(await this._apiDataSetup.complete()).emojis;this._subscription=this._chatService.messageReceived$.subscribe(({contentElement})=>{this.processAddedMessage(contentElement,emojis)}),this._component=new Chat_emojis({target:elements2.chatArea})}async onDestroy(){var _a81,_b,_c,_d;(await this._elements.complete()).chatInput.removeEventListener("keyup",this._inputListener),(_a81=this._subscription)==null||_a81.unsubscribe(),(_b=this._component)==null||_b.$destroy(),this._component=void 0,this._subscription=void 0,(_c=this._flyoutSubscription)==null||_c.unsubscribe(),(_d=this._flyoutComponent)==null||_d.$destroy(),this._flyoutComponent=void 0,this._flyoutSubscription=void 0}async handleInputEvent(){const emojis=(await this._apiDataSetup.complete()).emojis,elements2=await this._elements.complete();this._logger.debug("Finding emoji candidates for: ",elements2.chatInput.value);const emojiHead=this.parseUnfinishedEmoji(elements2.chatInput.value),emojiCandidates=emojiHead!==void 0?emojis.filter(e=>e.name.includes(emojiHead)):[];if(this._emojiCandidates$.next(emojiCandidates),emojiHead!==void 0&&this._flyoutComponent===void 0){const flyoutContent={componentType:Emoji_picker,props:{feature:this,onSelected:__name(emoji=>{var _a81;const text2=elements2.chatInput.value;elements2.chatInput.value=text2.slice(0,text2.lastIndexOf(":"))+`:${this.getEmojiId(emoji)}:`,(_a81=this._flyoutComponent)==null||_a81.close(),elements2.chatInput.focus()},"onSelected")}};this._flyoutComponent=new Area_flyout({target:elements2.gameWrapper,props:{componentData:flyoutContent,areaName:"chat",maxHeight:"600px",maxWidth:"300px",marginY:"2.5rem",title:"Emoji Picker",closeStrategy:"explicit"}}),this._flyoutSubscription=this._flyoutComponent.closed$.subscribe(()=>{var _a81,_b;this._logger.info("Destroyed flyout"),(_a81=this._flyoutComponent)==null||_a81.$destroy(),(_b=this._flyoutSubscription)==null||_b.unsubscribe(),this._flyoutComponent=void 0})}else this._flyoutComponent!==void 0&&emojiHead===void 0&&this._flyoutComponent.close()}processAddedMessage(message,emojis){Array.from(message.childNodes).filter(node=>node.nodeType===Node.TEXT_NODE).forEach(node=>{const parsedEmojis=this.parseTextWithEmojis(node.textContent??"");if(parsedEmojis.filter(e=>e.emoji!==void 0).length===0)return;const newTextNode=document.createElement("span");newTextNode.classList.add("typo-emoji-container"),parsedEmojis.forEach(({emoji,plain})=>{if(plain&&newTextNode.appendChild(document.createTextNode(plain)),emoji){const emojiDto=emojis.find(e=>`:${this.getEmojiId(e)}:`===emoji);if(emojiDto){const emojiElement=document.createElement("span");emojiElement.textContent=emoji,emojiElement.style.setProperty("--typo-emoji-url",`url(${emojiDto.url})`),emojiElement.style.setProperty("--typo-emoji-name",emojiDto.name),emojiElement.classList.add("typo-emoji"),newTextNode.appendChild(emojiElement)}else newTextNode.appendChild(document.createTextNode(emoji))}}),node.replaceWith(newTextNode)})}parseTextWithEmojis(text2){const emojiPattern=/:([a-zA-Z0-9_-]+):/g,result=[];let lastIndex=0,match;for(;(match=emojiPattern.exec(text2))!==null;)match.index>lastIndex&&result.push({plain:text2.slice(lastIndex,match.index)}),result.push({emoji:match[0]}),lastIndex=match.index+match[0].length;return lastIndex<text2.length&&result.push({plain:text2.slice(lastIndex)}),result}parseUnfinishedEmoji(text2){const parsedEmojiPattern=/:([a-zA-Z0-9_-]+):/g;text2=text2.replace(parsedEmojiPattern,"");const match=/:([a-zA-Z0-9_-]*)$/.exec(text2);return match==null?void 0:match[1]}getEmojiId(emoji){return emoji.nameId>0?`${emoji.name}-${emoji.nameId}`:emoji.name}get emojiCandidatesStore(){return fromObservable(this._emojiCandidates$,this._emojiCandidates$.value)}};__name(_ChatEmojisFeature,"ChatEmojisFeature");let ChatEmojisFeature=_ChatEmojisFeature;__decorateClass$Y([inject(ElementsSetup)],ChatEmojisFeature.prototype,"_elements");__decorateClass$Y([inject(ApiDataSetup)],ChatEmojisFeature.prototype,"_apiDataSetup");__decorateClass$Y([inject(ChatService)],ChatEmojisFeature.prototype,"_chatService");function create_fragment$W(ctx){let t0,br0,t1,br1;return{c(){t0=text("Add a hotkey to quickly focus the chat input, so you can start guessing right away. "),br0=element$1("br"),t1=text(`
If the auto-focus setting is enabled, the chat input will be focused automatically when someone else starts drawing. `),br1=element$1("br")},m(target,anchor){insert(target,t0,anchor),insert(target,br0,anchor),insert(target,t1,anchor),insert(target,br1,anchor)},p:noop$1,i:noop$1,o:noop$1,d(detaching){detaching&&(detach(t0),detach(br0),detach(t1),detach(br1))}}}__name(create_fragment$W,"create_fragment$W");const _Chat_focus_info=class _Chat_focus_info extends SvelteComponent{constructor(options){super(),init(this,options,null,create_fragment$W,safe_not_equal,{})}};__name(_Chat_focus_info,"Chat_focus_info");let Chat_focus_info=_Chat_focus_info;var __defProp$X=Object.defineProperty,__decorateClass$X=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$X(target,key,result),result},"__decorateClass$X");const _ChatFocusFeature=class _ChatFocusFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"elementsSetup");__publicField(this,"_lobbyStateChangedEventListener");__publicField(this,"name","Chat Focus");__publicField(this,"description","Quickly focus the chat input with a hotkey or when someone starts drawing");__publicField(this,"featureId",28);__publicField(this,"_chatFocusHotkey",this.useHotkey(new HotkeyAction("chat_focus","Chat Focus","Focus the chat input",this,async()=>(await this.elementsSetup.complete()).chatInput.focus(),!0,["Tab"],void 0,!1)));__publicField(this,"_autoFocusChatInputSetting",this.useSetting(new BooleanExtensionSetting("auto_focus_chat_input",!0,this).withName("Auto Focus Chat Input").withDescription("Automatically focus the chat input when someone else starts drawing")));__publicField(this,"_autoFocusSubscription")}get featureInfoComponent(){return{componentType:Chat_focus_info,props:{}}}async onActivate(){this._autoFocusSubscription=this._lobbyStateChangedEventListener.events$.pipe(filter(event=>event.data.drawingStarted!==void 0&&event.data.drawingStarted.word===void 0),withLatestFrom(this._autoFocusChatInputSetting.changes$,this.elementsSetup.complete()),filter(([,enabled])=>enabled)).subscribe(([,,elements2])=>elements2.chatInput.focus())}async onDestroy(){var _a81;(_a81=this._autoFocusSubscription)==null||_a81.unsubscribe(),this._autoFocusSubscription=void 0}get chatAutoFocusStore(){return this._autoFocusChatInputSetting.store}};__name(_ChatFocusFeature,"ChatFocusFeature");let ChatFocusFeature=_ChatFocusFeature;__decorateClass$X([inject(ElementsSetup)],ChatFocusFeature.prototype,"elementsSetup");__decorateClass$X([inject(LobbyStateChangedEventListener)],ChatFocusFeature.prototype,"_lobbyStateChangedEventListener");const _Chat_profile_link=class _Chat_profile_link extends SvelteComponent{constructor(options){super(),init(this,options,null,null,safe_not_equal,{})}};__name(_Chat_profile_link,"Chat_profile_link");let Chat_profile_link=_Chat_profile_link;var __defProp$W=Object.defineProperty,__decorateClass$W=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$W(target,key,result),result},"__decorateClass$W");const _ChatProfileLinkFeature=class _ChatProfileLinkFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_chatService");__publicField(this,"_toastService");__publicField(this,"_elementsSetup");__publicField(this,"name","Chat Profile Link");__publicField(this,"description","Open player profiles by clicking their name in the chat.");__publicField(this,"featureId",23);__publicField(this,"_subscription");__publicField(this,"_addedElements",[]);__publicField(this,"_component");__publicField(this,"_clickHandler",this.chatClicked.bind(this))}async onActivate(){const elements2=await this._elementsSetup.complete();this._component=new Chat_profile_link({target:elements2.chatContent}),this._subscription=this._chatService.messageReceived$.subscribe(({titleElement,player})=>{titleElement.classList.add("typo-chat-profile-link"),this._addedElements.push({titleElement,player})}),elements2.chatContent.addEventListener("click",this._clickHandler)}async onDestroy(){var _a81,_b;(await this._elementsSetup.complete()).chatContent.removeEventListener("click",this._clickHandler),(_a81=this._subscription)==null||_a81.unsubscribe(),this._addedElements.forEach(({titleElement})=>titleElement.classList.remove("typo-chat-profile-link")),this._addedElements=[],(_b=this._component)==null||_b.$destroy()}async chatClicked(event){if(event.target instanceof HTMLElement&&event.target.classList.contains("typo-chat-profile-link")){const element2=this._addedElements.find(e=>e.titleElement===event.target);element2?element2.player.container.click():await this._toastService.showToast("Player Profile not found")}}};__name(_ChatProfileLinkFeature,"ChatProfileLinkFeature");let ChatProfileLinkFeature=_ChatProfileLinkFeature;__decorateClass$W([inject(ChatService)],ChatProfileLinkFeature.prototype,"_chatService");__decorateClass$W([inject(ToastService)],ChatProfileLinkFeature.prototype,"_toastService");__decorateClass$W([inject(ElementsSetup)],ChatProfileLinkFeature.prototype,"_elementsSetup");const _NumericOptionalCommandParameter=class _NumericOptionalCommandParameter extends ExtensionCommandParameter{constructor(name,description,_mapping){super(name,description);__publicField(this,"typeName","number?");this._mapping=_mapping}readArg(args,dontMarkAsInterpreting){const split=args.trim().split(" "),arg=split[0].trim();if(arg.length<1)return dontMarkAsInterpreting(),{remainder:"",argument:this._mapping(void 0)};const number=Number(arg);if(isNaN(number))throw new InterpretableArgumentParsingError(this,"Failed to parse number from args: "+args);const argument=this._mapping(number);return{remainder:split.slice(1).join(" "),argument}}};__name(_NumericOptionalCommandParameter,"NumericOptionalCommandParameter");let NumericOptionalCommandParameter=_NumericOptionalCommandParameter;var __defProp$V=Object.defineProperty,__getOwnPropDesc$f=Object.getOwnPropertyDescriptor,__decorateClass$V=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$f(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$V(target,key,result),result},"__decorateClass$V"),__decorateParam$c=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$c"),_a64;let LobbyInteractionsService=(_a64=class{constructor(loggerFactory2){__publicField(this,"_lobbyService");__publicField(this,"_lobbyInteractedEvent");__publicField(this,"_lobbyStateChangedEvent");__publicField(this,"_skribblMessageRelaySetup");__publicField(this,"_availableInteractions$",new BehaviorSubject(void 0));__publicField(this,"_logger");this._logger=loggerFactory2(this)}postConstruct(){this._logger.debug("Initializing lobby interactions service"),this.setupAvailableInteractions()}setupAvailableInteractions(){this._lobbyService.lobby$.pipe(distinctUntilChanged(),pairwise(),map(([last2,current])=>{if(!(last2===null&&current===null||last2!==null&&current===null))return last2===null&&current!==null?{rateAvailable:!0,votekickAvailable:!0,interactionTarget:current.players.find(p=>p.id===current.drawerId&&p.id!==current.meId)}:null})).subscribe(update=>{update!==null&&(this._logger.info("Interactions reset on lobby join",update),this._availableInteractions$.next(update))}),this._lobbyStateChangedEvent.events$.pipe(map(evt=>evt.data.drawingStarted),filter(started=>started!==void 0),withLatestFrom(this._availableInteractions$,this._lobbyService.lobby$),filter(([,state,lobby])=>state!==void 0&&lobby!==null)).subscribe(([drawer,state,lobby])=>{lobby===null||state===void 0||(state.rateAvailable=!0,state.votekickAvailable=!0,state.interactionTarget=lobby.players.find(p=>p.id===drawer.drawerId&&p.id!==lobby.meId),this._logger.info("Interactions update on lobby change",state),this._availableInteractions$.next(state))}),this._lobbyInteractedEvent.events$.pipe(withLatestFrom(this._availableInteractions$,this._lobbyService.lobby$),filter(([,state,lobby])=>state!==void 0&&lobby!==null)).subscribe(([event,state,lobby])=>{if(lobby===null||state===void 0)return;const{likeInteraction,dislikeInteraction,votekickInteraction}=event.data;((likeInteraction==null?void 0:likeInteraction.sourcePlayerId)===lobby.meId||lobby.drawerId===null)&&(state.rateAvailable=!1),((dislikeInteraction==null?void 0:dislikeInteraction.sourcePlayerId)===lobby.meId||lobby.drawerId===null)&&(state.rateAvailable=!1),(votekickInteraction==null?void 0:votekickInteraction.sourcePlayerId)===lobby.meId&&(state.votekickAvailable=!1),this._logger.info("Interactions update on interaction",state),this._availableInteractions$.next(state)}),this._availableInteractions$.subscribe(state=>this._logger.info("Available interactions",state))}get availableInteractions$(){return this._availableInteractions$.asObservable()}async likePlayer(){(await this._skribblMessageRelaySetup.complete()).insertMessage({data:1,id:8})}async dislikePlayer(){(await this._skribblMessageRelaySetup.complete()).insertMessage({data:0,id:8})}async votekickPlayer(id2){(await this._skribblMessageRelaySetup.complete()).insertMessage({data:id2,id:5})}},__name(_a64,"LobbyInteractionsService"),_a64);__decorateClass$V([inject(LobbyService)],LobbyInteractionsService.prototype,"_lobbyService",2);__decorateClass$V([inject(LobbyInteractedEventListener)],LobbyInteractionsService.prototype,"_lobbyInteractedEvent",2);__decorateClass$V([inject(LobbyStateChangedEventListener)],LobbyInteractionsService.prototype,"_lobbyStateChangedEvent",2);__decorateClass$V([inject(SkribblMessageRelaySetup)],LobbyInteractionsService.prototype,"_skribblMessageRelaySetup",2);__decorateClass$V([postConstruct()],LobbyInteractionsService.prototype,"postConstruct",1);LobbyInteractionsService=__decorateClass$V([injectable(),__decorateParam$c(0,inject(loggerFactory))],LobbyInteractionsService);function create_fragment$V(ctx){let button,span,t,button_class_value,mounted,dispose;return{c(){button=element$1("button"),span=element$1("span"),t=text(ctx[0]),attr(span,"class","svelte-1nuwppq"),attr(button,"class",button_class_value="typo-flat-button flatUI "+ctx[1]+" svelte-1nuwppq"),toggle_class(button,"disabled",ctx[2])},m(target,anchor){insert(target,button,anchor),append(button,span),append(span,t),mounted||(dispose=[listen(button,"click",ctx[6]),listen(button,"click",ctx[5])],mounted=!0)},p(ctx2,[dirty]){dirty&1&&set_data(t,ctx2[0]),dirty&2&&button_class_value!==(button_class_value="typo-flat-button flatUI "+ctx2[1]+" svelte-1nuwppq")&&attr(button,"class",button_class_value),dirty&6&&toggle_class(button,"disabled",ctx2[2])},i:noop$1,o:noop$1,d(detaching){detaching&&detach(button),mounted=!1,run_all(dispose)}}}__name(create_fragment$V,"create_fragment$V");function instance$Q($$self,$$props,$$invalidate){let{content}=$$props,{color}=$$props,{disabled=!1}=$$props;const click=new Subject$1,click$=click.asObservable();function click_handler2(event){bubble.call(this,$$self,event)}__name(click_handler2,"click_handler");const click_handler_1=__name(()=>click.next(void 0),"click_handler_1");return $$self.$$set=$$props2=>{"content"in $$props2&&$$invalidate(0,content=$$props2.content),"color"in $$props2&&$$invalidate(1,color=$$props2.color),"disabled"in $$props2&&$$invalidate(2,disabled=$$props2.disabled)},[content,color,disabled,click,click$,click_handler2,click_handler_1]}__name(instance$Q,"instance$Q");const _Flat_button=class _Flat_button extends SvelteComponent{constructor(options){super(),init(this,options,instance$Q,create_fragment$V,safe_not_equal,{content:0,color:1,disabled:2,click$:4})}get click$(){return this.$$.ctx[4]}};__name(_Flat_button,"Flat_button");let Flat_button=_Flat_button;function create_else_block$c(ctx){let div;return{c(){div=element$1("div"),div.innerHTML='<b class="svelte-yvtrmi">No interactions available</b>',attr(div,"class","typo-quickreact-keys svelte-yvtrmi")},m(target,anchor){insert(target,div,anchor)},p:noop$1,i:noop$1,o:noop$1,d(detaching){detaching&&detach(div)}}}__name(create_else_block$c,"create_else_block$c");function create_if_block$u(ctx){let div,b,t0,t1_value=ctx[2].interactionTarget.name+"",t1,t2,flatbutton0,t3,flatbutton1,t4,flatbutton2,t5,flatbutton3,current;return flatbutton0=new Flat_button({props:{content:"⬅️ Kick",disabled:!ctx[2].votekickAvailable,color:"blue"}}),flatbutton0.$on("click",ctx[5]),flatbutton1=new Flat_button({props:{content:"➡️ Close",color:"blue"}}),flatbutton2=new Flat_button({props:{content:"⬆️ Like",disabled:!ctx[2].rateAvailable,color:"blue"}}),flatbutton2.$on("click",ctx[6]),flatbutton3=new Flat_button({props:{content:"⬇️ Dislike",disabled:!ctx[2].rateAvailable,color:"blue"}}),flatbutton3.$on("click",ctx[7]),{c(){div=element$1("div"),b=element$1("b"),t0=text("Press an arrow key to react to "),t1=text(t1_value),t2=space(),create_component(flatbutton0.$$.fragment),t3=space(),create_component(flatbutton1.$$.fragment),t4=space(),create_component(flatbutton2.$$.fragment),t5=space(),create_component(flatbutton3.$$.fragment),attr(b,"class","svelte-yvtrmi"),attr(div,"class","typo-quickreact-keys svelte-yvtrmi")},m(target,anchor){insert(target,div,anchor),append(div,b),append(b,t0),append(b,t1),append(div,t2),mount_component(flatbutton0,div,null),append(div,t3),mount_component(flatbutton1,div,null),append(div,t4),mount_component(flatbutton2,div,null),append(div,t5),mount_component(flatbutton3,div,null),current=!0},p(ctx2,dirty){(!current||dirty&4)&&t1_value!==(t1_value=ctx2[2].interactionTarget.name+"")&&set_data(t1,t1_value);const flatbutton0_changes={};dirty&4&&(flatbutton0_changes.disabled=!ctx2[2].votekickAvailable),flatbutton0.$set(flatbutton0_changes);const flatbutton2_changes={};dirty&4&&(flatbutton2_changes.disabled=!ctx2[2].rateAvailable),flatbutton2.$set(flatbutton2_changes);const flatbutton3_changes={};dirty&4&&(flatbutton3_changes.disabled=!ctx2[2].rateAvailable),flatbutton3.$set(flatbutton3_changes)},i(local){current||(transition_in(flatbutton0.$$.fragment,local),transition_in(flatbutton1.$$.fragment,local),transition_in(flatbutton2.$$.fragment,local),transition_in(flatbutton3.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton0.$$.fragment,local),transition_out(flatbutton1.$$.fragment,local),transition_out(flatbutton2.$$.fragment,local),transition_out(flatbutton3.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div),destroy_component(flatbutton0),destroy_component(flatbutton1),destroy_component(flatbutton2),destroy_component(flatbutton3)}}}__name(create_if_block$u,"create_if_block$u");function create_fragment$U(ctx){let div,current_block_type_index,if_block,current,mounted,dispose;const if_block_creators=[create_if_block$u,create_else_block$c],if_blocks=[];function select_block_type(ctx2,dirty){return ctx2[2]!==void 0&&ctx2[2].interactionTarget!==void 0?0:1}return __name(select_block_type,"select_block_type"),current_block_type_index=select_block_type(ctx),if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx),{c(){div=element$1("div"),if_block.c(),attr(div,"class","typo-quickreact-focus svelte-yvtrmi"),attr(div,"tabindex","0")},m(target,anchor){insert(target,div,anchor),if_blocks[current_block_type_index].m(div,null),ctx[8](div),current=!0,mounted||(dispose=listen(div,"keydown",ctx[9]),mounted=!0)},p(ctx2,[dirty]){let previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx2),current_block_type_index===previous_block_index?if_blocks[current_block_type_index].p(ctx2,dirty):(group_outros(),transition_out(if_blocks[previous_block_index],1,1,()=>{if_blocks[previous_block_index]=null}),check_outros(),if_block=if_blocks[current_block_type_index],if_block?if_block.p(ctx2,dirty):(if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx2),if_block.c()),transition_in(if_block,1),if_block.m(div,null))},i(local){current||(transition_in(if_block),current=!0)},o(local){transition_out(if_block),current=!1},d(detaching){detaching&&detach(div),if_blocks[current_block_type_index].d(),ctx[8](null),mounted=!1,dispose()}}}__name(create_fragment$U,"create_fragment$U");function instance$P($$self,$$props,$$invalidate){let $availableInteractions,{feature}=$$props,wrapper;const availableInteractions=feature.availableInteractionsStore;component_subscribe($$self,availableInteractions,value=>$$invalidate(2,$availableInteractions=value));const onKeyPress=__name(event=>{if($availableInteractions!==void 0&&$availableInteractions.interactionTarget!==void 0)switch(event.key){case"ArrowLeft":feature.votekickPlayer($availableInteractions.interactionTarget),feature.toggleQuickReactMenu();break;case"ArrowRight":feature.toggleQuickReactMenu();break;case"ArrowUp":feature.likeCurrentPlayer(),feature.toggleQuickReactMenu();break;case"ArrowDown":feature.dislikeCurrentPlayer(),feature.toggleQuickReactMenu();break}},"onKeyPress");onMount(()=>{wrapper.focus()});const click_handler2=__name(()=>feature.votekickPlayer($availableInteractions.interactionTarget),"click_handler"),click_handler_1=__name(()=>feature.likeCurrentPlayer(),"click_handler_1"),click_handler_2=__name(()=>feature.dislikeCurrentPlayer(),"click_handler_2");function div_binding($$value){binding_callbacks[$$value?"unshift":"push"](()=>{wrapper=$$value,$$invalidate(1,wrapper)})}__name(div_binding,"div_binding");const keydown_handler=__name(event=>onKeyPress(event),"keydown_handler");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},[feature,wrapper,$availableInteractions,availableInteractions,onKeyPress,click_handler2,click_handler_1,click_handler_2,div_binding,keydown_handler]}__name(instance$P,"instance$P");const _Quick_react=class _Quick_react extends SvelteComponent{constructor(options){super(),init(this,options,instance$P,create_fragment$U,safe_not_equal,{feature:0})}};__name(_Quick_react,"Quick_react");let Quick_react=_Quick_react;var __defProp$U=Object.defineProperty,__decorateClass$U=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$U(target,key,result),result},"__decorateClass$U");const _ChatQuickReactFeature=class _ChatQuickReactFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elements");__publicField(this,"_lobbyInteractionsService");__publicField(this,"_toastService");__publicField(this,"_lobbyService");__publicField(this,"name","Quick React");__publicField(this,"description","Adds accessibility to kick, like, and dislike via keyboard by pressing CTRL in the chat box.");__publicField(this,"featureId",33);__publicField(this,"_likeCommand",this.useCommand(new ExtensionCommand("like",this,"Like","Like the current drawing")).run(async command=>(await this.likeCurrentPlayer(),new InterpretableSilentSuccess(command))));__publicField(this,"_dislikeCommand",this.useCommand(new ExtensionCommand("dislike",this,"Dislike","Dislike the current drawing")).run(async command=>(await this.dislikeCurrentPlayer(),new InterpretableSilentSuccess(command))));__publicField(this,"_kickCommand",this.useCommand(new ExtensionCommand("kick",this,"Votekick","Kick the current (default) or another player")).withParameters(params=>params.addParam(new NumericOptionalCommandParameter("Player ID","The ID of the player to votekick, leave empty for current drawer",id2=>({id:id2}))).run(async(args,command)=>{const lobby=await firstValueFrom(this._lobbyService.lobby$);if(args.id===void 0&&(args.id=(lobby==null?void 0:lobby.drawerId)??void 0),args.id!==void 0&&args.id===(lobby==null?void 0:lobby.meId))return new InterpretableError(command,"You can't votekick yourself :(");const target=lobby==null?void 0:lobby.players.find(player=>player.id===args.id);return target===void 0&&args.id!==void 0?new InterpretableError(command,"Selected player not found"):target===void 0?new InterpretableError(command,"No default player to votekick"):(await this.votekickPlayer(target),new InterpretableSilentSuccess(command))})));__publicField(this,"_openQuickReactHotkey",this.useHotkey(new HotkeyAction("open_quickreact","Quick React","Open the quick react menu",this,()=>this.toggleQuickReactMenu(),!0,["ControlRight"],void 0,!1)));__publicField(this,"_instantLikeHotkey",this.useHotkey(new HotkeyAction("instant_like","Like Current Drawing","Instantly likes the current drawing, without quick react menu access",this,()=>this.likeCurrentPlayer(),!1,[])));__publicField(this,"_instantDislikeHotkey",this.useHotkey(new HotkeyAction("instant_dislike","Dislike Current Drawing","Dislikes the current drawing, without quick react menu access",this,()=>this.dislikeCurrentPlayer(),!1,[])));__publicField(this,"_instantVotekickHotkey",this.useHotkey(new HotkeyAction("instant_votekick","Votekick Current Drawer","Votes to kick the current drawer, without quick react menu access",this,()=>this.votekickPlayer(void 0),!1,[])));__publicField(this,"_subscription");__publicField(this,"_flyoutComponent");__publicField(this,"_flyoutSubscription");__publicField(this,"_rateInteractionsStyle",createElement("<style>.typo-hide-rate-interactions { display: none !important }</style>"));__publicField(this,"_interactionUpdateSubscription")}async onActivate(){document.body.appendChild(this._rateInteractionsStyle);const elements2=await this._elements.complete();this._interactionUpdateSubscription=this._lobbyInteractionsService.availableInteractions$.subscribe(interactions=>{elements2.gameRate.classList.toggle("typo-hide-rate-interactions",(interactions==null?void 0:interactions.rateAvailable)!==!0)})}async onDestroy(){var _a81,_b,_c,_d;(_a81=this._subscription)==null||_a81.unsubscribe(),this._subscription=void 0,(_b=this._flyoutSubscription)==null||_b.unsubscribe(),(_c=this._flyoutComponent)==null||_c.$destroy(),this._flyoutComponent=void 0,this._flyoutSubscription=void 0,(_d=this._interactionUpdateSubscription)==null||_d.unsubscribe(),this._interactionUpdateSubscription=void 0,this._rateInteractionsStyle.remove()}async toggleQuickReactMenu(){if(this._flyoutComponent)this._flyoutComponent.close();else{const elements2=await this._elements.complete(),flyoutContent={componentType:Quick_react,props:{feature:this}};this._flyoutComponent=new Area_flyout({target:elements2.gameWrapper,props:{componentData:flyoutContent,areaName:"chat",maxHeight:"600px",maxWidth:"300px",marginY:"2.5rem",title:"Quick React",closeStrategy:"implicit"}}),this._flyoutSubscription=this._flyoutComponent.closed$.subscribe(async()=>{var _a81,_b;this._logger.debug("Destroyed menu"),(_a81=this._flyoutComponent)==null||_a81.$destroy(),this._flyoutComponent=void 0,(_b=this._flyoutSubscription)==null||_b.unsubscribe(),this._flyoutSubscription=void 0,(await this._elements.complete()).chatInput.focus()})}}get availableInteractionsStore(){return fromObservable(this._lobbyInteractionsService.availableInteractions$,void 0)}async getCurrentInteractionPlayer(matchesAvailable){return firstValueFrom(this._lobbyInteractionsService.availableInteractions$.pipe(map(interactions=>{if(interactions===void 0||matchesAvailable&&!matchesAvailable(interactions))throw new Error("Interaction is not available");return interactions.interactionTarget})))}async likeCurrentPlayer(){const toast=await this._toastService.showLoadingToast("Liking current player");let player;try{const availablePlayer=await this.getCurrentInteractionPlayer(interactions=>interactions.rateAvailable);if(availablePlayer===void 0)throw new Error("No player available to rate");player=availablePlayer}catch(e){toast.reject(e.message);return}await this._lobbyInteractionsService.likePlayer(),toast.resolve(`Liked the drawing of ${player.name}`)}async dislikeCurrentPlayer(){const toast=await this._toastService.showLoadingToast("Disliking current player");let player;try{const availablePlayer=await this.getCurrentInteractionPlayer(interactions=>interactions.rateAvailable);if(availablePlayer===void 0)throw new Error("No player available to rate");player=availablePlayer}catch(e){toast.reject(e.message);return}await this._lobbyInteractionsService.dislikePlayer(),toast.resolve(`Disliked the drawing of ${player.name}`)}async votekickPlayer(player){const toast=await this._toastService.showLoadingToast("Voting to kick current player");try{const targetPlayer=await this.getCurrentInteractionPlayer(interactions=>interactions.votekickAvailable);if(player===void 0){if(targetPlayer===void 0)throw new Error("No default player available to votekick");player=targetPlayer}}catch(e){toast.reject(e.message);return}await this._lobbyInteractionsService.votekickPlayer(player.id),toast.resolve(`Voted to kick ${player.name}`)}};__name(_ChatQuickReactFeature,"ChatQuickReactFeature");let ChatQuickReactFeature=_ChatQuickReactFeature;__decorateClass$U([inject(ElementsSetup)],ChatQuickReactFeature.prototype,"_elements");__decorateClass$U([inject(LobbyInteractionsService)],ChatQuickReactFeature.prototype,"_lobbyInteractionsService");__decorateClass$U([inject(ToastService)],ChatQuickReactFeature.prototype,"_toastService");__decorateClass$U([inject(LobbyService)],ChatQuickReactFeature.prototype,"_lobbyService");var __defProp$T=Object.defineProperty,__decorateClass$T=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$T(target,key,result),result},"__decorateClass$T");const _ChatRecallFeature=class _ChatRecallFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elements");__publicField(this,"_messageSent");__publicField(this,"name","Chat Recall");__publicField(this,"description","Remembers your last messages so you can quickly recall them with arrow up/down in the chat box");__publicField(this,"featureId",15);__publicField(this,"_history",[]);__publicField(this,"_historyIndex");__publicField(this,"listener",this.handleInputEvent.bind(this))}async handleInputEvent(event){if(event.key==="ArrowUp"||event.key==="ArrowDown"){event.preventDefault();const element2=event.target;this._historyIndex===void 0?event.key==="ArrowUp"&&(this._historyIndex=this._history.length-1,element2.value=this._history[this._historyIndex]??""):event.key==="ArrowDown"?this._historyIndex<this._history.length-1?(this._historyIndex++,element2.value=this._history[this._historyIndex]):(this._historyIndex=void 0,element2.value=""):event.key==="ArrowUp"&&this._historyIndex>0&&(this._historyIndex--,element2.value=this._history[this._historyIndex])}}async onActivate(){(await this._elements.complete()).chatInput.addEventListener("keydown",this.listener),this._messageSent.events$.subscribe(event=>{this._history.push(event.data),this._historyIndex=void 0})}async onDestroy(){(await this._elements.complete()).chatInput.removeEventListener("keydown",this.listener),this._history=[],this._historyIndex=0}};__name(_ChatRecallFeature,"ChatRecallFeature");let ChatRecallFeature=_ChatRecallFeature;__decorateClass$T([inject(ElementsSetup)],ChatRecallFeature.prototype,"_elements");__decorateClass$T([inject(MessageSentEventListener)],ChatRecallFeature.prototype,"_messageSent");const _ImageData=class _ImageData{constructor(_base64Full,_blob){this._base64Full=_base64Full,this._blob=_blob}static async fromImageUrl(url){const blob=await(await fetch(url)).blob();return _ImageData.fromBlob(blob)}static async fromBlob(blob){const reader=new FileReader;return reader.readAsDataURL(blob),new Promise((resolve2,reject)=>{reader.onloadend=()=>{const base64=reader.result;resolve2(new _ImageData(base64,blob))},reader.onerror=()=>reject()})}static async fromBase64(base64){const blob=await(await fetch(base64)).blob();return new _ImageData(base64,blob)}get base64Full(){return this._base64Full}get blob(){return this._blob}get base64ApiTruncated(){return this._base64Full.split(",")[1].replace("==","")}getBase64(){return this._base64Full}};__name(_ImageData,"ImageData");let ImageData=_ImageData;var __defProp$S=Object.defineProperty,__getOwnPropDesc$e=Object.getOwnPropertyDescriptor,__decorateClass$S=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$e(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$S(target,key,result),result},"__decorateClass$S"),__decorateParam$b=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$b"),_a65;let DrawingService=(_a65=class{constructor(loggerFactory2,lobbyLeft,lobbyChanged,hintsAdded,draw,wordGuessed,imageReset,elementsSetup,skribblMessages){__publicField(this,"_logger");__publicField(this,"_currentImageState$",new BehaviorSubject(null));__publicField(this,"_currentCommands$",new BehaviorSubject([]));__publicField(this,"_drawingState$",new BehaviorSubject("idle"));__publicField(this,"_pasteInProgress$",new BehaviorSubject(!1));__publicField(this,"_abortCommands$",new BehaviorSubject(Number.MAX_VALUE));__publicField(this,"_incomingDrawCommands$",new Subject$1);this.lobbyLeft=lobbyLeft,this.lobbyChanged=lobbyChanged,this.hintsAdded=hintsAdded,this.draw=draw,this.wordGuessed=wordGuessed,this.imageReset=imageReset,this.elementsSetup=elementsSetup,this.skribblMessages=skribblMessages,this._logger=loggerFactory2(this),this.listenDrawCommands(),this.listenCurrentImageState(),this.imageState$.subscribe(data=>{this._logger.debug("Image state updated",data)}),this.commands$.pipe(debounceTime(1e3)).subscribe(data=>{this._logger.debug("Commands updated",data)}),lobbyLeft.events$.subscribe(()=>this.cancelPendingDrawCommands()),this._incomingDrawCommands$.pipe(concatMap(([value,scheduled2])=>{if(!scheduled2)return of(value);const scheduledTime=Date.now(),abort=this._abortCommands$.value;return scheduledTime<abort?of(value).pipe(delay(2)):of(null)}),filter(value=>value!==null),tap(command=>this.onDrawCommand(command)),mergeWith(this._pasteInProgress$),scan((acc,pastingOrCommands)=>pastingOrCommands===!1?0:pastingOrCommands===!0?acc:acc+1,0),filter(count=>count>0),debounceTime(50)).subscribe(count=>{this._logger.debug("finished pasting",count),document.dispatchEvent(new CustomEvent("collapseUndoActions",{detail:count})),this._pasteInProgress$.next(!1),this._abortCommands$.next(Number.MAX_VALUE)})}onDrawCommand(command){this._logger.debug("Incoming draw command",command),document.dispatchEvent(new CustomEvent("performDrawCommand",{detail:command}))}listenDrawCommands(){merge$1(this.lobbyLeft.events$,this.lobbyChanged.events$,this.draw.events$,this.imageReset.events$).pipe(withLatestFrom(this._currentCommands$),map(data=>({update:data[0],currentCommands:data[1]}))).subscribe(({update,currentCommands})=>{if(currentCommands=structuredClone(currentCommands),update instanceof LobbyLeftEvent)currentCommands=[];else if(update instanceof LobbyStateChangedEvent)update.data.drawingStarted!==void 0&&(currentCommands=[]);else if(update instanceof LobbyLeftEvent)currentCommands=[];else if(update instanceof DrawEvent){const commands=update.data.map(command=>command.length>7?arrayChunk(command,7):[command]).flat(1);currentCommands.push(...commands)}else update instanceof ImageResetEvent&&(currentCommands=update.data===0?[]:currentCommands.slice(0,update.data));this._currentCommands$.next(currentCommands)})}listenCurrentImageState(){merge$1(this.lobbyLeft.events$,this.lobbyChanged.events$,this.hintsAdded.events$,this.wordGuessed.events$).pipe(withLatestFrom(this._currentImageState$),map(data=>({update:data[0],currentImageState:data[1]}))).subscribe(({update,currentImageState})=>{if(currentImageState=currentImageState===null?null:structuredClone(currentImageState),update instanceof LobbyLeftEvent)currentImageState=null,this._drawingState$.next("idle");else if(update instanceof LobbyStateChangedEvent)currentImageState=currentImageState??{drawerId:void 0,word:{length:[0],hints:"",solution:void 0}},update.data.drawingStarted!==void 0&&(this._drawingState$.next("drawing"),currentImageState.drawerId=update.data.drawingStarted.drawerId,currentImageState.word.length=update.data.drawingStarted.characters,currentImageState.word.solution=update.data.drawingStarted.word,currentImageState.word.hints=update.data.drawingStarted.word??update.data.drawingStarted.characters.map(len=>"_".repeat(len)).join(" ")),update.data.drawingRevealed!==void 0&&(this._drawingState$.next("idle"),currentImageState.word.solution=update.data.drawingRevealed.word,currentImageState.word.hints=update.data.drawingRevealed.word);else if(currentImageState!==null&&update instanceof HintsAddedEvent){const hints=[...currentImageState.word.hints];update.data.forEach(hint=>{hints[hint[0]]=hint[1]}),currentImageState.word.hints=hints.join("")}else currentImageState!==null&&update instanceof WordGuessedEvent?update.data.word!==void 0&&(currentImageState.word.solution=update.data.word,currentImageState.word.hints=update.data.word):currentImageState!==null&&update instanceof LobbyLeftEvent&&(this._drawingState$.next("idle"),currentImageState=null);this._currentImageState$.next(currentImageState)})}get imageState$(){return this._currentImageState$.asObservable()}get commands$(){return this._currentCommands$.asObservable()}get drawingState$(){return this._drawingState$.asObservable()}async getCurrentImageBase64(){return(await this.elementsSetup.complete()).canvas.toDataURL()}async getCurrentImageData(){const base64=await this.getCurrentImageBase64();return await ImageData.fromBase64(base64)}async pasteDrawCommands(commands,scheduled2=!0){this._logger.debug("Pasting draw commands",commands),commands.length!==0&&(this._pasteInProgress$.next(!0),commands.forEach(command=>this._incomingDrawCommands$.next([command,scheduled2])))}cancelPendingDrawCommands(){this._abortCommands$.next(Date.now())}get pasteInProgress$(){return this._pasteInProgress$.pipe(distinctUntilChanged())}setColor(color){this._logger.debug("Setting color",color),document.dispatchEvent(new CustomEvent("setColor",{detail:{code:color.typoCode}}))}setSize(size){this._logger.debug("Setting size",size),document.dispatchEvent(new CustomEvent("selectSkribblSize",{detail:size}))}clearImage(){this._logger.debug("Clearing image"),document.dispatchEvent(new CustomEvent("clearDrawing"))}async drawImage(imageBase64,x,y,dx,dy){this._logger.debug("Drawing image",imageBase64,x,y,dx,dy);const img=new Image;img.src=imageBase64,await new Promise(resolve2=>img.onload=resolve2);const ctx=(await this.elementsSetup.complete()).canvas.getContext("2d");ctx==null||ctx.drawImage(img,x??0,y??0,dx??img.width,dy??img.height)}createLineCommands(coordinates,colorCode=void 0,size=void 0){var _a81;const clipped=(_a81=this.clipLine([coordinates[0],coordinates[1]],[coordinates[2],coordinates[3]]))==null?void 0:_a81.flat();if(clipped!==void 0)return clipped.some(n=>isNaN(n))&&this._logger.warn("Invalid line coordinates",coordinates,clipped),[0,colorCode??1,size??4,...clipped]}async drawLine(coordinates,colorCode=void 0,size=void 0){var _a81;this._logger.debug("Drawing line",coordinates,colorCode,size);const clipped=(_a81=this.clipLine([coordinates[0],coordinates[1]],[coordinates[2],coordinates[3]]))==null?void 0:_a81.flat();clipped!==void 0&&await this.pasteDrawCommands([[0,colorCode??1,size??4,...clipped]])}clipLine(origin,target){if(!(origin[0]<0&&target[0]<0||origin[0]>=800&&target[0]>=800||origin[1]<0&&target[1]<0||origin[1]>=600&&target[1]>=600)){if(target[0]<0||target[0]>=800){const y=(target[1]-origin[1])/(target[0]-origin[0])*((target[0]<0?0:799)-origin[0])+origin[1];target=[target[0]<0?0:799,y]}if((target[1]<0||target[1]>=600)&&(target=[(target[0]-origin[0])/(target[1]-origin[1])*((target[1]<0?0:599)-origin[1])+origin[0],target[1]<0?0:599]),(origin[1]<0||origin[1]>=600)&&(origin=[(target[0]-origin[0])/(target[1]-origin[1])*((origin[1]<0?0:599)-origin[1])+origin[0],origin[1]<0?0:599]),origin[0]<0||origin[0]>=800){const y=(target[1]-origin[1])/(target[0]-origin[0])*((origin[0]<0?0:799)-origin[0])+origin[1];origin=[origin[0]<0?0:799,y]}return origin=[Math.floor(origin[0]),Math.floor(origin[1])],target=[Math.floor(target[0]),Math.floor(target[1])],[origin,target]}}},__name(_a65,"DrawingService"),_a65);DrawingService=__decorateClass$S([injectable(),__decorateParam$b(0,inject(loggerFactory)),__decorateParam$b(1,inject(LobbyLeftEventListener)),__decorateParam$b(2,inject(LobbyStateChangedEventListener)),__decorateParam$b(3,inject(HintsAddedEventListener)),__decorateParam$b(4,inject(DrawEventListener)),__decorateParam$b(5,inject(WordGuessedEventListener)),__decorateParam$b(6,inject(ImageResetEventListener)),__decorateParam$b(7,inject(ElementsSetup)),__decorateParam$b(8,inject(SkribblMessageRelaySetup))],DrawingService);var __defProp$R=Object.defineProperty,__getOwnPropDesc$d=Object.getOwnPropertyDescriptor,__decorateClass$R=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$d(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$R(target,key,result),result},"__decorateClass$R"),__decorateParam$a=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$a"),_a66;let ImageFinishedService=(_a66=class{constructor(loggerFactory2,_drawingService,_lobbyService){__publicField(this,"_logger");__publicField(this,"_imageFinished$");this._drawingService=_drawingService,this._lobbyService=_lobbyService,this._logger=loggerFactory2(this),this._imageFinished$=this.listenImageFinished()}listenImageFinished(){return this.mapToImageState(this._drawingService.drawingState$.pipe(delay(100),filter(state=>state==="idle"))).pipe(filter(image=>image!==null),tap(()=>this._logger.debug("Image finished")))}mapToImageState(input){return input===void 0&&(input=of(1)),input.pipe(withLatestFrom(this._drawingService.imageState$,this._lobbyService.lobby$,this._drawingService.commands$),switchMap(data=>fromPromise(this._drawingService.getCurrentImageData()).pipe(map(imageData=>({image:structuredClone(data[1]),lobby:structuredClone(data[2]),commands:structuredClone(data[3]),imageData})))),map(state=>{var _a81,_b;if(state.image===null||state.lobby===null)return null;const{lobby,image,imageData,commands}=state;return{name:image.word.solution??`${image.word.hints} (${image.word.length.join(", ")})`,image:imageData,commands,private:lobby.private,artist:((_a81=lobby.players.find(p=>p.id===image.drawerId))==null?void 0:_a81.name)??"Unknown Artist",date:new Date,player:((_b=lobby.players.find(p=>p.id===lobby.meId))==null?void 0:_b.name)??"Unknown Poster",isOwn:lobby.meId===image.drawerId,language:lobby.settings.language}}))}get imageFinished$(){return this._imageFinished$}get imageHistory$(){return this._imageFinished$.pipe(scan((acc,image)=>image===null?acc:[...acc,image],[]),distinctUntilChanged((a,b)=>a.length===b.length))}},__name(_a66,"ImageFinishedService"),_a66);ImageFinishedService=__decorateClass$R([injectable(),__decorateParam$a(0,inject(loggerFactory)),__decorateParam$a(1,inject(DrawingService)),__decorateParam$a(2,inject(LobbyService))],ImageFinishedService);var __defProp$Q=Object.defineProperty,__getOwnPropDesc$c=Object.getOwnPropertyDescriptor,__decorateClass$Q=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$c(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$Q(target,key,result),result},"__decorateClass$Q"),__decorateParam$9=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$9"),_a67;let CloudService=(_a67=class{constructor(loggerFactory2){__publicField(this,"_apiService");__publicField(this,"_logger");__publicField(this,"_pendingAwardInventoryIds",new Set);this._logger=loggerFactory2(this)}async uploadToCloud(image,member,linkWithPendingAwards=!1){const api=this._apiService.getApi(CloudApi),uploaded=await api.uploadToUserCloud({login:Number(member.userLogin),cloudUploadDto:{name:image.name,author:image.artist,inPrivate:image.private,isOwn:image.isOwn,language:image.language,commands:image.commands,imageBase64:image.image.base64ApiTruncated}});if(this._logger.debug("Image saved to cloud"),linkWithPendingAwards&&this._pendingAwardInventoryIds.size>0){const ids=Array.from(this._pendingAwardInventoryIds);this._pendingAwardInventoryIds.clear();const linked=await Promise.all(ids.map(id2=>api.linkImageToAward({login:Number(member.userLogin),token:id2,id:uploaded.id})));this._logger.info("Linked image to pending awards",linked.length)}}addPendingAwardInventoryId(inventoryId){this._logger.debug("Adding pending award inventory id",inventoryId),this._pendingAwardInventoryIds.add(inventoryId)}clearPendingAwardInventoryIds(){this._logger.debug("Clearing pending award inventory ids"),this._pendingAwardInventoryIds.clear()}},__name(_a67,"CloudService"),_a67);__decorateClass$Q([inject(ApiService)],CloudService.prototype,"_apiService",2);CloudService=__decorateClass$Q([injectable(),__decorateParam$9(0,inject(loggerFactory))],CloudService);const convertOldSkd=__name(oldSkd=>{const commands=oldSkd.flat();return commands.forEach(command=>{switch(command[0]){case 2:command[0]=1;case 0:command[1]>11&&(command[1]+=2),command[1]>21&&(command[1]+=2);break;case 1:command=[command[0],0,command[1],command[2],command[3],command[4],command[5]];break}}),commands},"convertOldSkd");var __defProp$P=Object.defineProperty,__getOwnPropDesc$b=Object.getOwnPropertyDescriptor,__decorateClass$P=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$b(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$P(target,key,result),result},"__decorateClass$P"),__decorateParam$8=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$8"),_a68;let ImagelabService=(_a68=class{constructor(loggerFactory2){__publicField(this,"_logger");__publicField(this,"_savedDrawCommands$");this._logger=loggerFactory2(this)}async onFeatureDestroy(){this._savedDrawCommands$=void 0}async onFeatureActivate(){this._savedDrawCommands$=new BehaviorSubject([])}get savedDrawCommands$(){if(!this._savedDrawCommands$)throw this._logger.error("Tried to access saved draw commands without initializing the service first. Imagelab feature enabled?"),new Error("illegal state");return this._savedDrawCommands$}saveDrawCommands(name,commands){if(!this._savedDrawCommands$)throw this._logger.warn("Tried to save draw commands without initializing the service first. Imagelab feature enabled?"),new Error("illegal state");commands[0]&&Array.isArray(commands[0])&&Array.isArray(commands[0][0])?commands=convertOldSkd(commands):commands=commands,this._savedDrawCommands$.next([...this.savedDrawCommands$.value,{name,commands}])}removeSavedDrawCommands(index){if(!this._savedDrawCommands$)throw this._logger.warn("Tried to save draw commands without initializing the service first. Imagelab feature enabled?"),new Error("illegal state");this._savedDrawCommands$.next(this._savedDrawCommands$.value.filter((item,i)=>i!==index))}},__name(_a68,"ImagelabService"),_a68);ImagelabService=__decorateClass$P([injectable(),__decorateParam$8(0,inject(loggerFactory))],ImagelabService);var __defProp$O=Object.defineProperty,__getOwnPropDesc$a=Object.getOwnPropertyDescriptor,__decorateClass$O=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$a(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$O(target,key,result),result},"__decorateClass$O"),__decorateParam$7=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$7"),_a69;let ImagePostService=(_a69=class{constructor(loggerFactory2,_imageFinishedService){__publicField(this,"_logger");__publicField(this,"_history$");__publicField(this,"_historySubscription");this._imageFinishedService=_imageFinishedService,this._logger=loggerFactory2(this)}async onFeatureActivate(){this._history$=new BehaviorSubject([]),this._historySubscription=this._imageFinishedService.imageHistory$.subscribe(data=>{var _a81;return(_a81=this._history$)==null?void 0:_a81.next(data)})}async onFeatureDestroy(){var _a81;this._history$=void 0,(_a81=this._historySubscription)==null||_a81.unsubscribe()}get history$(){if(!this._history$)throw this._logger.error("Tried to access history without initializing the service first. Imagelab feature enabled?"),new Error("illegal state");return this._history$.asObservable()}addToHistory(image){if(!this._history$)throw this._logger.error("Tried to access history without initializing the service first. Imagelab feature enabled?"),new Error("illegal state");this._history$.next([...this._history$.value,image])}},__name(_a69,"ImagePostService"),_a69);ImagePostService=__decorateClass$O([injectable(),__decorateParam$7(0,inject(loggerFactory)),__decorateParam$7(1,inject(ImageFinishedService))],ImagePostService);function create_fragment$T(ctx){let div0,t0,div1,t1,div5,div4,div2,t2,h1,t3,t4,div3,t6,switch_instance,current,mounted,dispose;const switch_instance_spread_levels=[ctx[0].props];var switch_value=ctx[0].componentType;function switch_props(ctx2,dirty){let switch_instance_props={};for(let i=0;i<switch_instance_spread_levels.length;i+=1)switch_instance_props=assign(switch_instance_props,switch_instance_spread_levels[i]);return dirty!==void 0&&dirty&1&&(switch_instance_props=assign(switch_instance_props,get_spread_update(switch_instance_spread_levels,[get_spread_object(ctx2[0].props)]))),{props:switch_instance_props}}return __name(switch_props,"switch_props"),switch_value&&(switch_instance=construct_svelte_component(switch_value,switch_props(ctx))),{c(){div0=element$1("div"),t0=space(),div1=element$1("div"),t1=space(),div5=element$1("div"),div4=element$1("div"),div2=element$1("div"),t2=space(),h1=element$1("h1"),t3=text(ctx[1]),t4=space(),div3=element$1("div"),div3.textContent="×",t6=space(),switch_instance&&create_component(switch_instance.$$.fragment),attr(div0,"class","backdrop svelte-vz9fb6"),attr(div0,"role","presentation"),toggle_class(div0,"closing",ctx[2]),attr(div1,"class","content-top svelte-vz9fb6"),attr(div1,"role","presentation"),toggle_class(div1,"closing",ctx[2]),attr(div2,"class","svelte-vz9fb6"),attr(div3,"role","button"),attr(div3,"tabindex","0"),attr(div3,"class","svelte-vz9fb6"),toggle_class(div3,"closing",ctx[2]),attr(div4,"class","content-title svelte-vz9fb6"),attr(div5,"class","content svelte-vz9fb6"),toggle_class(div5,"closing",ctx[2])},m(target,anchor){insert(target,div0,anchor),insert(target,t0,anchor),insert(target,div1,anchor),insert(target,t1,anchor),insert(target,div5,anchor),append(div5,div4),append(div4,div2),append(div4,t2),append(div4,h1),append(h1,t3),append(div4,t4),append(div4,div3),append(div5,t6),switch_instance&&mount_component(switch_instance,div5,null),current=!0,mounted||(dispose=[listen(div0,"click",ctx[5]),listen(div1,"click",ctx[6]),listen(div3,"keypress",ctx[7]),listen(div3,"click",ctx[8])],mounted=!0)},p(ctx2,[dirty]){if((!current||dirty&4)&&toggle_class(div0,"closing",ctx2[2]),(!current||dirty&4)&&toggle_class(div1,"closing",ctx2[2]),(!current||dirty&2)&&set_data(t3,ctx2[1]),(!current||dirty&4)&&toggle_class(div3,"closing",ctx2[2]),dirty&1&&switch_value!==(switch_value=ctx2[0].componentType)){if(switch_instance){group_outros();const old_component=switch_instance;transition_out(old_component.$$.fragment,1,0,()=>{destroy_component(old_component,1)}),check_outros()}switch_value?(switch_instance=construct_svelte_component(switch_value,switch_props(ctx2,dirty)),create_component(switch_instance.$$.fragment),transition_in(switch_instance.$$.fragment,1),mount_component(switch_instance,div5,null)):switch_instance=null}else if(switch_value){const switch_instance_changes=dirty&1?get_spread_update(switch_instance_spread_levels,[get_spread_object(ctx2[0].props)]):{};switch_instance.$set(switch_instance_changes)}(!current||dirty&4)&&toggle_class(div5,"closing",ctx2[2])},i(local){current||(switch_instance&&transition_in(switch_instance.$$.fragment,local),current=!0)},o(local){switch_instance&&transition_out(switch_instance.$$.fragment,local),current=!1},d(detaching){detaching&&(detach(div0),detach(t0),detach(div1),detach(t1),detach(div5)),switch_instance&&destroy_component(switch_instance),mounted=!1,run_all(dispose)}}}__name(create_fragment$T,"create_fragment$T");function instance$O($$self,$$props,$$invalidate){let{componentData}=$$props,{closeHandler}=$$props,{title}=$$props,closing=!1;const close=__name(()=>{$$invalidate(2,closing=!0),setTimeout(()=>closeHandler(),150)},"close"),click_handler2=__name(()=>close(),"click_handler"),click_handler_1=__name(()=>close(),"click_handler_1"),keypress_handler=__name(e=>e.key==="Alt"&&close(),"keypress_handler"),click_handler_2=__name(()=>close(),"click_handler_2");return $$self.$$set=$$props2=>{"componentData"in $$props2&&$$invalidate(0,componentData=$$props2.componentData),"closeHandler"in $$props2&&$$invalidate(4,closeHandler=$$props2.closeHandler),"title"in $$props2&&$$invalidate(1,title=$$props2.title)},[componentData,title,closing,close,closeHandler,click_handler2,click_handler_1,keypress_handler,click_handler_2]}__name(instance$O,"instance$O");const _Modal_document=class _Modal_document extends SvelteComponent{constructor(options){super(),init(this,options,instance$O,create_fragment$T,safe_not_equal,{componentData:0,closeHandler:4,title:1})}};__name(_Modal_document,"Modal_document");let Modal_document=_Modal_document;function create_fragment$S(ctx){let div4,div3,div2,div0,t0,h1,t1,t2,div1,t4,switch_instance,current,mounted,dispose;const switch_instance_spread_levels=[ctx[0].props];var switch_value=ctx[0].componentType;function switch_props(ctx2,dirty){let switch_instance_props={};for(let i=0;i<switch_instance_spread_levels.length;i+=1)switch_instance_props=assign(switch_instance_props,switch_instance_spread_levels[i]);return dirty!==void 0&&dirty&1&&(switch_instance_props=assign(switch_instance_props,get_spread_update(switch_instance_spread_levels,[get_spread_object(ctx2[0].props)]))),{props:switch_instance_props}}return __name(switch_props,"switch_props"),switch_value&&(switch_instance=construct_svelte_component(switch_value,switch_props(ctx))),{c(){div4=element$1("div"),div3=element$1("div"),div2=element$1("div"),div0=element$1("div"),t0=space(),h1=element$1("h1"),t1=text(ctx[1]),t2=space(),div1=element$1("div"),div1.textContent="×",t4=space(),switch_instance&&create_component(switch_instance.$$.fragment),attr(div0,"class","svelte-e9zgcf"),attr(div1,"role","button"),attr(div1,"tabindex","0"),attr(div1,"class","svelte-e9zgcf"),toggle_class(div1,"closing",ctx[2]),attr(div2,"class","content-title svelte-e9zgcf"),attr(div3,"class","content svelte-e9zgcf"),toggle_class(div3,"closing",ctx[2]),attr(div4,"class","backdrop svelte-e9zgcf"),attr(div4,"role","presentation"),toggle_class(div4,"closing",ctx[2])},m(target,anchor){insert(target,div4,anchor),append(div4,div3),append(div3,div2),append(div2,div0),append(div2,t0),append(div2,h1),append(h1,t1),append(div2,t2),append(div2,div1),append(div3,t4),switch_instance&&mount_component(switch_instance,div3,null),current=!0,mounted||(dispose=[listen(div1,"keypress",ctx[5]),listen(div1,"click",ctx[6]),listen(div4,"click",ctx[7])],mounted=!0)},p(ctx2,[dirty]){if((!current||dirty&2)&&set_data(t1,ctx2[1]),(!current||dirty&4)&&toggle_class(div1,"closing",ctx2[2]),dirty&1&&switch_value!==(switch_value=ctx2[0].componentType)){if(switch_instance){group_outros();const old_component=switch_instance;transition_out(old_component.$$.fragment,1,0,()=>{destroy_component(old_component,1)}),check_outros()}switch_value?(switch_instance=construct_svelte_component(switch_value,switch_props(ctx2,dirty)),create_component(switch_instance.$$.fragment),transition_in(switch_instance.$$.fragment,1),mount_component(switch_instance,div3,null)):switch_instance=null}else if(switch_value){const switch_instance_changes=dirty&1?get_spread_update(switch_instance_spread_levels,[get_spread_object(ctx2[0].props)]):{};switch_instance.$set(switch_instance_changes)}(!current||dirty&4)&&toggle_class(div3,"closing",ctx2[2]),(!current||dirty&4)&&toggle_class(div4,"closing",ctx2[2])},i(local){current||(switch_instance&&transition_in(switch_instance.$$.fragment,local),current=!0)},o(local){switch_instance&&transition_out(switch_instance.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div4),switch_instance&&destroy_component(switch_instance),mounted=!1,run_all(dispose)}}}__name(create_fragment$S,"create_fragment$S");function instance$N($$self,$$props,$$invalidate){let{componentData}=$$props,{closeHandler}=$$props,{title}=$$props,closing=!1;const close=__name(()=>{$$invalidate(2,closing=!0),setTimeout(()=>closeHandler(),150)},"close"),keypress_handler=__name(e=>e.key==="Alt"&&close(),"keypress_handler"),click_handler2=__name(()=>close(),"click_handler"),click_handler_1=__name(e=>{e.currentTarget===e.target&&close()},"click_handler_1");return $$self.$$set=$$props2=>{"componentData"in $$props2&&$$invalidate(0,componentData=$$props2.componentData),"closeHandler"in $$props2&&$$invalidate(4,closeHandler=$$props2.closeHandler),"title"in $$props2&&$$invalidate(1,title=$$props2.title)},[componentData,title,closing,close,closeHandler,keypress_handler,click_handler2,click_handler_1]}__name(instance$N,"instance$N");const _Modal_card=class _Modal_card extends SvelteComponent{constructor(options){super(),init(this,options,instance$N,create_fragment$S,safe_not_equal,{componentData:0,closeHandler:4,title:1})}};__name(_Modal_card,"Modal_card");let Modal_card=_Modal_card;var __defProp$N=Object.defineProperty,__getOwnPropDesc$9=Object.getOwnPropertyDescriptor,__decorateClass$N=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$9(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$N(target,key,result),result},"__decorateClass$N"),__decorateParam$6=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$6"),_a70;let ModalService=(_a70=class{constructor(loggerFactory2){__publicField(this,"_logger");this._logger=loggerFactory2(this)}showModal(componentType,args,title,style="document"){const componentData={componentType,props:args},modal=style==="document"?new Modal_document({target:document.body,props:{componentData,closeHandler:__name(()=>{modal.$destroy()},"closeHandler"),title}}):new Modal_card({target:document.body,props:{componentData,closeHandler:__name(()=>{modal.$destroy()},"closeHandler"),title}})}async showPrompt(componentType,argsFactory,title,style="card",validate){const result$=new Subject$1,componentArgs=argsFactory(__name(async result2=>{let validated=validate===void 0?!0:validate(result2);validated instanceof Promise&&(validated=await validated),validated&&result$.next(result2)},"submit")),componentData={componentType,props:componentArgs},modal=style==="card"?new Modal_card({target:document.body,props:{componentData,closeHandler:__name(()=>{modal.$destroy(),result$.next(void 0)},"closeHandler"),title}}):new Modal_document({target:document.body,props:{componentData,closeHandler:__name(()=>{modal.$destroy(),result$.next(void 0)},"closeHandler"),title}}),result=await firstValueFrom(result$);return modal.$destroy(),result}},__name(_a70,"ModalService"),_a70);ModalService=__decorateClass$N([injectable(),__decorateParam$6(0,inject(loggerFactory))],ModalService);const downloadBlob=__name((blob,filename)=>{const url=URL.createObjectURL(blob),a=document.createElement("a");a.href=url,a.download=filename,a.click()},"downloadBlob"),downloadText=__name((text2,filename)=>{const blob=new Blob([text2],{type:"text/plain"});downloadBlob(blob,filename)},"downloadText"),getCloudCommands=__name(async url=>await(await fetch(url)).json(),"getCloudCommands"),getCloudMeta=__name(async url=>await(await fetch(url)).json(),"getCloudMeta");function get_each_context$s(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[32]=list[i],child_ctx}__name(get_each_context$s,"get_each_context$s");function create_if_block_2$9(ctx){let flatbutton,current;return flatbutton=new Flat_button({props:{content:"Search Cloud",color:"green"}}),flatbutton.$on("click",ctx[20]),{c(){create_component(flatbutton.$$.fragment)},m(target,anchor){mount_component(flatbutton,target,anchor),current=!0},p:noop$1,i(local){current||(transition_in(flatbutton.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton.$$.fragment,local),current=!1},d(detaching){destroy_component(flatbutton,detaching)}}}__name(create_if_block_2$9,"create_if_block_2$9");function create_if_block_1$e(ctx){let await_block_anchor,promise,current,info={ctx,current:null,token:null,hasCatch:!1,pending:create_pending_block$2,then:create_then_block$2,catch:create_catch_block$2,value:11,blocks:[,,,]};return handle_promise(promise=ctx[11],info),{c(){await_block_anchor=empty(),info.block.c()},m(target,anchor){insert(target,await_block_anchor,anchor),info.block.m(target,info.anchor=anchor),info.mount=()=>await_block_anchor.parentNode,info.anchor=await_block_anchor,current=!0},p(new_ctx,dirty){ctx=new_ctx,info.ctx=ctx,dirty[0]&2048&&promise!==(promise=ctx[11])&&handle_promise(promise,info)||update_await_block_branch(info,ctx,dirty)},i(local){current||(transition_in(info.block),current=!0)},o(local){for(let i=0;i<3;i+=1){const block=info.blocks[i];transition_out(block)}current=!1},d(detaching){detaching&&detach(await_block_anchor),info.block.d(detaching),info.token=null,info=null}}}__name(create_if_block_1$e,"create_if_block_1$e");function create_catch_block$2(ctx){return{c:noop$1,m:noop$1,p:noop$1,i:noop$1,o:noop$1,d:noop$1}}__name(create_catch_block$2,"create_catch_block$2");function create_then_block$2(ctx){let each_1_anchor,each_value=ensure_array_like(ctx[11]),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$s(get_each_context$s(ctx,each_value,i));return{c(){for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();each_1_anchor=empty()},m(target,anchor){for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(target,anchor);insert(target,each_1_anchor,anchor)},p(ctx2,dirty){if(dirty[0]&3584){each_value=ensure_array_like(ctx2[11]);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$s(ctx2,each_value,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block$s(child_ctx),each_blocks[i].c(),each_blocks[i].m(each_1_anchor.parentNode,each_1_anchor))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value.length}},i:noop$1,o:noop$1,d(detaching){detaching&&detach(each_1_anchor),destroy_each(each_blocks,detaching)}}}__name(create_then_block$2,"create_then_block$2");function create_each_block$s(ctx){let img,img_src_value,img_alt_value,mounted,dispose;function click_handler_4(){return ctx[23](ctx[32])}return __name(click_handler_4,"click_handler_4"),{c(){img=element$1("img"),src_url_equal(img.src,img_src_value=ctx[32].imageUrl)||attr(img,"src",img_src_value),attr(img,"alt",img_alt_value=ctx[32].name),set_style(img,"display",ctx[9].includes(ctx[32].id)?"none":""),attr(img,"class","svelte-1vf0qtx")},m(target,anchor){insert(target,img,anchor),mounted||(dispose=listen(img,"click",click_handler_4),mounted=!0)},p(new_ctx,dirty){ctx=new_ctx,dirty[0]&2048&&!src_url_equal(img.src,img_src_value=ctx[32].imageUrl)&&attr(img,"src",img_src_value),dirty[0]&2048&&img_alt_value!==(img_alt_value=ctx[32].name)&&attr(img,"alt",img_alt_value),dirty[0]&2560&&set_style(img,"display",ctx[9].includes(ctx[32].id)?"none":"")},d(detaching){detaching&&detach(img),mounted=!1,dispose()}}}__name(create_each_block$s,"create_each_block$s");function create_pending_block$2(ctx){let div,bounceload,current;return bounceload=new Bounceload({props:{content:"Loading Images..."}}),{c(){div=element$1("div"),create_component(bounceload.$$.fragment),attr(div,"class","loading svelte-1vf0qtx")},m(target,anchor){insert(target,div,anchor),mount_component(bounceload,div,null),current=!0},p:noop$1,i(local){current||(transition_in(bounceload.$$.fragment,local),current=!0)},o(local){transition_out(bounceload.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div),destroy_component(bounceload)}}}__name(create_pending_block$2,"create_pending_block$2");function create_if_block$t(ctx){let div0,img,img_src_value,img_alt_value,t0,div2,h3,t1_value=ctx[10].name+"",t1,t2,span0,t3,t4_value=ctx[10].author+"",t4,t5,span1,t6,t7_value=new Date(Number(ctx[10].createdAt)).toLocaleString()+"",t7,t8,br0,t9,flatbutton0,t10,flatbutton1,t11,flatbutton2,t12,br1,t13,flatbutton3,t14,flatbutton4,t15,br2,t16,flatbutton5,t17,div1,iconbutton,t18,current,mounted,dispose;return flatbutton0=new Flat_button({props:{content:"Download PNG",color:"green"}}),flatbutton0.$on("click",ctx[25]),flatbutton1=new Flat_button({props:{content:"Download GIF",color:"green"}}),flatbutton2=new Flat_button({props:{content:"Copy Link",color:"green"}}),flatbutton2.$on("click",ctx[26]),flatbutton3=new Flat_button({props:{content:"Add to Image Post",color:"blue"}}),flatbutton3.$on("click",ctx[27]),flatbutton4=new Flat_button({props:{content:"Add to Image Lab",color:"blue"}}),flatbutton4.$on("click",ctx[28]),flatbutton5=new Flat_button({props:{content:"Delete Image",color:"orange"}}),flatbutton5.$on("click",ctx[29]),iconbutton=new Icon_button({props:{icon:"file-img-arrow-left-gif",hoverMove:!1,name:"Exit"}}),iconbutton.$on("click",ctx[30]),{c(){div0=element$1("div"),img=element$1("img"),t0=space(),div2=element$1("div"),h3=element$1("h3"),t1=text(t1_value),t2=space(),span0=element$1("span"),t3=text("Drawn by "),t4=text(t4_value),t5=space(),span1=element$1("span"),t6=text("Created on "),t7=text(t7_value),t8=space(),br0=element$1("br"),t9=space(),create_component(flatbutton0.$$.fragment),t10=space(),create_component(flatbutton1.$$.fragment),t11=space(),create_component(flatbutton2.$$.fragment),t12=space(),br1=element$1("br"),t13=space(),create_component(flatbutton3.$$.fragment),t14=space(),create_component(flatbutton4.$$.fragment),t15=space(),br2=element$1("br"),t16=space(),create_component(flatbutton5.$$.fragment),t17=space(),div1=element$1("div"),create_component(iconbutton.$$.fragment),t18=text(`
        Back to Gallery`),src_url_equal(img.src,img_src_value=ctx[10].imageUrl)||attr(img,"src",img_src_value),attr(img,"alt",img_alt_value=ctx[10].name),attr(img,"class","svelte-1vf0qtx"),attr(div0,"class","present-image svelte-1vf0qtx"),attr(h3,"class","svelte-1vf0qtx"),attr(span0,"class","svelte-1vf0qtx"),attr(span1,"class","svelte-1vf0qtx"),attr(div1,"class","exit-present svelte-1vf0qtx"),attr(div2,"class","present-sidebar svelte-1vf0qtx")},m(target,anchor){insert(target,div0,anchor),append(div0,img),insert(target,t0,anchor),insert(target,div2,anchor),append(div2,h3),append(h3,t1),append(div2,t2),append(div2,span0),append(span0,t3),append(span0,t4),append(div2,t5),append(div2,span1),append(span1,t6),append(span1,t7),append(div2,t8),append(div2,br0),append(div2,t9),mount_component(flatbutton0,div2,null),append(div2,t10),mount_component(flatbutton1,div2,null),append(div2,t11),mount_component(flatbutton2,div2,null),append(div2,t12),append(div2,br1),append(div2,t13),mount_component(flatbutton3,div2,null),append(div2,t14),mount_component(flatbutton4,div2,null),append(div2,t15),append(div2,br2),append(div2,t16),mount_component(flatbutton5,div2,null),append(div2,t17),append(div2,div1),mount_component(iconbutton,div1,null),append(div1,t18),current=!0,mounted||(dispose=[listen(img,"click",click_handler_5),listen(div0,"click",ctx[24]),listen(div1,"click",ctx[31])],mounted=!0)},p(ctx2,dirty){(!current||dirty[0]&1024&&!src_url_equal(img.src,img_src_value=ctx2[10].imageUrl))&&attr(img,"src",img_src_value),(!current||dirty[0]&1024&&img_alt_value!==(img_alt_value=ctx2[10].name))&&attr(img,"alt",img_alt_value),(!current||dirty[0]&1024)&&t1_value!==(t1_value=ctx2[10].name+"")&&set_data(t1,t1_value),(!current||dirty[0]&1024)&&t4_value!==(t4_value=ctx2[10].author+"")&&set_data(t4,t4_value),(!current||dirty[0]&1024)&&t7_value!==(t7_value=new Date(Number(ctx2[10].createdAt)).toLocaleString()+"")&&set_data(t7,t7_value)},i(local){current||(transition_in(flatbutton0.$$.fragment,local),transition_in(flatbutton1.$$.fragment,local),transition_in(flatbutton2.$$.fragment,local),transition_in(flatbutton3.$$.fragment,local),transition_in(flatbutton4.$$.fragment,local),transition_in(flatbutton5.$$.fragment,local),transition_in(iconbutton.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton0.$$.fragment,local),transition_out(flatbutton1.$$.fragment,local),transition_out(flatbutton2.$$.fragment,local),transition_out(flatbutton3.$$.fragment,local),transition_out(flatbutton4.$$.fragment,local),transition_out(flatbutton5.$$.fragment,local),transition_out(iconbutton.$$.fragment,local),current=!1},d(detaching){detaching&&(detach(div0),detach(t0),detach(div2)),destroy_component(flatbutton0),destroy_component(flatbutton1),destroy_component(flatbutton2),destroy_component(flatbutton3),destroy_component(flatbutton4),destroy_component(flatbutton5),destroy_component(iconbutton),mounted=!1,run_all(dispose)}}}__name(create_if_block$t,"create_if_block$t");function create_fragment$R(ctx){let div3,div1,h3,t1,span0,t3,input0,t4,span1,t6,input1,t7,span2,t9,input2,t10,span3,t12,input3,t13,checkbox0,updating_checked,t14,checkbox1,updating_checked_1,t15,br,t16,t17,div0,iconbutton0,t18,span4,t19,t20_value=ctx[1]+1+"",t20,t21,iconbutton1,t22,div2,t23,current,mounted,dispose;function checkbox0_checked_binding(value){ctx[18](value)}__name(checkbox0_checked_binding,"checkbox0_checked_binding");let checkbox0_props={description:"Only private lobbies"};ctx[5]!==void 0&&(checkbox0_props.checked=ctx[5]),checkbox0=new Checkbox({props:checkbox0_props}),binding_callbacks.push(()=>bind$1(checkbox0,"checked",checkbox0_checked_binding));function checkbox1_checked_binding(value){ctx[19](value)}__name(checkbox1_checked_binding,"checkbox1_checked_binding");let checkbox1_props={description:"Only own drawings"};ctx[6]!==void 0&&(checkbox1_props.checked=ctx[6]),checkbox1=new Checkbox({props:checkbox1_props}),binding_callbacks.push(()=>bind$1(checkbox1,"checked",checkbox1_checked_binding));let if_block0=ctx[2]!==null&&create_if_block_2$9(ctx);iconbutton0=new Icon_button({props:{icon:"file-img-arrow-left-gif",name:"Previous",size:"2rem",hoverMove:!1,disabled:ctx[1]<=0}}),iconbutton0.$on("click",ctx[21]),iconbutton1=new Icon_button({props:{icon:"file-img-arrow-right-gif",name:"Next",size:"2rem",hoverMove:!1}}),iconbutton1.$on("click",ctx[22]);let if_block1=ctx[2]!==null&&ctx[11]!==null&&create_if_block_1$e(ctx),if_block2=ctx[10]!==null&&create_if_block$t(ctx);return{c(){div3=element$1("div"),div1=element$1("div"),h3=element$1("h3"),h3.textContent="Filter Cloud",t1=space(),span0=element$1("span"),span0.textContent="Artist Name",t3=space(),input0=element$1("input"),t4=space(),span1=element$1("span"),span1.textContent="Image Name",t6=space(),input1=element$1("input"),t7=space(),span2=element$1("span"),span2.textContent="Created Before",t9=space(),input2=element$1("input"),t10=space(),span3=element$1("span"),span3.textContent="Created After",t12=space(),input3=element$1("input"),t13=space(),create_component(checkbox0.$$.fragment),t14=space(),create_component(checkbox1.$$.fragment),t15=space(),br=element$1("br"),t16=space(),if_block0&&if_block0.c(),t17=space(),div0=element$1("div"),create_component(iconbutton0.$$.fragment),t18=space(),span4=element$1("span"),t19=text("Page "),t20=text(t20_value),t21=space(),create_component(iconbutton1.$$.fragment),t22=space(),div2=element$1("div"),if_block1&&if_block1.c(),t23=space(),if_block2&&if_block2.c(),attr(h3,"class","svelte-1vf0qtx"),attr(span0,"class","svelte-1vf0qtx"),attr(input0,"type","text"),attr(input0,"placeholder","Filter exact artist name"),attr(input0,"class","svelte-1vf0qtx"),attr(span1,"class","svelte-1vf0qtx"),attr(input1,"type","text"),attr(input1,"placeholder","Filter exact image title"),attr(input1,"class","svelte-1vf0qtx"),attr(span2,"class","svelte-1vf0qtx"),attr(input2,"type","datetime-local"),attr(input2,"class","svelte-1vf0qtx"),attr(span3,"class","svelte-1vf0qtx"),attr(input3,"type","datetime-local"),attr(input3,"class","svelte-1vf0qtx"),attr(br,"class","svelte-1vf0qtx"),attr(span4,"class","svelte-1vf0qtx"),attr(div0,"class","navigate-page svelte-1vf0qtx"),attr(div1,"class","gallery-sidebar svelte-1vf0qtx"),toggle_class(div1,"present",ctx[10]!==null),attr(div2,"class","gallery-results svelte-1vf0qtx"),toggle_class(div2,"present",ctx[10]!==null),attr(div3,"class","typo-gallery-grid color-scrollbar svelte-1vf0qtx")},m(target,anchor){insert(target,div3,anchor),append(div3,div1),append(div1,h3),append(div1,t1),append(div1,span0),append(div1,t3),append(div1,input0),set_input_value(input0,ctx[3]),append(div1,t4),append(div1,span1),append(div1,t6),append(div1,input1),set_input_value(input1,ctx[4]),append(div1,t7),append(div1,span2),append(div1,t9),append(div1,input2),set_input_value(input2,ctx[7]),append(div1,t10),append(div1,span3),append(div1,t12),append(div1,input3),set_input_value(input3,ctx[8]),append(div1,t13),mount_component(checkbox0,div1,null),append(div1,t14),mount_component(checkbox1,div1,null),append(div1,t15),append(div1,br),append(div1,t16),if_block0&&if_block0.m(div1,null),append(div1,t17),append(div1,div0),mount_component(iconbutton0,div0,null),append(div0,t18),append(div0,span4),append(span4,t19),append(span4,t20),append(div0,t21),mount_component(iconbutton1,div0,null),append(div3,t22),append(div3,div2),if_block1&&if_block1.m(div2,null),append(div3,t23),if_block2&&if_block2.m(div3,null),current=!0,mounted||(dispose=[listen(input0,"input",ctx[14]),listen(input1,"input",ctx[15]),listen(input2,"input",ctx[16]),listen(input3,"input",ctx[17])],mounted=!0)},p(ctx2,dirty){dirty[0]&8&&input0.value!==ctx2[3]&&set_input_value(input0,ctx2[3]),dirty[0]&16&&input1.value!==ctx2[4]&&set_input_value(input1,ctx2[4]),dirty[0]&128&&set_input_value(input2,ctx2[7]),dirty[0]&256&&set_input_value(input3,ctx2[8]);const checkbox0_changes={};!updating_checked&&dirty[0]&32&&(updating_checked=!0,checkbox0_changes.checked=ctx2[5],add_flush_callback(()=>updating_checked=!1)),checkbox0.$set(checkbox0_changes);const checkbox1_changes={};!updating_checked_1&&dirty[0]&64&&(updating_checked_1=!0,checkbox1_changes.checked=ctx2[6],add_flush_callback(()=>updating_checked_1=!1)),checkbox1.$set(checkbox1_changes),ctx2[2]!==null?if_block0?(if_block0.p(ctx2,dirty),dirty[0]&4&&transition_in(if_block0,1)):(if_block0=create_if_block_2$9(ctx2),if_block0.c(),transition_in(if_block0,1),if_block0.m(div1,t17)):if_block0&&(group_outros(),transition_out(if_block0,1,1,()=>{if_block0=null}),check_outros());const iconbutton0_changes={};dirty[0]&2&&(iconbutton0_changes.disabled=ctx2[1]<=0),iconbutton0.$set(iconbutton0_changes),(!current||dirty[0]&2)&&t20_value!==(t20_value=ctx2[1]+1+"")&&set_data(t20,t20_value),(!current||dirty[0]&1024)&&toggle_class(div1,"present",ctx2[10]!==null),ctx2[2]!==null&&ctx2[11]!==null?if_block1?(if_block1.p(ctx2,dirty),dirty[0]&2052&&transition_in(if_block1,1)):(if_block1=create_if_block_1$e(ctx2),if_block1.c(),transition_in(if_block1,1),if_block1.m(div2,null)):if_block1&&(group_outros(),transition_out(if_block1,1,1,()=>{if_block1=null}),check_outros()),(!current||dirty[0]&1024)&&toggle_class(div2,"present",ctx2[10]!==null),ctx2[10]!==null?if_block2?(if_block2.p(ctx2,dirty),dirty[0]&1024&&transition_in(if_block2,1)):(if_block2=create_if_block$t(ctx2),if_block2.c(),transition_in(if_block2,1),if_block2.m(div3,null)):if_block2&&(group_outros(),transition_out(if_block2,1,1,()=>{if_block2=null}),check_outros())},i(local){current||(transition_in(checkbox0.$$.fragment,local),transition_in(checkbox1.$$.fragment,local),transition_in(if_block0),transition_in(iconbutton0.$$.fragment,local),transition_in(iconbutton1.$$.fragment,local),transition_in(if_block1),transition_in(if_block2),current=!0)},o(local){transition_out(checkbox0.$$.fragment,local),transition_out(checkbox1.$$.fragment,local),transition_out(if_block0),transition_out(iconbutton0.$$.fragment,local),transition_out(iconbutton1.$$.fragment,local),transition_out(if_block1),transition_out(if_block2),current=!1},d(detaching){detaching&&detach(div3),destroy_component(checkbox0),destroy_component(checkbox1),if_block0&&if_block0.d(),destroy_component(iconbutton0),destroy_component(iconbutton1),if_block1&&if_block1.d(),if_block2&&if_block2.d(),mounted=!1,run_all(dispose)}}}__name(create_fragment$R,"create_fragment$R");const pageSize=200,click_handler_5=__name(e=>e.stopImmediatePropagation(),"click_handler_5");function instance$M($$self,$$props,$$invalidate){let $member,{feature}=$$props;const member=feature.memberStore;component_subscribe($$self,member,value=>$$invalidate(2,$member=value));let page=0,authorQuery="",titleQuery="",createdInPrivateLobbyQuery=!1,isOwnQuery=!1,createdBeforeQuery=new Date,createdAfterQuery=new Date(new Date().setFullYear(2020,9,1)),hiddenImages=[];const search=__name((login,resetPage=!1)=>(resetPage&&$$invalidate(1,page=0),feature.getImages({page,pageSize,authorQuery,titleQuery,isOwnQuery,createdInPrivateLobbyQuery,createdAfterQuery:createdAfterQuery!==""?new Date(createdAfterQuery).getTime().toString():void 0,createdBeforeQuery:createdBeforeQuery!==""?new Date(createdBeforeQuery).getTime().toString():void 0},login)),"search");let selectedImage=null,images=$member?search(Number($member.userLogin)):null;function input0_input_handler(){authorQuery=this.value,$$invalidate(3,authorQuery)}__name(input0_input_handler,"input0_input_handler");function input1_input_handler(){titleQuery=this.value,$$invalidate(4,titleQuery)}__name(input1_input_handler,"input1_input_handler");function input2_input_handler(){createdBeforeQuery=this.value,$$invalidate(7,createdBeforeQuery)}__name(input2_input_handler,"input2_input_handler");function input3_input_handler(){createdAfterQuery=this.value,$$invalidate(8,createdAfterQuery)}__name(input3_input_handler,"input3_input_handler");function checkbox0_checked_binding(value){createdInPrivateLobbyQuery=value,$$invalidate(5,createdInPrivateLobbyQuery)}__name(checkbox0_checked_binding,"checkbox0_checked_binding");function checkbox1_checked_binding(value){isOwnQuery=value,$$invalidate(6,isOwnQuery)}__name(checkbox1_checked_binding,"checkbox1_checked_binding");const click_handler_1=__name(()=>$$invalidate(11,images=search(Number($member==null?void 0:$member.userLogin),!0)),"click_handler_1"),click_handler_2=__name(()=>$$invalidate(1,page--,page),"click_handler_2"),click_handler_3=__name(()=>$$invalidate(1,page++,page),"click_handler_3"),click_handler_4=__name(image=>$$invalidate(10,selectedImage=image),"click_handler_4"),click_handler_6=__name(()=>$$invalidate(10,selectedImage=null),"click_handler_6"),click_handler_7=__name(async()=>{if($member==null||selectedImage===null)throw new Error("illegal state");await feature.saveAsPng(selectedImage)},"click_handler_7"),click_handler_8=__name(async()=>{if($member==null||selectedImage===null)throw new Error("illegal state");await feature.copyToClipboard(selectedImage)},"click_handler_8"),click_handler_9=__name(async()=>{if($member==null||selectedImage===null)throw new Error("illegal state");await feature.addToImagePost(selectedImage,$member)},"click_handler_9"),click_handler_10=__name(async()=>{if($member==null||selectedImage===null)throw new Error("illegal state");await feature.addToImageLab(selectedImage)},"click_handler_10"),click_handler_11=__name(async()=>{if($member==null||selectedImage===null)throw new Error("illegal state");await feature.deleteImage(selectedImage.id,Number($member.userLogin)),$$invalidate(9,hiddenImages=[...hiddenImages,selectedImage.id]),$$invalidate(10,selectedImage=null)},"click_handler_11");function click_handler2(event){bubble.call(this,$$self,event)}__name(click_handler2,"click_handler");const click_handler_12=__name(()=>$$invalidate(10,selectedImage=null),"click_handler_12");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},$$self.$$.update=()=>{$$self.$$.dirty[0]&6&&$$invalidate(11,images=$member?search(Number($member.userLogin)):null)},[feature,page,$member,authorQuery,titleQuery,createdInPrivateLobbyQuery,isOwnQuery,createdBeforeQuery,createdAfterQuery,hiddenImages,selectedImage,images,member,search,input0_input_handler,input1_input_handler,input2_input_handler,input3_input_handler,checkbox0_checked_binding,checkbox1_checked_binding,click_handler_1,click_handler_2,click_handler_3,click_handler_4,click_handler_6,click_handler_7,click_handler_8,click_handler_9,click_handler_10,click_handler_11,click_handler2,click_handler_12]}__name(instance$M,"instance$M");const _Controls_cloud=class _Controls_cloud extends SvelteComponent{constructor(options){super(),init(this,options,instance$M,create_fragment$R,safe_not_equal,{feature:0},null,[-1,-1])}};__name(_Controls_cloud,"Controls_cloud");let Controls_cloud=_Controls_cloud;var __defProp$M=Object.defineProperty,__decorateClass$M=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$M(target,key,result),result},"__decorateClass$M");const _ControlsCloudFeature=class _ControlsCloudFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elementsSetup");__publicField(this,"_modalService");__publicField(this,"_memberService");__publicField(this,"_cloudService");__publicField(this,"_imagePostService");__publicField(this,"_imageLabService");__publicField(this,"_toastService");__publicField(this,"_apiService");__publicField(this,"_imageFinishedService");__publicField(this,"name","Typo Cloud");__publicField(this,"description","Saves all images from your lobbies in a cloud and adds a gallery to browse them");__publicField(this,"featureId",17);__publicField(this,"_iconComponent");__publicField(this,"_iconClickSubscription");__publicField(this,"_cloudSavedSubscription")}async onActivate(){const elements2=await this._elementsSetup.complete();this._iconComponent=new Icon_button({target:elements2.controls,props:{hoverMove:!1,size:"48px",icon:"file-img-cloud-gif",name:"Typo Cloud",order:2,tooltipAction:this.createTooltip}}),this._cloudSavedSubscription=this._imageFinishedService.imageFinished$.pipe(withLatestFrom(this._memberService.member$)).subscribe(async([image,member])=>{if(image===null||member===null||member===void 0){this._logger.debug("Did not save image because either member or image not defined");return}await this._cloudService.uploadToCloud(image,member,!0)}),this._iconClickSubscription=this._iconComponent.click$.subscribe(()=>{const settingsComponent={componentType:Controls_cloud,props:{feature:this}};this._modalService.showModal(settingsComponent.componentType,settingsComponent.props,"Typo Cloud")})}onDestroy(){var _a81,_b,_c;(_a81=this._iconClickSubscription)==null||_a81.unsubscribe(),(_b=this._iconComponent)==null||_b.$destroy(),(_c=this._cloudSavedSubscription)==null||_c.unsubscribe()}get memberStore(){return fromObservable(this._memberService.member$,void 0)}async getImages(search,login){return search.authorQuery===""&&(search.authorQuery=void 0),search.titleQuery===""&&(search.titleQuery=void 0),search.createdInPrivateLobbyQuery===!1&&(search.createdInPrivateLobbyQuery=void 0),search.isOwnQuery===!1&&(search.isOwnQuery=void 0),this._apiService.getApi(CloudApi).searchUserCloud({login,cloudSearchDto:search})}async deleteImage(id2,login){const toast=await this._toastService.showLoadingToast("Removing image from cloud");try{const image=await this._apiService.getApi(CloudApi).deleteImageFromUserCloud({login,id:id2});return toast.resolve(),image}catch{toast.reject()}}async addToImagePost(image,member){const toast=await this._toastService.showLoadingToast("Adding image to history");try{const meta=await getCloudMeta(image.metaUrl),commands=await getCloudCommands(image.commandsUrl),imageData=await ImageData.fromImageUrl(image.imageUrl),skribblImage={name:image.name,artist:image.author,private:meta.private,isOwn:meta.own,language:meta.language,player:member.userName,date:new Date(meta.date),commands,image:imageData};this._imagePostService.addToHistory(skribblImage),toast.resolve()}catch{toast.reject()}}async saveAsPng(image){const toast=await this._toastService.showLoadingToast("Downloading image");try{const imageData=await ImageData.fromImageUrl(image.imageUrl);downloadBlob(imageData.blob,`skribbl-${image.name}-by-${image.author}.png`),toast.resolve()}catch(e){throw this._logger.error("Failed to download image",e),toast.reject(),e}}async copyToClipboard(image){const toast=await this._toastService.showLoadingToast("Copying image link");try{await navigator.clipboard.writeText(image.imageUrl),toast.resolve()}catch(e){throw this._logger.error("Failed to copy image link to clipboard",e),toast.reject(),e}}async addToImageLab(image){const toast=await this._toastService.showLoadingToast("Adding image to image lab");try{const commands=await getCloudCommands(image.commandsUrl);this._imageLabService.saveDrawCommands(`${image.name}-by-${image.author}`,commands),toast.resolve()}catch{toast.reject("Is the image lab feature enabled?")}}};__name(_ControlsCloudFeature,"ControlsCloudFeature");let ControlsCloudFeature=_ControlsCloudFeature;__decorateClass$M([inject(ElementsSetup)],ControlsCloudFeature.prototype,"_elementsSetup");__decorateClass$M([inject(ModalService)],ControlsCloudFeature.prototype,"_modalService");__decorateClass$M([inject(MemberService)],ControlsCloudFeature.prototype,"_memberService");__decorateClass$M([inject(CloudService)],ControlsCloudFeature.prototype,"_cloudService");__decorateClass$M([inject(ImagePostService)],ControlsCloudFeature.prototype,"_imagePostService");__decorateClass$M([inject(ImagelabService)],ControlsCloudFeature.prototype,"_imageLabService");__decorateClass$M([inject(ToastService)],ControlsCloudFeature.prototype,"_toastService");__decorateClass$M([inject(ApiService)],ControlsCloudFeature.prototype,"_apiService");__decorateClass$M([inject(ImageFinishedService)],ControlsCloudFeature.prototype,"_imageFinishedService");var __defProp$L=Object.defineProperty,__getOwnPropDesc$8=Object.getOwnPropertyDescriptor,__decorateClass$L=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$8(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$L(target,key,result),result},"__decorateClass$L"),__decorateParam$5=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$5"),_a71;let FeaturesService=(_a71=class{constructor(loggerFactory2){__publicField(this,"_logger");__publicField(this,"_features",[]);__publicField(this,"_featureStates",new Subject$1);this._logger=loggerFactory2(this)}async registerFeature(feature){if(this.features.some(f=>f.featureId===feature.featureId))throw this._logger.error("Attempted to register a feature with a duplicate ID",feature.name),new Error("Duplicate feature ID");this._features.push(feature),feature.activated$.subscribe(state=>this._featureStates.next({feature,running:state}))}get features(){return[...this._features]}},__name(_a71,"FeaturesService"),_a71);FeaturesService=__decorateClass$L([injectable(),__decorateParam$5(0,inject(loggerFactory))],FeaturesService);function create_if_block$s(ctx){let br,span;return{c(){br=element$1("br"),span=element$1("span"),span.textContent="Disabled in text inputs",attr(span,"class","inputs-disabled-hint svelte-10zlzgr")},m(target,anchor){insert(target,br,anchor),insert(target,span,anchor)},d(detaching){detaching&&(detach(br),detach(span))}}}__name(create_if_block$s,"create_if_block$s");function create_fragment$Q(ctx){let div5,h3,t0_value=ctx[0].name+"",t0,t1,div0,t2_value=ctx[0].description+"",t2,t3,t4,div1,flatbutton0,t5,div2,flatbutton1,t6,div3,checkbox,updating_checked,t7,div4,input,input_value_value,current,mounted,dispose,if_block=ctx[0].disabledOnInputs&&create_if_block$s();flatbutton0=new Flat_button({props:{content:"Reset to default",color:"orange"}}),flatbutton0.$on("click",ctx[9]),flatbutton1=new Flat_button({props:{content:"Save combo",color:"green"}}),flatbutton1.$on("click",ctx[10]);function checkbox_checked_binding(value){ctx[11](value)}__name(checkbox_checked_binding,"checkbox_checked_binding");let checkbox_props={disabled:ctx[2].length===0,description:ctx[5]?"Enabled":"Disabled"};return ctx[5]!==void 0&&(checkbox_props.checked=ctx[5]),checkbox=new Checkbox({props:checkbox_props}),binding_callbacks.push(()=>bind$1(checkbox,"checked",checkbox_checked_binding)),{c(){div5=element$1("div"),h3=element$1("h3"),t0=text(t0_value),t1=space(),div0=element$1("div"),t2=text(t2_value),t3=space(),if_block&&if_block.c(),t4=space(),div1=element$1("div"),create_component(flatbutton0.$$.fragment),t5=space(),div2=element$1("div"),create_component(flatbutton1.$$.fragment),t6=space(),div3=element$1("div"),create_component(checkbox.$$.fragment),t7=space(),div4=element$1("div"),input=element$1("input"),attr(div1,"class","button-container svelte-10zlzgr"),attr(div2,"class","button-container svelte-10zlzgr"),input.value=input_value_value=ctx[4].join(" + "),attr(input,"type","text"),attr(input,"placeholder","Press Keys"),set_style(div4,"grid-column","2 / span 3"),attr(div5,"class","typo-feature-settings-hotkey svelte-10zlzgr")},m(target,anchor){insert(target,div5,anchor),append(div5,h3),append(h3,t0),append(div5,t1),append(div5,div0),append(div0,t2),append(div0,t3),if_block&&if_block.m(div0,null),append(div5,t4),append(div5,div1),mount_component(flatbutton0,div1,null),append(div5,t5),append(div5,div2),mount_component(flatbutton1,div2,null),append(div5,t6),append(div5,div3),mount_component(checkbox,div3,null),append(div5,t7),append(div5,div4),append(div4,input),ctx[12](input),current=!0,mounted||(dispose=[listen(input,"click",ctx[13]),listen(input,"keydown",ctx[14])],mounted=!0)},p(ctx2,[dirty]){(!current||dirty&1)&&t0_value!==(t0_value=ctx2[0].name+"")&&set_data(t0,t0_value),(!current||dirty&1)&&t2_value!==(t2_value=ctx2[0].description+"")&&set_data(t2,t2_value),ctx2[0].disabledOnInputs?if_block||(if_block=create_if_block$s(),if_block.c(),if_block.m(div0,null)):if_block&&(if_block.d(1),if_block=null);const checkbox_changes={};dirty&4&&(checkbox_changes.disabled=ctx2[2].length===0),dirty&32&&(checkbox_changes.description=ctx2[5]?"Enabled":"Disabled"),!updating_checked&&dirty&32&&(updating_checked=!0,checkbox_changes.checked=ctx2[5],add_flush_callback(()=>updating_checked=!1)),checkbox.$set(checkbox_changes),(!current||dirty&16&&input_value_value!==(input_value_value=ctx2[4].join(" + "))&&input.value!==input_value_value)&&(input.value=input_value_value)},i(local){current||(transition_in(flatbutton0.$$.fragment,local),transition_in(flatbutton1.$$.fragment,local),transition_in(checkbox.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton0.$$.fragment,local),transition_out(flatbutton1.$$.fragment,local),transition_out(checkbox.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div5),if_block&&if_block.d(),destroy_component(flatbutton0),destroy_component(flatbutton1),destroy_component(checkbox),ctx[12](null),mounted=!1,run_all(dispose)}}}__name(create_fragment$Q,"create_fragment$Q");function instance$L($$self,$$props,$$invalidate){let $comboStore,$enabledStore,{hotkey}=$$props,{feature}=$$props;const enabledStore=hotkey.enabledSetting.store;component_subscribe($$self,enabledStore,value=>$$invalidate(5,$enabledStore=value));const comboStore=hotkey.comboSetting.store;component_subscribe($$self,comboStore,value=>$$invalidate(2,$comboStore=value));let recordingElement,recordedKeys;const getHotkeyComboHumanReadable=__name(async combo=>{var _a81;if((_a81=navigator==null?void 0:navigator.keyboard)!=null&&_a81.getLayoutMap){const layoutMap=await navigator.keyboard.getLayoutMap();return combo.map(key=>layoutMap.get(key)||key).join(" + ")}else return combo.join(" + ")},"getHotkeyComboHumanReadable"),click_handler2=__name(async()=>{const update=await feature.resetHotkeyCombo(hotkey);update&&($$invalidate(4,recordedKeys=update),$$invalidate(3,recordingElement.value=await getHotkeyComboHumanReadable(recordedKeys),recordingElement))},"click_handler"),click_handler_1=__name(()=>{feature.setHotkeyCombo(hotkey,recordedKeys),recordedKeys.length>0&&set_store_value(enabledStore,$enabledStore=!0,$enabledStore)},"click_handler_1");function checkbox_checked_binding(value){$enabledStore=value,enabledStore.set($enabledStore)}__name(checkbox_checked_binding,"checkbox_checked_binding");function input_binding($$value){binding_callbacks[$$value?"unshift":"push"](()=>{recordingElement=$$value,$$invalidate(3,recordingElement)})}__name(input_binding,"input_binding");const click_handler_2=__name(()=>{$$invalidate(4,recordedKeys=[]),$$invalidate(3,recordingElement.value="",recordingElement)},"click_handler_2"),keydown_handler=__name(async event=>{event.preventDefault(),recordedKeys.includes(event.code)?($$invalidate(4,recordedKeys=recordedKeys.filter(key=>key!==event.code)),$$invalidate(3,recordingElement.value=await getHotkeyComboHumanReadable(recordedKeys),recordingElement)):(recordedKeys.push(event.code),$$invalidate(3,recordingElement.value=await getHotkeyComboHumanReadable(recordedKeys),recordingElement))},"keydown_handler");return $$self.$$set=$$props2=>{"hotkey"in $$props2&&$$invalidate(0,hotkey=$$props2.hotkey),"feature"in $$props2&&$$invalidate(1,feature=$$props2.feature)},$$self.$$.update=()=>{$$self.$$.dirty&4&&$$invalidate(4,recordedKeys=[...$comboStore])},[hotkey,feature,$comboStore,recordingElement,recordedKeys,$enabledStore,enabledStore,comboStore,getHotkeyComboHumanReadable,click_handler2,click_handler_1,checkbox_checked_binding,input_binding,click_handler_2,keydown_handler]}__name(instance$L,"instance$L");const _Controls_settings_hotkey=class _Controls_settings_hotkey extends SvelteComponent{constructor(options){super(),init(this,options,instance$L,create_fragment$Q,safe_not_equal,{hotkey:0,feature:1})}};__name(_Controls_settings_hotkey,"Controls_settings_hotkey");let Controls_settings_hotkey=_Controls_settings_hotkey;function create_fragment$P(ctx){let div5,h3,t0_value=ctx[0].name+"",t0,t1,div0,t2_value=ctx[0].description+"",t2,t3,div1,flatbutton0,t4,div2,flatbutton1,t5,div3,checkbox,updating_checked,t6,div4,input,current,mounted,dispose;flatbutton0=new Flat_button({props:{content:"Reset name",color:"orange"}}),flatbutton0.$on("click",ctx[7]),flatbutton1=new Flat_button({props:{content:"Save name",color:"green"}}),flatbutton1.$on("click",ctx[8]);function checkbox_checked_binding(value){ctx[9](value)}__name(checkbox_checked_binding,"checkbox_checked_binding");let checkbox_props={description:ctx[3]?"Enabled":"Disabled"};return ctx[3]!==void 0&&(checkbox_props.checked=ctx[3]),checkbox=new Checkbox({props:checkbox_props}),binding_callbacks.push(()=>bind$1(checkbox,"checked",checkbox_checked_binding)),{c(){div5=element$1("div"),h3=element$1("h3"),t0=text(t0_value),t1=space(),div0=element$1("div"),t2=text(t2_value),t3=space(),div1=element$1("div"),create_component(flatbutton0.$$.fragment),t4=space(),div2=element$1("div"),create_component(flatbutton1.$$.fragment),t5=space(),div3=element$1("div"),create_component(checkbox.$$.fragment),t6=space(),div4=element$1("div"),input=element$1("input"),attr(div1,"class","button-container svelte-lvvgs4"),attr(div2,"class","button-container svelte-lvvgs4"),attr(input,"type","text"),attr(input,"placeholder","Enter command name"),set_style(div4,"grid-column","2 / span 3"),attr(div5,"class","typo-feature-settings-command svelte-lvvgs4")},m(target,anchor){insert(target,div5,anchor),append(div5,h3),append(h3,t0),append(div5,t1),append(div5,div0),append(div0,t2),append(div5,t3),append(div5,div1),mount_component(flatbutton0,div1,null),append(div5,t4),append(div5,div2),mount_component(flatbutton1,div2,null),append(div5,t5),append(div5,div3),mount_component(checkbox,div3,null),append(div5,t6),append(div5,div4),append(div4,input),set_input_value(input,ctx[2]),current=!0,mounted||(dispose=listen(input,"input",ctx[10]),mounted=!0)},p(ctx2,[dirty]){(!current||dirty&1)&&t0_value!==(t0_value=ctx2[0].name+"")&&set_data(t0,t0_value),(!current||dirty&1)&&t2_value!==(t2_value=ctx2[0].description+"")&&set_data(t2,t2_value);const checkbox_changes={};dirty&8&&(checkbox_changes.description=ctx2[3]?"Enabled":"Disabled"),!updating_checked&&dirty&8&&(updating_checked=!0,checkbox_changes.checked=ctx2[3],add_flush_callback(()=>updating_checked=!1)),checkbox.$set(checkbox_changes),dirty&4&&input.value!==ctx2[2]&&set_input_value(input,ctx2[2])},i(local){current||(transition_in(flatbutton0.$$.fragment,local),transition_in(flatbutton1.$$.fragment,local),transition_in(checkbox.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton0.$$.fragment,local),transition_out(flatbutton1.$$.fragment,local),transition_out(checkbox.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div5),destroy_component(flatbutton0),destroy_component(flatbutton1),destroy_component(checkbox),mounted=!1,dispose()}}}__name(create_fragment$P,"create_fragment$P");function instance$K($$self,$$props,$$invalidate){let $idStore,$enabledStore,{command}=$$props,{feature}=$$props;const enabledStore=command.enabledSetting.store;component_subscribe($$self,enabledStore,value=>$$invalidate(3,$enabledStore=value));const idStore=command.idSetting.store;component_subscribe($$self,idStore,value=>$$invalidate(1,$idStore=value));let idInput="";const click_handler2=__name(()=>{set_store_value(idStore,$idStore=command.defaultId,$idStore)},"click_handler"),click_handler_1=__name(()=>{set_store_value(idStore,$idStore=idInput.length===0?command.defaultId:idInput,$idStore)},"click_handler_1");function checkbox_checked_binding(value){$enabledStore=value,enabledStore.set($enabledStore)}__name(checkbox_checked_binding,"checkbox_checked_binding");function input_input_handler(){idInput=this.value,$$invalidate(2,idInput),$$invalidate(1,$idStore)}return __name(input_input_handler,"input_input_handler"),$$self.$$set=$$props2=>{"command"in $$props2&&$$invalidate(0,command=$$props2.command),"feature"in $$props2&&$$invalidate(6,feature=$$props2.feature)},$$self.$$.update=()=>{$$self.$$.dirty&2&&$$invalidate(2,idInput=$idStore)},[command,$idStore,idInput,$enabledStore,enabledStore,idStore,feature,click_handler2,click_handler_1,checkbox_checked_binding,input_input_handler]}__name(instance$K,"instance$K");const _Controls_settings_command=class _Controls_settings_command extends SvelteComponent{constructor(options){super(),init(this,options,instance$K,create_fragment$P,safe_not_equal,{command:0,feature:6})}};__name(_Controls_settings_command,"Controls_settings_command");let Controls_settings_command=_Controls_settings_command;function get_each_context$r(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[9]=list[i],child_ctx}__name(get_each_context$r,"get_each_context$r");function get_each_context_1$8(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[12]=list[i],child_ctx}__name(get_each_context_1$8,"get_each_context_1$8");function get_each_context_2$2(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[15]=list[i],child_ctx}__name(get_each_context_2$2,"get_each_context_2$2");function create_if_block_5$2(ctx){let div1,h2,t1,div0,switch_instance,current;const switch_instance_spread_levels=[ctx[4].props];var switch_value=ctx[4].componentType;function switch_props(ctx2,dirty){let switch_instance_props={};for(let i=0;i<switch_instance_spread_levels.length;i+=1)switch_instance_props=assign(switch_instance_props,switch_instance_spread_levels[i]);return dirty!==void 0&&dirty&16&&(switch_instance_props=assign(switch_instance_props,get_spread_update(switch_instance_spread_levels,[get_spread_object(ctx2[4].props)]))),{props:switch_instance_props}}return __name(switch_props,"switch_props"),switch_value&&(switch_instance=construct_svelte_component(switch_value,switch_props(ctx))),{c(){div1=element$1("div"),h2=element$1("h2"),h2.textContent="Feature Information",t1=space(),div0=element$1("div"),switch_instance&&create_component(switch_instance.$$.fragment),attr(h2,"class","svelte-1njssi3"),attr(div1,"class","typo-feature-settings-info svelte-1njssi3")},m(target,anchor){insert(target,div1,anchor),append(div1,h2),append(div1,t1),append(div1,div0),switch_instance&&mount_component(switch_instance,div0,null),current=!0},p(ctx2,dirty){if(dirty&16&&switch_value!==(switch_value=ctx2[4].componentType)){if(switch_instance){group_outros();const old_component=switch_instance;transition_out(old_component.$$.fragment,1,0,()=>{destroy_component(old_component,1)}),check_outros()}switch_value?(switch_instance=construct_svelte_component(switch_value,switch_props(ctx2,dirty)),create_component(switch_instance.$$.fragment),transition_in(switch_instance.$$.fragment,1),mount_component(switch_instance,div0,null)):switch_instance=null}else if(switch_value){const switch_instance_changes=dirty&16?get_spread_update(switch_instance_spread_levels,[get_spread_object(ctx2[4].props)]):{};switch_instance.$set(switch_instance_changes)}},i(local){current||(switch_instance&&transition_in(switch_instance.$$.fragment,local),current=!0)},o(local){switch_instance&&transition_out(switch_instance.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div1),switch_instance&&destroy_component(switch_instance)}}}__name(create_if_block_5$2,"create_if_block_5$2");function create_if_block_4$5(ctx){let div1,h2,t1,div0,current,each_value_2=ensure_array_like(ctx[1].settings),each_blocks=[];for(let i=0;i<each_value_2.length;i+=1)each_blocks[i]=create_each_block_2$2(get_each_context_2$2(ctx,each_value_2,i));const out=__name(i=>transition_out(each_blocks[i],1,1,()=>{each_blocks[i]=null}),"out");return{c(){div1=element$1("div"),h2=element$1("h2"),h2.textContent="Feature Settings",t1=space(),div0=element$1("div");for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();attr(h2,"class","svelte-1njssi3"),attr(div0,"class","typo-feature-settings-default-list svelte-1njssi3"),attr(div1,"class","typo-feature-settings-default svelte-1njssi3")},m(target,anchor){insert(target,div1,anchor),append(div1,h2),append(div1,t1),append(div1,div0);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div0,null);current=!0},p(ctx2,dirty){if(dirty&2){each_value_2=ensure_array_like(ctx2[1].settings);let i;for(i=0;i<each_value_2.length;i+=1){const child_ctx=get_each_context_2$2(ctx2,each_value_2,i);each_blocks[i]?(each_blocks[i].p(child_ctx,dirty),transition_in(each_blocks[i],1)):(each_blocks[i]=create_each_block_2$2(child_ctx),each_blocks[i].c(),transition_in(each_blocks[i],1),each_blocks[i].m(div0,null))}for(group_outros(),i=each_value_2.length;i<each_blocks.length;i+=1)out(i);check_outros()}},i(local){if(!current){for(let i=0;i<each_value_2.length;i+=1)transition_in(each_blocks[i]);current=!0}},o(local){each_blocks=each_blocks.filter(Boolean);for(let i=0;i<each_blocks.length;i+=1)transition_out(each_blocks[i]);current=!1},d(detaching){detaching&&detach(div1),destroy_each(each_blocks,detaching)}}}__name(create_if_block_4$5,"create_if_block_4$5");function create_each_block_2$2(ctx){let div,switch_instance,t,current;const switch_instance_spread_levels=[ctx[15].componentData.props];var switch_value=ctx[15].componentData.componentType;function switch_props(ctx2,dirty){let switch_instance_props={};for(let i=0;i<switch_instance_spread_levels.length;i+=1)switch_instance_props=assign(switch_instance_props,switch_instance_spread_levels[i]);return dirty!==void 0&&dirty&2&&(switch_instance_props=assign(switch_instance_props,get_spread_update(switch_instance_spread_levels,[get_spread_object(ctx2[15].componentData.props)]))),{props:switch_instance_props}}return __name(switch_props,"switch_props"),switch_value&&(switch_instance=construct_svelte_component(switch_value,switch_props(ctx))),{c(){div=element$1("div"),switch_instance&&create_component(switch_instance.$$.fragment),t=space(),attr(div,"class","typo-feature-settings-default-item svelte-1njssi3")},m(target,anchor){insert(target,div,anchor),switch_instance&&mount_component(switch_instance,div,null),append(div,t),current=!0},p(ctx2,dirty){if(dirty&2&&switch_value!==(switch_value=ctx2[15].componentData.componentType)){if(switch_instance){group_outros();const old_component=switch_instance;transition_out(old_component.$$.fragment,1,0,()=>{destroy_component(old_component,1)}),check_outros()}switch_value?(switch_instance=construct_svelte_component(switch_value,switch_props(ctx2,dirty)),create_component(switch_instance.$$.fragment),transition_in(switch_instance.$$.fragment,1),mount_component(switch_instance,div,t)):switch_instance=null}else if(switch_value){const switch_instance_changes=dirty&2?get_spread_update(switch_instance_spread_levels,[get_spread_object(ctx2[15].componentData.props)]):{};switch_instance.$set(switch_instance_changes)}},i(local){current||(switch_instance&&transition_in(switch_instance.$$.fragment,local),current=!0)},o(local){switch_instance&&transition_out(switch_instance.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div),switch_instance&&destroy_component(switch_instance)}}}__name(create_each_block_2$2,"create_each_block_2$2");function create_if_block_3$5(ctx){let div1,h2,t1,div0,switch_instance,current;const switch_instance_spread_levels=[ctx[3].props];var switch_value=ctx[3].componentType;function switch_props(ctx2,dirty){let switch_instance_props={};for(let i=0;i<switch_instance_spread_levels.length;i+=1)switch_instance_props=assign(switch_instance_props,switch_instance_spread_levels[i]);return dirty!==void 0&&dirty&8&&(switch_instance_props=assign(switch_instance_props,get_spread_update(switch_instance_spread_levels,[get_spread_object(ctx2[3].props)]))),{props:switch_instance_props}}return __name(switch_props,"switch_props"),switch_value&&(switch_instance=construct_svelte_component(switch_value,switch_props(ctx))),{c(){div1=element$1("div"),h2=element$1("h2"),h2.textContent="Feature Management",t1=space(),div0=element$1("div"),switch_instance&&create_component(switch_instance.$$.fragment),attr(h2,"class","svelte-1njssi3"),attr(div1,"class","typo-feature-settings-management svelte-1njssi3")},m(target,anchor){insert(target,div1,anchor),append(div1,h2),append(div1,t1),append(div1,div0),switch_instance&&mount_component(switch_instance,div0,null),current=!0},p(ctx2,dirty){if(dirty&8&&switch_value!==(switch_value=ctx2[3].componentType)){if(switch_instance){group_outros();const old_component=switch_instance;transition_out(old_component.$$.fragment,1,0,()=>{destroy_component(old_component,1)}),check_outros()}switch_value?(switch_instance=construct_svelte_component(switch_value,switch_props(ctx2,dirty)),create_component(switch_instance.$$.fragment),transition_in(switch_instance.$$.fragment,1),mount_component(switch_instance,div0,null)):switch_instance=null}else if(switch_value){const switch_instance_changes=dirty&8?get_spread_update(switch_instance_spread_levels,[get_spread_object(ctx2[3].props)]):{};switch_instance.$set(switch_instance_changes)}},i(local){current||(switch_instance&&transition_in(switch_instance.$$.fragment,local),current=!0)},o(local){switch_instance&&transition_out(switch_instance.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div1),switch_instance&&destroy_component(switch_instance)}}}__name(create_if_block_3$5,"create_if_block_3$5");function create_if_block_1$d(ctx){let div1,h2,t1,p,t5,t6,br2,t7,div0,current,if_block=!ctx[7]&&create_if_block_2$8(),each_value_1=ensure_array_like(ctx[5]),each_blocks=[];for(let i=0;i<each_value_1.length;i+=1)each_blocks[i]=create_each_block_1$8(get_each_context_1$8(ctx,each_value_1,i));const out=__name(i=>transition_out(each_blocks[i],1,1,()=>{each_blocks[i]=null}),"out");return{c(){div1=element$1("div"),h2=element$1("h2"),h2.textContent="Feature Hotkeys",t1=space(),p=element$1("p"),p.innerHTML=`Hotkeys are key combinations to quickly access feature functions. You can disable hotkeys that you don&#39;t need.<br/>
      Hotkeys with
      To change a hotkey, click in the input field and press the desired key combination. To remove a key from the combination, press it again.<br/>
      Empty combinations will be disabled automatically.`,t5=space(),if_block&&if_block.c(),t6=space(),br2=element$1("br"),t7=space(),div0=element$1("div");for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();attr(h2,"class","svelte-1njssi3"),attr(div0,"class","typo-feature-settings-hotkeys-list svelte-1njssi3"),attr(div1,"class","typo-feature-settings-hotkeys svelte-1njssi3")},m(target,anchor){insert(target,div1,anchor),append(div1,h2),append(div1,t1),append(div1,p),append(div1,t5),if_block&&if_block.m(div1,null),append(div1,t6),append(div1,br2),append(div1,t7),append(div1,div0);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div0,null);current=!0},p(ctx2,dirty){if(dirty&36){each_value_1=ensure_array_like(ctx2[5]);let i;for(i=0;i<each_value_1.length;i+=1){const child_ctx=get_each_context_1$8(ctx2,each_value_1,i);each_blocks[i]?(each_blocks[i].p(child_ctx,dirty),transition_in(each_blocks[i],1)):(each_blocks[i]=create_each_block_1$8(child_ctx),each_blocks[i].c(),transition_in(each_blocks[i],1),each_blocks[i].m(div0,null))}for(group_outros(),i=each_value_1.length;i<each_blocks.length;i+=1)out(i);check_outros()}},i(local){if(!current){for(let i=0;i<each_value_1.length;i+=1)transition_in(each_blocks[i]);current=!0}},o(local){each_blocks=each_blocks.filter(Boolean);for(let i=0;i<each_blocks.length;i+=1)transition_out(each_blocks[i]);current=!1},d(detaching){detaching&&detach(div1),if_block&&if_block.d(),destroy_each(each_blocks,detaching)}}}__name(create_if_block_1$d,"create_if_block_1$d");function create_if_block_2$8(ctx){let p;return{c(){p=element$1("p"),p.innerHTML=`Your browser does not support localized key names. Hotkeys will use US keyboard layout names.<br/>
        Switch to any Chrome-based browser to see the real key names.`},m(target,anchor){insert(target,p,anchor)},d(detaching){detaching&&detach(p)}}}__name(create_if_block_2$8,"create_if_block_2$8");function create_each_block_1$8(ctx){let controlssettingshotkey,current;return controlssettingshotkey=new Controls_settings_hotkey({props:{hotkey:ctx[12],feature:ctx[2]}}),{c(){create_component(controlssettingshotkey.$$.fragment)},m(target,anchor){mount_component(controlssettingshotkey,target,anchor),current=!0},p(ctx2,dirty){const controlssettingshotkey_changes={};dirty&32&&(controlssettingshotkey_changes.hotkey=ctx2[12]),dirty&4&&(controlssettingshotkey_changes.feature=ctx2[2]),controlssettingshotkey.$set(controlssettingshotkey_changes)},i(local){current||(transition_in(controlssettingshotkey.$$.fragment,local),current=!0)},o(local){transition_out(controlssettingshotkey.$$.fragment,local),current=!1},d(detaching){destroy_component(controlssettingshotkey,detaching)}}}__name(create_each_block_1$8,"create_each_block_1$8");function create_if_block$r(ctx){let div1,h2,t1,p,t5,br2,t6,div0,current,each_value=ensure_array_like(ctx[6]),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$r(get_each_context$r(ctx,each_value,i));const out=__name(i=>transition_out(each_blocks[i],1,1,()=>{each_blocks[i]=null}),"out");return{c(){div1=element$1("div"),h2=element$1("h2"),h2.textContent="Feature Commands",t1=space(),p=element$1("p"),p.innerHTML=`Commands are a quick way to execute actions of a feature from the chat.<br/>
      Here, you can toggle commands on or off and customize the command name.<br/>
      To use a command, type &quot;/&quot; and continue with the command name.`,t5=space(),br2=element$1("br"),t6=space(),div0=element$1("div");for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();attr(h2,"class","svelte-1njssi3"),attr(div0,"class","typo-feature-settings-commands-list svelte-1njssi3"),attr(div1,"class","typo-feature-settings-hotkeys svelte-1njssi3")},m(target,anchor){insert(target,div1,anchor),append(div1,h2),append(div1,t1),append(div1,p),append(div1,t5),append(div1,br2),append(div1,t6),append(div1,div0);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div0,null);current=!0},p(ctx2,dirty){if(dirty&68){each_value=ensure_array_like(ctx2[6]);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$r(ctx2,each_value,i);each_blocks[i]?(each_blocks[i].p(child_ctx,dirty),transition_in(each_blocks[i],1)):(each_blocks[i]=create_each_block$r(child_ctx),each_blocks[i].c(),transition_in(each_blocks[i],1),each_blocks[i].m(div0,null))}for(group_outros(),i=each_value.length;i<each_blocks.length;i+=1)out(i);check_outros()}},i(local){if(!current){for(let i=0;i<each_value.length;i+=1)transition_in(each_blocks[i]);current=!0}},o(local){each_blocks=each_blocks.filter(Boolean);for(let i=0;i<each_blocks.length;i+=1)transition_out(each_blocks[i]);current=!1},d(detaching){detaching&&detach(div1),destroy_each(each_blocks,detaching)}}}__name(create_if_block$r,"create_if_block$r");function create_each_block$r(ctx){let controlssettingscommand,current;return controlssettingscommand=new Controls_settings_command({props:{command:ctx[9],feature:ctx[2]}}),{c(){create_component(controlssettingscommand.$$.fragment)},m(target,anchor){mount_component(controlssettingscommand,target,anchor),current=!0},p(ctx2,dirty){const controlssettingscommand_changes={};dirty&64&&(controlssettingscommand_changes.command=ctx2[9]),dirty&4&&(controlssettingscommand_changes.feature=ctx2[2]),controlssettingscommand.$set(controlssettingscommand_changes)},i(local){current||(transition_in(controlssettingscommand.$$.fragment,local),current=!0)},o(local){transition_out(controlssettingscommand.$$.fragment,local),current=!1},d(detaching){destroy_component(controlssettingscommand,detaching)}}}__name(create_each_block$r,"create_each_block$r");function create_fragment$O(ctx){let div2,div0,t1,h1,t2_value=ctx[1].name+"",t2,t3,div1,t5,div3,t6_value=ctx[1].description+"",t6,t7,t8,t9,t10,t11,if_block4_anchor,current,mounted,dispose,if_block0=ctx[4]&&create_if_block_5$2(ctx),if_block1=ctx[1].settings.length>0&&create_if_block_4$5(ctx),if_block2=ctx[3]&&create_if_block_3$5(ctx),if_block3=ctx[5].length>0&&create_if_block_1$d(ctx),if_block4=ctx[6].length>0&&create_if_block$r(ctx);return{c(){div2=element$1("div"),div0=element$1("div"),div0.textContent="Feature Details",t1=space(),h1=element$1("h1"),t2=text(t2_value),t3=space(),div1=element$1("div"),div1.textContent="Back to Features ➜",t5=space(),div3=element$1("div"),t6=text(t6_value),t7=space(),if_block0&&if_block0.c(),t8=space(),if_block1&&if_block1.c(),t9=space(),if_block2&&if_block2.c(),t10=space(),if_block3&&if_block3.c(),t11=space(),if_block4&&if_block4.c(),if_block4_anchor=empty(),attr(div0,"class","typo-feature-settings-hero svelte-1njssi3"),attr(h1,"class","svelte-1njssi3"),attr(div1,"class","typo-feature-settings-back svelte-1njssi3"),attr(div2,"class","typo-feature-settings-title svelte-1njssi3"),attr(div3,"class","typo-feature-settings-summary svelte-1njssi3")},m(target,anchor){insert(target,div2,anchor),append(div2,div0),append(div2,t1),append(div2,h1),append(h1,t2),append(div2,t3),append(div2,div1),insert(target,t5,anchor),insert(target,div3,anchor),append(div3,t6),insert(target,t7,anchor),if_block0&&if_block0.m(target,anchor),insert(target,t8,anchor),if_block1&&if_block1.m(target,anchor),insert(target,t9,anchor),if_block2&&if_block2.m(target,anchor),insert(target,t10,anchor),if_block3&&if_block3.m(target,anchor),insert(target,t11,anchor),if_block4&&if_block4.m(target,anchor),insert(target,if_block4_anchor,anchor),current=!0,mounted||(dispose=listen(div1,"click",ctx[8]),mounted=!0)},p(ctx2,[dirty]){(!current||dirty&2)&&t2_value!==(t2_value=ctx2[1].name+"")&&set_data(t2,t2_value),(!current||dirty&2)&&t6_value!==(t6_value=ctx2[1].description+"")&&set_data(t6,t6_value),ctx2[4]?if_block0?(if_block0.p(ctx2,dirty),dirty&16&&transition_in(if_block0,1)):(if_block0=create_if_block_5$2(ctx2),if_block0.c(),transition_in(if_block0,1),if_block0.m(t8.parentNode,t8)):if_block0&&(group_outros(),transition_out(if_block0,1,1,()=>{if_block0=null}),check_outros()),ctx2[1].settings.length>0?if_block1?(if_block1.p(ctx2,dirty),dirty&2&&transition_in(if_block1,1)):(if_block1=create_if_block_4$5(ctx2),if_block1.c(),transition_in(if_block1,1),if_block1.m(t9.parentNode,t9)):if_block1&&(group_outros(),transition_out(if_block1,1,1,()=>{if_block1=null}),check_outros()),ctx2[3]?if_block2?(if_block2.p(ctx2,dirty),dirty&8&&transition_in(if_block2,1)):(if_block2=create_if_block_3$5(ctx2),if_block2.c(),transition_in(if_block2,1),if_block2.m(t10.parentNode,t10)):if_block2&&(group_outros(),transition_out(if_block2,1,1,()=>{if_block2=null}),check_outros()),ctx2[5].length>0?if_block3?(if_block3.p(ctx2,dirty),dirty&32&&transition_in(if_block3,1)):(if_block3=create_if_block_1$d(ctx2),if_block3.c(),transition_in(if_block3,1),if_block3.m(t11.parentNode,t11)):if_block3&&(group_outros(),transition_out(if_block3,1,1,()=>{if_block3=null}),check_outros()),ctx2[6].length>0?if_block4?(if_block4.p(ctx2,dirty),dirty&64&&transition_in(if_block4,1)):(if_block4=create_if_block$r(ctx2),if_block4.c(),transition_in(if_block4,1),if_block4.m(if_block4_anchor.parentNode,if_block4_anchor)):if_block4&&(group_outros(),transition_out(if_block4,1,1,()=>{if_block4=null}),check_outros())},i(local){current||(transition_in(if_block0),transition_in(if_block1),transition_in(if_block2),transition_in(if_block3),transition_in(if_block4),current=!0)},o(local){transition_out(if_block0),transition_out(if_block1),transition_out(if_block2),transition_out(if_block3),transition_out(if_block4),current=!1},d(detaching){detaching&&(detach(div2),detach(t5),detach(div3),detach(t7),detach(t8),detach(t9),detach(t10),detach(t11),detach(if_block4_anchor)),if_block0&&if_block0.d(detaching),if_block1&&if_block1.d(detaching),if_block2&&if_block2.d(detaching),if_block3&&if_block3.d(detaching),if_block4&&if_block4.d(detaching),mounted=!1,dispose()}}}__name(create_fragment$O,"create_fragment$O");function instance$J($$self,$$props,$$invalidate){var _a81;let{detailsClosed}=$$props,{feature}=$$props,{settingsFeature}=$$props,settingsComponent,infoComponent,featureHotkeys=[],featureCommands=[];const supportskeyboardLayout=((_a81=navigator==null?void 0:navigator.keyboard)==null?void 0:_a81.getLayoutMap)!==void 0,click_handler2=__name(()=>detailsClosed(),"click_handler");return $$self.$$set=$$props2=>{"detailsClosed"in $$props2&&$$invalidate(0,detailsClosed=$$props2.detailsClosed),"feature"in $$props2&&$$invalidate(1,feature=$$props2.feature),"settingsFeature"in $$props2&&$$invalidate(2,settingsFeature=$$props2.settingsFeature)},$$self.$$.update=()=>{$$self.$$.dirty&2&&($$invalidate(5,featureHotkeys=[...feature.hotkeys]),$$invalidate(6,featureCommands=[...feature.commands]),$$invalidate(3,settingsComponent=feature.featureManagementComponent),$$invalidate(4,infoComponent=feature.featureInfoComponent))},[detailsClosed,feature,settingsFeature,settingsComponent,infoComponent,featureHotkeys,featureCommands,supportskeyboardLayout,click_handler2]}__name(instance$J,"instance$J");const _Controls_settings_details=class _Controls_settings_details extends SvelteComponent{constructor(options){super(),init(this,options,instance$J,create_fragment$O,safe_not_equal,{detailsClosed:0,feature:1,settingsFeature:2})}};__name(_Controls_settings_details,"Controls_settings_details");let Controls_settings_details=_Controls_settings_details;function create_else_block$b(ctx){let div,t_value=ctx[0].description+"",t;return{c(){div=element$1("div"),t=text(t_value),attr(div,"class","description svelte-z48pgy")},m(target,anchor){insert(target,div,anchor),append(div,t)},p(ctx2,dirty){dirty&1&&t_value!==(t_value=ctx2[0].description+"")&&set_data(t,t_value)},d(detaching){detaching&&detach(div)}}}__name(create_else_block$b,"create_else_block$b");function create_if_block$q(ctx){let div,img,img_src_value,img_alt_value,t0,span,t1_value=ctx[0].description+"",t1,mounted,dispose;return{c(){div=element$1("div"),img=element$1("img"),t0=space(),span=element$1("span"),t1=text(t1_value),src_url_equal(img.src,img_src_value="")||attr(img,"src",img_src_value),attr(img,"alt",img_alt_value=ctx[4]?"enabled":"disabled"),set_style(img,"content","var(--file-img-wrench-gif)"),attr(img,"class","svelte-z48pgy"),attr(span,"class","svelte-z48pgy"),attr(div,"class","description svelte-z48pgy"),attr(div,"role","button")},m(target,anchor){insert(target,div,anchor),append(div,img),append(div,t0),append(div,span),append(span,t1),mounted||(dispose=listen(div,"click",ctx[8]),mounted=!0)},p(ctx2,dirty){dirty&16&&img_alt_value!==(img_alt_value=ctx2[4]?"enabled":"disabled")&&attr(img,"alt",img_alt_value),dirty&1&&t1_value!==(t1_value=ctx2[0].description+"")&&set_data(t1,t1_value)},d(detaching){detaching&&detach(div),mounted=!1,dispose()}}}__name(create_if_block$q,"create_if_block$q");function create_fragment$N(ctx){let div2,div0,img,img_src_value,img_alt_value,t0,span0,t1_value=ctx[0].name+"",t1,t2,span1,t3_value=ctx[4]?"enabled":"disabled",t3,t4,t5,div1,t6,t7_value=ctx[0].featureId+"",t7,mounted,dispose;function select_block_type(ctx2,dirty){return ctx2[0].hasDetailComponents?create_if_block$q:create_else_block$b}__name(select_block_type,"select_block_type");let current_block_type=select_block_type(ctx),if_block=current_block_type(ctx);return{c(){div2=element$1("div"),div0=element$1("div"),img=element$1("img"),t0=space(),span0=element$1("span"),t1=text(t1_value),t2=space(),span1=element$1("span"),t3=text(t3_value),t4=space(),if_block.c(),t5=space(),div1=element$1("div"),t6=text("#"),t7=text(t7_value),src_url_equal(img.src,img_src_value="")||attr(img,"src",img_src_value),attr(img,"alt",img_alt_value=ctx[4]?"enabled":"disabled"),set_style(img,"content","var(--"+(ctx[4]?"file-img-enabled-gif":"file-img-disabled-gif")+")"),attr(img,"class","svelte-z48pgy"),attr(span0,"class","svelte-z48pgy"),attr(span1,"class","svelte-z48pgy"),attr(div0,"class","name-toggle svelte-z48pgy"),attr(div0,"role","button"),attr(div0,"tabindex","0"),toggle_class(div0,"locked",!ctx[0].toggleEnabled),attr(div1,"class","feature-id svelte-z48pgy"),attr(div2,"class","typo-feature-item svelte-z48pgy"),toggle_class(div2,"devMode",ctx[1]),toggle_class(div2,"hidden",ctx[0].developerFeature&&!ctx[1])},m(target,anchor){insert(target,div2,anchor),append(div2,div0),append(div0,img),append(div0,t0),append(div0,span0),append(span0,t1),append(div0,t2),append(div0,span1),append(span1,t3),append(div2,t4),if_block.m(div2,null),append(div2,t5),append(div2,div1),append(div1,t6),append(div1,t7),mounted||(dispose=[listen(div0,"click",ctx[6]),listen(div0,"keypress",ctx[7])],mounted=!0)},p(ctx2,[dirty]){dirty&16&&img_alt_value!==(img_alt_value=ctx2[4]?"enabled":"disabled")&&attr(img,"alt",img_alt_value),dirty&16&&set_style(img,"content","var(--"+(ctx2[4]?"file-img-enabled-gif":"file-img-disabled-gif")+")"),dirty&1&&t1_value!==(t1_value=ctx2[0].name+"")&&set_data(t1,t1_value),dirty&16&&t3_value!==(t3_value=ctx2[4]?"enabled":"disabled")&&set_data(t3,t3_value),dirty&1&&toggle_class(div0,"locked",!ctx2[0].toggleEnabled),current_block_type===(current_block_type=select_block_type(ctx2))&&if_block?if_block.p(ctx2,dirty):(if_block.d(1),if_block=current_block_type(ctx2),if_block&&(if_block.c(),if_block.m(div2,t5))),dirty&1&&t7_value!==(t7_value=ctx2[0].featureId+"")&&set_data(t7,t7_value),dirty&2&&toggle_class(div2,"devMode",ctx2[1]),dirty&3&&toggle_class(div2,"hidden",ctx2[0].developerFeature&&!ctx2[1])},i:noop$1,o:noop$1,d(detaching){detaching&&detach(div2),if_block.d(),mounted=!1,run_all(dispose)}}}__name(create_fragment$N,"create_fragment$N");function instance$I($$self,$$props,$$invalidate){let $featureState,$$unsubscribe_featureState=noop$1,$$subscribe_featureState=__name(()=>($$unsubscribe_featureState(),$$unsubscribe_featureState=subscribe(featureState,$$value=>$$invalidate(4,$featureState=$$value)),featureState),"$$subscribe_featureState");$$self.$$.on_destroy.push(()=>$$unsubscribe_featureState());let{devmodeEnabled}=$$props,{feature}=$$props,{featureSettingsClicked}=$$props;const toggleFeature=__name(async feature2=>(feature2.toggleEnabled===!1||(await firstValueFrom(feature2.activated$)?await feature2.destroy():await feature2.activate()),feature2),"toggleFeature");let featureState;const click_handler2=__name(async()=>$$invalidate(0,feature=await toggleFeature(feature)),"click_handler"),keypress_handler=__name(async key=>{key.key==="Enter"&&$$invalidate(0,feature=await toggleFeature(feature))},"keypress_handler"),click_handler_1=__name(()=>featureSettingsClicked(),"click_handler_1");return $$self.$$set=$$props2=>{"devmodeEnabled"in $$props2&&$$invalidate(1,devmodeEnabled=$$props2.devmodeEnabled),"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature),"featureSettingsClicked"in $$props2&&$$invalidate(2,featureSettingsClicked=$$props2.featureSettingsClicked)},$$self.$$.update=()=>{$$self.$$.dirty&1&&$$subscribe_featureState($$invalidate(3,featureState=fromObservable(feature.activated$,!1)))},[feature,devmodeEnabled,featureSettingsClicked,featureState,$featureState,toggleFeature,click_handler2,keypress_handler,click_handler_1]}__name(instance$I,"instance$I");const _Controls_settings_feature=class _Controls_settings_feature extends SvelteComponent{constructor(options){super(),init(this,options,instance$I,create_fragment$N,safe_not_equal,{devmodeEnabled:1,feature:0,featureSettingsClicked:2})}};__name(_Controls_settings_feature,"Controls_settings_feature");let Controls_settings_feature=_Controls_settings_feature;function get_each_context$q(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[7]=list[i],child_ctx}__name(get_each_context$q,"get_each_context$q");function create_each_block$q(ctx){let controlssettingsfeatureitem,current;function func2(){return ctx[4](ctx[7])}return __name(func2,"func"),controlssettingsfeatureitem=new Controls_settings_feature({props:{feature:ctx[7],devmodeEnabled:ctx[2],featureSettingsClicked:func2}}),{c(){create_component(controlssettingsfeatureitem.$$.fragment)},m(target,anchor){mount_component(controlssettingsfeatureitem,target,anchor),current=!0},p(new_ctx,dirty){ctx=new_ctx;const controlssettingsfeatureitem_changes={};dirty&1&&(controlssettingsfeatureitem_changes.feature=ctx[7]),dirty&4&&(controlssettingsfeatureitem_changes.devmodeEnabled=ctx[2]),dirty&3&&(controlssettingsfeatureitem_changes.featureSettingsClicked=func2),controlssettingsfeatureitem.$set(controlssettingsfeatureitem_changes)},i(local){current||(transition_in(controlssettingsfeatureitem.$$.fragment,local),current=!0)},o(local){transition_out(controlssettingsfeatureitem.$$.fragment,local),current=!1},d(detaching){destroy_component(controlssettingsfeatureitem,detaching)}}}__name(create_each_block$q,"create_each_block$q");function create_if_block$p(ctx){let controlssettingsdetails,current;return controlssettingsdetails=new Controls_settings_details({props:{feature:ctx[1],detailsClosed:ctx[5],settingsFeature:ctx[0]}}),{c(){create_component(controlssettingsdetails.$$.fragment)},m(target,anchor){mount_component(controlssettingsdetails,target,anchor),current=!0},p(ctx2,dirty){const controlssettingsdetails_changes={};dirty&2&&(controlssettingsdetails_changes.feature=ctx2[1]),dirty&2&&(controlssettingsdetails_changes.detailsClosed=ctx2[5]),dirty&1&&(controlssettingsdetails_changes.settingsFeature=ctx2[0]),controlssettingsdetails.$set(controlssettingsdetails_changes)},i(local){current||(transition_in(controlssettingsdetails.$$.fragment,local),current=!0)},o(local){transition_out(controlssettingsdetails.$$.fragment,local),current=!1},d(detaching){destroy_component(controlssettingsdetails,detaching)}}}__name(create_if_block$p,"create_if_block$p");function create_fragment$M(ctx){let div4,div2,div0,t3,div1,t4,div3,current,each_value=ensure_array_like(ctx[0].features),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$q(get_each_context$q(ctx,each_value,i));const out=__name(i=>transition_out(each_blocks[i],1,1,()=>{each_blocks[i]=null}),"out");let if_block=ctx[1]&&create_if_block$p(ctx);return{c(){div4=element$1("div"),div2=element$1("div"),div0=element$1("div"),div0.innerHTML=`All features of skribbltypo can be managed here.<br/>
      You can click on a feature name to toggle it. To open feature settings, click the settings icon.<br/>
      If you are unsure how a feature works, you can have a look at the typo website or join the typo discord server and get help there!`,t3=space(),div1=element$1("div");for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();t4=space(),div3=element$1("div"),if_block&&if_block.c(),attr(div0,"class","typo-features-info svelte-1j1alrb"),attr(div1,"class","typo-features-list color-scrollbar svelte-1j1alrb"),attr(div2,"class","typo-features svelte-1j1alrb"),toggle_class(div2,"settingsVisible",ctx[1]!==void 0),attr(div3,"class","typo-feature-settings color-scrollbar svelte-1j1alrb"),toggle_class(div3,"settingsVisible",ctx[1]!==void 0),attr(div4,"class","typo-features-container svelte-1j1alrb")},m(target,anchor){insert(target,div4,anchor),append(div4,div2),append(div2,div0),append(div2,t3),append(div2,div1);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div1,null);append(div4,t4),append(div4,div3),if_block&&if_block.m(div3,null),current=!0},p(ctx2,[dirty]){if(dirty&7){each_value=ensure_array_like(ctx2[0].features);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$q(ctx2,each_value,i);each_blocks[i]?(each_blocks[i].p(child_ctx,dirty),transition_in(each_blocks[i],1)):(each_blocks[i]=create_each_block$q(child_ctx),each_blocks[i].c(),transition_in(each_blocks[i],1),each_blocks[i].m(div1,null))}for(group_outros(),i=each_value.length;i<each_blocks.length;i+=1)out(i);check_outros()}(!current||dirty&2)&&toggle_class(div2,"settingsVisible",ctx2[1]!==void 0),ctx2[1]?if_block?(if_block.p(ctx2,dirty),dirty&2&&transition_in(if_block,1)):(if_block=create_if_block$p(ctx2),if_block.c(),transition_in(if_block,1),if_block.m(div3,null)):if_block&&(group_outros(),transition_out(if_block,1,1,()=>{if_block=null}),check_outros()),(!current||dirty&2)&&toggle_class(div3,"settingsVisible",ctx2[1]!==void 0)},i(local){if(!current){for(let i=0;i<each_value.length;i+=1)transition_in(each_blocks[i]);transition_in(if_block),current=!0}},o(local){each_blocks=each_blocks.filter(Boolean);for(let i=0;i<each_blocks.length;i+=1)transition_out(each_blocks[i]);transition_out(if_block),current=!1},d(detaching){detaching&&detach(div4),destroy_each(each_blocks,detaching),if_block&&if_block.d()}}}__name(create_fragment$M,"create_fragment$M");function instance$H($$self,$$props,$$invalidate){let $devMode,{feature}=$$props;const devMode=feature.devModeStore;component_subscribe($$self,devMode,value=>$$invalidate(2,$devMode=value));let selectedDetailsFeature;const func2=__name(feat=>$$invalidate(1,selectedDetailsFeature=feat),"func"),func_1=__name(()=>$$invalidate(1,selectedDetailsFeature=void 0),"func_1");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},[feature,selectedDetailsFeature,$devMode,devMode,func2,func_1]}__name(instance$H,"instance$H");const _Controls_settings=class _Controls_settings extends SvelteComponent{constructor(options){super(),init(this,options,instance$H,create_fragment$M,safe_not_equal,{feature:0})}};__name(_Controls_settings,"Controls_settings");let Controls_settings=_Controls_settings;var __defProp$K=Object.defineProperty,__decorateClass$K=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$K(target,key,result),result},"__decorateClass$K");const _ControlsSettingsFeature=class _ControlsSettingsFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elementsSetup");__publicField(this,"_modalService");__publicField(this,"_toastService");__publicField(this,"_featuresService");__publicField(this,"_settingsService");__publicField(this,"name","Typo Settings");__publicField(this,"description","Manage the features of typo");__publicField(this,"toggleEnabled",!1);__publicField(this,"featureId",1);__publicField(this,"_iconComponent");__publicField(this,"_iconClickSubscription")}async onActivate(){const elements2=await this._elementsSetup.complete();this._iconComponent=new Icon_button({target:elements2.controls,props:{hoverMove:!1,size:"48px",icon:"file-img-wrench-gif",name:"Typo Settings",order:1,tooltipAction:this.createTooltip}}),this._iconClickSubscription=this._iconComponent.click$.subscribe(()=>{const settingsComponent={componentType:Controls_settings,props:{feature:this}};this._modalService.showModal(settingsComponent.componentType,settingsComponent.props,"Typo Settings")})}postConstruct(){this.useSetting(this._settingsService.settings.devMode),this.useSetting(this._settingsService.settings.controlsPosition),this.useSetting(this._settingsService.settings.controlsDirection)}onDestroy(){var _a81,_b;(_a81=this._iconClickSubscription)==null||_a81.unsubscribe(),(_b=this._iconComponent)==null||_b.$destroy()}get features(){return this._featuresService.features}get devModeStore(){return fromObservable(this._settingsService.settings.devMode.changes$,!1)}async setHotkeyCombo(hotkey,value){const toast=await this._toastService.showLoadingToast(`Updating hotkey ${hotkey.name} to ${value.join(" + ")}`);try{await this._hotkeysService.setHotkeyCombo(hotkey,value)}catch{toast.reject();return}toast.resolve()}async resetHotkeyCombo(hotkey){var _a81;const toast=await this._toastService.showLoadingToast(`Resetting hotkey ${hotkey.name} to default ${((_a81=hotkey.defaultCombo)==null?void 0:_a81.join(" + "))??"(disabled)"}`);let newCombo;try{newCombo=await this._hotkeysService.resetHotkeyCombo(hotkey)}catch{toast.reject();return}return toast.resolve(),newCombo}};__name(_ControlsSettingsFeature,"ControlsSettingsFeature");let ControlsSettingsFeature=_ControlsSettingsFeature;__decorateClass$K([inject(ElementsSetup)],ControlsSettingsFeature.prototype,"_elementsSetup");__decorateClass$K([inject(ModalService)],ControlsSettingsFeature.prototype,"_modalService");__decorateClass$K([inject(ToastService)],ControlsSettingsFeature.prototype,"_toastService");__decorateClass$K([inject(FeaturesService)],ControlsSettingsFeature.prototype,"_featuresService");__decorateClass$K([inject(GlobalSettingsService)],ControlsSettingsFeature.prototype,"_settingsService");const themeColors=Object.freeze({"--COLOR_PANEL_BG":[226,85,32,.75],"--COLOR_PANEL_LO":[226,90,27,.75],"--COLOR_PANEL_BUTTON":[226,67,49],"--COLOR_PANEL_BUTTON_HOVER":[226,73,43],"--COLOR_PANEL_BUTTON_ACTIVE":[226,72,41],"--COLOR_PANEL_HI":[226,80,44],"--COLOR_PANEL_FOCUS":[32,85,56],"--COLOR_PANEL_BORDER":[232,85,11],"--COLOR_PANEL_BORDER_FOCUS":[207,98,66],"--COLOR_PANEL_TEXT":[0,0,94],"--COLOR_PANEL_TEXT_FOCUS":[0,0,100],"--COLOR_PANEL_TEXT_PLACEHOLDER":[0,0,61],"--COLOR_TOOL_BASE":[0,0,100],"--COLOR_TOOL_HOVER":[0,0,77],"--COLOR_TOOL_TEXT":[0,0,0],"--COLOR_TOOL_SIZE_BASE":[0,0,100],"--COLOR_TOOL_SIZE_HOVER":[0,0,77],"--COLOR_TOOL_ACTIVE":[271,77,66],"--COLOR_TOOL_SIZE_ACTIVE":[271,77,66],"--COLOR_INPUT_BG":[0,0,100],"--COLOR_INPUT_HOVER":[0,0,100],"--COLOR_INPUT_TEXT":[0,0,17],"--COLOR_INPUT_BORDER":[0,0,44],"--COLOR_INPUT_BORDER_FOCUS":[207,98,66],"--COLOR_PLAYER_TEXT_BASE":[0,0,0],"--COLOR_PLAYER_ME":[214,100,64],"--COLOR_PLAYER_ME_GUESSED":[216,100,35],"--COLOR_PLAYER_BG_BASE":[0,0,100],"--COLOR_PLAYER_BG_ALT":[0,0,93],"--COLOR_PLAYER_BG_GUESSED_BASE":[113,68,58],"--COLOR_PLAYER_BG_GUESSED_ALT":[113,57,50],"--COLOR_TOOL_TIP_BG":[226,100,64],"--COLOR_GAMEBAR_TEXT":[0,0,0],"--COLOR_GAMEBAR_ROUND_TEXT":[0,0,0],"--COLOR_GAMEBAR_WORD_DESCRIPTION":[0,0,21],"--COLOR_TEXT_CANVAS_TRANSPARENT":[0,0,25],"--COLOR_CHAT_TEXT_BASE":[0,0,0],"--COLOR_CHAT_TEXT_GUESSED":[103,68,48],"--COLOR_CHAT_TEXT_CLOSE":[54,100,44],"--COLOR_CHAT_TEXT_DRAWING":[216,60,52],"--COLOR_CHAT_TEXT_JOIN":[103,68,48],"--COLOR_CHAT_TEXT_LEAVE":[21,91,42],"--COLOR_CHAT_TEXT_OWNER":[32,100,63],"--COLOR_CHAT_TEXT_GUESSCHAT":[86,47,46],"--COLOR_CHAT_BG_BASE":[0,0,100],"--COLOR_CHAT_BG_ALT":[0,0,93],"--COLOR_CHAT_SCROLLBAR":[0,0,49],"--COLOR_CHAT_SCROLLBAR_THUMB":[0,0,78],"--COLOR_CHAT_BG_GUESSED_BASE":[105,100,94],"--COLOR_CHAT_BG_GUESSED_ALT":[104,100,87],"--COLOR_CHAT_INPUT_COUNT":[0,0,0],"--COLOR_BUTTON_DANGER_BG":[44,81,51],"--COLOR_BUTTON_SUBMIT_BG":[110,75,55],"--COLOR_BUTTON_NORMAL_BG":[208,80,54],"--COLOR_BUTTON_DANGER_TEXT":[0,0,100],"--COLOR_BUTTON_SUBMIT_TEXT":[0,0,100],"--COLOR_BUTTON_NORMAL_TEXT":[0,0,100]}),createEmptyTheme=__name((author,name,id2)=>{const date=new Date;return{meta:{author,created:date.getTime(),id:id2===void 0?date.getTime():id2,name:name??`Untitled Theme ${date.getTime()}`,type:"theme"},colors:structuredClone(themeColors),hooks:{},images:{},misc:{}}},"createEmptyTheme");function convertOldTheme(options,theme){theme.images.urlLogo=options.urlLogo,theme.images.urlBackground=options.urlBackground,theme.images.urlBackgroundGame=options.urlBackgroundGame,theme.misc.fontStyle=options.fontStyle,theme.misc.htmlText=options.injection;let css="";if(options.containerBackgroundsCheck==!0){const val=options.containerBackgrounds?options.containerBackgrounds.trim():"";css+=":root {--COLOR_PANEL_BUTTON: "+(val!=""?val:"transparent")+" !important}",css+="#setting-bar .content, #emojiPrev, #imageAgent, #home .news ::-webkit-scrollbar, #home .news ::-webkit-scrollbar-thumb, .modalContainer, .toast, #modal .box, #home .panel, #home .bottom .footer {background-color: "+(val!=""?val:"transparent")+" !important}",css+="#home .bottom svg {fill: "+(val!=""?val:"transparent")+" !important}"}if(options.containerBackgroundsCheck==!0&&options.ingameContainerBackgroundsCheck!==!1&&(options.ingameContainerBackgrounds=options.containerBackgrounds,options.ingameContainerBackgroundsCheck=!0),options.ingameContainerBackgroundsCheck==!0){const val=options.ingameContainerBackgrounds?options.ingameContainerBackgrounds.trim():"";css+="#game-bar, .clickable,  #game-room .settings, #game-room .players,   .tooltip .tooltip-content, #imageAgent, #gamemodePopup, #optionsPopup, #downloadPopup, #sharePopup, #typoUserInfo, #imageOptions, div#game-toolbar.typomod div.tools-container div.tools div.tool, #game-toolbar divdiv.preview div.graphic-container, #game-room .container-settings, #game-chat .container, #game-players .players-list .player, #game-players .players-list .player.odd {background-color: "+(val!=""?val:"transparent")+" !important}",css+="#game-players .players-list .player.odd{background-image: linear-gradient(0, "+(val!=""?val:"transparent")+", "+(val!=""?val:"transparent")+");}",css+="#game-chat .chat-content {background:none}",css+=":root{ --COLOR_TOOL_TIP_BG: "+val+" !important; --COLOR_CHAT_BG_BASE: "+val+" !important; } ",css+="#game-players div.list div.player div.bubble div.arrow{border-right-color:"+val+"} #game-players div.list div.player div.bubble div.content{background-color:"+val+"}",css+="#game-chat .chat-content p:nth-child(even), #game-chat .chat-content p.guessed:nth-child(even) {background-color: #ffffff20;} #game-chat .chat-content p.guessed:nth-child(odd){background-color:transparent}"}if(options.containerOutlinesCheck==!0){const val=options.containerOutlines?options.containerOutlines.trim():"";css+="#game-bar,  #game-room .settings, #game-room .players,   #imageAgent, #modal .box, #home .panel, .modalContainer, #game-chat, #game-players .players-list .player, #imageOptions {border-radius: 4px; border: 2px solid "+(val!=""?val:"transparent")+" !important}"}options.containerImages&&options.containerImages.trim()!=""&&(css+="#game-bar, #game-room .settings, #game-room .players,  #imageAgent, #gamemodePopup, #optionsPopup, #downloadPopup, #sharePopup, #typoUserInfo, #imageOptions, #game-room .container-settings, #game-chat, #game-players .players-list  {background-image: url("+options.containerImages.trim()+") !important}",css+="#game-players .players-list {background:none !important}");const color=options.fontColor?options.fontColor:"";color&&color!=""&&(css+="#home .bottom .footer .notice, *:not(.chat-content *), .characters {color:"+color.trim()+" !important}",css+="input[type=checkbox].flatUI, #game-chat form input, input[type=text].flatUI, #home .bottom .footer .section-container .section{color:unset}"),!options.ingameFontColor&&options.fontColor&&(options.ingameFontColor=options.fontColor);const ingamecolor=options.ingameFontColor?options.ingameFontColor:"";ingamecolor&&ingamecolor!=""&&(css+=":root{ --COLOR_CHAT_TEXT_BASE:"+ingamecolor.trim()+" !important}",css+="#game *:not(.chat-content *) {color:"+ingamecolor.trim()+"}",css+="div#game-toolbar.typomod div.tools-container div.tools div.tool div.key, #game-word .description, #game-round .round-max, #game-round span, #game-players .player-amount b:nth-child(4), #game-players .player-amount span {color:"+ingamecolor.trim()+"; filter: brightness(0.8);}");const colorBtns=options.fontColorButtons?options.fontColorButtons:"";if(colorBtns&&colorBtns!=""&&(css+="select, input, button, textarea {color:"+colorBtns.trim()+"}"),(ingamecolor||color||colorBtns)&&(css+="#game-clock{color:black !important}"),options.inputBackgroundsCheck==!0){const val=options.inputBackgrounds?options.inputBackgrounds.trim():"";css+="input[type=checkbox], input[type=checkbox].flatUI,#modal .container .box .content .container-rooms .room, button.flatUI.green,button.flatUI.orange, button.flatUI.blue, button.flatUI, input[type=text].flatUI, .link .input-container .link-overlay, input, textarea, button, select, #quickreact > span {background: "+(val!=""?val:"transparent")+" !important; box-shadow:none !important;} ",css+="button:is(.flatUI, .flatUI.green, .flatUI.orange, .flatUI.blue):is(:hover, :active, :focus), input:is(:hover, :active, :focus), textarea:is(:hover, :active, :focus), button:is(:hover, :active, :focus), select:is(:hover, :active, :focus) {background: "+(val!=""?val:"transparent")+" !important; opacity: 0.75}",css+=":is(#game-room .container-settings .group.customwords .checkbox, .report-menu) input[type=checkbox]:checked:after { content: '🞬'; height:100%; width: 100%; display: grid; place-content: center;}"}if(options.inputOutlinesCheck==!0){const val=options.inputOutlines?options.inputOutlines.trim():"";css+=".link .input-container .link-overlay {display:none !important} input[type=checkbox]{border:none !important;} input, textarea, button, select {border: 2px solid "+(val!=""?val:"transparent")+" !important; }"}options.hideFooter==!0&&(css+=".tos, .notice {display:none}"),options.hideTypoInfo==!0&&(css+="#typoUserInfo {display:none !important}"),options.hideDiscord==!0&&(css+="#home .socials {opacity:0}"),options.hideInGameLogo==!0&&(css+="#game #game-logo{display:none} #game{margin-top:2em}"),options.hideAvatarLogo==!0&&(css+="#home .logo-big .avatar-container {display:none }"),options.hideTypoPanels==!0&&(css+="#panelgrid .panel:is(:first-child, :last-child) {display:none } #panelgrid{grid-template-columns: 100% !important}"),options.hideAvatarSprites==!0&&(css+=".avatar-customizer .spriteSlot{display:none }",css+=".avatar-customizer {background-image: unset !important }",css+=".avatar-customizer .color, .avatar-customizer .mouth, .avatar-customizer .eyes {opacity: 1 !important}"),theme.misc.cssText=css}__name(convertOldTheme,"convertOldTheme");var __defProp$J=Object.defineProperty,__getOwnPropDesc$7=Object.getOwnPropertyDescriptor,__decorateClass$J=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$7(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$J(target,key,result),result},"__decorateClass$J"),__decorateParam$4=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$4"),_a72;let ThemesService=(_a72=class{constructor(loggerFactory2,_elementsSetup,_apiService){__publicField(this,"_logger");__publicField(this,"_originalTheme",createEmptyTheme("Mel","Original Skribbl",0));__publicField(this,"_activeThemeSetting",new ExtensionSetting("active_theme_local_id",void 0));__publicField(this,"_savedThemesSetting",new ExtensionSetting("saved_themes",[{theme:this._originalTheme,savedAt:Date.now(),enableManage:!1}]));__publicField(this,"_loadedEditorTheme$",new BehaviorSubject(void 0));this._elementsSetup=_elementsSetup,this._apiService=_apiService,this._logger=loggerFactory2(this)}get activeThemeSetting(){return this._activeThemeSetting.asFrozen}get savedThemesSetting(){return this._savedThemesSetting.asFrozen}get loadedEditorTheme$(){return this._loadedEditorTheme$.asObservable()}get loadedEditorThemeStore(){return fromObservable(this._loadedEditorTheme$,this._loadedEditorTheme$.value)}async loadThemeToEditor(theme){if(this._logger.info("Loading theme to editor",theme),(await this._savedThemesSetting.getValue()).find(t=>t.theme.meta.id===theme.theme.meta.id)===void 0)throw this._logger.error("Theme not found",theme),new Error("Theme not found");this._loadedEditorTheme$.next(structuredClone(theme))}updateLoadedEditorTheme(theme){var _a81;if(this._logger.debug("Updating loaded theme",theme),((_a81=this._loadedEditorTheme$.value)==null?void 0:_a81.theme.meta.id)!==theme.theme.meta.id)throw this._logger.error("Theme not loaded or different theme loaded",theme),new Error("Theme not loaded or different theme loaded");this._loadedEditorTheme$.next(structuredClone(theme))}async unloadThemeFromEditor(){this._logger.info("Unloading theme from editor"),this._loadedEditorTheme$.next(void 0)}async createLocalTheme(){this._logger.info("Creating new theme");const elements2=await this._elementsSetup.complete(),username=elements2.inputName.value.length>0?elements2.inputName.value:"User",theme=createEmptyTheme(username,"Untitled Theme"),themes=await this._savedThemesSetting.getValue(),newTheme={theme,savedAt:Date.now(),enableManage:!0};return await this._savedThemesSetting.setValue([newTheme,...themes]),newTheme}async saveLoadedEditorTheme(){this._logger.info("Updating local theme and unloading from editor");const editorTheme=this._loadedEditorTheme$.value,themes=await this._savedThemesSetting.getValue(),savedTheme=themes.find(t=>t.theme.meta.id===(editorTheme==null?void 0:editorTheme.theme.meta.id));if(editorTheme===void 0||savedTheme===void 0)throw this._logger.error("Theme to update not found",editorTheme),new Error("Theme to update not found");return savedTheme.theme=editorTheme.theme,savedTheme.savedAt=Date.now(),await this._savedThemesSetting.setValue([savedTheme,...themes.filter(t=>t.theme.meta.id!==savedTheme.theme.meta.id)]),this._loadedEditorTheme$.next(void 0),await this._activeThemeSetting.setValue(savedTheme.theme.meta.id),savedTheme}async importOldTheme(options,name){this._logger.info("Importing old theme",options);const theme=createEmptyTheme("Unknown",name);convertOldTheme(options,theme);const themes=await this._savedThemesSetting.getValue();themes.find(t=>t.theme.meta.id===theme.meta.id)!==void 0&&(this._logger.warn("Theme already exists, assigning new ID",theme),theme.meta.id=Date.now());const savedTheme={theme,savedAt:Date.now(),publicTheme:void 0,enableManage:!0};return await this._savedThemesSetting.setValue([savedTheme,...themes]),savedTheme}async savePublicTheme(theme){this._logger.info("Saving public theme",theme);const themeData=await this._apiService.getApi(ThemesApi).useThemeById({id:theme.id}),saveData={theme:themeData,savedAt:Date.now(),publicTheme:{publicId:theme.id,localVersion:theme.version},enableManage:!1};let currentThemes=await this._savedThemesSetting.getValue();const existingTheme=currentThemes.find(t=>t.theme.meta.id===themeData.meta.id);return existingTheme!==void 0?(this._logger.warn("Theme already saved",theme),existingTheme):(currentThemes=[saveData,...currentThemes],await this._savedThemesSetting.setValue(currentThemes),saveData)}async activateLocalTheme(id2){this._logger.info("Activating local theme",id2);const existingTheme=(await this._savedThemesSetting.getValue()).find(t=>t.theme.meta.id===id2);if(existingTheme===void 0)throw this._logger.warn("Local Theme not found",id2),new Error("Local Theme not found");return this._loadedEditorTheme$.next(void 0),await this._activeThemeSetting.setValue(existingTheme.theme.meta.id),existingTheme}async activatePublicTheme(theme){this._logger.debug("Getting saved theme of public listing",theme);const existingTheme=(await this._savedThemesSetting.getValue()).find(t=>{var _a81;return((_a81=t.publicTheme)==null?void 0:_a81.publicId)===theme.id});if(existingTheme===void 0)throw this._logger.error("Theme not found",theme),new Error("Theme not found");return this._loadedEditorTheme$.next(void 0),await this._activeThemeSetting.setValue(existingTheme.theme.meta.id),existingTheme}async removeSavedTheme(localId){var _a81;this._logger.info("Removing saved theme",localId);const themes=await this._savedThemesSetting.getValue(),theme=themes.find(t=>t.theme.meta.id===localId);if(theme===void 0)throw this._logger.error("Theme not found",localId),new Error("Theme not found");const filtered=themes.filter(t=>t.theme.meta.id!==localId);return await this._savedThemesSetting.setValue(filtered),((_a81=this._loadedEditorTheme$.value)==null?void 0:_a81.theme.meta.id)===localId&&this._loadedEditorTheme$.next(void 0),theme}async shareTheme(theme){this._logger.debug("Sharing theme",theme);const response=await this._apiService.getApi(ThemesApi).shareTheme({themeDto:theme}),shareId=response.id;return this._logger.info("created theme share id:",response.id),shareId}async importTheme(shareId){this._logger.debug("Importing theme",shareId);const theme=await this._apiService.getApi(ThemesApi).getThemeById({id:shareId});this._logger.info("Loaded theme",theme);const themes=await this._savedThemesSetting.getValue();themes.find(t=>t.theme.meta.id===theme.meta.id)!==void 0&&(this._logger.warn("Theme already exists, assigning new ID",theme),theme.meta.id=Date.now());const savedTheme={theme,savedAt:Date.now(),publicTheme:void 0,enableManage:!0};return await this._savedThemesSetting.setValue([savedTheme,...themes]),savedTheme}},__name(_a72,"ThemesService"),_a72);ThemesService=__decorateClass$J([injectable(),__decorateParam$4(0,inject(loggerFactory)),__decorateParam$4(1,inject(ElementsSetup)),__decorateParam$4(2,inject(ApiService))],ThemesService);const getCssVariableSelectorHooks=__name((cssText,colorVariables)=>{var _a81;const css=new DOMParser().parseFromString(`<style>${cssText}</style>`,"text/html").querySelector("style"),rules=(_a81=css==null?void 0:css.sheet)==null?void 0:_a81.cssRules;if(rules==null)throw new Error("Failed to parse css rules");const variableSelectors={};colorVariables.forEach(colorVariable=>{variableSelectors[colorVariable]=[]});for(const rule of rules)if(rule instanceof CSSStyleRule)for(const propertyName in rule.style){const propertyValue=rule.style.getPropertyValue(propertyName);colorVariables.forEach(colorVariable=>{propertyValue.includes(`var(${colorVariable}`)&&variableSelectors[colorVariable].push(rule.selectorText)})}return variableSelectors},"getCssVariableSelectorHooks");var __defProp$I=Object.defineProperty,__getOwnPropDesc$6=Object.getOwnPropertyDescriptor,__decorateClass$I=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$6(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$I(target,key,result),result},"__decorateClass$I"),_a73;let CssColorVarSelectorsSetup=(_a73=class extends Setup{async runSetup(){const css=await(await fetch("/css/style.css")).text();return getCssVariableSelectorHooks(css,Object.keys(themeColors))}},__name(_a73,"CssColorVarSelectorsSetup"),_a73);CssColorVarSelectorsSetup=__decorateClass$I([earlySetup()],CssColorVarSelectorsSetup);const generateColorScheme=__name((mainColor,textColor,useIngame,useInputs,invertInputText)=>{const theme=structuredClone(themeColors),mainHueBase=226,mainSatBase=85,mainLigBase=32,mainOpBase=.75;if(mainColor){const mainHsl=mainColor.hsl,mainHue=mainHsl[0],mainSat=mainHsl[1],mainLig=mainHsl[2],mains=["--COLOR_PANEL_BG","--COLOR_PANEL_LO","--COLOR_PANEL_BUTTON","--COLOR_PANEL_BUTTON_HOVER","--COLOR_PANEL_BUTTON_ACTIVE","--COLOR_PANEL_HI","--COLOR_PANEL_FOCUS","--COLOR_PANEL_BORDER","--COLOR_TOOL_TIP_BG"];if(mains.forEach(k=>theme[k][0]=(theme[k][0]-mainHueBase+mainHue)%360),mains.forEach(k=>theme[k][1]=theme[k][1]*(mainSat/100)),mains.forEach(k=>theme[k][2]=theme[k][2]*(mainLig/100)),theme["--COLOR_CHAT_SCROLLBAR"]=[...theme["--COLOR_PANEL_LO"]],theme["--COLOR_CHAT_SCROLLBAR_THUMB"]=[...theme["--COLOR_PANEL_HI"]],useIngame){const themeSat=mainSatBase*(mainSat/100),themeLight=mainLigBase*(mainLig/100);theme["--COLOR_CHAT_BG_BASE"]=[mainHue,themeSat,themeLight,mainOpBase],theme["--COLOR_CHAT_BG_ALT"]=[mainHue,themeSat,themeLight-7,mainOpBase],theme["--COLOR_PLAYER_BG_BASE"]=[mainHue,themeSat,themeLight,mainOpBase],theme["--COLOR_PLAYER_BG_ALT"]=[mainHue,themeSat,themeLight-7,mainOpBase]}useInputs&&(theme["--COLOR_INPUT_BORDER"]=[mainHue,mainSatBase,75*(mainLigBase/100),.4],theme["--COLOR_INPUT_BORDER_FOCUS"]=[mainHue,mainSatBase,85*(mainLigBase/100),.4],theme["--COLOR_INPUT_BG"]=[mainHue,mainSatBase,80*(mainLigBase/100),.3],theme["--COLOR_INPUT_HOVER"]=[mainHue,mainSatBase,90*(mainLigBase/100),.3])}if(textColor){const textHsl=textColor.hsl;[...useIngame?["--COLOR_GAMEBAR_TEXT","--COLOR_GAMEBAR_ROUND_TEXT","--COLOR_PLAYER_TEXT_BASE","--COLOR_CHAT_TEXT_BASE"]:[],...useInputs?["--COLOR_INPUT_TEXT"]:[],"--COLOR_PANEL_TEXT"].forEach(k=>theme[k]=[textHsl[0],textHsl[1],textHsl[2],...textHsl[3]?[textHsl[3]]:[]]),useInputs&&(theme["--COLOR_PANEL_TEXT_PLACEHOLDER"]=[textHsl[0],textHsl[1],textHsl[2]-50]),useIngame&&(theme["--COLOR_GAMEBAR_WORD_DESCRIPTION"]=[textHsl[0],textHsl[1],textHsl[2],.7]),invertInputText&&(theme["--COLOR_INPUT_TEXT"][2]=100-theme["--COLOR_INPUT_TEXT"][2])}return theme},"generateColorScheme"),generateThemeBackgroundElement=__name(theme=>createElement(`<div id='typo-theme-background-${theme.meta.id}' class="typo-theme-background"></div>`),"generateThemeBackgroundElement"),stringHasContent=__name(str=>str!==void 0&&str.trim().length>0,"stringHasContent"),generateStyleElementForTheme=__name((theme,selectorHooks)=>{const colorsCss=Object.entries(theme.colors).map(entry=>{const value=entry[1],colorString=value.length==3?`hsl(${value[0]}, ${value[1]}%, ${value[2]}%)`:`hsla(${value[0]}, ${value[1]}%, ${value[2]}%, ${value[3]})`;return`${entry[0]}: ${colorString};`}).join(`
`),style=document.createElement("STYLE");return style.id=`typo-theme-style-${theme.meta.id}`,style.innerHTML=`
        :root {${colorsCss}}
        body {
            background: none;
        }
        .typo-theme-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: ${stringHasContent(theme.images.urlBackground)?"":theme.images.backgroundTint??""};
            z-index: -10;
            pointer-events: none;
            filter: brightness(${!stringHasContent(theme.images.urlBackground)&&(theme.images.backgroundTint??"transparent")!=="transparent"?4:1});
        }
        .typo-theme-background::after {
            image-rendering: unset;
            content: "";
            position: absolute;
            inset: 0;
            background-position: center;
            background-image: url(${stringHasContent(theme.images.urlBackground)?theme.images.urlBackground:"/img/background.png"});
            background-repeat: ${!stringHasContent(theme.images.urlBackground)||theme.images.backgroundRepeat?"repeat":"no-repeat"};
            background-size: ${stringHasContent(theme.images.urlBackground)?theme.images.backgroundRepeat?"auto":"cover":"350px"};
            mix-blend-mode: ${theme.images.backgroundTint=="transparent"||!stringHasContent(theme.images.backgroundTint)?"none":"multiply"};
            filter: ${theme.images.backgroundTint=="transparent"||!stringHasContent(theme.images.backgroundTint)?"none":"saturate(0%)"};
        }
        body:has(#game[style*="display: flex"]) .typo-theme-background${stringHasContent(theme.images.urlBackgroundGame)?"":".disabled"}::after {
            background-image: url(${theme.images.urlBackgroundGame});
        }

        ${theme.misc.hideFooter?".tos, .notice {display:none}":""}
        
        ${theme.misc.hideInGameLogo?"#game #game-logo{display:none} #game{margin-top:2em}":""}

        ${theme.misc.hideAvatarLogo?"#home .logo-big .avatar-container {display:none }":""}

        ${theme.misc.hideSkribblPanels?".bottom .footer .section-container { display: none !important }":""}

        ${stringHasContent(theme.images.containerImages)?`
        #game-bar, #game-room .settings, #game-room .players,  #imageAgent, #gamemodePopup, #optionsPopup, #downloadPopup, 
        #sharePopup, #typoUserInfo, #imageOptions, #game-room .container-settings, #game-chat 
        .chat-content, #game-players .players-list  {background-image: url(${theme.images.containerImages}) !important}
        #game-players .players-list .player {background:none !important}
        `:""}

        .flatUi.orange, .button-orange {
            background-color: var(--COLOR_BUTTON_DANGER_BG) !important;
            color: var(--COLOR_BUTTON_DANGER_TEXT) !important;
        }
        .flatUI.green, .button-play, #start-game {
            color: var(--COLOR_BUTTON_SUBMIT_TEXT) !important;
            background-color: var(--COLOR_BUTTON_SUBMIT_BG) !important;
        }
        .flatUI.blue, .button-create, .button-blue, #copy-invite {
            background-color: var(--COLOR_BUTTON_NORMAL_BG) !important;
            color: var(--COLOR_BUTTON_NORMAL_TEXT) !important;
        }

        :is(.flatUi.orange, .button-orange):is(:hover, :active, :focus) {
            background-color: var(--COLOR_BUTTON_DANGER_BG) !important;
            color: var(--COLOR_BUTTON_DANGER_TEXT) !important;
            opacity: 0.8;
        }
        :is(.flatUI.green, .button-play, #start-game):is(:hover, :active, :focus) {
            color: var(--COLOR_BUTTON_SUBMIT_TEXT) !important;
            background-color: var(--COLOR_BUTTON_SUBMIT_BG) !important;
            opacity: 0.8;
        }
        :is(.flatUI.blue, .button-create, .button-blue, #copy-invite):is(:hover, :active, :focus) {
            background-color: var(--COLOR_BUTTON_NORMAL_BG) !important;
            color: var(--COLOR_BUTTON_NORMAL_TEXT) !important;
            opacity: 0.8;
        }

        ${stringHasContent(theme.misc.fontStyle)?`*{font-family:'${theme.misc.fontStyle.trim().split(":")[0].replaceAll("+"," ")}', sans-serif !important}`:""}

        ${stringHasContent(theme.images.urlLogo)?`
          div.logo-big a {display: flex; justify-content: center }
          div.logo-big img {max-height:20vh; content: url(${theme.images.urlLogo}) }
        `:""}

        ${Object.entries(theme.hooks?theme.hooks:{}).filter(entry=>entry[1]!=="").map(entry=>`${selectorHooks[entry[0]].join(",")}{${entry[1]}}`).join(`
`)}

        ::-webkit-scrollbar {
            width: 14px;
            border-radius: 7px;
            background-color: var(--COLOR_PANEL_LO); 
        }
        
        ::-webkit-scrollbar-thumb {
            border-radius: 7px;
            background-color: var(--COLOR_PANEL_HI)
        }

        #game-chat ::-webkit-scrollbar {
            width: 14px;
            border-radius: 7px;
            background-color: var(--COLOR_CHAT_SCROLLBAR); 
        }
        
        #game-chat ::-webkit-scrollbar-thumb {
            border-radius: 7px;
            background-color: var(--COLOR_CHAT_SCROLLBAR_THUMB); 
        }

        ${theme.misc.cssText??""}
    
        `,style},"generateStyleElementForTheme"),generateThemeExternalCssElement=__name(theme=>theme.misc.themeCssUrl&&theme.misc.themeCssUrl.length>0?[createElement(`<link id='typo-theme-external-css-${theme.meta.id}' rel="stylesheet" href="${theme.misc.themeCssUrl}">`)]:[],"generateThemeExternalCssElement"),generateThemeFontElements=__name(theme=>{var _a81;return theme.misc.fontStyle&&theme.misc.fontStyle.length>0?[createElement(`<link id='typo-theme-font-preconnect-${theme.meta.id}' rel="preconnect" href="https://fonts.gstatic.com">`),createElement(`<link id='typo-theme-font-style-${theme.meta.id}' href="https://fonts.googleapis.com/css2?family=${(_a81=theme.misc.fontStyle)==null?void 0:_a81.trim()}&display=swap" rel="stylesheet">`)]:[]},"generateThemeFontElements"),generateThemeCustomHtmlElement=__name(theme=>theme.misc.htmlText&&theme.misc.htmlText.length>0?[createElement(`<div id='typo-theme-html-${theme.meta.id}'>${theme.misc.htmlText}</div>`)]:[],"generateThemeCustomHtmlElement");function get_each_context$p(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[14]=list[i],child_ctx}__name(get_each_context$p,"get_each_context$p");function create_catch_block$1(ctx){return{c:noop$1,m:noop$1,p:noop$1,i:noop$1,o:noop$1,d:noop$1}}__name(create_catch_block$1,"create_catch_block$1");function create_then_block$1(ctx){let div,current,each_value=ensure_array_like(ctx[13]),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$p(get_each_context$p(ctx,each_value,i));const out=__name(i=>transition_out(each_blocks[i],1,1,()=>{each_blocks[i]=null}),"out");return{c(){div=element$1("div");for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();attr(div,"class","typo-themes-browser-list svelte-163v0av")},m(target,anchor){insert(target,div,anchor);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div,null);current=!0},p(ctx2,dirty){if(dirty&15){each_value=ensure_array_like(ctx2[13]);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$p(ctx2,each_value,i);each_blocks[i]?(each_blocks[i].p(child_ctx,dirty),transition_in(each_blocks[i],1)):(each_blocks[i]=create_each_block$p(child_ctx),each_blocks[i].c(),transition_in(each_blocks[i],1),each_blocks[i].m(div,null))}for(group_outros(),i=each_value.length;i<each_blocks.length;i+=1)out(i);check_outros()}},i(local){if(!current){for(let i=0;i<each_value.length;i+=1)transition_in(each_blocks[i]);current=!0}},o(local){each_blocks=each_blocks.filter(Boolean);for(let i=0;i<each_blocks.length;i+=1)transition_out(each_blocks[i]);current=!1},d(detaching){detaching&&detach(div),destroy_each(each_blocks,detaching)}}}__name(create_then_block$1,"create_then_block$1");function create_if_block_1$c(ctx){let div0,t0,div1,span0,t1,t2_value=ctx[14].version+"",t2,t3,span1,t4,t5_value=ctx[14].id+"",t5;return{c(){div0=element$1("div"),t0=space(),div1=element$1("div"),span0=element$1("span"),t1=text("v"),t2=text(t2_value),t3=space(),span1=element$1("span"),t4=text("#"),t5=text(t5_value),attr(div0,"class","svelte-163v0av"),attr(span0,"class","svelte-163v0av"),attr(span1,"class","svelte-163v0av"),attr(div1,"class","svelte-163v0av")},m(target,anchor){insert(target,div0,anchor),insert(target,t0,anchor),insert(target,div1,anchor),append(div1,span0),append(span0,t1),append(span0,t2),append(div1,t3),append(div1,span1),append(span1,t4),append(span1,t5)},p(ctx2,dirty){dirty&1&&t2_value!==(t2_value=ctx2[14].version+"")&&set_data(t2,t2_value),dirty&1&&t5_value!==(t5_value=ctx2[14].id+"")&&set_data(t5,t5_value)},d(detaching){detaching&&(detach(div0),detach(t0),detach(div1))}}}__name(create_if_block_1$c,"create_if_block_1$c");function create_else_block$a(ctx){let flatbutton,current;function click_handler_1(){return ctx[12](ctx[14])}return __name(click_handler_1,"click_handler_1"),flatbutton=new Flat_button({props:{content:"Download",color:"blue"}}),flatbutton.$on("click",click_handler_1),{c(){create_component(flatbutton.$$.fragment)},m(target,anchor){mount_component(flatbutton,target,anchor),current=!0},p(new_ctx,dirty){ctx=new_ctx},i(local){current||(transition_in(flatbutton.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton.$$.fragment,local),current=!1},d(detaching){destroy_component(flatbutton,detaching)}}}__name(create_else_block$a,"create_else_block$a");function create_if_block$o(ctx){var _a81,_b,_c,_d;let flatbutton,current;function click_handler2(){return ctx[11](ctx[14])}return __name(click_handler2,"click_handler"),flatbutton=new Flat_button({props:{content:((_b=(_a81=ctx[2])==null?void 0:_a81.publicTheme)==null?void 0:_b.publicId)===ctx[14].id?"Active":"Activate",disabled:((_d=(_c=ctx[2])==null?void 0:_c.publicTheme)==null?void 0:_d.publicId)===ctx[14].id,color:"green"}}),flatbutton.$on("click",click_handler2),{c(){create_component(flatbutton.$$.fragment)},m(target,anchor){mount_component(flatbutton,target,anchor),current=!0},p(new_ctx,dirty){var _a82,_b2,_c2,_d2;ctx=new_ctx;const flatbutton_changes={};dirty&5&&(flatbutton_changes.content=((_b2=(_a82=ctx[2])==null?void 0:_a82.publicTheme)==null?void 0:_b2.publicId)===ctx[14].id?"Active":"Activate"),dirty&5&&(flatbutton_changes.disabled=((_d2=(_c2=ctx[2])==null?void 0:_c2.publicTheme)==null?void 0:_d2.publicId)===ctx[14].id),flatbutton.$set(flatbutton_changes)},i(local){current||(transition_in(flatbutton.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton.$$.fragment,local),current=!1},d(detaching){destroy_component(flatbutton,detaching)}}}__name(create_if_block$o,"create_if_block$o");function create_each_block$p(ctx){let div2,b,t0_value=ctx[14].name+"",t0,t1,div0,t2,t3_value=ctx[14].author+"",t3,t4,t5,show_if,current_block_type_index,if_block1,t6,div1,t7_value=ctx[14].downloads+"",t7,t8,t9,current;function func2(...args){return ctx[10](ctx[14],...args)}__name(func2,"func");let if_block0=ctx[3]&&create_if_block_1$c(ctx);const if_block_creators=[create_if_block$o,create_else_block$a],if_blocks=[];function select_block_type(ctx2,dirty){return dirty&3&&(show_if=null),show_if==null&&(show_if=!!ctx2[1].some(func2)),show_if?0:1}return __name(select_block_type,"select_block_type"),current_block_type_index=select_block_type(ctx,-1),if_block1=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx),{c(){div2=element$1("div"),b=element$1("b"),t0=text(t0_value),t1=space(),div0=element$1("div"),t2=text("by "),t3=text(t3_value),t4=space(),if_block0&&if_block0.c(),t5=space(),if_block1.c(),t6=space(),div1=element$1("div"),t7=text(t7_value),t8=text(" downloads"),t9=space(),attr(div0,"class","svelte-163v0av"),attr(div1,"class","svelte-163v0av"),attr(div2,"class","typo-themes-browser-item svelte-163v0av")},m(target,anchor){insert(target,div2,anchor),append(div2,b),append(b,t0),append(div2,t1),append(div2,div0),append(div0,t2),append(div0,t3),append(div2,t4),if_block0&&if_block0.m(div2,null),append(div2,t5),if_blocks[current_block_type_index].m(div2,null),append(div2,t6),append(div2,div1),append(div1,t7),append(div1,t8),append(div2,t9),current=!0},p(new_ctx,dirty){ctx=new_ctx,(!current||dirty&1)&&t0_value!==(t0_value=ctx[14].name+"")&&set_data(t0,t0_value),(!current||dirty&1)&&t3_value!==(t3_value=ctx[14].author+"")&&set_data(t3,t3_value),ctx[3]?if_block0?if_block0.p(ctx,dirty):(if_block0=create_if_block_1$c(ctx),if_block0.c(),if_block0.m(div2,t5)):if_block0&&(if_block0.d(1),if_block0=null);let previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx,dirty),current_block_type_index===previous_block_index?if_blocks[current_block_type_index].p(ctx,dirty):(group_outros(),transition_out(if_blocks[previous_block_index],1,1,()=>{if_blocks[previous_block_index]=null}),check_outros(),if_block1=if_blocks[current_block_type_index],if_block1?if_block1.p(ctx,dirty):(if_block1=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx),if_block1.c()),transition_in(if_block1,1),if_block1.m(div2,t6)),(!current||dirty&1)&&t7_value!==(t7_value=ctx[14].downloads+"")&&set_data(t7,t7_value)},i(local){current||(transition_in(if_block1),current=!0)},o(local){transition_out(if_block1),current=!1},d(detaching){detaching&&detach(div2),if_block0&&if_block0.d(),if_blocks[current_block_type_index].d()}}}__name(create_each_block$p,"create_each_block$p");function create_pending_block$1(ctx){return{c:noop$1,m:noop$1,p:noop$1,i:noop$1,o:noop$1,d:noop$1}}__name(create_pending_block$1,"create_pending_block$1");function create_fragment$L(ctx){let div,t2,await_block_anchor,promise,current,info={ctx,current:null,token:null,hasCatch:!1,pending:create_pending_block$1,then:create_then_block$1,catch:create_catch_block$1,value:13,blocks:[,,,]};return handle_promise(promise=ctx[0].getOnlineThemes(),info),{c(){div=element$1("div"),div.innerHTML=`Here you can discover themes made by other typo users. When you download a theme, it will be activated and saved to your local themes.<br/>
  When a theme receives an update, it will be automatically downloaded.`,t2=space(),await_block_anchor=empty(),info.block.c(),attr(div,"class","typo-themes-browser-header svelte-163v0av")},m(target,anchor){insert(target,div,anchor),insert(target,t2,anchor),insert(target,await_block_anchor,anchor),info.block.m(target,info.anchor=anchor),info.mount=()=>await_block_anchor.parentNode,info.anchor=await_block_anchor,current=!0},p(new_ctx,[dirty]){ctx=new_ctx,info.ctx=ctx,dirty&1&&promise!==(promise=ctx[0].getOnlineThemes())&&handle_promise(promise,info)||update_await_block_branch(info,ctx,dirty)},i(local){current||(transition_in(info.block),current=!0)},o(local){for(let i=0;i<3;i+=1){const block=info.blocks[i];transition_out(block)}current=!1},d(detaching){detaching&&(detach(div),detach(t2),detach(await_block_anchor)),info.block.d(detaching),info.token=null,info=null}}}__name(create_fragment$L,"create_fragment$L");function instance$G($$self,$$props,$$invalidate){let $currentThemeId,$savedThemes,$loadedEditorTheme,$devmode,{feature}=$$props;const devmode=feature.devmodeStore;component_subscribe($$self,devmode,value=>$$invalidate(3,$devmode=value));const savedThemes=feature.savedThemesStore;component_subscribe($$self,savedThemes,value=>$$invalidate(1,$savedThemes=value));const currentThemeId=feature.activeThemeStore;component_subscribe($$self,currentThemeId,value=>$$invalidate(8,$currentThemeId=value));const loadedEditorTheme=feature.loadedEditorThemeStore;component_subscribe($$self,loadedEditorTheme,value=>$$invalidate(9,$loadedEditorTheme=value));let currentTheme;const func2=__name((theme,t)=>{var _a81;return((_a81=t.publicTheme)==null?void 0:_a81.publicId)===theme.id},"func"),click_handler2=__name(theme=>feature.activatePublicTheme(theme),"click_handler"),click_handler_1=__name(async theme=>{await feature.savePublicTheme(theme),await feature.activatePublicTheme(theme)},"click_handler_1");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},$$self.$$.update=()=>{$$self.$$.dirty&770&&$$invalidate(2,currentTheme=$loadedEditorTheme===void 0?$savedThemes.find(t=>t.theme.meta.id===$currentThemeId):void 0)},[feature,$savedThemes,currentTheme,$devmode,devmode,savedThemes,currentThemeId,loadedEditorTheme,$currentThemeId,$loadedEditorTheme,func2,click_handler2,click_handler_1]}__name(instance$G,"instance$G");const _Themes_browser=class _Themes_browser extends SvelteComponent{constructor(options){super(),init(this,options,instance$G,create_fragment$L,safe_not_equal,{feature:0})}};__name(_Themes_browser,"Themes_browser");let Themes_browser=_Themes_browser;function create_if_block_1$b(ctx){let p,t;return{c(){p=element$1("p"),t=text(ctx[2])},m(target,anchor){insert(target,p,anchor),append(p,t)},p(ctx2,dirty){dirty&4&&set_data(t,ctx2[2])},d(detaching){detaching&&detach(p)}}}__name(create_if_block_1$b,"create_if_block_1$b");function create_if_block$n(ctx){let div1,div0,mounted,dispose;return{c(){div1=element$1("div"),div0=element$1("div"),attr(div0,"class","alpha-thumb svelte-1x2m4l5"),set_style(div0,"top","calc(50% - .5rem)"),set_style(div0,"left","calc("+(ctx[7]??1)*100+"% - .5rem)"),toggle_class(div0,"listen",ctx[10]),attr(div1,"class","alpha-rect svelte-1x2m4l5"),set_style(div1,"background","linear-gradient(to right, "+ctx[0].copy().withAlpha(0).rgbString+", "+ctx[0].copy().withAlpha(1).rgbString+")")},m(target,anchor){insert(target,div1,anchor),append(div1,div0),mounted||(dispose=[listen(div1,"mousedown",ctx[16]),listen(div1,"mouseup",ctx[13]),listen(div1,"mouseleave",ctx[13])],mounted=!0)},p(ctx2,dirty){dirty&128&&set_style(div0,"left","calc("+(ctx2[7]??1)*100+"% - .5rem)"),dirty&1024&&toggle_class(div0,"listen",ctx2[10]),dirty&1&&set_style(div1,"background","linear-gradient(to right, "+ctx2[0].copy().withAlpha(0).rgbString+", "+ctx2[0].copy().withAlpha(1).rgbString+")")},d(detaching){detaching&&detach(div1),mounted=!1,run_all(dispose)}}}__name(create_if_block$n,"create_if_block$n");function create_fragment$K(ctx){let div5,div0,t2,t3,div2,div1,t4,div4,div3,t5,t6,input,mounted,dispose,if_block0=ctx[2].length>0&&create_if_block_1$b(ctx),if_block1=ctx[1]&&create_if_block$n(ctx);return{c(){div5=element$1("div"),div0=element$1("div"),div0.innerHTML='<img src="" alt="picker icon" style="content: var(--file-img-crosshair-gif)" class="svelte-1x2m4l5"/> <h3 class="svelte-1x2m4l5">Color Picker</h3>',t2=space(),if_block0&&if_block0.c(),t3=space(),div2=element$1("div"),div1=element$1("div"),t4=space(),div4=element$1("div"),div3=element$1("div"),t5=space(),if_block1&&if_block1.c(),t6=space(),input=element$1("input"),attr(div0,"class","picker-header svelte-1x2m4l5"),attr(div1,"class","color-thumb svelte-1x2m4l5"),set_style(div1,"top","calc(100% - "+ctx[6]+"% - .5rem)"),set_style(div1,"left","calc("+ctx[5]+"% - .5rem)"),toggle_class(div1,"listen",ctx[8]),attr(div2,"class","color-rect svelte-1x2m4l5"),set_style(div2,"background","linear-gradient(to top, rgba(0, 0, 0, 1), rgba(0, 0, 0, 0)), linear-gradient(to right, hsl(0, 0%, 100%), hsl("+ctx[4]+", 100%, 50%))"),attr(div3,"class","hue-thumb svelte-1x2m4l5"),set_style(div3,"top","calc(50% - .5rem)"),set_style(div3,"left","calc("+ctx[4]/3.6+"% - .5rem)"),toggle_class(div3,"listen",ctx[9]),attr(div4,"class","hue-rect svelte-1x2m4l5"),attr(input,"type","text"),attr(input,"placeholder","#aabbcc"),attr(div5,"class","color-picker svelte-1x2m4l5")},m(target,anchor){insert(target,div5,anchor),append(div5,div0),append(div5,t2),if_block0&&if_block0.m(div5,null),append(div5,t3),append(div5,div2),append(div2,div1),append(div5,t4),append(div5,div4),append(div4,div3),append(div5,t5),if_block1&&if_block1.m(div5,null),append(div5,t6),append(div5,input),set_input_value(input,ctx[3]),mounted||(dispose=[listen(div2,"mousedown",ctx[14]),listen(div2,"mouseup",ctx[11]),listen(div2,"mouseleave",ctx[11]),listen(div4,"mousedown",ctx[15]),listen(div4,"mouseup",ctx[12]),listen(div4,"mouseleave",ctx[12]),listen(input,"input",ctx[17]),listen(input,"change",ctx[18])],mounted=!0)},p(ctx2,[dirty]){ctx2[2].length>0?if_block0?if_block0.p(ctx2,dirty):(if_block0=create_if_block_1$b(ctx2),if_block0.c(),if_block0.m(div5,t3)):if_block0&&(if_block0.d(1),if_block0=null),dirty&64&&set_style(div1,"top","calc(100% - "+ctx2[6]+"% - .5rem)"),dirty&32&&set_style(div1,"left","calc("+ctx2[5]+"% - .5rem)"),dirty&256&&toggle_class(div1,"listen",ctx2[8]),dirty&16&&set_style(div2,"background","linear-gradient(to top, rgba(0, 0, 0, 1), rgba(0, 0, 0, 0)), linear-gradient(to right, hsl(0, 0%, 100%), hsl("+ctx2[4]+", 100%, 50%))"),dirty&16&&set_style(div3,"left","calc("+ctx2[4]/3.6+"% - .5rem)"),dirty&512&&toggle_class(div3,"listen",ctx2[9]),ctx2[1]?if_block1?if_block1.p(ctx2,dirty):(if_block1=create_if_block$n(ctx2),if_block1.c(),if_block1.m(div5,t6)):if_block1&&(if_block1.d(1),if_block1=null),dirty&8&&input.value!==ctx2[3]&&set_input_value(input,ctx2[3])},i:noop$1,o:noop$1,d(detaching){detaching&&detach(div5),if_block0&&if_block0.d(),if_block1&&if_block1.d(),mounted=!1,run_all(dispose)}}}__name(create_fragment$K,"create_fragment$K");function instance$F($$self,$$props,$$invalidate){let{color=Color.fromHex("#45588d")}=$$props,{allowAlpha=!1}=$$props,{description=""}=$$props,inputHex=color.hex,hue,saturation,value,alpha,listenSV=!1;const handleSV=__name(event=>{if(!listenSV)return;$$invalidate(8,listenSV=!1);const rect=event.target.getBoundingClientRect(),x=event.clientX-rect.left,y=event.clientY-rect.top;$$invalidate(5,saturation=x/rect.width*100),$$invalidate(6,value=100-y/rect.height*100),$$invalidate(0,color=Color.fromHsv(hue,saturation,value,alpha)),$$invalidate(3,inputHex=color.hex)},"handleSV");let listenHue=!1;const handleHue=__name(event=>{if(!listenHue)return;$$invalidate(9,listenHue=!1);const rect=event.target.getBoundingClientRect(),x=event.clientX-rect.left;$$invalidate(4,hue=x/rect.width*360),$$invalidate(0,color=Color.fromHsv(hue,saturation,value,alpha)),$$invalidate(3,inputHex=color.hex)},"handleHue");let listenAlpha=!1;const handleAlpha=__name(event=>{if(!listenAlpha||!allowAlpha)return;$$invalidate(10,listenAlpha=!1);const rect=event.target.getBoundingClientRect(),x=event.clientX-rect.left;$$invalidate(7,alpha=x/rect.width),$$invalidate(0,color=Color.fromHsv(hue,saturation,value,alpha)),$$invalidate(3,inputHex=color.hex)},"handleAlpha"),mousedown_handler=__name(()=>$$invalidate(8,listenSV=!0),"mousedown_handler"),mousedown_handler_1=__name(()=>$$invalidate(9,listenHue=!0),"mousedown_handler_1"),mousedown_handler_2=__name(()=>$$invalidate(10,listenAlpha=!0),"mousedown_handler_2");function input_input_handler(){inputHex=this.value,$$invalidate(3,inputHex)}__name(input_input_handler,"input_input_handler");const change_handler=__name(event=>{$$invalidate(0,color=Color.fromHex(inputHex))},"change_handler");return $$self.$$set=$$props2=>{"color"in $$props2&&$$invalidate(0,color=$$props2.color),"allowAlpha"in $$props2&&$$invalidate(1,allowAlpha=$$props2.allowAlpha),"description"in $$props2&&$$invalidate(2,description=$$props2.description)},$$self.$$.update=()=>{if($$self.$$.dirty&3){const hsv=color.hsv;$$invalidate(4,hue=hsv[0]??0),$$invalidate(5,saturation=hsv[1]??100),$$invalidate(6,value=hsv[2]??50),$$invalidate(7,alpha=allowAlpha?hsv[3]:void 0)}},[color,allowAlpha,description,inputHex,hue,saturation,value,alpha,listenSV,listenHue,listenAlpha,handleSV,handleHue,handleAlpha,mousedown_handler,mousedown_handler_1,mousedown_handler_2,input_input_handler,change_handler]}__name(instance$F,"instance$F");const _Color_picker=class _Color_picker extends SvelteComponent{constructor(options){super(),init(this,options,instance$F,create_fragment$K,safe_not_equal,{color:0,allowAlpha:1,description:2})}};__name(_Color_picker,"Color_picker");let Color_picker=_Color_picker;function create_if_block$m(ctx){let div,colorpicker,updating_color,current,mounted,dispose;function colorpicker_color_binding(value){ctx[10](value)}__name(colorpicker_color_binding,"colorpicker_color_binding");let colorpicker_props={allowAlpha:ctx[1],description:ctx[5]};return ctx[0]!==void 0&&(colorpicker_props.color=ctx[0]),colorpicker=new Color_picker({props:colorpicker_props}),binding_callbacks.push(()=>bind$1(colorpicker,"color",colorpicker_color_binding)),{c(){div=element$1("div"),create_component(colorpicker.$$.fragment),attr(div,"class","color-picker-popout svelte-1bdf7g"),set_style(div,"top",ctx[6].top),set_style(div,"left",ctx[6].left),set_style(div,"right",ctx[6].right),set_style(div,"bottom",ctx[6].bottom),set_style(div,"transform-origin",ctx[6].transformOrigin),toggle_class(div,"closing",ctx[7])},m(target,anchor){insert(target,div,anchor),mount_component(colorpicker,div,null),current=!0,mounted||(dispose=listen(div,"click",click_handler),mounted=!0)},p(ctx2,dirty){const colorpicker_changes={};dirty&2&&(colorpicker_changes.allowAlpha=ctx2[1]),dirty&32&&(colorpicker_changes.description=ctx2[5]),!updating_color&&dirty&1&&(updating_color=!0,colorpicker_changes.color=ctx2[0],add_flush_callback(()=>updating_color=!1)),colorpicker.$set(colorpicker_changes),(!current||dirty&64)&&set_style(div,"top",ctx2[6].top),(!current||dirty&64)&&set_style(div,"left",ctx2[6].left),(!current||dirty&64)&&set_style(div,"right",ctx2[6].right),(!current||dirty&64)&&set_style(div,"bottom",ctx2[6].bottom),(!current||dirty&64)&&set_style(div,"transform-origin",ctx2[6].transformOrigin),(!current||dirty&128)&&toggle_class(div,"closing",ctx2[7])},i(local){current||(transition_in(colorpicker.$$.fragment,local),current=!0)},o(local){transition_out(colorpicker.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div),destroy_component(colorpicker),mounted=!1,dispose()}}}__name(create_if_block$m,"create_if_block$m");function create_fragment$J(ctx){let div1,div0,t,div1_data_rgb_value,current,mounted,dispose,if_block=ctx[6]&&create_if_block$m(ctx);return{c(){div1=element$1("div"),div0=element$1("div"),t=space(),if_block&&if_block.c(),attr(div0,"class","color-picker-button-content svelte-1bdf7g"),set_style(div0,"background-color",ctx[2]?ctx[0].hex:void 0),set_style(div0,"border-radius",ctx[4]),attr(div1,"class","typo-color-picker-button svelte-1bdf7g"),set_style(div1,"height",ctx[3]),attr(div1,"data-rgb",div1_data_rgb_value=ctx[0].rgbString)},m(target,anchor){insert(target,div1,anchor),append(div1,div0),append(div1,t),if_block&&if_block.m(div1,null),current=!0,mounted||(dispose=listen(div1,"click",ctx[8]),mounted=!0)},p(ctx2,[dirty]){(!current||dirty&5)&&set_style(div0,"background-color",ctx2[2]?ctx2[0].hex:void 0),(!current||dirty&16)&&set_style(div0,"border-radius",ctx2[4]),ctx2[6]?if_block?(if_block.p(ctx2,dirty),dirty&64&&transition_in(if_block,1)):(if_block=create_if_block$m(ctx2),if_block.c(),transition_in(if_block,1),if_block.m(div1,null)):if_block&&(group_outros(),transition_out(if_block,1,1,()=>{if_block=null}),check_outros()),(!current||dirty&8)&&set_style(div1,"height",ctx2[3]),(!current||dirty&1&&div1_data_rgb_value!==(div1_data_rgb_value=ctx2[0].rgbString))&&attr(div1,"data-rgb",div1_data_rgb_value)},i(local){current||(transition_in(if_block),current=!0)},o(local){transition_out(if_block),current=!1},d(detaching){detaching&&detach(div1),if_block&&if_block.d(),mounted=!1,dispose()}}}__name(create_fragment$J,"create_fragment$J");const click_handler=__name(e=>e.stopImmediatePropagation(),"click_handler");function instance$E($$self,$$props,$$invalidate){let{color=Color.fromHex("#45588d")}=$$props,{allowAlpha=!1}=$$props,{useBackground=!0}=$$props,{height="2rem"}=$$props,{borderRadius="3px"}=$$props,{colorChanged=void 0}=$$props,{description=""}=$$props,popupPosition,closing=!1;const openPopup=__name(event=>{$$invalidate(7,closing=!1);const anchor=event.target,rect=anchor.getBoundingClientRect(),handler=__name(e=>{e.target!==anchor&&(document.removeEventListener("click",handler),colorChanged==null||colorChanged(color),$$invalidate(7,closing=!0),setTimeout(()=>{$$invalidate(6,popupPosition=void 0)},150))},"handler");document.addEventListener("click",handler);let left,right,bottom,top,transformOrigin;rect.x>window.innerWidth/2?right="0":left="0",rect.y>window.innerHeight/2?(bottom="0",transformOrigin="bottom"):(top="0",transformOrigin="top"),$$invalidate(6,popupPosition={top,left,right,bottom,transformOrigin})},"openPopup");function colorpicker_color_binding(value){color=value,$$invalidate(0,color)}return __name(colorpicker_color_binding,"colorpicker_color_binding"),$$self.$$set=$$props2=>{"color"in $$props2&&$$invalidate(0,color=$$props2.color),"allowAlpha"in $$props2&&$$invalidate(1,allowAlpha=$$props2.allowAlpha),"useBackground"in $$props2&&$$invalidate(2,useBackground=$$props2.useBackground),"height"in $$props2&&$$invalidate(3,height=$$props2.height),"borderRadius"in $$props2&&$$invalidate(4,borderRadius=$$props2.borderRadius),"colorChanged"in $$props2&&$$invalidate(9,colorChanged=$$props2.colorChanged),"description"in $$props2&&$$invalidate(5,description=$$props2.description)},[color,allowAlpha,useBackground,height,borderRadius,description,popupPosition,closing,openPopup,colorChanged,colorpicker_color_binding]}__name(instance$E,"instance$E");const _Color_picker_button=class _Color_picker_button extends SvelteComponent{constructor(options){super(),init(this,options,instance$E,create_fragment$J,safe_not_equal,{color:0,allowAlpha:1,useBackground:2,height:3,borderRadius:4,colorChanged:9,description:5})}};__name(_Color_picker_button,"Color_picker_button");let Color_picker_button=_Color_picker_button;function get_each_context$o(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[61]=list[i],child_ctx[62]=list,child_ctx[63]=i,child_ctx}__name(get_each_context$o,"get_each_context$o");function get_each_context_1$7(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[61]=list[i],child_ctx}__name(get_each_context_1$7,"get_each_context_1$7");function create_else_block$9(ctx){let div0,h3,t0,t1_value=ctx[2].theme.meta.name+"",t1,t2,br0,t3,flatbutton0,t4,flatbutton1,t5,flatbutton2,t6,div42,div5,div2,div1,t8,input0,t9,div4,div3,t11,input1,t12,details0,summary0,t14,br1,t15,br2,t16,br3,t17,div10,div7,div6,t19,colorpickerbutton0,updating_color,t20,div9,div8,t22,colorpickerbutton1,updating_color_1,t23,br4,t24,div11,checkbox0,updating_checked,t25,checkbox1,updating_checked_1,t26,checkbox2,updating_checked_2,t27,br5,t28,div12,flatbutton3,t29,details1,summary1,t31,div21,div14,div13,t33,input2,t34,div16,div15,t36,input3,t37,div18,div17,t39,input4,t40,div20,div19,t42,input5,t43,br6,t44,div23,div22,checkbox3,updating_checked_3,t45,colorpickerbutton2,t46,br7,t47,div24,checkbox4,updating_checked_4,t48,details2,summary2,t50,p0,t52,p1,t54,p2,t56,br8,t57,div27,div26,div25,t58,details3,summary3,t60,div32,div29,div28,t62,input6,t63,div31,div30,t65,input7,t66,br9,t67,div37,div34,div33,t69,input8,t70,div36,div35,t72,input9,t73,br10,t74,div38,checkbox5,updating_checked_5,t75,checkbox6,updating_checked_6,t76,checkbox7,updating_checked_7,t77,checkbox8,updating_checked_8,t78,details4,summary4,t80,p3,t82,p4,t84,p5,t86,br11,t87,div41,div40,div39,current,mounted,dispose;flatbutton0=new Flat_button({props:{content:"Discard & Delete",color:"orange"}}),flatbutton0.$on("click",ctx[18]),flatbutton1=new Flat_button({props:{content:"Discard Changes",color:"blue"}}),flatbutton1.$on("click",ctx[19]),flatbutton2=new Flat_button({props:{content:"Save Theme",color:"green"}}),flatbutton2.$on("click",ctx[20]);function colorpickerbutton0_color_binding(value){ctx[23](value)}__name(colorpickerbutton0_color_binding,"colorpickerbutton0_color_binding");let colorpickerbutton0_props={};ctx[3]!==void 0&&(colorpickerbutton0_props.color=ctx[3]),colorpickerbutton0=new Color_picker_button({props:colorpickerbutton0_props}),binding_callbacks.push(()=>bind$1(colorpickerbutton0,"color",colorpickerbutton0_color_binding));function colorpickerbutton1_color_binding(value){ctx[24](value)}__name(colorpickerbutton1_color_binding,"colorpickerbutton1_color_binding");let colorpickerbutton1_props={};ctx[4]!==void 0&&(colorpickerbutton1_props.color=ctx[4]),colorpickerbutton1=new Color_picker_button({props:colorpickerbutton1_props}),binding_callbacks.push(()=>bind$1(colorpickerbutton1,"color",colorpickerbutton1_color_binding));function checkbox0_checked_binding(value){ctx[25](value)}__name(checkbox0_checked_binding,"checkbox0_checked_binding");let checkbox0_props={description:"Generate colors for input fields"};ctx[6]!==void 0&&(checkbox0_props.checked=ctx[6]),checkbox0=new Checkbox({props:checkbox0_props}),binding_callbacks.push(()=>bind$1(checkbox0,"checked",checkbox0_checked_binding));function checkbox1_checked_binding(value){ctx[26](value)}__name(checkbox1_checked_binding,"checkbox1_checked_binding");let checkbox1_props={description:"Invert text brightness on input fields"};ctx[7]!==void 0&&(checkbox1_props.checked=ctx[7]),checkbox1=new Checkbox({props:checkbox1_props}),binding_callbacks.push(()=>bind$1(checkbox1,"checked",checkbox1_checked_binding));function checkbox2_checked_binding(value){ctx[27](value)}__name(checkbox2_checked_binding,"checkbox2_checked_binding");let checkbox2_props={description:"Use theme colors in-game"};ctx[9]!==void 0&&(checkbox2_props.checked=ctx[9]),checkbox2=new Checkbox({props:checkbox2_props}),binding_callbacks.push(()=>bind$1(checkbox2,"checked",checkbox2_checked_binding)),flatbutton3=new Flat_button({props:{content:"Generate Color Scheme",color:"green"}}),flatbutton3.$on("click",ctx[28]);function checkbox3_checked_binding(value){ctx[37](value)}__name(checkbox3_checked_binding,"checkbox3_checked_binding");let checkbox3_props={description:"Tint the skribbl background with a color"};ctx[8]!==void 0&&(checkbox3_props.checked=ctx[8]),checkbox3=new Checkbox({props:checkbox3_props}),binding_callbacks.push(()=>bind$1(checkbox3,"checked",checkbox3_checked_binding)),checkbox3.$on("change",ctx[38]),colorpickerbutton2=new Color_picker_button({props:{allowAlpha:!0,colorChanged:ctx[39]}});function checkbox4_checked_binding(value){ctx[40](value)}__name(checkbox4_checked_binding,"checkbox4_checked_binding");let checkbox4_props={description:"Repeat custom background image"};ctx[2].theme.images.backgroundRepeat!==void 0&&(checkbox4_props.checked=ctx[2].theme.images.backgroundRepeat),checkbox4=new Checkbox({props:checkbox4_props}),binding_callbacks.push(()=>bind$1(checkbox4,"checked",checkbox4_checked_binding)),checkbox4.$on("change",ctx[41]);let each_value_1=ensure_array_like(ctx[11]),each_blocks_1=[];for(let i=0;i<each_value_1.length;i+=1)each_blocks_1[i]=create_each_block_1$7(get_each_context_1$7(ctx,each_value_1,i));const out=__name(i=>transition_out(each_blocks_1[i],1,1,()=>{each_blocks_1[i]=null}),"out");function checkbox5_checked_binding(value){ctx[51](value)}__name(checkbox5_checked_binding,"checkbox5_checked_binding");let checkbox5_props={description:"Hide skribbl footer"};ctx[2].theme.misc.hideFooter!==void 0&&(checkbox5_props.checked=ctx[2].theme.misc.hideFooter),checkbox5=new Checkbox({props:checkbox5_props}),binding_callbacks.push(()=>bind$1(checkbox5,"checked",checkbox5_checked_binding)),checkbox5.$on("change",ctx[52]);function checkbox6_checked_binding(value){ctx[53](value)}__name(checkbox6_checked_binding,"checkbox6_checked_binding");let checkbox6_props={description:"Hide About, News & How-To Panels"};ctx[2].theme.misc.hideSkribblPanels!==void 0&&(checkbox6_props.checked=ctx[2].theme.misc.hideSkribblPanels),checkbox6=new Checkbox({props:checkbox6_props}),binding_callbacks.push(()=>bind$1(checkbox6,"checked",checkbox6_checked_binding)),checkbox6.$on("change",ctx[54]);function checkbox7_checked_binding(value){ctx[55](value)}__name(checkbox7_checked_binding,"checkbox7_checked_binding");let checkbox7_props={description:"Hide avatars below skribbl logo"};ctx[2].theme.misc.hideAvatarLogo!==void 0&&(checkbox7_props.checked=ctx[2].theme.misc.hideAvatarLogo),checkbox7=new Checkbox({props:checkbox7_props}),binding_callbacks.push(()=>bind$1(checkbox7,"checked",checkbox7_checked_binding)),checkbox7.$on("change",ctx[56]);function checkbox8_checked_binding(value){ctx[57](value)}__name(checkbox8_checked_binding,"checkbox8_checked_binding");let checkbox8_props={description:"Hide in-game skribbl logo"};ctx[2].theme.misc.hideInGameLogo!==void 0&&(checkbox8_props.checked=ctx[2].theme.misc.hideInGameLogo),checkbox8=new Checkbox({props:checkbox8_props}),binding_callbacks.push(()=>bind$1(checkbox8,"checked",checkbox8_checked_binding)),checkbox8.$on("change",ctx[58]);let each_value=ensure_array_like(Object.entries(ctx[1])),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$o(get_each_context$o(ctx,each_value,i));return{c(){div0=element$1("div"),h3=element$1("h3"),t0=text("Editing Theme: "),t1=text(t1_value),t2=space(),br0=element$1("br"),t3=space(),create_component(flatbutton0.$$.fragment),t4=space(),create_component(flatbutton1.$$.fragment),t5=space(),create_component(flatbutton2.$$.fragment),t6=space(),div42=element$1("div"),div5=element$1("div"),div2=element$1("div"),div1=element$1("div"),div1.textContent="Theme Name:",t8=space(),input0=element$1("input"),t9=space(),div4=element$1("div"),div3=element$1("div"),div3.textContent="Creator Name:",t11=space(),input1=element$1("input"),t12=space(),details0=element$1("details"),summary0=element$1("summary"),summary0.textContent="Color Scheme",t14=text(`

        Using the color scheme generator, you can easily create a unique color theme for skribbl.`),br1=element$1("br"),t15=text(`
        This overwrites all existing color customizations in "Advanced Color Settings".`),br2=element$1("br"),t16=space(),br3=element$1("br"),t17=space(),div10=element$1("div"),div7=element$1("div"),div6=element$1("div"),div6.textContent="Primary Color:",t19=space(),create_component(colorpickerbutton0.$$.fragment),t20=space(),div9=element$1("div"),div8=element$1("div"),div8.textContent="Text Color:",t22=space(),create_component(colorpickerbutton1.$$.fragment),t23=space(),br4=element$1("br"),t24=space(),div11=element$1("div"),create_component(checkbox0.$$.fragment),t25=space(),create_component(checkbox1.$$.fragment),t26=space(),create_component(checkbox2.$$.fragment),t27=space(),br5=element$1("br"),t28=space(),div12=element$1("div"),create_component(flatbutton3.$$.fragment),t29=space(),details1=element$1("details"),summary1=element$1("summary"),summary1.textContent="Image Settings",t31=space(),div21=element$1("div"),div14=element$1("div"),div13=element$1("div"),div13.textContent="Replace Skribbl Logo:",t33=space(),input2=element$1("input"),t34=space(),div16=element$1("div"),div15=element$1("div"),div15.textContent="Replace Background:",t36=space(),input3=element$1("input"),t37=space(),div18=element$1("div"),div17=element$1("div"),div17.textContent="In-Game Background:",t39=space(),input4=element$1("input"),t40=space(),div20=element$1("div"),div19=element$1("div"),div19.textContent="Container Background:",t42=space(),input5=element$1("input"),t43=space(),br6=element$1("br"),t44=space(),div23=element$1("div"),div22=element$1("div"),create_component(checkbox3.$$.fragment),t45=space(),create_component(colorpickerbutton2.$$.fragment),t46=space(),br7=element$1("br"),t47=space(),div24=element$1("div"),create_component(checkbox4.$$.fragment),t48=space(),details2=element$1("details"),summary2=element$1("summary"),summary2.textContent="Advanced Color Settings",t50=space(),p0=element$1("p"),p0.textContent="Advanced color settings allow you to customize the appearance of skribbl in more detail.",t52=space(),p1=element$1("p"),p1.textContent="These settings are overwritten when the color scheme generator is used.",t54=space(),p2=element$1("p"),p2.textContent="The color names are taken from the skribbl code.",t56=space(),br8=element$1("br"),t57=space(),div27=element$1("div"),div26=element$1("div"),div25=element$1("div");for(let i=0;i<each_blocks_1.length;i+=1)each_blocks_1[i].c();t58=space(),details3=element$1("details"),summary3=element$1("summary"),summary3.textContent="Miscellaneous",t60=space(),div32=element$1("div"),div29=element$1("div"),div28=element$1("div"),div28.textContent="Use Google Font:",t62=space(),input6=element$1("input"),t63=space(),div31=element$1("div"),div30=element$1("div"),div30.textContent="External CSS URL:",t65=space(),input7=element$1("input"),t66=space(),br9=element$1("br"),t67=space(),div37=element$1("div"),div34=element$1("div"),div33=element$1("div"),div33.textContent="Custom CSS:",t69=space(),input8=element$1("input"),t70=space(),div36=element$1("div"),div35=element$1("div"),div35.textContent="HTML Element Injection:",t72=space(),input9=element$1("input"),t73=space(),br10=element$1("br"),t74=space(),div38=element$1("div"),create_component(checkbox5.$$.fragment),t75=space(),create_component(checkbox6.$$.fragment),t76=space(),create_component(checkbox7.$$.fragment),t77=space(),create_component(checkbox8.$$.fragment),t78=space(),details4=element$1("details"),summary4=element$1("summary"),summary4.textContent="Skribbl Style Hooks",t80=space(),p3=element$1("p"),p3.textContent="Skribbl style hooks allow more advanced CSS styling without having to dig through the skribbl css classes.",t82=space(),p4=element$1("p"),p4.textContent="The CSS you write will be applied wherever the skribbl color variable is used.",t84=space(),p5=element$1("p"),p5.textContent="Hover over the ℹ️ icon to display the linked CSS classes.",t86=space(),br11=element$1("br"),t87=space(),div41=element$1("div"),div40=element$1("div"),div39=element$1("div");for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();set_style(h3,"flex-grow","1"),attr(div0,"class","typo-themes-editor-header svelte-1gh1qig"),attr(input0,"type","text"),attr(input0,"class","svelte-1gh1qig"),attr(div2,"class","group svelte-1gh1qig"),attr(input1,"type","text"),attr(input1,"class","svelte-1gh1qig"),attr(div4,"class","group svelte-1gh1qig"),attr(div5,"class","typo-themes-editor-content-section svelte-1gh1qig"),attr(summary0,"class","svelte-1gh1qig"),attr(div7,"class","group svelte-1gh1qig"),attr(div9,"class","group svelte-1gh1qig"),attr(div10,"class","typo-themes-editor-content-section svelte-1gh1qig"),attr(div11,"class","typo-themes-editor-content-section svelte-1gh1qig"),attr(div12,"class","typo-themes-editor-content-section svelte-1gh1qig"),details0.open=!0,attr(details0,"class","svelte-1gh1qig"),attr(summary1,"class","svelte-1gh1qig"),attr(input2,"type","text"),attr(input2,"placeholder","https://link.here/image.gif"),attr(input2,"class","svelte-1gh1qig"),attr(div14,"class","group svelte-1gh1qig"),attr(input3,"type","text"),attr(input3,"placeholder","https://link.here/image.gif"),attr(input3,"class","svelte-1gh1qig"),attr(div16,"class","group svelte-1gh1qig"),attr(input4,"type","text"),attr(input4,"placeholder","https://link.here/image.gif"),attr(input4,"class","svelte-1gh1qig"),attr(div18,"class","group svelte-1gh1qig"),attr(input5,"type","text"),attr(input5,"placeholder","https://link.here/image.gif"),attr(input5,"class","svelte-1gh1qig"),attr(div20,"class","group svelte-1gh1qig"),attr(div21,"class","typo-themes-editor-content-section svelte-1gh1qig"),attr(div22,"class","group svelte-1gh1qig"),attr(div23,"class","typo-themes-editor-content-section svelte-1gh1qig"),attr(div24,"class","typo-themes-editor-content-section svelte-1gh1qig"),details1.open=!0,attr(details1,"class","svelte-1gh1qig"),attr(summary2,"class","svelte-1gh1qig"),attr(div25,"class","color-pickers svelte-1gh1qig"),attr(div26,"class","group svelte-1gh1qig"),attr(div27,"class","typo-themes-editor-content-section svelte-1gh1qig"),attr(details2,"class","svelte-1gh1qig"),attr(summary3,"class","svelte-1gh1qig"),attr(input6,"type","text"),attr(input6,"placeholder","Google Fonts import URL"),attr(input6,"class","svelte-1gh1qig"),attr(div29,"class","group svelte-1gh1qig"),attr(input7,"type","text"),attr(input7,"placeholder","https://some.website/link-to-style.css"),attr(input7,"class","svelte-1gh1qig"),attr(div31,"class","group svelte-1gh1qig"),attr(div32,"class","typo-themes-editor-content-section svelte-1gh1qig"),attr(input8,"type","text"),attr(input8,"placeholder",".logo-big { display: none !important; }"),attr(input8,"class","svelte-1gh1qig"),attr(div34,"class","group svelte-1gh1qig"),attr(input9,"type","text"),attr(input9,"placeholder","<div>hello there</div>"),attr(input9,"class","svelte-1gh1qig"),attr(div36,"class","group svelte-1gh1qig"),attr(div37,"class","typo-themes-editor-content-section svelte-1gh1qig"),attr(div38,"class","typo-themes-editor-content-section svelte-1gh1qig"),attr(details3,"class","svelte-1gh1qig"),attr(summary4,"class","svelte-1gh1qig"),attr(div39,"class","style-hooks svelte-1gh1qig"),attr(div40,"class","group svelte-1gh1qig"),attr(div41,"class","typo-themes-editor-content-section svelte-1gh1qig"),attr(details4,"class","svelte-1gh1qig"),attr(div42,"class","typo-themes-editor-content svelte-1gh1qig")},m(target,anchor){insert(target,div0,anchor),append(div0,h3),append(h3,t0),append(h3,t1),append(div0,t2),append(div0,br0),append(div0,t3),mount_component(flatbutton0,div0,null),append(div0,t4),mount_component(flatbutton1,div0,null),append(div0,t5),mount_component(flatbutton2,div0,null),insert(target,t6,anchor),insert(target,div42,anchor),append(div42,div5),append(div5,div2),append(div2,div1),append(div2,t8),append(div2,input0),set_input_value(input0,ctx[2].theme.meta.name),append(div5,t9),append(div5,div4),append(div4,div3),append(div4,t11),append(div4,input1),set_input_value(input1,ctx[2].theme.meta.author),append(div42,t12),append(div42,details0),append(details0,summary0),append(details0,t14),append(details0,br1),append(details0,t15),append(details0,br2),append(details0,t16),append(details0,br3),append(details0,t17),append(details0,div10),append(div10,div7),append(div7,div6),append(div7,t19),mount_component(colorpickerbutton0,div7,null),append(div10,t20),append(div10,div9),append(div9,div8),append(div9,t22),mount_component(colorpickerbutton1,div9,null),append(details0,t23),append(details0,br4),append(details0,t24),append(details0,div11),mount_component(checkbox0,div11,null),append(div11,t25),mount_component(checkbox1,div11,null),append(div11,t26),mount_component(checkbox2,div11,null),append(details0,t27),append(details0,br5),append(details0,t28),append(details0,div12),mount_component(flatbutton3,div12,null),append(div42,t29),append(div42,details1),append(details1,summary1),append(details1,t31),append(details1,div21),append(div21,div14),append(div14,div13),append(div14,t33),append(div14,input2),set_input_value(input2,ctx[2].theme.images.urlLogo),append(div21,t34),append(div21,div16),append(div16,div15),append(div16,t36),append(div16,input3),set_input_value(input3,ctx[2].theme.images.urlBackground),append(div21,t37),append(div21,div18),append(div18,div17),append(div18,t39),append(div18,input4),set_input_value(input4,ctx[2].theme.images.urlBackgroundGame),append(div21,t40),append(div21,div20),append(div20,div19),append(div20,t42),append(div20,input5),set_input_value(input5,ctx[2].theme.images.containerImages),append(details1,t43),append(details1,br6),append(details1,t44),append(details1,div23),append(div23,div22),mount_component(checkbox3,div22,null),append(div22,t45),mount_component(colorpickerbutton2,div22,null),append(details1,t46),append(details1,br7),append(details1,t47),append(details1,div24),mount_component(checkbox4,div24,null),append(div42,t48),append(div42,details2),append(details2,summary2),append(details2,t50),append(details2,p0),append(details2,t52),append(details2,p1),append(details2,t54),append(details2,p2),append(details2,t56),append(details2,br8),append(details2,t57),append(details2,div27),append(div27,div26),append(div26,div25);for(let i=0;i<each_blocks_1.length;i+=1)each_blocks_1[i]&&each_blocks_1[i].m(div25,null);append(div42,t58),append(div42,details3),append(details3,summary3),append(details3,t60),append(details3,div32),append(div32,div29),append(div29,div28),append(div29,t62),append(div29,input6),set_input_value(input6,ctx[2].theme.misc.fontStyle),append(div32,t63),append(div32,div31),append(div31,div30),append(div31,t65),append(div31,input7),set_input_value(input7,ctx[2].theme.misc.themeCssUrl),append(details3,t66),append(details3,br9),append(details3,t67),append(details3,div37),append(div37,div34),append(div34,div33),append(div34,t69),append(div34,input8),set_input_value(input8,ctx[2].theme.misc.cssText),append(div37,t70),append(div37,div36),append(div36,div35),append(div36,t72),append(div36,input9),set_input_value(input9,ctx[2].theme.misc.htmlText),append(details3,t73),append(details3,br10),append(details3,t74),append(details3,div38),mount_component(checkbox5,div38,null),append(div38,t75),mount_component(checkbox6,div38,null),append(div38,t76),mount_component(checkbox7,div38,null),append(div38,t77),mount_component(checkbox8,div38,null),append(div42,t78),append(div42,details4),append(details4,summary4),append(details4,t80),append(details4,p3),append(details4,t82),append(details4,p4),append(details4,t84),append(details4,p5),append(details4,t86),append(details4,br11),append(details4,t87),append(details4,div41),append(div41,div40),append(div40,div39);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div39,null);current=!0,mounted||(dispose=[listen(input0,"input",ctx[21]),listen(input1,"input",ctx[22]),listen(input2,"input",ctx[29]),listen(input2,"change",ctx[30]),listen(input3,"input",ctx[31]),listen(input3,"change",ctx[32]),listen(input4,"input",ctx[33]),listen(input4,"change",ctx[34]),listen(input5,"input",ctx[35]),listen(input5,"change",ctx[36]),listen(input6,"input",ctx[43]),listen(input6,"change",ctx[44]),listen(input7,"input",ctx[45]),listen(input7,"change",ctx[46]),listen(input8,"input",ctx[47]),listen(input8,"change",ctx[48]),listen(input9,"input",ctx[49]),listen(input9,"change",ctx[50])],mounted=!0)},p(ctx2,dirty){(!current||dirty[0]&4)&&t1_value!==(t1_value=ctx2[2].theme.meta.name+"")&&set_data(t1,t1_value),dirty[0]&4&&input0.value!==ctx2[2].theme.meta.name&&set_input_value(input0,ctx2[2].theme.meta.name),dirty[0]&4&&input1.value!==ctx2[2].theme.meta.author&&set_input_value(input1,ctx2[2].theme.meta.author);const colorpickerbutton0_changes={};!updating_color&&dirty[0]&8&&(updating_color=!0,colorpickerbutton0_changes.color=ctx2[3],add_flush_callback(()=>updating_color=!1)),colorpickerbutton0.$set(colorpickerbutton0_changes);const colorpickerbutton1_changes={};!updating_color_1&&dirty[0]&16&&(updating_color_1=!0,colorpickerbutton1_changes.color=ctx2[4],add_flush_callback(()=>updating_color_1=!1)),colorpickerbutton1.$set(colorpickerbutton1_changes);const checkbox0_changes={};!updating_checked&&dirty[0]&64&&(updating_checked=!0,checkbox0_changes.checked=ctx2[6],add_flush_callback(()=>updating_checked=!1)),checkbox0.$set(checkbox0_changes);const checkbox1_changes={};!updating_checked_1&&dirty[0]&128&&(updating_checked_1=!0,checkbox1_changes.checked=ctx2[7],add_flush_callback(()=>updating_checked_1=!1)),checkbox1.$set(checkbox1_changes);const checkbox2_changes={};!updating_checked_2&&dirty[0]&512&&(updating_checked_2=!0,checkbox2_changes.checked=ctx2[9],add_flush_callback(()=>updating_checked_2=!1)),checkbox2.$set(checkbox2_changes),dirty[0]&4&&input2.value!==ctx2[2].theme.images.urlLogo&&set_input_value(input2,ctx2[2].theme.images.urlLogo),dirty[0]&4&&input3.value!==ctx2[2].theme.images.urlBackground&&set_input_value(input3,ctx2[2].theme.images.urlBackground),dirty[0]&4&&input4.value!==ctx2[2].theme.images.urlBackgroundGame&&set_input_value(input4,ctx2[2].theme.images.urlBackgroundGame),dirty[0]&4&&input5.value!==ctx2[2].theme.images.containerImages&&set_input_value(input5,ctx2[2].theme.images.containerImages);const checkbox3_changes={};!updating_checked_3&&dirty[0]&256&&(updating_checked_3=!0,checkbox3_changes.checked=ctx2[8],add_flush_callback(()=>updating_checked_3=!1)),checkbox3.$set(checkbox3_changes);const colorpickerbutton2_changes={};dirty[0]&293&&(colorpickerbutton2_changes.colorChanged=ctx2[39]),colorpickerbutton2.$set(colorpickerbutton2_changes);const checkbox4_changes={};if(!updating_checked_4&&dirty[0]&4&&(updating_checked_4=!0,checkbox4_changes.checked=ctx2[2].theme.images.backgroundRepeat,add_flush_callback(()=>updating_checked_4=!1)),checkbox4.$set(checkbox4_changes),dirty[0]&2053){each_value_1=ensure_array_like(ctx2[11]);let i;for(i=0;i<each_value_1.length;i+=1){const child_ctx=get_each_context_1$7(ctx2,each_value_1,i);each_blocks_1[i]?(each_blocks_1[i].p(child_ctx,dirty),transition_in(each_blocks_1[i],1)):(each_blocks_1[i]=create_each_block_1$7(child_ctx),each_blocks_1[i].c(),transition_in(each_blocks_1[i],1),each_blocks_1[i].m(div25,null))}for(group_outros(),i=each_value_1.length;i<each_blocks_1.length;i+=1)out(i);check_outros()}dirty[0]&4&&input6.value!==ctx2[2].theme.misc.fontStyle&&set_input_value(input6,ctx2[2].theme.misc.fontStyle),dirty[0]&4&&input7.value!==ctx2[2].theme.misc.themeCssUrl&&set_input_value(input7,ctx2[2].theme.misc.themeCssUrl),dirty[0]&4&&input8.value!==ctx2[2].theme.misc.cssText&&set_input_value(input8,ctx2[2].theme.misc.cssText),dirty[0]&4&&input9.value!==ctx2[2].theme.misc.htmlText&&set_input_value(input9,ctx2[2].theme.misc.htmlText);const checkbox5_changes={};!updating_checked_5&&dirty[0]&4&&(updating_checked_5=!0,checkbox5_changes.checked=ctx2[2].theme.misc.hideFooter,add_flush_callback(()=>updating_checked_5=!1)),checkbox5.$set(checkbox5_changes);const checkbox6_changes={};!updating_checked_6&&dirty[0]&4&&(updating_checked_6=!0,checkbox6_changes.checked=ctx2[2].theme.misc.hideSkribblPanels,add_flush_callback(()=>updating_checked_6=!1)),checkbox6.$set(checkbox6_changes);const checkbox7_changes={};!updating_checked_7&&dirty[0]&4&&(updating_checked_7=!0,checkbox7_changes.checked=ctx2[2].theme.misc.hideAvatarLogo,add_flush_callback(()=>updating_checked_7=!1)),checkbox7.$set(checkbox7_changes);const checkbox8_changes={};if(!updating_checked_8&&dirty[0]&4&&(updating_checked_8=!0,checkbox8_changes.checked=ctx2[2].theme.misc.hideInGameLogo,add_flush_callback(()=>updating_checked_8=!1)),checkbox8.$set(checkbox8_changes),dirty[0]&7){each_value=ensure_array_like(Object.entries(ctx2[1]));let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$o(ctx2,each_value,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block$o(child_ctx),each_blocks[i].c(),each_blocks[i].m(div39,null))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value.length}},i(local){if(!current){transition_in(flatbutton0.$$.fragment,local),transition_in(flatbutton1.$$.fragment,local),transition_in(flatbutton2.$$.fragment,local),transition_in(colorpickerbutton0.$$.fragment,local),transition_in(colorpickerbutton1.$$.fragment,local),transition_in(checkbox0.$$.fragment,local),transition_in(checkbox1.$$.fragment,local),transition_in(checkbox2.$$.fragment,local),transition_in(flatbutton3.$$.fragment,local),transition_in(checkbox3.$$.fragment,local),transition_in(colorpickerbutton2.$$.fragment,local),transition_in(checkbox4.$$.fragment,local);for(let i=0;i<each_value_1.length;i+=1)transition_in(each_blocks_1[i]);transition_in(checkbox5.$$.fragment,local),transition_in(checkbox6.$$.fragment,local),transition_in(checkbox7.$$.fragment,local),transition_in(checkbox8.$$.fragment,local),current=!0}},o(local){transition_out(flatbutton0.$$.fragment,local),transition_out(flatbutton1.$$.fragment,local),transition_out(flatbutton2.$$.fragment,local),transition_out(colorpickerbutton0.$$.fragment,local),transition_out(colorpickerbutton1.$$.fragment,local),transition_out(checkbox0.$$.fragment,local),transition_out(checkbox1.$$.fragment,local),transition_out(checkbox2.$$.fragment,local),transition_out(flatbutton3.$$.fragment,local),transition_out(checkbox3.$$.fragment,local),transition_out(colorpickerbutton2.$$.fragment,local),transition_out(checkbox4.$$.fragment,local),each_blocks_1=each_blocks_1.filter(Boolean);for(let i=0;i<each_blocks_1.length;i+=1)transition_out(each_blocks_1[i]);transition_out(checkbox5.$$.fragment,local),transition_out(checkbox6.$$.fragment,local),transition_out(checkbox7.$$.fragment,local),transition_out(checkbox8.$$.fragment,local),current=!1},d(detaching){detaching&&(detach(div0),detach(t6),detach(div42)),destroy_component(flatbutton0),destroy_component(flatbutton1),destroy_component(flatbutton2),destroy_component(colorpickerbutton0),destroy_component(colorpickerbutton1),destroy_component(checkbox0),destroy_component(checkbox1),destroy_component(checkbox2),destroy_component(flatbutton3),destroy_component(checkbox3),destroy_component(colorpickerbutton2),destroy_component(checkbox4),destroy_each(each_blocks_1,detaching),destroy_component(checkbox5),destroy_component(checkbox6),destroy_component(checkbox7),destroy_component(checkbox8),destroy_each(each_blocks,detaching),mounted=!1,run_all(dispose)}}}__name(create_else_block$9,"create_else_block$9");function create_if_block$l(ctx){let div0,t0,br0,t1,br1,t2,flatbutton0,t3,br2,t4,br3,t5,div2,div1,t7,br4,t8,input,t9,flatbutton1,current,mounted,dispose;return flatbutton0=new Flat_button({props:{content:"Create new Theme",color:"green"}}),flatbutton0.$on("click",ctx[15]),flatbutton1=new Flat_button({props:{content:"Import Theme",color:"blue"}}),flatbutton1.$on("click",ctx[17]),{c(){div0=element$1("div"),t0=text('No theme loaded for editing. Select one of your themes in the "Saved Themes" tab or create a new one!'),br0=element$1("br"),t1=space(),br1=element$1("br"),t2=space(),create_component(flatbutton0.$$.fragment),t3=space(),br2=element$1("br"),t4=space(),br3=element$1("br"),t5=space(),div2=element$1("div"),div1=element$1("div"),div1.textContent="If you have received a theme share ID, you can import it here:",t7=space(),br4=element$1("br"),t8=space(),input=element$1("input"),t9=space(),create_component(flatbutton1.$$.fragment),attr(div0,"class","typo-themes-editor-header svelte-1gh1qig"),attr(input,"type","text"),set_style(input,"width","auto"),set_style(input,"margin-right","1rem"),attr(input,"placeholder","Share ID"),attr(div2,"class","typo-themes-editor-header svelte-1gh1qig")},m(target,anchor){insert(target,div0,anchor),append(div0,t0),append(div0,br0),append(div0,t1),append(div0,br1),append(div0,t2),mount_component(flatbutton0,div0,null),insert(target,t3,anchor),insert(target,br2,anchor),insert(target,t4,anchor),insert(target,br3,anchor),insert(target,t5,anchor),insert(target,div2,anchor),append(div2,div1),append(div2,t7),append(div2,br4),append(div2,t8),append(div2,input),set_input_value(input,ctx[10]),append(div2,t9),mount_component(flatbutton1,div2,null),current=!0,mounted||(dispose=listen(input,"input",ctx[16]),mounted=!0)},p(ctx2,dirty){dirty[0]&1024&&input.value!==ctx2[10]&&set_input_value(input,ctx2[10])},i(local){current||(transition_in(flatbutton0.$$.fragment,local),transition_in(flatbutton1.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton0.$$.fragment,local),transition_out(flatbutton1.$$.fragment,local),current=!1},d(detaching){detaching&&(detach(div0),detach(t3),detach(br2),detach(t4),detach(br3),detach(t5),detach(div2)),destroy_component(flatbutton0),destroy_component(flatbutton1),mounted=!1,dispose()}}}__name(create_if_block$l,"create_if_block$l");function create_each_block_1$7(ctx){let div,t0_value=ctx[61][0].replace("--","")+"",t0,t1,t2,colorpickerbutton,current;function func_1(...args){return ctx[42](ctx[61],...args)}return __name(func_1,"func_1"),colorpickerbutton=new Color_picker_button({props:{color:ctx[61][1],allowAlpha:!0,colorChanged:func_1}}),{c(){div=element$1("div"),t0=text(t0_value),t1=text(":"),t2=space(),create_component(colorpickerbutton.$$.fragment)},m(target,anchor){insert(target,div,anchor),append(div,t0),append(div,t1),insert(target,t2,anchor),mount_component(colorpickerbutton,target,anchor),current=!0},p(new_ctx,dirty){ctx=new_ctx,(!current||dirty[0]&2048)&&t0_value!==(t0_value=ctx[61][0].replace("--","")+"")&&set_data(t0,t0_value);const colorpickerbutton_changes={};dirty[0]&2048&&(colorpickerbutton_changes.color=ctx[61][1]),dirty[0]&2053&&(colorpickerbutton_changes.colorChanged=func_1),colorpickerbutton.$set(colorpickerbutton_changes)},i(local){current||(transition_in(colorpickerbutton.$$.fragment,local),current=!0)},o(local){transition_out(colorpickerbutton.$$.fragment,local),current=!1},d(detaching){detaching&&(detach(div),detach(t2)),destroy_component(colorpickerbutton,detaching)}}}__name(create_each_block_1$7,"create_each_block_1$7");function create_each_block$o(ctx){let div,abbr,t0,abbr_title_value,t1,t2_value=ctx[61][0].replace("--","")+"",t2,t3,t4,input,mounted,dispose;function input_input_handler_1(){ctx[59].call(input,ctx[61])}return __name(input_input_handler_1,"input_input_handler_1"),{c(){div=element$1("div"),abbr=element$1("abbr"),t0=text("ℹ️"),t1=space(),t2=text(t2_value),t3=text(":"),t4=space(),input=element$1("input"),attr(abbr,"title",abbr_title_value=ctx[61][1].join(", ")),attr(input,"type","text"),attr(input,"placeholder","color: red; border: 1px solid green;"),attr(input,"class","svelte-1gh1qig")},m(target,anchor){insert(target,div,anchor),append(div,abbr),append(abbr,t0),append(div,t1),append(div,t2),append(div,t3),insert(target,t4,anchor),insert(target,input,anchor),set_input_value(input,ctx[2].theme.hooks[ctx[61][0]]),mounted||(dispose=[listen(input,"input",input_input_handler_1),listen(input,"change",ctx[60])],mounted=!0)},p(new_ctx,dirty){ctx=new_ctx,dirty[0]&2&&abbr_title_value!==(abbr_title_value=ctx[61][1].join(", "))&&attr(abbr,"title",abbr_title_value),dirty[0]&2&&t2_value!==(t2_value=ctx[61][0].replace("--","")+"")&&set_data(t2,t2_value),dirty[0]&6&&input.value!==ctx[2].theme.hooks[ctx[61][0]]&&set_input_value(input,ctx[2].theme.hooks[ctx[61][0]])},d(detaching){detaching&&(detach(div),detach(t4),detach(input)),mounted=!1,run_all(dispose)}}}__name(create_each_block$o,"create_each_block$o");function create_fragment$I(ctx){let div,current_block_type_index,if_block,current;const if_block_creators=[create_if_block$l,create_else_block$9],if_blocks=[];function select_block_type(ctx2,dirty){return ctx2[2]===void 0?0:1}return __name(select_block_type,"select_block_type"),current_block_type_index=select_block_type(ctx),if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx),{c(){div=element$1("div"),if_block.c(),attr(div,"class","typo-themes-editor svelte-1gh1qig")},m(target,anchor){insert(target,div,anchor),if_blocks[current_block_type_index].m(div,null),current=!0},p(ctx2,dirty){let previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx2),current_block_type_index===previous_block_index?if_blocks[current_block_type_index].p(ctx2,dirty):(group_outros(),transition_out(if_blocks[previous_block_index],1,1,()=>{if_blocks[previous_block_index]=null}),check_outros(),if_block=if_blocks[current_block_type_index],if_block?if_block.p(ctx2,dirty):(if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx2),if_block.c()),transition_in(if_block,1),if_block.m(div,null))},i(local){current||(transition_in(if_block),current=!0)},o(local){transition_out(if_block),current=!1},d(detaching){detaching&&detach(div),if_blocks[current_block_type_index].d()}}}__name(create_fragment$I,"create_fragment$I");function instance$D($$self,$$props,$$invalidate){let $loadedTheme,$activeThemeTab,schemePrimaryColor=Color.fromHex("#4197c5"),schemeTextColor=Color.fromHex("#FFFFFF"),schemeBackgroundTint=Color.fromHex("#2f61eb"),schemeOnInputs=!0,schemeInvertInputBrightness=!1,schemeEnableBackgroundTint=!0,schemeIngame=!1,shareId="",{feature}=$$props,{variableHooks}=$$props;const loadedTheme=feature.loadedEditorThemeStore;component_subscribe($$self,loadedTheme,value=>$$invalidate(2,$loadedTheme=value));const activeThemeTab=feature.activeThemeTabStore;component_subscribe($$self,activeThemeTab,value=>$$invalidate(12,$activeThemeTab=value));let themeColors2=[];const click_handler2=__name(async()=>{const theme=await feature.createLocalTheme();await feature.loadThemeToEditor(theme)},"click_handler");function input_input_handler(){shareId=this.value,$$invalidate(10,shareId)}__name(input_input_handler,"input_input_handler");const click_handler_1=__name(async()=>{const theme=await feature.importTheme(shareId);await feature.activateLocalTheme(theme.theme.meta.id),set_store_value(activeThemeTab,$activeThemeTab="list",$activeThemeTab)},"click_handler_1"),click_handler_2=__name(async()=>{const id2=$loadedTheme.theme.meta.id;await feature.unloadThemeFromEditor(),await feature.removeSavedTheme(id2)},"click_handler_2"),click_handler_3=__name(()=>feature.unloadThemeFromEditor(),"click_handler_3"),click_handler_4=__name(()=>{feature.saveLoadedEditorTheme(),feature.activeThemeTabStore.set("list")},"click_handler_4");function input0_input_handler(){$loadedTheme.theme.meta.name=this.value,loadedTheme.set($loadedTheme)}__name(input0_input_handler,"input0_input_handler");function input1_input_handler(){$loadedTheme.theme.meta.author=this.value,loadedTheme.set($loadedTheme)}__name(input1_input_handler,"input1_input_handler");function colorpickerbutton0_color_binding(value){schemePrimaryColor=value,$$invalidate(3,schemePrimaryColor)}__name(colorpickerbutton0_color_binding,"colorpickerbutton0_color_binding");function colorpickerbutton1_color_binding(value){schemeTextColor=value,$$invalidate(4,schemeTextColor)}__name(colorpickerbutton1_color_binding,"colorpickerbutton1_color_binding");function checkbox0_checked_binding(value){schemeOnInputs=value,$$invalidate(6,schemeOnInputs)}__name(checkbox0_checked_binding,"checkbox0_checked_binding");function checkbox1_checked_binding(value){schemeInvertInputBrightness=value,$$invalidate(7,schemeInvertInputBrightness)}__name(checkbox1_checked_binding,"checkbox1_checked_binding");function checkbox2_checked_binding(value){schemeIngame=value,$$invalidate(9,schemeIngame)}__name(checkbox2_checked_binding,"checkbox2_checked_binding");const click_handler_52=__name(async()=>{await feature.setColorScheme($loadedTheme.theme,schemePrimaryColor,schemeTextColor,schemeOnInputs,schemeInvertInputBrightness,schemeIngame),feature.updateLoadedEditorTheme($loadedTheme)},"click_handler_5");function input2_input_handler(){$loadedTheme.theme.images.urlLogo=this.value,loadedTheme.set($loadedTheme)}__name(input2_input_handler,"input2_input_handler");const change_handler=__name(()=>feature.updateLoadedEditorTheme($loadedTheme),"change_handler");function input3_input_handler(){$loadedTheme.theme.images.urlBackground=this.value,loadedTheme.set($loadedTheme)}__name(input3_input_handler,"input3_input_handler");const change_handler_1=__name(()=>feature.updateLoadedEditorTheme($loadedTheme),"change_handler_1");function input4_input_handler(){$loadedTheme.theme.images.urlBackgroundGame=this.value,loadedTheme.set($loadedTheme)}__name(input4_input_handler,"input4_input_handler");const change_handler_2=__name(()=>feature.updateLoadedEditorTheme($loadedTheme),"change_handler_2");function input5_input_handler(){$loadedTheme.theme.images.containerImages=this.value,loadedTheme.set($loadedTheme)}__name(input5_input_handler,"input5_input_handler");const change_handler_3=__name(()=>feature.updateLoadedEditorTheme($loadedTheme),"change_handler_3");function checkbox3_checked_binding(value){schemeEnableBackgroundTint=value,$$invalidate(8,schemeEnableBackgroundTint),$$invalidate(2,$loadedTheme)}__name(checkbox3_checked_binding,"checkbox3_checked_binding");const change_handler_4=__name(()=>{schemeEnableBackgroundTint?set_store_value(loadedTheme,$loadedTheme.theme.images.backgroundTint=schemeBackgroundTint.hex,$loadedTheme):set_store_value(loadedTheme,$loadedTheme.theme.images.backgroundTint=void 0,$loadedTheme),feature.updateLoadedEditorTheme($loadedTheme)},"change_handler_4"),func2=__name(color=>{$$invalidate(5,schemeBackgroundTint=color),$$invalidate(8,schemeEnableBackgroundTint=!0),set_store_value(loadedTheme,$loadedTheme.theme.images.backgroundTint=color.hex,$loadedTheme),feature.updateLoadedEditorTheme($loadedTheme)},"func");function checkbox4_checked_binding(value){$$self.$$.not_equal($loadedTheme.theme.images.backgroundRepeat,value)&&($loadedTheme.theme.images.backgroundRepeat=value,loadedTheme.set($loadedTheme))}__name(checkbox4_checked_binding,"checkbox4_checked_binding");const change_handler_5=__name(()=>feature.updateLoadedEditorTheme($loadedTheme),"change_handler_5"),func_1=__name((color,update)=>{set_store_value(loadedTheme,$loadedTheme.theme.colors[color[0]]=update.hsl,$loadedTheme),feature.updateLoadedEditorTheme($loadedTheme)},"func_1");function input6_input_handler(){$loadedTheme.theme.misc.fontStyle=this.value,loadedTheme.set($loadedTheme)}__name(input6_input_handler,"input6_input_handler");const change_handler_6=__name(()=>feature.updateLoadedEditorTheme($loadedTheme),"change_handler_6");function input7_input_handler(){$loadedTheme.theme.misc.themeCssUrl=this.value,loadedTheme.set($loadedTheme)}__name(input7_input_handler,"input7_input_handler");const change_handler_7=__name(()=>feature.updateLoadedEditorTheme($loadedTheme),"change_handler_7");function input8_input_handler(){$loadedTheme.theme.misc.cssText=this.value,loadedTheme.set($loadedTheme)}__name(input8_input_handler,"input8_input_handler");const change_handler_8=__name(()=>feature.updateLoadedEditorTheme($loadedTheme),"change_handler_8");function input9_input_handler(){$loadedTheme.theme.misc.htmlText=this.value,loadedTheme.set($loadedTheme)}__name(input9_input_handler,"input9_input_handler");const change_handler_9=__name(()=>feature.updateLoadedEditorTheme($loadedTheme),"change_handler_9");function checkbox5_checked_binding(value){$$self.$$.not_equal($loadedTheme.theme.misc.hideFooter,value)&&($loadedTheme.theme.misc.hideFooter=value,loadedTheme.set($loadedTheme))}__name(checkbox5_checked_binding,"checkbox5_checked_binding");const change_handler_10=__name(()=>feature.updateLoadedEditorTheme($loadedTheme),"change_handler_10");function checkbox6_checked_binding(value){$$self.$$.not_equal($loadedTheme.theme.misc.hideSkribblPanels,value)&&($loadedTheme.theme.misc.hideSkribblPanels=value,loadedTheme.set($loadedTheme))}__name(checkbox6_checked_binding,"checkbox6_checked_binding");const change_handler_11=__name(()=>feature.updateLoadedEditorTheme($loadedTheme),"change_handler_11");function checkbox7_checked_binding(value){$$self.$$.not_equal($loadedTheme.theme.misc.hideAvatarLogo,value)&&($loadedTheme.theme.misc.hideAvatarLogo=value,loadedTheme.set($loadedTheme))}__name(checkbox7_checked_binding,"checkbox7_checked_binding");const change_handler_12=__name(()=>feature.updateLoadedEditorTheme($loadedTheme),"change_handler_12");function checkbox8_checked_binding(value){$$self.$$.not_equal($loadedTheme.theme.misc.hideInGameLogo,value)&&($loadedTheme.theme.misc.hideInGameLogo=value,loadedTheme.set($loadedTheme))}__name(checkbox8_checked_binding,"checkbox8_checked_binding");const change_handler_13=__name(()=>feature.updateLoadedEditorTheme($loadedTheme),"change_handler_13");function input_input_handler_1(color){$loadedTheme.theme.hooks[color[0]]=this.value,loadedTheme.set($loadedTheme)}__name(input_input_handler_1,"input_input_handler_1");const change_handler_14=__name(()=>{feature.updateLoadedEditorTheme($loadedTheme)},"change_handler_14");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature),"variableHooks"in $$props2&&$$invalidate(1,variableHooks=$$props2.variableHooks)},$$self.$$.update=()=>{$$self.$$.dirty[0]&4&&($$invalidate(11,themeColors2=$loadedTheme?Object.entries($loadedTheme.theme.colors).map(entry=>{const color=Color.fromHsl(entry[1][0],entry[1][1],entry[1][2],entry[1][3]);return[entry[0],color]}):[]),$loadedTheme!=null&&$loadedTheme.theme.images.backgroundTint&&($loadedTheme==null?void 0:$loadedTheme.theme.images.backgroundTint)!=="transparent"?($$invalidate(5,schemeBackgroundTint=Color.fromHex($loadedTheme.theme.images.backgroundTint)),$$invalidate(8,schemeEnableBackgroundTint=!0)):$$invalidate(8,schemeEnableBackgroundTint=!1))},[feature,variableHooks,$loadedTheme,schemePrimaryColor,schemeTextColor,schemeBackgroundTint,schemeOnInputs,schemeInvertInputBrightness,schemeEnableBackgroundTint,schemeIngame,shareId,themeColors2,$activeThemeTab,loadedTheme,activeThemeTab,click_handler2,input_input_handler,click_handler_1,click_handler_2,click_handler_3,click_handler_4,input0_input_handler,input1_input_handler,colorpickerbutton0_color_binding,colorpickerbutton1_color_binding,checkbox0_checked_binding,checkbox1_checked_binding,checkbox2_checked_binding,click_handler_52,input2_input_handler,change_handler,input3_input_handler,change_handler_1,input4_input_handler,change_handler_2,input5_input_handler,change_handler_3,checkbox3_checked_binding,change_handler_4,func2,checkbox4_checked_binding,change_handler_5,func_1,input6_input_handler,change_handler_6,input7_input_handler,change_handler_7,input8_input_handler,change_handler_8,input9_input_handler,change_handler_9,checkbox5_checked_binding,change_handler_10,checkbox6_checked_binding,change_handler_11,checkbox7_checked_binding,change_handler_12,checkbox8_checked_binding,change_handler_13,input_input_handler_1,change_handler_14]}__name(instance$D,"instance$D");const _Themes_editor=class _Themes_editor extends SvelteComponent{constructor(options){super(),init(this,options,instance$D,create_fragment$I,safe_not_equal,{feature:0,variableHooks:1},null,[-1,-1,-1])}};__name(_Themes_editor,"Themes_editor");let Themes_editor=_Themes_editor;function get_each_context$n(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[15]=list[i],child_ctx}__name(get_each_context$n,"get_each_context$n");function create_else_block$8(ctx){let div1;return{c(){div1=element$1("div"),div1.innerHTML='<img src="" alt="disabled" style="content: var(--file-img-disabled-gif)" class="svelte-6dmj7f"/> <div>Inactive</div>',attr(div1,"class","active-marker svelte-6dmj7f")},m(target,anchor){insert(target,div1,anchor)},d(detaching){detaching&&detach(div1)}}}__name(create_else_block$8,"create_else_block$8");function create_if_block_5$1(ctx){let div1;return{c(){div1=element$1("div"),div1.innerHTML='<img src="" alt="enabled" style="content: var(--file-img-enabled-gif)" class="svelte-6dmj7f"/> <div>Editing</div>',attr(div1,"class","active-marker svelte-6dmj7f")},m(target,anchor){insert(target,div1,anchor)},d(detaching){detaching&&detach(div1)}}}__name(create_if_block_5$1,"create_if_block_5$1");function create_if_block_4$4(ctx){let div1;return{c(){div1=element$1("div"),div1.innerHTML='<img src="" alt="enabled" style="content: var(--file-img-enabled-gif)" class="svelte-6dmj7f"/> <div>Selected</div>',attr(div1,"class","active-marker svelte-6dmj7f")},m(target,anchor){insert(target,div1,anchor)},d(detaching){detaching&&detach(div1)}}}__name(create_if_block_4$4,"create_if_block_4$4");function create_if_block_3$4(ctx){let span0,t0,t1_value=ctx[15].publicTheme.localVersion+"",t1,t2,span1,t3,t4_value=ctx[15].publicTheme.publicId+"",t4;return{c(){span0=element$1("span"),t0=text("v"),t1=text(t1_value),t2=space(),span1=element$1("span"),t3=text("#"),t4=text(t4_value),attr(span0,"class","svelte-6dmj7f"),attr(span1,"class","svelte-6dmj7f")},m(target,anchor){insert(target,span0,anchor),append(span0,t0),append(span0,t1),insert(target,t2,anchor),insert(target,span1,anchor),append(span1,t3),append(span1,t4)},p(ctx2,dirty){dirty&2&&t1_value!==(t1_value=ctx2[15].publicTheme.localVersion+"")&&set_data(t1,t1_value),dirty&2&&t4_value!==(t4_value=ctx2[15].publicTheme.publicId+"")&&set_data(t4,t4_value)},d(detaching){detaching&&(detach(span0),detach(t2),detach(span1))}}}__name(create_if_block_3$4,"create_if_block_3$4");function create_if_block_2$7(ctx){let flatbutton,current;function click_handler_1(){return ctx[12](ctx[15])}return __name(click_handler_1,"click_handler_1"),flatbutton=new Flat_button({props:{content:"Remove",color:"orange"}}),flatbutton.$on("click",click_handler_1),{c(){create_component(flatbutton.$$.fragment)},m(target,anchor){mount_component(flatbutton,target,anchor),current=!0},p(new_ctx,dirty){ctx=new_ctx},i(local){current||(transition_in(flatbutton.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton.$$.fragment,local),current=!1},d(detaching){destroy_component(flatbutton,detaching)}}}__name(create_if_block_2$7,"create_if_block_2$7");function create_if_block_1$a(ctx){var _a81,_b;let flatbutton,current;function click_handler_2(){return ctx[13](ctx[15])}return __name(click_handler_2,"click_handler_2"),flatbutton=new Flat_button({props:{content:((_a81=ctx[3])==null?void 0:_a81.theme.meta.id)===ctx[15].theme.meta.id?"Editing":"Edit",color:"blue",disabled:((_b=ctx[3])==null?void 0:_b.theme.meta.id)===ctx[15].theme.meta.id}}),flatbutton.$on("click",click_handler_2),{c(){create_component(flatbutton.$$.fragment)},m(target,anchor){mount_component(flatbutton,target,anchor),current=!0},p(new_ctx,dirty){var _a82,_b2;ctx=new_ctx;const flatbutton_changes={};dirty&10&&(flatbutton_changes.content=((_a82=ctx[3])==null?void 0:_a82.theme.meta.id)===ctx[15].theme.meta.id?"Editing":"Edit"),dirty&10&&(flatbutton_changes.disabled=((_b2=ctx[3])==null?void 0:_b2.theme.meta.id)===ctx[15].theme.meta.id),flatbutton.$set(flatbutton_changes)},i(local){current||(transition_in(flatbutton.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton.$$.fragment,local),current=!1},d(detaching){destroy_component(flatbutton,detaching)}}}__name(create_if_block_1$a,"create_if_block_1$a");function create_if_block$k(ctx){var _a81;let flatbutton,current;function click_handler_3(){return ctx[14](ctx[15])}return __name(click_handler_3,"click_handler_3"),flatbutton=new Flat_button({props:{content:"Share",color:"blue",disabled:((_a81=ctx[3])==null?void 0:_a81.theme.meta.id)===ctx[15].theme.meta.id}}),flatbutton.$on("click",click_handler_3),{c(){create_component(flatbutton.$$.fragment)},m(target,anchor){mount_component(flatbutton,target,anchor),current=!0},p(new_ctx,dirty){var _a82;ctx=new_ctx;const flatbutton_changes={};dirty&10&&(flatbutton_changes.disabled=((_a82=ctx[3])==null?void 0:_a82.theme.meta.id)===ctx[15].theme.meta.id),flatbutton.$set(flatbutton_changes)},i(local){current||(transition_in(flatbutton.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton.$$.fragment,local),current=!1},d(detaching){destroy_component(flatbutton,detaching)}}}__name(create_if_block$k,"create_if_block$k");function create_each_block$n(ctx){let div4,div0,b,t0_value=ctx[15].theme.meta.name+"",t0,t1,span,t2_value=ctx[15].publicTheme?"Featured Theme":"Local Theme",t2,t3,div2,t4,div1,t5,t6_value=ctx[15].theme.meta.author+"",t6,t7,t8,div3,flatbutton,t9,t10,t11,t12,current;function select_block_type(ctx2,dirty){var _a81;return ctx2[2]===ctx2[15].theme.meta.id&&ctx2[3]===void 0?create_if_block_4$4:((_a81=ctx2[3])==null?void 0:_a81.theme.meta.id)===ctx2[15].theme.meta.id?create_if_block_5$1:create_else_block$8}__name(select_block_type,"select_block_type");let current_block_type=select_block_type(ctx),if_block0=current_block_type(ctx),if_block1=ctx[4]&&ctx[15].publicTheme&&create_if_block_3$4(ctx);function click_handler2(){return ctx[11](ctx[15])}__name(click_handler2,"click_handler"),flatbutton=new Flat_button({props:{content:ctx[2]===ctx[15].theme.meta.id&&ctx[3]===void 0?"Active":"Activate",disabled:ctx[2]===ctx[15].theme.meta.id&&ctx[3]===void 0,color:"green"}}),flatbutton.$on("click",click_handler2);let if_block2=(ctx[15].publicTheme||ctx[15].enableManage===!0)&&create_if_block_2$7(ctx),if_block3=ctx[15].enableManage===!0&&create_if_block_1$a(ctx),if_block4=ctx[15].enableManage===!0&&create_if_block$k(ctx);return{c(){div4=element$1("div"),div0=element$1("div"),b=element$1("b"),t0=text(t0_value),t1=space(),span=element$1("span"),t2=text(t2_value),t3=space(),div2=element$1("div"),if_block0.c(),t4=space(),div1=element$1("div"),t5=text("by "),t6=text(t6_value),t7=space(),if_block1&&if_block1.c(),t8=space(),div3=element$1("div"),create_component(flatbutton.$$.fragment),t9=space(),if_block2&&if_block2.c(),t10=space(),if_block3&&if_block3.c(),t11=space(),if_block4&&if_block4.c(),t12=space(),attr(b,"class","svelte-6dmj7f"),attr(span,"class","svelte-6dmj7f"),attr(div0,"class","svelte-6dmj7f"),attr(div1,"class","svelte-6dmj7f"),attr(div2,"class","svelte-6dmj7f"),attr(div3,"class","svelte-6dmj7f"),attr(div4,"class","typo-themes-list-item svelte-6dmj7f")},m(target,anchor){insert(target,div4,anchor),append(div4,div0),append(div0,b),append(b,t0),append(div0,t1),append(div0,span),append(span,t2),append(div4,t3),append(div4,div2),if_block0.m(div2,null),append(div2,t4),append(div2,div1),append(div1,t5),append(div1,t6),append(div2,t7),if_block1&&if_block1.m(div2,null),append(div4,t8),append(div4,div3),mount_component(flatbutton,div3,null),append(div3,t9),if_block2&&if_block2.m(div3,null),append(div3,t10),if_block3&&if_block3.m(div3,null),append(div3,t11),if_block4&&if_block4.m(div3,null),append(div4,t12),current=!0},p(new_ctx,dirty){ctx=new_ctx,(!current||dirty&2)&&t0_value!==(t0_value=ctx[15].theme.meta.name+"")&&set_data(t0,t0_value),(!current||dirty&2)&&t2_value!==(t2_value=ctx[15].publicTheme?"Featured Theme":"Local Theme")&&set_data(t2,t2_value),current_block_type!==(current_block_type=select_block_type(ctx))&&(if_block0.d(1),if_block0=current_block_type(ctx),if_block0&&(if_block0.c(),if_block0.m(div2,t4))),(!current||dirty&2)&&t6_value!==(t6_value=ctx[15].theme.meta.author+"")&&set_data(t6,t6_value),ctx[4]&&ctx[15].publicTheme?if_block1?if_block1.p(ctx,dirty):(if_block1=create_if_block_3$4(ctx),if_block1.c(),if_block1.m(div2,null)):if_block1&&(if_block1.d(1),if_block1=null);const flatbutton_changes={};dirty&14&&(flatbutton_changes.content=ctx[2]===ctx[15].theme.meta.id&&ctx[3]===void 0?"Active":"Activate"),dirty&14&&(flatbutton_changes.disabled=ctx[2]===ctx[15].theme.meta.id&&ctx[3]===void 0),flatbutton.$set(flatbutton_changes),ctx[15].publicTheme||ctx[15].enableManage===!0?if_block2?(if_block2.p(ctx,dirty),dirty&2&&transition_in(if_block2,1)):(if_block2=create_if_block_2$7(ctx),if_block2.c(),transition_in(if_block2,1),if_block2.m(div3,t10)):if_block2&&(group_outros(),transition_out(if_block2,1,1,()=>{if_block2=null}),check_outros()),ctx[15].enableManage===!0?if_block3?(if_block3.p(ctx,dirty),dirty&2&&transition_in(if_block3,1)):(if_block3=create_if_block_1$a(ctx),if_block3.c(),transition_in(if_block3,1),if_block3.m(div3,t11)):if_block3&&(group_outros(),transition_out(if_block3,1,1,()=>{if_block3=null}),check_outros()),ctx[15].enableManage===!0?if_block4?(if_block4.p(ctx,dirty),dirty&2&&transition_in(if_block4,1)):(if_block4=create_if_block$k(ctx),if_block4.c(),transition_in(if_block4,1),if_block4.m(div3,null)):if_block4&&(group_outros(),transition_out(if_block4,1,1,()=>{if_block4=null}),check_outros())},i(local){current||(transition_in(flatbutton.$$.fragment,local),transition_in(if_block2),transition_in(if_block3),transition_in(if_block4),current=!0)},o(local){transition_out(flatbutton.$$.fragment,local),transition_out(if_block2),transition_out(if_block3),transition_out(if_block4),current=!1},d(detaching){detaching&&detach(div4),if_block0.d(),if_block1&&if_block1.d(),destroy_component(flatbutton),if_block2&&if_block2.d(),if_block3&&if_block3.d(),if_block4&&if_block4.d()}}}__name(create_each_block$n,"create_each_block$n");function create_fragment$H(ctx){let div0,t1,div1,current,each_value=ensure_array_like(ctx[1]),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$n(get_each_context$n(ctx,each_value,i));const out=__name(i=>transition_out(each_blocks[i],1,1,()=>{each_blocks[i]=null}),"out");return{c(){div0=element$1("div"),div0.textContent="Downloaded and created themes will appear here. Select a theme to change the appearance of skribbl!",t1=space(),div1=element$1("div");for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();attr(div0,"class","typo-themes-list-header svelte-6dmj7f"),attr(div1,"class","typo-themes-list-list svelte-6dmj7f")},m(target,anchor){insert(target,div0,anchor),insert(target,t1,anchor),insert(target,div1,anchor);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div1,null);current=!0},p(ctx2,[dirty]){if(dirty&63){each_value=ensure_array_like(ctx2[1]);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$n(ctx2,each_value,i);each_blocks[i]?(each_blocks[i].p(child_ctx,dirty),transition_in(each_blocks[i],1)):(each_blocks[i]=create_each_block$n(child_ctx),each_blocks[i].c(),transition_in(each_blocks[i],1),each_blocks[i].m(div1,null))}for(group_outros(),i=each_value.length;i<each_blocks.length;i+=1)out(i);check_outros()}},i(local){if(!current){for(let i=0;i<each_value.length;i+=1)transition_in(each_blocks[i]);current=!0}},o(local){each_blocks=each_blocks.filter(Boolean);for(let i=0;i<each_blocks.length;i+=1)transition_out(each_blocks[i]);current=!1},d(detaching){detaching&&(detach(div0),detach(t1),detach(div1)),destroy_each(each_blocks,detaching)}}}__name(create_fragment$H,"create_fragment$H");function instance$C($$self,$$props,$$invalidate){let $savedThemes,$currentThemeId,$loadedEditorTheme,$devmode,$selectedTab,{feature}=$$props;const devmode=feature.devmodeStore;component_subscribe($$self,devmode,value=>$$invalidate(4,$devmode=value));const savedThemes=feature.savedThemesStore;component_subscribe($$self,savedThemes,value=>$$invalidate(1,$savedThemes=value));const currentThemeId=feature.activeThemeStore;component_subscribe($$self,currentThemeId,value=>$$invalidate(2,$currentThemeId=value));const loadedEditorTheme=feature.loadedEditorThemeStore;component_subscribe($$self,loadedEditorTheme,value=>$$invalidate(3,$loadedEditorTheme=value));const selectedTab=feature.activeThemeTabStore;component_subscribe($$self,selectedTab,value=>$$invalidate(5,$selectedTab=value));const click_handler2=__name(theme=>feature.activateLocalTheme(theme.theme.meta.id),"click_handler"),click_handler_1=__name(theme=>feature.removeSavedTheme(theme.theme.meta.id),"click_handler_1"),click_handler_2=__name(theme=>{feature.loadThemeToEditor(theme),set_store_value(selectedTab,$selectedTab="editor",$selectedTab)},"click_handler_2"),click_handler_3=__name(theme=>{feature.shareTheme(theme.theme)},"click_handler_3");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},[feature,$savedThemes,$currentThemeId,$loadedEditorTheme,$devmode,$selectedTab,devmode,savedThemes,currentThemeId,loadedEditorTheme,selectedTab,click_handler2,click_handler_1,click_handler_2,click_handler_3]}__name(instance$C,"instance$C");const _Themes_list=class _Themes_list extends SvelteComponent{constructor(options){super(),init(this,options,instance$C,create_fragment$H,safe_not_equal,{feature:0})}};__name(_Themes_list,"Themes_list");let Themes_list=_Themes_list;function create_if_block_2$6(ctx){let themesbrowser,current;return themesbrowser=new Themes_browser({props:{feature:ctx[0]}}),{c(){create_component(themesbrowser.$$.fragment)},m(target,anchor){mount_component(themesbrowser,target,anchor),current=!0},p(ctx2,dirty){const themesbrowser_changes={};dirty&1&&(themesbrowser_changes.feature=ctx2[0]),themesbrowser.$set(themesbrowser_changes)},i(local){current||(transition_in(themesbrowser.$$.fragment,local),current=!0)},o(local){transition_out(themesbrowser.$$.fragment,local),current=!1},d(detaching){destroy_component(themesbrowser,detaching)}}}__name(create_if_block_2$6,"create_if_block_2$6");function create_if_block_1$9(ctx){let themeseditor,current;return themeseditor=new Themes_editor({props:{feature:ctx[0],variableHooks:ctx[1]}}),{c(){create_component(themeseditor.$$.fragment)},m(target,anchor){mount_component(themeseditor,target,anchor),current=!0},p(ctx2,dirty){const themeseditor_changes={};dirty&1&&(themeseditor_changes.feature=ctx2[0]),dirty&2&&(themeseditor_changes.variableHooks=ctx2[1]),themeseditor.$set(themeseditor_changes)},i(local){current||(transition_in(themeseditor.$$.fragment,local),current=!0)},o(local){transition_out(themeseditor.$$.fragment,local),current=!1},d(detaching){destroy_component(themeseditor,detaching)}}}__name(create_if_block_1$9,"create_if_block_1$9");function create_if_block$j(ctx){let themeslist,current;return themeslist=new Themes_list({props:{feature:ctx[0]}}),{c(){create_component(themeslist.$$.fragment)},m(target,anchor){mount_component(themeslist,target,anchor),current=!0},p(ctx2,dirty){const themeslist_changes={};dirty&1&&(themeslist_changes.feature=ctx2[0]),themeslist.$set(themeslist_changes)},i(local){current||(transition_in(themeslist.$$.fragment,local),current=!0)},o(local){transition_out(themeslist.$$.fragment,local),current=!1},d(detaching){destroy_component(themeslist,detaching)}}}__name(create_if_block$j,"create_if_block$j");function create_fragment$G(ctx){let div2,div0,h30,t1,h31,t3,h32,t5,div1,current_block_type_index,if_block,current,mounted,dispose;const if_block_creators=[create_if_block$j,create_if_block_1$9,create_if_block_2$6],if_blocks=[];function select_block_type(ctx2,dirty){return ctx2[2]==="list"?0:ctx2[2]==="editor"?1:ctx2[2]==="browser"?2:-1}return __name(select_block_type,"select_block_type"),~(current_block_type_index=select_block_type(ctx))&&(if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx)),{c(){div2=element$1("div"),div0=element$1("div"),h30=element$1("h3"),h30.textContent="Saved Themes",t1=space(),h31=element$1("h3"),h31.textContent="Theme Editor",t3=space(),h32=element$1("h3"),h32.textContent="Discover Themes",t5=space(),div1=element$1("div"),if_block&&if_block.c(),attr(h30,"class","svelte-1ikbg14"),toggle_class(h30,"selected",ctx[2]==="list"),attr(h31,"class","svelte-1ikbg14"),toggle_class(h31,"selected",ctx[2]==="editor"),attr(h32,"class","svelte-1ikbg14"),toggle_class(h32,"selected",ctx[2]==="browser"),attr(div0,"class","typo-themes-navigation svelte-1ikbg14"),attr(div1,"class","typo-themes-tab color-scrollbar svelte-1ikbg14"),attr(div2,"class","typo-themes-content svelte-1ikbg14")},m(target,anchor){insert(target,div2,anchor),append(div2,div0),append(div0,h30),append(div0,t1),append(div0,h31),append(div0,t3),append(div0,h32),append(div2,t5),append(div2,div1),~current_block_type_index&&if_blocks[current_block_type_index].m(div1,null),current=!0,mounted||(dispose=[listen(h30,"click",ctx[4]),listen(h31,"click",ctx[5]),listen(h32,"click",ctx[6])],mounted=!0)},p(ctx2,[dirty]){(!current||dirty&4)&&toggle_class(h30,"selected",ctx2[2]==="list"),(!current||dirty&4)&&toggle_class(h31,"selected",ctx2[2]==="editor"),(!current||dirty&4)&&toggle_class(h32,"selected",ctx2[2]==="browser");let previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx2),current_block_type_index===previous_block_index?~current_block_type_index&&if_blocks[current_block_type_index].p(ctx2,dirty):(if_block&&(group_outros(),transition_out(if_blocks[previous_block_index],1,1,()=>{if_blocks[previous_block_index]=null}),check_outros()),~current_block_type_index?(if_block=if_blocks[current_block_type_index],if_block?if_block.p(ctx2,dirty):(if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx2),if_block.c()),transition_in(if_block,1),if_block.m(div1,null)):if_block=null)},i(local){current||(transition_in(if_block),current=!0)},o(local){transition_out(if_block),current=!1},d(detaching){detaching&&detach(div2),~current_block_type_index&&if_blocks[current_block_type_index].d(),mounted=!1,run_all(dispose)}}}__name(create_fragment$G,"create_fragment$G");function instance$B($$self,$$props,$$invalidate){let $selectedTab,{feature}=$$props,{variableHooks}=$$props;const selectedTab=feature.activeThemeTabStore;component_subscribe($$self,selectedTab,value=>$$invalidate(2,$selectedTab=value));const click_handler2=__name(()=>set_store_value(selectedTab,$selectedTab="list",$selectedTab),"click_handler"),click_handler_1=__name(()=>set_store_value(selectedTab,$selectedTab="editor",$selectedTab),"click_handler_1"),click_handler_2=__name(()=>set_store_value(selectedTab,$selectedTab="browser",$selectedTab),"click_handler_2");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature),"variableHooks"in $$props2&&$$invalidate(1,variableHooks=$$props2.variableHooks)},[feature,variableHooks,$selectedTab,selectedTab,click_handler2,click_handler_1,click_handler_2]}__name(instance$B,"instance$B");const _Controls_themes=class _Controls_themes extends SvelteComponent{constructor(options){super(),init(this,options,instance$B,create_fragment$G,safe_not_equal,{feature:0,variableHooks:1})}};__name(_Controls_themes,"Controls_themes");let Controls_themes=_Controls_themes;var __defProp$H=Object.defineProperty,__decorateClass$H=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$H(target,key,result),result},"__decorateClass$H");const _ControlsThemesFeature=class _ControlsThemesFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elementsSetup");__publicField(this,"_cssColorVarSelectorsSetup");__publicField(this,"_apiDataSetup");__publicField(this,"_modalService");__publicField(this,"_toastService");__publicField(this,"_themesService");__publicField(this,"_globalSettingsService");__publicField(this,"name","Themes");__publicField(this,"description","Customize the skribbl.io appearance with pre-made themes or your own style");__publicField(this,"featureId",34);__publicField(this,"_iconComponent");__publicField(this,"_iconClickSubscription");__publicField(this,"_themeResetSubscription");__publicField(this,"_currentThemeSubscription");__publicField(this,"_activeThemeTab$",new BehaviorSubject("list"));__publicField(this,"_themeElements",[])}async onActivate(){const elements2=await this._elementsSetup.complete(),variableHooks=await this._cssColorVarSelectorsSetup.complete();this._iconComponent=new Icon_button({target:elements2.controls,props:{hoverMove:!1,size:"48px",icon:"file-img-themes-gif",name:"Themes",order:3,tooltipAction:this.createTooltip}}),this._iconClickSubscription=this._iconComponent.click$.subscribe(()=>{const themesComponent={componentType:Controls_themes,props:{feature:this,variableHooks}};this._modalService.showModal(themesComponent.componentType,themesComponent.props,"Typo Themes")}),this._themeResetSubscription=this._themesService.savedThemesSetting.changes$.pipe(combineLatestWith(this._themesService.activeThemeSetting.changes$)).subscribe(([themes,activeId])=>{themes.some(t=>t.theme.meta.id===activeId)||this._themesService.activeThemeSetting.setValue(0)}),this._currentThemeSubscription=this._themesService.activeThemeSetting.changes$.pipe(withLatestFrom(this._themesService.savedThemesSetting.changes$),map(([activeId,themes])=>{var _a81;return activeId===0||(_a81=themes.find(t=>t.theme.meta.id===activeId))==null?void 0:_a81.theme}),combineLatestWith(this._themesService.loadedEditorTheme$),map(([activeTheme,loadedTheme])=>(loadedTheme==null?void 0:loadedTheme.theme)??activeTheme)).subscribe(theme=>{this._logger.debug("Active theme changed",theme),this.setThemeElements(theme)})}onDestroy(){var _a81,_b,_c,_d;(_a81=this._iconComponent)==null||_a81.$destroy(),(_b=this._iconClickSubscription)==null||_b.unsubscribe(),this._iconClickSubscription=void 0,(_c=this._themeResetSubscription)==null||_c.unsubscribe(),this._themeResetSubscription=void 0,(_d=this._currentThemeSubscription)==null||_d.unsubscribe(),this._currentThemeSubscription=void 0}get savedThemesStore(){return this._themesService.savedThemesSetting.store}get activeThemeStore(){return this._themesService.activeThemeSetting.store}get loadedEditorThemeStore(){return this._themesService.loadedEditorThemeStore}get activeThemeTabStore(){return fromObservable(this._activeThemeTab$,this._activeThemeTab$.value,value=>this._activeThemeTab$.next(value))}get devmodeStore(){return this._globalSettingsService.settings.devMode.store}async getOnlineThemes(){return(await this._apiDataSetup.complete()).themes}async loadThemeToEditor(theme){const toast=await this._toastService.showLoadingToast("Loading theme to editor");try{await this._themesService.loadThemeToEditor(theme),toast.resolve(`Theme ${theme.theme.meta.name} loaded`)}catch{toast.reject("Failed to load theme")}}updateLoadedEditorTheme(theme){this._themesService.updateLoadedEditorTheme(theme)}async unloadThemeFromEditor(){await this._themesService.unloadThemeFromEditor(),await this._toastService.showToast("Theme unloaded from editor")}async createLocalTheme(){const toast=await this._toastService.showLoadingToast("Creating new theme");try{const theme=await this._themesService.createLocalTheme();return toast.resolve("New theme created"),theme}catch(e){throw toast.reject("Failed to create theme"),e}}async importOldTheme(theme){const toast=await this._toastService.showLoadingToast("Converting old theme..");try{const oldTheme=JSON.parse(theme),newTheme=await this._themesService.importOldTheme(oldTheme.options,oldTheme.name);return toast.resolve("Old theme convert"),newTheme}catch(e){throw toast.reject("Failed to convert theme"),e}}async saveLoadedEditorTheme(){const toast=await this._toastService.showLoadingToast("Saving theme changes");try{const theme=await this._themesService.saveLoadedEditorTheme();return toast.resolve(`Theme ${theme.theme.meta.name} updated`),theme}catch(e){throw toast.reject("Failed to create theme"),e}}async savePublicTheme(theme){const toast=await this._toastService.showLoadingToast("Saving theme");try{const localTheme=await this._themesService.savePublicTheme(theme);toast.resolve(`Theme ${localTheme.theme.meta.name} saved`)}catch{toast.reject("Failed to save theme")}}async activateLocalTheme(id2){const toast=await this._toastService.showLoadingToast("Activating theme");try{const theme=await this._themesService.activateLocalTheme(id2);toast.resolve(`Theme ${theme.theme.meta.name} activated`)}catch{toast.reject("Failed to activate theme")}}async activatePublicTheme(theme){const toast=await this._toastService.showLoadingToast("Activating theme");try{const localTheme=await this._themesService.activatePublicTheme(theme);toast.resolve(`Theme ${localTheme.theme.meta.name} activated`)}catch{toast.reject("Failed to activate theme")}}async removeSavedTheme(localId){const toast=await this._toastService.showLoadingToast("Removing theme");try{const theme=await this._themesService.removeSavedTheme(localId);toast.resolve(`Theme ${theme.theme.meta.name} removed`)}catch{toast.reject("Failed to remove theme")}}async shareTheme(theme){const toast=await this._toastService.showLoadingToast("Sharing theme");try{const id2=await this._themesService.shareTheme(theme);await navigator.clipboard.writeText(id2),toast.resolve(`Share id (${id2}) for theme ${theme.meta.name} copied`)}catch{toast.reject("Failed to share theme")}}async importTheme(shareId){const toast=await this._toastService.showLoadingToast("Importing theme");try{const theme=await this._themesService.importTheme(shareId);return toast.resolve(`Theme ${theme.theme.meta.name} imported`),theme}catch(e){throw toast.reject("Failed to import theme"),e}}async setThemeElements(theme){this._logger.info("Setting theme elements",theme),this._themeElements.forEach(e=>e.remove()),this._themeElements=theme?await this.createThemeElements(theme):[],this._themeElements.forEach(e=>document.body.appendChild(e))}async createThemeElements(theme){const selectorHooks=await this._cssColorVarSelectorsSetup.complete(),themeStyle=generateStyleElementForTheme(theme,selectorHooks),themeFont=generateThemeFontElements(theme),themeHtml=generateThemeCustomHtmlElement(theme),themeExternalCss=generateThemeExternalCssElement(theme),themeBackground=generateThemeBackgroundElement(theme);return[themeStyle,...themeFont,...themeHtml,...themeExternalCss,themeBackground]}async setColorScheme(theme,primary,text2,useOnInputs,invertInputText,useIngame){this._logger.debug("Setting color scheme",theme,primary,text2,useOnInputs,invertInputText,useIngame);const colors=generateColorScheme(primary,text2,useIngame,useOnInputs,invertInputText);theme.colors=colors,await this._toastService.showToast("Color scheme updated")}};__name(_ControlsThemesFeature,"ControlsThemesFeature");let ControlsThemesFeature=_ControlsThemesFeature;__decorateClass$H([inject(ElementsSetup)],ControlsThemesFeature.prototype,"_elementsSetup");__decorateClass$H([inject(CssColorVarSelectorsSetup)],ControlsThemesFeature.prototype,"_cssColorVarSelectorsSetup");__decorateClass$H([inject(ApiDataSetup)],ControlsThemesFeature.prototype,"_apiDataSetup");__decorateClass$H([inject(ModalService)],ControlsThemesFeature.prototype,"_modalService");__decorateClass$H([inject(ToastService)],ControlsThemesFeature.prototype,"_toastService");__decorateClass$H([inject(ThemesService)],ControlsThemesFeature.prototype,"_themesService");__decorateClass$H([inject(GlobalSettingsService)],ControlsThemesFeature.prototype,"_globalSettingsService");var __defProp$G=Object.defineProperty,__getOwnPropDesc$5=Object.getOwnPropertyDescriptor,__decorateClass$G=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$5(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$G(target,key,result),result},"__decorateClass$G"),_a74;let TypoDrawMod=(_a74=class{constructor(){__publicField(this,"disableSkribblSamplingRate",!1)}noEffect(line,pressure,brushStyle){return{lines:[line],style:brushStyle}}},__name(_a74,"TypoDrawMod"),_a74);TypoDrawMod=__decorateClass$G([injectable()],TypoDrawMod);const _ExtensionContainer=class _ExtensionContainer{constructor(_interceptor){__publicField(this,"_diContainer",new Container);__publicField(this,"_logging");__publicField(this,"_logger");__publicField(this,"_events");__publicField(this,"_features");this._interceptor=_interceptor,this.bindCoreServices(),this._logging=this._diContainer.get(LoggingService),this._logger=this._diContainer.get(loggerFactory)(this),this._events=this._diContainer.get(EventsService),this._features=this._diContainer.get(FeaturesService),this._logger.debug("Extension container initialized")}bindCoreServices(){this._diContainer.bind(Interceptor).toConstantValue(this._interceptor),this._diContainer.bind(_ExtensionContainer).toConstantValue(this),this._diContainer.bind(LoggingService).toSelf().inSingletonScope();const logging=this._diContainer.get(LoggingService);this._diContainer.bind(LoggerService).toSelf(),this._diContainer.bind(loggerFactory).toFactory(context=>loggerContext=>{const logger=context.container.get(LoggerService).bindTo(loggerContext);return logging.trackLoggerInstance(logger),logger}),this._diContainer.bind(CommandsService).toSelf().inSingletonScope(),this._diContainer.bind(HotkeysService).toSelf().inSingletonScope(),this._diContainer.bind(TooltipsService).toSelf().inSingletonScope(),this._diContainer.bind(EventsService).toSelf().inSingletonScope(),this._diContainer.bind(TokenService).toSelf().inSingletonScope(),this._diContainer.bind(FeaturesService).toSelf().inSingletonScope()}registerEventProcessors(...events){return events.forEach(event=>{this._diContainer.bind(event.processorType).toSelf().inSingletonScope(),this._diContainer.bind(event.listenerType).toSelf().inRequestScope()}),this}registerFeatures(...features){return features.forEach(feature=>{this._diContainer.bind(feature).toSelf().inSingletonScope();const featureInstance=this._diContainer.get(feature);this._features.registerFeature(featureInstance)}),this}registerSetups(...setups){return setups.forEach(setup=>{this._diContainer.bind(setup).toSelf().inSingletonScope(),isEarlySetup(setup)&&this._diContainer.get(setup).complete()}),this}registerServices(...services){return services.forEach(service=>{service.scope==="singleton"?this._diContainer.bind(service.type).toSelf().inSingletonScope():this._diContainer.bind(service.type).toSelf()}),this}resolveService(service){return this._diContainer.resolve(service)}};__name(_ExtensionContainer,"ExtensionContainer");let ExtensionContainer=_ExtensionContainer;const _ConstantDrawMod=class _ConstantDrawMod extends TypoDrawMod{async applyEffect(line,pressure,brushStyle,eventId,strokeId){const effect=this.applyConstantEffect(line,pressure,brushStyle,eventId,strokeId),awaited=effect instanceof Promise?await effect:effect;return{lines:[awaited.line],style:awaited.style}}noConstantEffect(line,pressure,brushStyle){return{line,style:brushStyle}}};__name(_ConstantDrawMod,"ConstantDrawMod");let ConstantDrawMod=_ConstantDrawMod;const _TypoDrawTool=class _TypoDrawTool extends ConstantDrawMod{constructor(){super(...arguments);__publicField(this,"cursorCanvas",document.createElement("canvas"))}noCommands(){return[]}createSkribblLikeCursor(brushStyle){const color=brushStyle.color.rgbArray;color[3]=.8;const canvasSize=brushStyle.size+2,cursorSize=brushStyle.size,canvas=this.cursorCanvas;canvas.width=canvasSize,canvas.height=canvasSize;const context=canvas.getContext("2d");if(!context)throw new Error("Could not get 2d context");context.clearRect(0,0,canvas.width,canvas.height),context.fillStyle=`rgba(${color[0]}, ${color[1]}, ${color[2]}, ${color[3]})`,context.beginPath(),context.arc(canvasSize/2,canvasSize/2,cursorSize/2-1,0,2*Math.PI),context.fill(),context.strokeStyle="#FFF",context.beginPath(),context.arc(canvasSize/2,canvasSize/2,cursorSize/2-1,0,2*Math.PI),context.stroke(),context.strokeStyle="#000",context.beginPath(),context.arc(canvasSize/2,canvasSize/2,cursorSize/2,0,2*Math.PI),context.stroke();const cursorCenter=canvasSize/2;return{source:`url(${canvas.toDataURL()})`,x:cursorCenter,y:cursorCenter}}};__name(_TypoDrawTool,"TypoDrawTool");let TypoDrawTool=_TypoDrawTool;var __defProp$F=Object.defineProperty,__getOwnPropDesc$4=Object.getOwnPropertyDescriptor,__decorateClass$F=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$4(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$F(target,key,result),result},"__decorateClass$F"),__decorateParam$3=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$3"),_a75;let ToolsService=(_a75=class{constructor(loggerFactory2){__publicField(this,"_prioritizedCanvasEventsSetup");__publicField(this,"_drawingService");__publicField(this,"_toolChangedListener");__publicField(this,"_extensionContainer");__publicField(this,"_lobbyService");__publicField(this,"_sizeChangedListener");__publicField(this,"_colorChangedListener");__publicField(this,"_elementsSetup");__publicField(this,"_logger");__publicField(this,"_activeTool$",new BehaviorSubject(skribblTool.brush));__publicField(this,"_activeMods$",new BehaviorSubject([]));__publicField(this,"_activeBrushStyle$",new BehaviorSubject({color:Color.fromHex("#000000"),size:1}));__publicField(this,"_collapseSignal$",new Subject$1);__publicField(this,"_currentPointerDown$",new BehaviorSubject(null));__publicField(this,"_currentPointerDownPosition$",new BehaviorSubject(null));__publicField(this,"_lastPointerDownPosition$",new BehaviorSubject(null));__publicField(this,"_canvasCursorStyle",document.createElement("style"));this._logger=loggerFactory2(this)}postConstruct(){this._logger.debug("Post construct"),this._toolChangedListener.events$.subscribe(event=>{event.data!==skribblTool.deselected&&event.data!==this._activeTool$.value&&(this._logger.debug("Tool changed event",event.data),this._activeTool$.next(event.data))}),this._activeTool$.pipe(combineLatestWith(this._activeBrushStyle$)).subscribe(async([tool,style])=>{if(tool instanceof TypoDrawTool){this._canvasCursorStyle.parentNode||document.body.appendChild(this._canvasCursorStyle);const cursor=tool.createCursor(style);this._canvasCursorStyle.innerText=`#game-canvas canvas { cursor: ${cursor.source} ${cursor.x} ${cursor.y}, auto !important; }`}else this._canvasCursorStyle.remove()}),this._prioritizedCanvasEventsSetup.complete().then(({add})=>{add("draw")("pointerdown",this.onCanvasDown.bind(this)),add("draw")("pointermove",this.onCanvasMove.bind(this)),document.addEventListener("pointerup",this.onDocumentUp.bind(this))}),this.mapDrawCoordinates().pipe(withLatestFrom(this._lobbyService.lobby$),filter(([,lobby])=>(lobby==null?void 0:lobby.meId)===(lobby==null?void 0:lobby.drawerId)),map(([coords])=>coords),withLatestFrom(this._activeTool$,this._activeMods$,this._activeBrushStyle$)).subscribe(([stroke,tool,mods,style])=>this.processDrawCoordinates(stroke.coordinates[0],stroke.coordinates[1],tool,mods,style,stroke.strokeId)),this._sizeChangedListener.events$.pipe(combineLatestWith(this._colorChangedListener.events$),map(([size,color])=>({size:size.data,color:color.data}))).subscribe(style=>this._activeBrushStyle$.next(style))}async processDrawCoordinates(start,end,tool,mods,style,strokeId){if(this._logger.debug("Activating tool and applying mods",start,end),mods.length===0&&!(tool instanceof TypoDrawTool))return 0;const eventId=Date.now(),allMods=[...mods,...tool instanceof TypoDrawTool?[tool]:[]];let lines=[{from:[start[0],start[1]],to:[end[0],end[1]]}],modStyle={size:style.size,color:Color.fromTypoCode(style.color.typoCode)};const pressure=end[2];for(const mod of allMods){const modLines=[];for(const line of lines){const effect=await mod.applyEffect(line,pressure,modStyle,eventId,strokeId);modLines.push(...effect.lines),modStyle=effect.style,this._logger.debug("Mod applied",mod)}lines=modLines}modStyle.size!==style.size&&(this._logger.debug("Brush size changed by mods",modStyle.size),this._drawingService.setSize(modStyle.size)),modStyle.color.typoCode!==style.color.typoCode&&(this._logger.debug("Brush color changed by mods",modStyle.color),this._drawingService.setColor(modStyle.color));const commands=[];if(tool instanceof TypoDrawTool)for(let line of lines){line={from:[Math.floor(line.from[0]),Math.floor(line.from[1])],to:[Math.floor(line.to[0]),Math.floor(line.to[1])]};const lineCommands=await tool.createCommands(line,pressure,style,eventId,strokeId);lineCommands.length>0?(commands.push(...lineCommands),this._logger.debug("Adding commands created by tool",tool,commands)):this._logger.debug("No draw commands created from tool",tool)}else for(const line of lines){const lineCommand=this._drawingService.createLineCommands([...line.from,...line.to],modStyle.color.skribblCode,modStyle.size);lineCommand!==void 0&&commands.push(lineCommand)}return this._logger.info("Pasting draw commands",commands),await this._drawingService.pasteDrawCommands(commands,!1),commands.length}onCanvasDown(event){if(this._activeMods$.value.length>0&&this._activeTool$.value===skribblTool.brush||this._activeTool$.value instanceof TypoDrawTool){event.stopImmediatePropagation(),this.setSkribblCommandRateBypass(!0),event.currentTarget.setPointerCapture(event.pointerId);const strokeId=Date.now();this._currentPointerDown$.next(strokeId),this._currentPointerDownPosition$.next({strokeId,event}),this._lastPointerDownPosition$.next(event)}}onCanvasMove(event){if(this._activeMods$.value.length>0&&this._activeTool$.value===skribblTool.brush||this._activeTool$.value instanceof TypoDrawTool){event.stopImmediatePropagation();const strokeId=this._currentPointerDown$.value;strokeId!==null&&this._currentPointerDownPosition$.next({event,strokeId})}}onDocumentUp(){this._currentPointerDown$.next(null),this._currentPointerDownPosition$.next(null),this._lastPointerDownPosition$.next(null),this._collapseSignal$.next(void 0),this.setSkribblCommandRateBypass(!1)}setSkribblCommandRateBypass(state){this._logger.debug("Setting skribbl command rate bypass",state),document.body.dataset.bypassCommandRate=state?"true":"false"}mapDrawCoordinates(){return this._currentPointerDown$.pipe(distinctUntilChanged(),filter(down=>down!==null),switchMap(async id2=>{this._logger.debug("Retrieving new rect");const elements2=await this._elementsSetup.complete();return[elements2.canvas,elements2.canvas.getBoundingClientRect(),id2]}),switchMap(([canvas,rect,strokeId])=>this._currentPointerDownPosition$.pipe(filter(data=>data===null||data.strokeId===strokeId),map(data=>data!==null?{coordinates:this.mapPointerEventToDrawCoordinate(data.event,canvas,rect),strokeId}:null))),pairwise(),map(([prev,curr])=>prev===null&&curr!==null?{coordinates:[curr.coordinates,curr.coordinates],strokeId:curr.strokeId}:curr===null||prev===null?null:{coordinates:[prev.coordinates,curr.coordinates],strokeId:curr.strokeId}),filter(coords=>coords!==null))}mapPointerEventToDrawCoordinate(event,canvas,canvasRect){const canvasX=event.offsetX*canvas.width/canvasRect.width,canvasY=event.offsetY*canvas.height/canvasRect.height;return[canvasX,canvasY,event.pointerType==="pen"?event.pressure:void 0]}setSkribblTool(tool){this._logger.debug("Setting skribbl tool",tool),document.dispatchEvent(new CustomEvent("selectSkribblTool",{detail:tool}))}activateTool(tool){if(this._logger.debug("Activating tool",tool),tool===this._activeTool$.value){this._logger.debug("Tool already active",tool);return}tool instanceof TypoDrawTool?this.setSkribblTool(skribblTool.deselected):this.setSkribblTool(tool),this._activeTool$.next(tool),tool instanceof TypoDrawMod&&tool.applyEffect({from:[0,0],to:[0,0]},void 0,{color:Color.fromHex("#000000"),size:1},0,0),tool instanceof TypoDrawTool&&tool.createCommands({from:[0,0],to:[0,0]},void 0,{color:Color.fromHex("#000000"),size:1},0,0)}activateMod(mod){this._logger.debug("Activating mod",mod);let mods=this._activeMods$.value;mod instanceof ConstantDrawMod||(mods=mods.filter(m=>m instanceof ConstantDrawMod)),this._activeMods$.next([...mods,mod])}removeMod(mod){this._logger.debug("Removing mod",mod),this._activeMods$.next(this._activeMods$.value.filter(m=>m!==mod))}get activeTool$(){return this._activeTool$.asObservable()}get activeMods$(){return this._activeMods$.asObservable()}get activeBrushStyle$(){return this._activeBrushStyle$.asObservable()}get lastPointerDownPosition$(){return this._lastPointerDownPosition$.asObservable()}resolveModOrTool(tool){return this._extensionContainer.resolveService(tool)}},__name(_a75,"ToolsService"),_a75);__decorateClass$F([inject(PrioritizedCanvasEventsSetup)],ToolsService.prototype,"_prioritizedCanvasEventsSetup",2);__decorateClass$F([inject(DrawingService)],ToolsService.prototype,"_drawingService",2);__decorateClass$F([inject(ToolChangedEventListener)],ToolsService.prototype,"_toolChangedListener",2);__decorateClass$F([inject(ExtensionContainer)],ToolsService.prototype,"_extensionContainer",2);__decorateClass$F([inject(LobbyService)],ToolsService.prototype,"_lobbyService",2);__decorateClass$F([inject(SizeChangedEventListener)],ToolsService.prototype,"_sizeChangedListener",2);__decorateClass$F([inject(ColorChangedEventListener)],ToolsService.prototype,"_colorChangedListener",2);__decorateClass$F([inject(ElementsSetup)],ToolsService.prototype,"_elementsSetup",2);__decorateClass$F([postConstruct()],ToolsService.prototype,"postConstruct",1);ToolsService=__decorateClass$F([injectable(),__decorateParam$3(0,inject(loggerFactory))],ToolsService);var __defProp$E=Object.defineProperty,__decorateClass$E=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$E(target,key,result),result},"__decorateClass$E");const _MandalaMod=class _MandalaMod extends TypoDrawMod{constructor(){super(...arguments);__publicField(this,"_toolsService");__publicField(this,"description","Draws an additional mirrored line to create a mandala effect.");__publicField(this,"icon","var(--file-img-line-mandala-gif)");__publicField(this,"name","Mandala");__publicField(this,"_mirrorCenterSetting",new ChoiceExtensionSetting("brushlab.mandala.center","center").withName("Mandala Mirror Center").withDescription("The center of the mandala mirroring effect").withChoices([{choice:"click",name:"At last click"},{choice:"center",name:"At canvas center"}]));__publicField(this,"_axisSetting",new ChoiceExtensionSetting("brushlab.mandala.axis","xy").withName("Mandala Mirror Axis").withDescription("The axis where the mandala line will be mirrored on").withChoices([{choice:"x",name:"Horizontal"},{choice:"y",name:"Vertical"},{choice:"xy",name:"Both"}]));__publicField(this,"settings",[this._mirrorCenterSetting,this._axisSetting])}async applyEffect(line,pressure,style){const axis=await firstValueFrom(this._axisSetting.changes$),mirrorCenter=await firstValueFrom(this._mirrorCenterSetting.changes$);let center=[400,300];if(mirrorCenter==="click"){const event=await firstValueFrom(this._toolsService.lastPointerDownPosition$);event?center=[event.offsetX,event.offsetY]:center=line.from}const mirrored=this.calculateMirroredLine(axis,center,line.from,line.to);return{style,lines:[line,mirrored]}}calculateMirroredLine(axis,center,from2,to){return axis==="y"?{from:[center[0]-(from2[0]-center[0]),from2[1]],to:[center[0]-(to[0]-center[0]),to[1]]}:axis==="x"?{from:[from2[0],center[1]-(from2[1]-center[1])],to:[to[0],center[1]-(to[1]-center[1])]}:{from:[center[0]-(from2[0]-center[0]),center[1]-(from2[1]-center[1])],to:[center[0]-(to[0]-center[0]),center[1]-(to[1]-center[1])]}}};__name(_MandalaMod,"MandalaMod");let MandalaMod=_MandalaMod;__decorateClass$E([inject(ToolsService)],MandalaMod.prototype,"_toolsService");const _NoiseMod=class _NoiseMod extends ConstantDrawMod{constructor(){super(...arguments);__publicField(this,"description","Randomly adds noise to drawn lines.");__publicField(this,"icon","var(--file-img-line-noise-gif)");__publicField(this,"name","Noise");__publicField(this,"_scaleSetting",new NumericExtensionSetting("brushlab.noise.scale",5).withName("Noise Scale").withDescription("Select how much noise is added to the line").withSlider(1).withBounds(1,100));__publicField(this,"settings",[this._scaleSetting])}async applyConstantEffect(line,pressure,style){const scale=await firstValueFrom(this._scaleSetting.changes$),randomRotate=(Math.random()-.5)*Math.PI,randomScale=1+(Math.random()-.5)*scale*style.size/40,centerX=(line.from[0]+line.to[0])/2,centerY=(line.from[1]+line.to[1])/2,rotatePoint=__name((x,y,angle)=>{const cos=Math.cos(angle),sin=Math.sin(angle);return[cos*(x-centerX)-sin*(y-centerY)+centerX,sin*(x-centerX)+cos*(y-centerY)+centerY]},"rotatePoint"),from2=rotatePoint(line.from[0],line.from[1],randomRotate),to=rotatePoint(line.to[0],line.to[1],randomRotate);return from2[0]=centerX+(from2[0]-centerX)*randomScale,from2[1]=centerY+(from2[1]-centerY)*randomScale,to[0]=centerX+(to[0]-centerX)*randomScale,to[1]=centerY+(to[1]-centerY)*randomScale,{style,line:{from:from2,to}}}};__name(_NoiseMod,"NoiseMod");let NoiseMod=_NoiseMod;const _ParallelLineMod=class _ParallelLineMod extends TypoDrawMod{constructor(){super(...arguments);__publicField(this,"description","Draws additional parallel lines in a angle and distance. In public lobbies, a max of 1 parallel line should be used.");__publicField(this,"icon","var(--file-img-line-parallel-gif)");__publicField(this,"name","Parallel");__publicField(this,"_distanceSetting",new NumericExtensionSetting("brushlab.parallel.distance",20).withName("Line Distance").withDescription("The distance between the lines").withSlider(1).withBounds(1,100));__publicField(this,"_distanceDependencySetting",new BooleanExtensionSetting("brushlab.parallel.dependency",!1).withName("Size Dependency").withDescription("Make line distance proportionally dependent on brush size"));__publicField(this,"_angleSetting",new NumericExtensionSetting("brushlab.parallel.angle",180).withName("Line Angle").withDescription("The clockwise angle where the parallel lines are drawn with the distance offset").withSlider(1).withBounds(1,360));__publicField(this,"_lineCountSetting",new NumericExtensionSetting("brushlab.parallel.count",1).withName("Line Count").withDescription("The amount of parallel lines drawn").withSlider(1).withBounds(1,4));__publicField(this,"settings",[this._distanceSetting,this._distanceDependencySetting,this._angleSetting,this._lineCountSetting])}async applyEffect(line,pressure,style){const distance=await firstValueFrom(this._distanceSetting.changes$),angle=await firstValueFrom(this._angleSetting.changes$),count=await firstValueFrom(this._lineCountSetting.changes$),dependency=await firstValueFrom(this._distanceDependencySetting.changes$),lines=[],offset=this.getOffset(distance,angle);dependency&&(offset[0]*=style.size/40,offset[1]*=style.size/40);for(let i=0;i<count;i++){const offsetLine={from:[line.from[0]+offset[0]*(i+1),line.from[1]+offset[1]*(i+1)],to:[line.to[0]+offset[0]*(i+1),line.to[1]+offset[1]*(i+1)]};lines.push(offsetLine)}return{style,lines:[line,...lines]}}getOffset(distance,angle){const angleRad=angle*Math.PI/180,x=Math.cos(angleRad)*distance,y=Math.sin(angleRad)*distance;return[x,y]}};__name(_ParallelLineMod,"ParallelLineMod");let ParallelLineMod=_ParallelLineMod;const _RainbowMod=class _RainbowMod extends ConstantDrawMod{constructor(){super(...arguments);__publicField(this,"description","Switches colors while drawing to create a rainbow effect.");__publicField(this,"icon","var(--file-img-line-rainbow-gif)");__publicField(this,"name","Rainbow");__publicField(this,"_rainbowModeSetting",new ChoiceExtensionSetting("brushlab.rainbow.mode","light").withName("Rainbow Colors").withDescription("Choose between the rainbow color shades").withChoices([{choice:"light",name:"Light Colors"},{choice:"dark",name:"Dark Colors"}]));__publicField(this,"_colorSwitchSetting",new NumericExtensionSetting("brushlab.rainbow.distance",20).withName("Color Switch Distance").withDescription("The distance between the color switches").withSlider(1).withBounds(1,100));__publicField(this,"lastSwitch");__publicField(this,"settings",[this._rainbowModeSetting,this._colorSwitchSetting])}async applyConstantEffect(line,pressure,style,eventId){var _a81;const mode=await firstValueFrom(this._rainbowModeSetting.changes$),distance=await firstValueFrom(this._colorSwitchSetting.changes$),colors=Color.skribblColors.filter((color,index)=>index%2===0?mode==="light":mode==="dark");if(this.lastSwitch===void 0||this.lastSwitch.eventId!==eventId&&this.getDistance(this.lastSwitch.position,line.from)>style.size/10*distance){let index=((((_a81=this.lastSwitch)==null?void 0:_a81.index)??-1)+1)%(colors.length-1);index<2&&(index=2);const color=colors[index];style.color=Color.fromRgb(color[0],color[1],color[2]),this.lastSwitch={eventId,position:line.from,index}}return{style,line}}getDistance(from2,to){return Math.sqrt(Math.pow(to[0]-from2[0],2)+Math.pow(to[1]-from2[1],2))}};__name(_RainbowMod,"RainbowMod");let RainbowMod=_RainbowMod;var __defProp$D=Object.defineProperty,__decorateClass$D=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$D(target,key,result),result},"__decorateClass$D");const _SculptMod=class _SculptMod extends TypoDrawMod{constructor(){super(...arguments);__publicField(this,"_toolsService");__publicField(this,"description","Creates a figure by mirroring and connecting the line on a axis.");__publicField(this,"icon","var(--file-img-line-sculpt-gif)");__publicField(this,"name","Sculpt");__publicField(this,"_mirrorCenterSetting",new ChoiceExtensionSetting("brushlab.sculpt.center","center").withName("Sculpt Mirror Center").withDescription("The center of the sculpt figure mirroring effect").withChoices([{choice:"click",name:"At last click"},{choice:"center",name:"At canvas center"}]));__publicField(this,"_axisSetting",new ChoiceExtensionSetting("brushlab.sculpt.axis","xy").withName("Sculpt Mirror Axis").withDescription("The axis where the sculpt figure will be mirrored on").withChoices([{choice:"x",name:"Horizontal"},{choice:"y",name:"Vertical"},{choice:"xy",name:"Both"}]));__publicField(this,"settings",[this._mirrorCenterSetting,this._axisSetting])}async applyEffect(line,pressure,style){const axis=await firstValueFrom(this._axisSetting.changes$),mirrorCenter=await firstValueFrom(this._mirrorCenterSetting.changes$);let center=[400,300];if(mirrorCenter==="click"){const event=await firstValueFrom(this._toolsService.lastPointerDownPosition$);event?center=[event.offsetX,event.offsetY]:center=line.from}const originalLineCenter=[(line.from[0]+line.to[0])/2,(line.from[1]+line.to[1])/2],mirroredLineCenter=this.calculateMirroredPoint(center,originalLineCenter,axis);return{style,lines:[{from:line.from,to:mirroredLineCenter},{from:mirroredLineCenter,to:line.to}]}}calculateMirroredPoint(center,point,axis){return axis==="x"?[point[0],2*center[1]-point[1]]:axis==="y"?[2*center[0]-point[0],point[1]]:[2*center[0]-point[0],2*center[1]-point[1]]}};__name(_SculptMod,"SculptMod");let SculptMod=_SculptMod;__decorateClass$D([inject(ToolsService)],SculptMod.prototype,"_toolsService");const _TiltMod=class _TiltMod extends ConstantDrawMod{constructor(){super(...arguments);__publicField(this,"description","Tilt the line into a direction.");__publicField(this,"icon","var(--file-img-line-tilt-gif)");__publicField(this,"name","Tilt");__publicField(this,"_distanceSetting",new NumericExtensionSetting("brushlab.tilt.size",20).withName("Tilt Size").withDescription("The size of the tilted line").withSlider(1).withBounds(1,100));__publicField(this,"_distanceDependencySetting",new BooleanExtensionSetting("brushlab.tilt.dependency",!1).withName("Size Dependency").withDescription("Make tilt size proportionally dependent on brush size"));__publicField(this,"_angleSetting",new NumericExtensionSetting("brushlab.tilt.angle",180).withName("Tilt Angle").withDescription("The clockwise angle where the tilt lines created").withSlider(1).withBounds(1,360));__publicField(this,"settings",[this._distanceSetting,this._distanceDependencySetting,this._angleSetting])}async applyConstantEffect(line,pressure,style){const distance=await firstValueFrom(this._distanceSetting.changes$),angle=await firstValueFrom(this._angleSetting.changes$),dependency=await firstValueFrom(this._distanceDependencySetting.changes$),offset=this.getOffset(distance,angle-90);dependency&&(offset[0]*=style.size/40,offset[1]*=style.size/40);const offsetLine={from:line.from,to:[line.to[0]+offset[0],line.to[1]+offset[1]]};return{style,line:offsetLine}}getOffset(distance,angle){const angleRad=angle*Math.PI/180,x=Math.cos(angleRad)*distance,y=Math.sin(angleRad)*distance;return[x,y]}};__name(_TiltMod,"TiltMod");let TiltMod=_TiltMod;const _DashTool=class _DashTool extends TypoDrawTool{constructor(){super(...arguments);__publicField(this,"name","Dashed Lines");__publicField(this,"description","Draw dashed lines with a customizable interval and blank size");__publicField(this,"icon","var(--file-img-line-dash-gif)");__publicField(this,"_intervalSetting",new NumericExtensionSetting("brushlab.dash.interval",10).withName("Dash Interval").withDescription("The time interval between making line blanks in milliseconds").withSlider(1).withBounds(1,300));__publicField(this,"_blankSizeSetting",new NumericExtensionSetting("brushlab.dash.blank",20).withName("Blank Size").withDescription("The size of the blanks between dashes, depending on brush size").withSlider(1).withBounds(1,100));__publicField(this,"settings",[this._intervalSetting,this._blankSizeSetting]);__publicField(this,"dashStart");__publicField(this,"lineStart");__publicField(this,"applyConstantEffect",this.noConstantEffect)}createCursor(style){return this.createSkribblLikeCursor(style)}async createCommands(line,pressure,style,eventId){const interval2=await firstValueFrom(this._intervalSetting.changes$),blankSize=await firstValueFrom(this._blankSizeSetting.changes$),now=Date.now();return this.dashStart!==void 0?(this.getDistance(this.dashStart.position,line.from)>style.size/10*blankSize&&(this.dashStart=void 0),[]):this.lineStart!==void 0&&now-this.lineStart.time>interval2?(this.lineStart=void 0,this.dashStart={eventId,position:line.to},[]):(this.lineStart===void 0&&(this.lineStart={eventId,time:now}),[[0,style.color.skribblCode,style.size,...line.from,...line.to]])}getDistance(from2,to){return Math.sqrt(Math.pow(to[0]-from2[0],2)+Math.pow(to[1]-from2[1],2))}};__name(_DashTool,"DashTool");let DashTool=_DashTool;const _DotTool=class _DotTool extends TypoDrawTool{constructor(){super(...arguments);__publicField(this,"name","Dotted Lines");__publicField(this,"description","Draw dotted lines with a customizable interval");__publicField(this,"icon","var(--file-img-line-dot-gif)");__publicField(this,"_intervalSetting",new NumericExtensionSetting("brushlab.dot.interval",10).withName("Dot Interval").withDescription("The time interval between making dots in milliseconds").withSlider(1).withBounds(1,1e3));__publicField(this,"settings",[this._intervalSetting]);__publicField(this,"lastDown",{eventId:0,time:Date.now()});__publicField(this,"applyConstantEffect",this.noConstantEffect)}createCursor(style){return this.createSkribblLikeCursor(style)}async createCommands(line,pressure,style,eventId){const interval2=await firstValueFrom(this._intervalSetting.changes$),now=Date.now();return this.lastDown.eventId===eventId?[[0,style.color.skribblCode,style.size,...line.to,...line.to]]:now-this.lastDown.time>interval2?(this.lastDown.time=now,this.lastDown.eventId=eventId,[[0,style.color.skribblCode,style.size,...line.to,...line.to]]):[]}};__name(_DotTool,"DotTool");let DotTool=_DotTool;var __defProp$C=Object.defineProperty,__decorateClass$C=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$C(target,key,result),result},"__decorateClass$C");const _GridTool=class _GridTool extends TypoDrawTool{constructor(){super(...arguments);__publicField(this,"_toolsService");__publicField(this,"name","Grid Generator");__publicField(this,"description","Click anywhere on the canvas to create a grid");__publicField(this,"icon","var(--file-img-line-grid-gif)");__publicField(this,"_rowsSetting",new NumericExtensionSetting("brushlab.grid.rows",6).withName("Row Count").withDescription("The amount of rows in the grid").withSlider(1).withBounds(1,30));__publicField(this,"_columnsSetting",new NumericExtensionSetting("brushlab.grid.columns",8).withName("Column Count").withDescription("The amount of columns in the grid").withSlider(1).withBounds(1,30));__publicField(this,"settings",[this._rowsSetting,this._columnsSetting]);__publicField(this,"_lastDownEvent",null);__publicField(this,"applyConstantEffect",this.noConstantEffect)}createCursor(){return{source:"var(--file-img-grid_cur-png)",x:7,y:37}}async createCommands(line,pressure,style){const lastPointerDown=await firstValueFrom(this._toolsService.lastPointerDownPosition$);if(this._lastDownEvent===lastPointerDown)return[];this._lastDownEvent=lastPointerDown;const canvasWidth=800,canvasHeight=600,rows=await firstValueFrom(this._rowsSetting.changes$),columns=await firstValueFrom(this._columnsSetting.changes$),rowHeight=Math.ceil(canvasHeight/rows),columnWidth=Math.ceil(canvasWidth/columns),commands=[];for(let i=1;i<rows;i++)commands.push([0,style.color.skribblCode,style.size,0,i*rowHeight,canvasWidth,i*rowHeight]);for(let i=1;i<columns;i++)commands.push([0,style.color.skribblCode,style.size,i*columnWidth,0,i*columnWidth,canvasHeight]);return commands}};__name(_GridTool,"GridTool");let GridTool=_GridTool;__decorateClass$C([inject(ToolsService)],GridTool.prototype,"_toolsService");function create_fragment$F(ctx){let div;return{c(){div=element$1("div"),div.innerHTML=""},m(target,anchor){insert(target,div,anchor)},p:noop$1,i:noop$1,o:noop$1,d(detaching){detaching&&detach(div)}}}__name(create_fragment$F,"create_fragment$F");function instance$A($$self,$$props,$$invalidate){let{feature}=$$props;return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},[feature]}__name(instance$A,"instance$A");const _Drawing_brush_lab_info=class _Drawing_brush_lab_info extends SvelteComponent{constructor(options){super(),init(this,options,instance$A,create_fragment$F,safe_not_equal,{feature:0})}};__name(_Drawing_brush_lab_info,"Drawing_brush_lab_info");let Drawing_brush_lab_info=_Drawing_brush_lab_info;function create_fragment$E(ctx){let div1,div0,mounted,dispose;return{c(){div1=element$1("div"),div0=element$1("div"),attr(div0,"class","icon"),set_style(div0,"background-image",ctx[1]?"url(/img/pen.gif)":"var(--file-img-wand-gif)"),attr(div1,"class","typo-brush-lab-switch tool clickable"),toggle_class(div1,"expanded",ctx[1])},m(target,anchor){insert(target,div1,anchor),append(div1,div0),mounted||(dispose=[listen(div1,"click",ctx[2]),action_destroyer(ctx[0].createTooltip(div1,{title:"Toggle Brush Lab",lock:"Y"}))],mounted=!0)},p(ctx2,[dirty]){dirty&2&&set_style(div0,"background-image",ctx2[1]?"url(/img/pen.gif)":"var(--file-img-wand-gif)"),dirty&2&&toggle_class(div1,"expanded",ctx2[1])},i:noop$1,o:noop$1,d(detaching){detaching&&detach(div1),mounted=!1,run_all(dispose)}}}__name(create_fragment$E,"create_fragment$E");function instance$z($$self,$$props,$$invalidate){let{feature}=$$props,expanded=!1;const click_handler2=__name(()=>$$invalidate(1,expanded=!expanded),"click_handler");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},[feature,expanded,click_handler2]}__name(instance$z,"instance$z");const _Drawing_brush_lab_switch=class _Drawing_brush_lab_switch extends SvelteComponent{constructor(options){super(),init(this,options,instance$z,create_fragment$E,safe_not_equal,{feature:0})}};__name(_Drawing_brush_lab_switch,"Drawing_brush_lab_switch");let Drawing_brush_lab_switch=_Drawing_brush_lab_switch;function get_each_context$m(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[6]=list[i],child_ctx}__name(get_each_context$m,"get_each_context$m");function get_each_context_1$6(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[9]=list[i],child_ctx}__name(get_each_context_1$6,"get_each_context_1$6");function create_each_block_1$6(ctx){let div1,div0,t,feature_createTooltip_action,mounted,dispose;function click_handler_1(){return ctx[4](ctx[9])}return __name(click_handler_1,"click_handler_1"),{c(){div1=element$1("div"),div0=element$1("div"),t=space(),attr(div0,"class","icon"),set_style(div0,"background-image",ctx[9].item.icon),attr(div1,"class","tool clickable"),toggle_class(div1,"selected",ctx[9].active)},m(target,anchor){insert(target,div1,anchor),append(div1,div0),append(div1,t),mounted||(dispose=[action_destroyer(feature_createTooltip_action=ctx[0].createTooltip(div1,{title:ctx[9].item.name,lock:"Y"})),listen(div1,"click",click_handler_1)],mounted=!0)},p(new_ctx,dirty){ctx=new_ctx,dirty&2&&set_style(div0,"background-image",ctx[9].item.icon),feature_createTooltip_action&&is_function(feature_createTooltip_action.update)&&dirty&2&&feature_createTooltip_action.update.call(null,{title:ctx[9].item.name,lock:"Y"}),dirty&2&&toggle_class(div1,"selected",ctx[9].active)},d(detaching){detaching&&detach(div1),mounted=!1,run_all(dispose)}}}__name(create_each_block_1$6,"create_each_block_1$6");function create_each_block$m(ctx){let div1,div0,t,feature_createTooltip_action,mounted,dispose;function click_handler_2(){return ctx[5](ctx[6])}return __name(click_handler_2,"click_handler_2"),{c(){div1=element$1("div"),div0=element$1("div"),t=space(),attr(div0,"class","icon"),set_style(div0,"background-image",ctx[6].item.icon),attr(div1,"class","tool clickable"),toggle_class(div1,"selected",ctx[6].active)},m(target,anchor){insert(target,div1,anchor),append(div1,div0),append(div1,t),mounted||(dispose=[action_destroyer(feature_createTooltip_action=ctx[0].createTooltip(div1,{title:ctx[6].item.name,lock:"Y"})),listen(div1,"click",click_handler_2)],mounted=!0)},p(new_ctx,dirty){ctx=new_ctx,dirty&2&&set_style(div0,"background-image",ctx[6].item.icon),feature_createTooltip_action&&is_function(feature_createTooltip_action.update)&&dirty&2&&feature_createTooltip_action.update.call(null,{title:ctx[6].item.name,lock:"Y"}),dirty&2&&toggle_class(div1,"selected",ctx[6].active)},d(detaching){detaching&&detach(div1),mounted=!1,run_all(dispose)}}}__name(create_each_block$m,"create_each_block$m");function create_fragment$D(ctx){let div5,div2,div1,t0,div3,t1,div4,mounted,dispose,each_value_1=ensure_array_like(ctx[1].mods),each_blocks_1=[];for(let i=0;i<each_value_1.length;i+=1)each_blocks_1[i]=create_each_block_1$6(get_each_context_1$6(ctx,each_value_1,i));let each_value=ensure_array_like(ctx[1].tools),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$m(get_each_context$m(ctx,each_value,i));return{c(){div5=element$1("div"),div2=element$1("div"),div1=element$1("div"),div1.innerHTML='<div class="icon" style="background-image: var(--file-img-wrench-gif)"></div>',t0=space(),div3=element$1("div");for(let i=0;i<each_blocks_1.length;i+=1)each_blocks_1[i].c();t1=space(),div4=element$1("div");for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();attr(div1,"class","tool clickable"),attr(div2,"class","typo-brush-lab-settings"),attr(div3,"class","typo-brush-lab-mods svelte-1tel3ns"),attr(div4,"class","typo-brush-lab-tools svelte-1tel3ns"),attr(div5,"class","typo-brush-lab-group svelte-1tel3ns")},m(target,anchor){insert(target,div5,anchor),append(div5,div2),append(div2,div1),append(div5,t0),append(div5,div3);for(let i=0;i<each_blocks_1.length;i+=1)each_blocks_1[i]&&each_blocks_1[i].m(div3,null);append(div5,t1),append(div5,div4);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div4,null);mounted||(dispose=[action_destroyer(ctx[0].createTooltip(div1,{title:"Brush Lab Settings",lock:"Y"})),listen(div1,"click",ctx[3])],mounted=!0)},p(ctx2,[dirty]){if(dirty&3){each_value_1=ensure_array_like(ctx2[1].mods);let i;for(i=0;i<each_value_1.length;i+=1){const child_ctx=get_each_context_1$6(ctx2,each_value_1,i);each_blocks_1[i]?each_blocks_1[i].p(child_ctx,dirty):(each_blocks_1[i]=create_each_block_1$6(child_ctx),each_blocks_1[i].c(),each_blocks_1[i].m(div3,null))}for(;i<each_blocks_1.length;i+=1)each_blocks_1[i].d(1);each_blocks_1.length=each_value_1.length}if(dirty&3){each_value=ensure_array_like(ctx2[1].tools);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$m(ctx2,each_value,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block$m(child_ctx),each_blocks[i].c(),each_blocks[i].m(div4,null))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value.length}},i:noop$1,o:noop$1,d(detaching){detaching&&detach(div5),destroy_each(each_blocks_1,detaching),destroy_each(each_blocks,detaching),mounted=!1,run_all(dispose)}}}__name(create_fragment$D,"create_fragment$D");function instance$y($$self,$$props,$$invalidate){let $tools,{feature}=$$props;const tools=feature.toolbarItemsStore;component_subscribe($$self,tools,value=>$$invalidate(1,$tools=value));const click_handler2=__name(()=>feature.openBrushLabSettings(),"click_handler"),click_handler_1=__name(mod=>{mod.active?feature.removeMod(mod.item):feature.activateMod(mod.item)},"click_handler_1"),click_handler_2=__name(tool=>{tool.active?feature.activateTool(skribblTool.brush):feature.activateTool(tool.item)},"click_handler_2");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},[feature,$tools,tools,click_handler2,click_handler_1,click_handler_2]}__name(instance$y,"instance$y");const _Drawing_brush_lab_group=class _Drawing_brush_lab_group extends SvelteComponent{constructor(options){super(),init(this,options,instance$y,create_fragment$D,safe_not_equal,{feature:0})}};__name(_Drawing_brush_lab_group,"Drawing_brush_lab_group");let Drawing_brush_lab_group=_Drawing_brush_lab_group;function get_each_context$l(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[9]=list[i],child_ctx}__name(get_each_context$l,"get_each_context$l");function get_each_context_1$5(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[12]=list[i],child_ctx}__name(get_each_context_1$5,"get_each_context_1$5");function get_each_context_2$1(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[12]=list[i],child_ctx}__name(get_each_context_2$1,"get_each_context_2$1");function get_each_context_3$1(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[17]=list[i],child_ctx}__name(get_each_context_3$1,"get_each_context_3$1");function create_each_block_3$1(ctx){let div,img,img_src_value,t0,b,t1_value=ctx[17].item.name+"",t1,mounted,dispose;function click_handler2(){return ctx[4](ctx[17])}return __name(click_handler2,"click_handler"),{c(){div=element$1("div"),img=element$1("img"),t0=space(),b=element$1("b"),t1=text(t1_value),src_url_equal(img.src,img_src_value="")||attr(img,"src",img_src_value),set_style(img,"content",ctx[17].item.icon),attr(img,"alt","icon"),attr(img,"class","svelte-17ek4ye"),attr(b,"class","svelte-17ek4ye"),attr(div,"class","item-sidebar-entry svelte-17ek4ye")},m(target,anchor){insert(target,div,anchor),append(div,img),append(div,t0),append(div,b),append(b,t1),mounted||(dispose=listen(div,"click",click_handler2),mounted=!0)},p(new_ctx,dirty){ctx=new_ctx,dirty&1&&set_style(img,"content",ctx[17].item.icon),dirty&1&&t1_value!==(t1_value=ctx[17].item.name+"")&&set_data(t1,t1_value)},d(detaching){detaching&&detach(div),mounted=!1,dispose()}}}__name(create_each_block_3$1,"create_each_block_3$1");function create_each_block_2$1(ctx){let div,img,img_src_value,t0,b,t1_value=ctx[12].item.name+"",t1,mounted,dispose;function click_handler_1(){return ctx[6](ctx[12])}return __name(click_handler_1,"click_handler_1"),{c(){div=element$1("div"),img=element$1("img"),t0=space(),b=element$1("b"),t1=text(t1_value),src_url_equal(img.src,img_src_value="")||attr(img,"src",img_src_value),set_style(img,"content",ctx[12].item.icon),attr(img,"alt","icon"),attr(img,"class","svelte-17ek4ye"),attr(b,"class","svelte-17ek4ye"),attr(div,"class","item-sidebar-entry svelte-17ek4ye")},m(target,anchor){insert(target,div,anchor),append(div,img),append(div,t0),append(div,b),append(b,t1),mounted||(dispose=listen(div,"click",click_handler_1),mounted=!0)},p(new_ctx,dirty){ctx=new_ctx,dirty&1&&set_style(img,"content",ctx[12].item.icon),dirty&1&&t1_value!==(t1_value=ctx[12].item.name+"")&&set_data(t1,t1_value)},d(detaching){detaching&&detach(div),mounted=!1,dispose()}}}__name(create_each_block_2$1,"create_each_block_2$1");function create_each_block_1$5(ctx){let div,img,img_src_value,t0,b,t1_value=ctx[12].item.name+"",t1,t2,mounted,dispose;function click_handler_2(){return ctx[8](ctx[12])}return __name(click_handler_2,"click_handler_2"),{c(){div=element$1("div"),img=element$1("img"),t0=space(),b=element$1("b"),t1=text(t1_value),t2=space(),src_url_equal(img.src,img_src_value="")||attr(img,"src",img_src_value),set_style(img,"content",ctx[12].item.icon),attr(img,"alt","icon"),attr(img,"class","svelte-17ek4ye"),attr(b,"class","svelte-17ek4ye"),attr(div,"class","item-sidebar-entry svelte-17ek4ye")},m(target,anchor){insert(target,div,anchor),append(div,img),append(div,t0),append(div,b),append(b,t1),append(div,t2),mounted||(dispose=listen(div,"click",click_handler_2),mounted=!0)},p(new_ctx,dirty){ctx=new_ctx,dirty&1&&set_style(img,"content",ctx[12].item.icon),dirty&1&&t1_value!==(t1_value=ctx[12].item.name+"")&&set_data(t1,t1_value)},d(detaching){detaching&&detach(div),mounted=!1,dispose()}}}__name(create_each_block_1$5,"create_each_block_1$5");function create_if_block$i(ctx){let div,current,each_value=ensure_array_like(ctx[1].settings),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$l(get_each_context$l(ctx,each_value,i));const out=__name(i=>transition_out(each_blocks[i],1,1,()=>{each_blocks[i]=null}),"out");return{c(){div=element$1("div");for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();attr(div,"class","item-details-settings-list svelte-17ek4ye")},m(target,anchor){insert(target,div,anchor);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div,null);current=!0},p(ctx2,dirty){if(dirty&2){each_value=ensure_array_like(ctx2[1].settings);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$l(ctx2,each_value,i);each_blocks[i]?(each_blocks[i].p(child_ctx,dirty),transition_in(each_blocks[i],1)):(each_blocks[i]=create_each_block$l(child_ctx),each_blocks[i].c(),transition_in(each_blocks[i],1),each_blocks[i].m(div,null))}for(group_outros(),i=each_value.length;i<each_blocks.length;i+=1)out(i);check_outros()}},i(local){if(!current){for(let i=0;i<each_value.length;i+=1)transition_in(each_blocks[i]);current=!0}},o(local){each_blocks=each_blocks.filter(Boolean);for(let i=0;i<each_blocks.length;i+=1)transition_out(each_blocks[i]);current=!1},d(detaching){detaching&&detach(div),destroy_each(each_blocks,detaching)}}}__name(create_if_block$i,"create_if_block$i");function create_each_block$l(ctx){let div,switch_instance,t,current;const switch_instance_spread_levels=[ctx[9].componentData.props];var switch_value=ctx[9].componentData.componentType;function switch_props(ctx2,dirty){let switch_instance_props={};for(let i=0;i<switch_instance_spread_levels.length;i+=1)switch_instance_props=assign(switch_instance_props,switch_instance_spread_levels[i]);return dirty!==void 0&&dirty&2&&(switch_instance_props=assign(switch_instance_props,get_spread_update(switch_instance_spread_levels,[get_spread_object(ctx2[9].componentData.props)]))),{props:switch_instance_props}}return __name(switch_props,"switch_props"),switch_value&&(switch_instance=construct_svelte_component(switch_value,switch_props(ctx))),{c(){div=element$1("div"),switch_instance&&create_component(switch_instance.$$.fragment),t=space(),attr(div,"class","item-details-settings-item svelte-17ek4ye")},m(target,anchor){insert(target,div,anchor),switch_instance&&mount_component(switch_instance,div,null),append(div,t),current=!0},p(ctx2,dirty){if(dirty&2&&switch_value!==(switch_value=ctx2[9].componentData.componentType)){if(switch_instance){group_outros();const old_component=switch_instance;transition_out(old_component.$$.fragment,1,0,()=>{destroy_component(old_component,1)}),check_outros()}switch_value?(switch_instance=construct_svelte_component(switch_value,switch_props(ctx2,dirty)),create_component(switch_instance.$$.fragment),transition_in(switch_instance.$$.fragment,1),mount_component(switch_instance,div,t)):switch_instance=null}else if(switch_value){const switch_instance_changes=dirty&2?get_spread_update(switch_instance_spread_levels,[get_spread_object(ctx2[9].componentData.props)]):{};switch_instance.$set(switch_instance_changes)}},i(local){current||(switch_instance&&transition_in(switch_instance.$$.fragment,local),current=!0)},o(local){switch_instance&&transition_out(switch_instance.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div),switch_instance&&destroy_component(switch_instance)}}}__name(create_each_block$l,"create_each_block$l");function create_fragment$C(ctx){var _a81,_b;let p0,t3,div3,div0,h30,t5,t6,h31,t8,t9,h32,t11,t12,div2,div1,img,img_src_value,t13,h2,t14_value=((_a81=ctx[1])==null?void 0:_a81.name)+"",t14,t15,b,t16,t17_value=ctx[1]instanceof ConstantDrawMod?ctx[1]instanceof TypoDrawTool?"TOOL":"COMBO MOD":"MOD",t17,t18,t19,p1,t20_value=((_b=ctx[1])==null?void 0:_b.description)+"",t20,t21,current,each_value_3=ensure_array_like(ctx[0].tools),each_blocks_2=[];for(let i=0;i<each_value_3.length;i+=1)each_blocks_2[i]=create_each_block_3$1(get_each_context_3$1(ctx,each_value_3,i));let each_value_2=ensure_array_like(ctx[0].mods.filter(ctx[5])),each_blocks_1=[];for(let i=0;i<each_value_2.length;i+=1)each_blocks_1[i]=create_each_block_2$1(get_each_context_2$1(ctx,each_value_2,i));let each_value_1=ensure_array_like(ctx[0].mods.filter(ctx[7])),each_blocks=[];for(let i=0;i<each_value_1.length;i+=1)each_blocks[i]=create_each_block_1$5(get_each_context_1$5(ctx,each_value_1,i));let if_block=ctx[1]!==void 0&&ctx[1].settings.length>0&&create_if_block$i(ctx);return{c(){var _a82;p0=element$1("p"),p0.innerHTML=`The Brush Laboratory has many mods and tools to create unique masterpices.<br/>
  Below, you can find all available tools and mods and their settings.<br/>
  Additionally to a tool, you can select one mod and multiple combo mods.`,t3=space(),div3=element$1("div"),div0=element$1("div"),h30=element$1("h3"),h30.textContent="Tools",t5=space();for(let i=0;i<each_blocks_2.length;i+=1)each_blocks_2[i].c();t6=space(),h31=element$1("h3"),h31.textContent="Mods",t8=space();for(let i=0;i<each_blocks_1.length;i+=1)each_blocks_1[i].c();t9=space(),h32=element$1("h3"),h32.textContent="Combo Mods",t11=space();for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();t12=space(),div2=element$1("div"),div1=element$1("div"),img=element$1("img"),t13=space(),h2=element$1("h2"),t14=text(t14_value),t15=space(),b=element$1("b"),t16=text("("),t17=text(t17_value),t18=text(")"),t19=space(),p1=element$1("p"),t20=text(t20_value),t21=space(),if_block&&if_block.c(),attr(h30,"class","svelte-17ek4ye"),attr(h31,"class","svelte-17ek4ye"),attr(h32,"class","svelte-17ek4ye"),attr(div0,"class","item-sidebar svelte-17ek4ye"),src_url_equal(img.src,img_src_value="")||attr(img,"src",img_src_value),set_style(img,"content",(_a82=ctx[1])==null?void 0:_a82.icon),attr(img,"alt","icon"),attr(img,"class","svelte-17ek4ye"),attr(b,"class","svelte-17ek4ye"),attr(div1,"class","item-title svelte-17ek4ye"),attr(div2,"class","item-details svelte-17ek4ye"),attr(div3,"class","item-selection svelte-17ek4ye")},m(target,anchor){insert(target,p0,anchor),insert(target,t3,anchor),insert(target,div3,anchor),append(div3,div0),append(div0,h30),append(div0,t5);for(let i=0;i<each_blocks_2.length;i+=1)each_blocks_2[i]&&each_blocks_2[i].m(div0,null);append(div0,t6),append(div0,h31),append(div0,t8);for(let i=0;i<each_blocks_1.length;i+=1)each_blocks_1[i]&&each_blocks_1[i].m(div0,null);append(div0,t9),append(div0,h32),append(div0,t11);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div0,null);append(div3,t12),append(div3,div2),append(div2,div1),append(div1,img),append(div1,t13),append(div1,h2),append(h2,t14),append(div1,t15),append(div1,b),append(b,t16),append(b,t17),append(b,t18),append(div2,t19),append(div2,p1),append(p1,t20),append(div2,t21),if_block&&if_block.m(div2,null),current=!0},p(ctx2,[dirty]){var _a82,_b2,_c;if(dirty&3){each_value_3=ensure_array_like(ctx2[0].tools);let i;for(i=0;i<each_value_3.length;i+=1){const child_ctx=get_each_context_3$1(ctx2,each_value_3,i);each_blocks_2[i]?each_blocks_2[i].p(child_ctx,dirty):(each_blocks_2[i]=create_each_block_3$1(child_ctx),each_blocks_2[i].c(),each_blocks_2[i].m(div0,t6))}for(;i<each_blocks_2.length;i+=1)each_blocks_2[i].d(1);each_blocks_2.length=each_value_3.length}if(dirty&3){each_value_2=ensure_array_like(ctx2[0].mods.filter(ctx2[5]));let i;for(i=0;i<each_value_2.length;i+=1){const child_ctx=get_each_context_2$1(ctx2,each_value_2,i);each_blocks_1[i]?each_blocks_1[i].p(child_ctx,dirty):(each_blocks_1[i]=create_each_block_2$1(child_ctx),each_blocks_1[i].c(),each_blocks_1[i].m(div0,t9))}for(;i<each_blocks_1.length;i+=1)each_blocks_1[i].d(1);each_blocks_1.length=each_value_2.length}if(dirty&3){each_value_1=ensure_array_like(ctx2[0].mods.filter(ctx2[7]));let i;for(i=0;i<each_value_1.length;i+=1){const child_ctx=get_each_context_1$5(ctx2,each_value_1,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block_1$5(child_ctx),each_blocks[i].c(),each_blocks[i].m(div0,null))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value_1.length}(!current||dirty&2)&&set_style(img,"content",(_a82=ctx2[1])==null?void 0:_a82.icon),(!current||dirty&2)&&t14_value!==(t14_value=((_b2=ctx2[1])==null?void 0:_b2.name)+"")&&set_data(t14,t14_value),(!current||dirty&2)&&t17_value!==(t17_value=ctx2[1]instanceof ConstantDrawMod?ctx2[1]instanceof TypoDrawTool?"TOOL":"COMBO MOD":"MOD")&&set_data(t17,t17_value),(!current||dirty&2)&&t20_value!==(t20_value=((_c=ctx2[1])==null?void 0:_c.description)+"")&&set_data(t20,t20_value),ctx2[1]!==void 0&&ctx2[1].settings.length>0?if_block?(if_block.p(ctx2,dirty),dirty&2&&transition_in(if_block,1)):(if_block=create_if_block$i(ctx2),if_block.c(),transition_in(if_block,1),if_block.m(div2,null)):if_block&&(group_outros(),transition_out(if_block,1,1,()=>{if_block=null}),check_outros())},i(local){current||(transition_in(if_block),current=!0)},o(local){transition_out(if_block),current=!1},d(detaching){detaching&&(detach(p0),detach(t3),detach(div3)),destroy_each(each_blocks_2,detaching),destroy_each(each_blocks_1,detaching),destroy_each(each_blocks,detaching),if_block&&if_block.d()}}}__name(create_fragment$C,"create_fragment$C");function instance$x($$self,$$props,$$invalidate){let $items,{feature}=$$props;const items=feature.toolbarItemsStore;component_subscribe($$self,items,value=>$$invalidate(0,$items=value));let selectedItem;const click_handler2=__name(tool=>$$invalidate(1,selectedItem=tool.item),"click_handler"),func2=__name(mod=>!(mod.item instanceof ConstantDrawMod),"func"),click_handler_1=__name(mod=>$$invalidate(1,selectedItem=mod.item),"click_handler_1"),func_1=__name(mod=>mod.item instanceof ConstantDrawMod,"func_1"),click_handler_2=__name(mod=>$$invalidate(1,selectedItem=mod.item),"click_handler_2");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(3,feature=$$props2.feature)},$$self.$$.update=()=>{var _a81;$$self.$$.dirty&1&&$$invalidate(1,selectedItem=(_a81=$items.tools.find(tool=>tool.active)??$items.mods.find(mod=>mod.active)??$items.tools[0])==null?void 0:_a81.item)},[$items,selectedItem,items,feature,click_handler2,func2,click_handler_1,func_1,click_handler_2]}__name(instance$x,"instance$x");const _Drawing_brush_lab_manage=class _Drawing_brush_lab_manage extends SvelteComponent{constructor(options){super(),init(this,options,instance$x,create_fragment$C,safe_not_equal,{feature:3})}};__name(_Drawing_brush_lab_manage,"Drawing_brush_lab_manage");let Drawing_brush_lab_manage=_Drawing_brush_lab_manage;var __defProp$B=Object.defineProperty,__decorateClass$B=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$B(target,key,result),result},"__decorateClass$B");const _DrawingBrushLabFeature=class _DrawingBrushLabFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_toolsService");__publicField(this,"_elementsSetup");__publicField(this,"_modalService");__publicField(this,"name","Brush Laboratory");__publicField(this,"description","Add custom drawing tools for special effects to the toolbar");__publicField(this,"featureId",39);__publicField(this,"_labSwitchComponent");__publicField(this,"_labGroupComponent");__publicField(this,"_toolbarItems$",new BehaviorSubject({tools:[],mods:[]}));__publicField(this,"_items",[ParallelLineMod,MandalaMod,SculptMod,DotTool,DashTool,RainbowMod,GridTool,NoiseMod,TiltMod])}get featureInfoComponent(){return{componentType:Drawing_brush_lab_info,props:{feature:this}}}async onActivate(){const elements2=await this._elementsSetup.complete();this._labGroupComponent=new Drawing_brush_lab_group({target:elements2.skribblToolbar,props:{feature:this}}),this._labSwitchComponent=new Drawing_brush_lab_switch({target:elements2.skribblActions,props:{feature:this}}),this.createItems()}async onDestroy(){this._labSwitchComponent&&(this._labSwitchComponent.$destroy(),this._labSwitchComponent=void 0),this._labGroupComponent&&(this._labGroupComponent.$destroy(),this._labGroupComponent=void 0),(await firstValueFrom(this._toolbarItems$)).mods.forEach(({item})=>this._toolsService.removeMod(item)),this._toolsService.activateTool(skribblTool.brush)}get toolbarItemsStore(){return fromObservable(this._toolbarItems$.pipe(combineLatestWith(this._toolsService.activeTool$,this._toolsService.activeMods$),map(([items,activeTool,activeMods])=>({mods:items.mods.map(item=>({item:item.item,active:activeMods.includes(item.item)})),tools:items.tools.map(item=>({item:item.item,active:activeTool===item.item}))}))),this._toolbarItems$.value)}createItems(){const items=this._items.map(item=>this._toolsService.resolveModOrTool(item)),tools=items.filter(item=>item instanceof TypoDrawTool).map(item=>({item,active:!1})),mods=items.filter(item=>!(item instanceof TypoDrawTool)).map(item=>({item,active:!1}));this._toolbarItems$.next({tools,mods})}activateTool(tool){this._toolsService.activateTool(tool)}activateMod(mod){this._toolsService.activateMod(mod)}removeMod(mod){this._toolsService.removeMod(mod)}openBrushLabSettings(){const componentData={componentType:Drawing_brush_lab_manage,props:{feature:this}};this._modalService.showModal(componentData.componentType,componentData.props,"Brush Laboratory")}};__name(_DrawingBrushLabFeature,"DrawingBrushLabFeature");let DrawingBrushLabFeature=_DrawingBrushLabFeature;__decorateClass$B([inject(ToolsService)],DrawingBrushLabFeature.prototype,"_toolsService");__decorateClass$B([inject(ElementsSetup)],DrawingBrushLabFeature.prototype,"_elementsSetup");__decorateClass$B([inject(ModalService)],DrawingBrushLabFeature.prototype,"_modalService");function create_fragment$B(ctx){let t0,br0,t1,br1,t2,h3,t4,b,t6,br2,t7;return{c(){t0=text("Using custom palettes, you can customize the colors available in the typo toolbar."),br0=element$1("br"),t1=space(),br1=element$1("br"),t2=space(),h3=element$1("h3"),h3.textContent="⚠️ Warning:",t4=text(`
Only `),b=element$1("b"),b.textContent="typo users can see custom colors",t6=text(", other players will not see anything until the next time you clear the canvas."),br2=element$1("br"),t7=text(`
Use custom colors and custom palettes only when you're in free draw mode, or when everyone in the lobby has typo installed.`)},m(target,anchor){insert(target,t0,anchor),insert(target,br0,anchor),insert(target,t1,anchor),insert(target,br1,anchor),insert(target,t2,anchor),insert(target,h3,anchor),insert(target,t4,anchor),insert(target,b,anchor),insert(target,t6,anchor),insert(target,br2,anchor),insert(target,t7,anchor)},p:noop$1,i:noop$1,o:noop$1,d(detaching){detaching&&(detach(t0),detach(br0),detach(t1),detach(br1),detach(t2),detach(h3),detach(t4),detach(b),detach(t6),detach(br2),detach(t7))}}}__name(create_fragment$B,"create_fragment$B");const _Drawing_color_palettes_info=class _Drawing_color_palettes_info extends SvelteComponent{constructor(options){super(),init(this,options,null,create_fragment$B,safe_not_equal,{})}};__name(_Drawing_color_palettes_info,"Drawing_color_palettes_info");let Drawing_color_palettes_info=_Drawing_color_palettes_info;function get_each_context$k(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[16]=list[i],child_ctx[17]=list,child_ctx[18]=i,child_ctx}__name(get_each_context$k,"get_each_context$k");function create_each_block$k(ctx){let div,colorpickerbutton,updating_color,t,current;function colorpickerbutton_color_binding(value){ctx[9](value,ctx[16],ctx[17],ctx[18])}__name(colorpickerbutton_color_binding,"colorpickerbutton_color_binding");let colorpickerbutton_props={height:"auto"};return ctx[16]!==void 0&&(colorpickerbutton_props.color=ctx[16]),colorpickerbutton=new Color_picker_button({props:colorpickerbutton_props}),binding_callbacks.push(()=>bind$1(colorpickerbutton,"color",colorpickerbutton_color_binding)),{c(){div=element$1("div"),create_component(colorpickerbutton.$$.fragment),t=space(),attr(div,"class","typo-palette-builder-color")},m(target,anchor){insert(target,div,anchor),mount_component(colorpickerbutton,div,null),append(div,t),current=!0},p(new_ctx,dirty){ctx=new_ctx;const colorpickerbutton_changes={};!updating_color&&dirty&16&&(updating_color=!0,colorpickerbutton_changes.color=ctx[16],add_flush_callback(()=>updating_color=!1)),colorpickerbutton.$set(colorpickerbutton_changes)},i(local){current||(transition_in(colorpickerbutton.$$.fragment,local),current=!0)},o(local){transition_out(colorpickerbutton.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div),destroy_component(colorpickerbutton)}}}__name(create_each_block$k,"create_each_block$k");function create_if_block_4$3(ctx){let flatbutton,current;return flatbutton=new Flat_button({props:{color:"green",content:"Save Palette"}}),flatbutton.$on("click",ctx[10]),{c(){create_component(flatbutton.$$.fragment)},m(target,anchor){mount_component(flatbutton,target,anchor),current=!0},p:noop$1,i(local){current||(transition_in(flatbutton.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton.$$.fragment,local),current=!1},d(detaching){destroy_component(flatbutton,detaching)}}}__name(create_if_block_4$3,"create_if_block_4$3");function create_if_block_3$3(ctx){let flatbutton,current;return flatbutton=new Flat_button({props:{color:"orange",content:"Delete Palette"}}),flatbutton.$on("click",ctx[11]),{c(){create_component(flatbutton.$$.fragment)},m(target,anchor){mount_component(flatbutton,target,anchor),current=!0},p:noop$1,i(local){current||(transition_in(flatbutton.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton.$$.fragment,local),current=!1},d(detaching){destroy_component(flatbutton,detaching)}}}__name(create_if_block_3$3,"create_if_block_3$3");function create_if_block_2$5(ctx){let flatbutton,current;return flatbutton=new Flat_button({props:{color:"blue",content:"Export to clipboard"}}),flatbutton.$on("click",ctx[12]),{c(){create_component(flatbutton.$$.fragment)},m(target,anchor){mount_component(flatbutton,target,anchor),current=!0},p:noop$1,i(local){current||(transition_in(flatbutton.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton.$$.fragment,local),current=!1},d(detaching){destroy_component(flatbutton,detaching)}}}__name(create_if_block_2$5,"create_if_block_2$5");function create_if_block_1$8(ctx){let flatbutton,current;return flatbutton=new Flat_button({props:{content:"Add Color",color:"green"}}),flatbutton.$on("click",ctx[13]),{c(){create_component(flatbutton.$$.fragment)},m(target,anchor){mount_component(flatbutton,target,anchor),current=!0},p:noop$1,i(local){current||(transition_in(flatbutton.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton.$$.fragment,local),current=!1},d(detaching){destroy_component(flatbutton,detaching)}}}__name(create_if_block_1$8,"create_if_block_1$8");function create_if_block$h(ctx){let flatbutton,current;return flatbutton=new Flat_button({props:{content:"Remove Color",color:"orange"}}),flatbutton.$on("click",ctx[14]),{c(){create_component(flatbutton.$$.fragment)},m(target,anchor){mount_component(flatbutton,target,anchor),current=!0},p:noop$1,i(local){current||(transition_in(flatbutton.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton.$$.fragment,local),current=!1},d(detaching){destroy_component(flatbutton,detaching)}}}__name(create_if_block$h,"create_if_block$h");function create_fragment$A(ctx){let div3,div1,b0,t1,input0,input0_disabled_value,t2,b1,t4,input1,input1_disabled_value,t5,b2,t7,div0,t8,div2,t9,t10,t11,br,t12,t13,current,mounted,dispose,each_value=ensure_array_like(ctx[4]),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$k(get_each_context$k(ctx,each_value,i));const out=__name(i=>transition_out(each_blocks[i],1,1,()=>{each_blocks[i]=null}),"out");let if_block0=ctx[0]&&create_if_block_4$3(ctx),if_block1=ctx[2]&&create_if_block_3$3(ctx),if_block2=ctx[1]&&create_if_block_2$5(ctx),if_block3=ctx[0]&&create_if_block_1$8(ctx),if_block4=ctx[0]&&create_if_block$h(ctx);return{c(){div3=element$1("div"),div1=element$1("div"),b0=element$1("b"),b0.textContent="Palette Name",t1=space(),input0=element$1("input"),t2=space(),b1=element$1("b"),b1.textContent="Columns per row",t4=space(),input1=element$1("input"),t5=space(),b2=element$1("b"),b2.textContent="Palette colors",t7=space(),div0=element$1("div");for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();t8=space(),div2=element$1("div"),if_block0&&if_block0.c(),t9=space(),if_block1&&if_block1.c(),t10=space(),if_block2&&if_block2.c(),t11=space(),br=element$1("br"),t12=space(),if_block3&&if_block3.c(),t13=space(),if_block4&&if_block4.c(),attr(b0,"class","svelte-nspiqx"),attr(input0,"type","text"),input0.disabled=input0_disabled_value=ctx[0]===void 0,attr(b1,"class","svelte-nspiqx"),attr(input1,"type","number"),attr(input1,"min","0"),input1.disabled=input1_disabled_value=ctx[0]===void 0,attr(b2,"class","svelte-nspiqx"),attr(div0,"class","typo-palette-builder-colors svelte-nspiqx"),set_style(div0,"pointer-events",ctx[0]===void 0?"none":"all"),set_style(div0,"grid-template-columns","repeat("+ctx[5]+", 2rem)"),set_style(div0,"width","calc("+ctx[5]+" * 2rem + "+(ctx[5]-1)+" * .2rem)"),attr(div1,"class","typo-palette-builder-inputs svelte-nspiqx"),attr(div2,"class","typo-palette-builder-actions svelte-nspiqx"),attr(div3,"class","typo-palette-builder-container svelte-nspiqx")},m(target,anchor){insert(target,div3,anchor),append(div3,div1),append(div1,b0),append(div1,t1),append(div1,input0),set_input_value(input0,ctx[3]),append(div1,t2),append(div1,b1),append(div1,t4),append(div1,input1),set_input_value(input1,ctx[5]),append(div1,t5),append(div1,b2),append(div1,t7),append(div1,div0);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div0,null);append(div3,t8),append(div3,div2),if_block0&&if_block0.m(div2,null),append(div2,t9),if_block1&&if_block1.m(div2,null),append(div2,t10),if_block2&&if_block2.m(div2,null),append(div2,t11),append(div2,br),append(div2,t12),if_block3&&if_block3.m(div2,null),append(div2,t13),if_block4&&if_block4.m(div2,null),current=!0,mounted||(dispose=[listen(input0,"input",ctx[7]),listen(input1,"input",ctx[8])],mounted=!0)},p(ctx2,[dirty]){if((!current||dirty&1&&input0_disabled_value!==(input0_disabled_value=ctx2[0]===void 0))&&(input0.disabled=input0_disabled_value),dirty&8&&input0.value!==ctx2[3]&&set_input_value(input0,ctx2[3]),(!current||dirty&1&&input1_disabled_value!==(input1_disabled_value=ctx2[0]===void 0))&&(input1.disabled=input1_disabled_value),dirty&32&&to_number(input1.value)!==ctx2[5]&&set_input_value(input1,ctx2[5]),dirty&16){each_value=ensure_array_like(ctx2[4]);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$k(ctx2,each_value,i);each_blocks[i]?(each_blocks[i].p(child_ctx,dirty),transition_in(each_blocks[i],1)):(each_blocks[i]=create_each_block$k(child_ctx),each_blocks[i].c(),transition_in(each_blocks[i],1),each_blocks[i].m(div0,null))}for(group_outros(),i=each_value.length;i<each_blocks.length;i+=1)out(i);check_outros()}(!current||dirty&1)&&set_style(div0,"pointer-events",ctx2[0]===void 0?"none":"all"),(!current||dirty&32)&&set_style(div0,"grid-template-columns","repeat("+ctx2[5]+", 2rem)"),(!current||dirty&32)&&set_style(div0,"width","calc("+ctx2[5]+" * 2rem + "+(ctx2[5]-1)+" * .2rem)"),ctx2[0]?if_block0?(if_block0.p(ctx2,dirty),dirty&1&&transition_in(if_block0,1)):(if_block0=create_if_block_4$3(ctx2),if_block0.c(),transition_in(if_block0,1),if_block0.m(div2,t9)):if_block0&&(group_outros(),transition_out(if_block0,1,1,()=>{if_block0=null}),check_outros()),ctx2[2]?if_block1?(if_block1.p(ctx2,dirty),dirty&4&&transition_in(if_block1,1)):(if_block1=create_if_block_3$3(ctx2),if_block1.c(),transition_in(if_block1,1),if_block1.m(div2,t10)):if_block1&&(group_outros(),transition_out(if_block1,1,1,()=>{if_block1=null}),check_outros()),ctx2[1]?if_block2?(if_block2.p(ctx2,dirty),dirty&2&&transition_in(if_block2,1)):(if_block2=create_if_block_2$5(ctx2),if_block2.c(),transition_in(if_block2,1),if_block2.m(div2,t11)):if_block2&&(group_outros(),transition_out(if_block2,1,1,()=>{if_block2=null}),check_outros()),ctx2[0]?if_block3?(if_block3.p(ctx2,dirty),dirty&1&&transition_in(if_block3,1)):(if_block3=create_if_block_1$8(ctx2),if_block3.c(),transition_in(if_block3,1),if_block3.m(div2,t13)):if_block3&&(group_outros(),transition_out(if_block3,1,1,()=>{if_block3=null}),check_outros()),ctx2[0]?if_block4?(if_block4.p(ctx2,dirty),dirty&1&&transition_in(if_block4,1)):(if_block4=create_if_block$h(ctx2),if_block4.c(),transition_in(if_block4,1),if_block4.m(div2,null)):if_block4&&(group_outros(),transition_out(if_block4,1,1,()=>{if_block4=null}),check_outros())},i(local){if(!current){for(let i=0;i<each_value.length;i+=1)transition_in(each_blocks[i]);transition_in(if_block0),transition_in(if_block1),transition_in(if_block2),transition_in(if_block3),transition_in(if_block4),current=!0}},o(local){each_blocks=each_blocks.filter(Boolean);for(let i=0;i<each_blocks.length;i+=1)transition_out(each_blocks[i]);transition_out(if_block0),transition_out(if_block1),transition_out(if_block2),transition_out(if_block3),transition_out(if_block4),current=!1},d(detaching){detaching&&detach(div3),destroy_each(each_blocks,detaching),if_block0&&if_block0.d(),if_block1&&if_block1.d(),if_block2&&if_block2.d(),if_block3&&if_block3.d(),if_block4&&if_block4.d(),mounted=!1,run_all(dispose)}}}__name(create_fragment$A,"create_fragment$A");function instance$w($$self,$$props,$$invalidate){let name="new-palette",colors=[],columns=10;const loadPalette=__name(palette=>{$$invalidate(3,name=palette.name),$$invalidate(4,colors=palette.colorHexCodes.map(code=>Color.fromHex(code))),$$invalidate(5,columns=palette.columns)},"loadPalette");let{onPaletteSave=void 0}=$$props,{onPaletteExport=void 0}=$$props,{onPaletteDelete=void 0}=$$props,{initialPalette=void 0}=$$props;onMount(()=>{initialPalette&&loadPalette(initialPalette)});function input0_input_handler(){name=this.value,$$invalidate(3,name)}__name(input0_input_handler,"input0_input_handler");function input1_input_handler(){columns=to_number(this.value),$$invalidate(5,columns)}__name(input1_input_handler,"input1_input_handler");function colorpickerbutton_color_binding(value,color,each_value,i){each_value[i]=value,$$invalidate(4,colors)}__name(colorpickerbutton_color_binding,"colorpickerbutton_color_binding");const click_handler2=__name(()=>onPaletteSave({name,columns,colorHexCodes:colors.map(c=>c.hex)}),"click_handler"),click_handler_1=__name(()=>onPaletteDelete(),"click_handler_1"),click_handler_2=__name(()=>onPaletteExport({name,columns,colorHexCodes:colors.map(c=>c.hex)}),"click_handler_2"),click_handler_3=__name(()=>$$invalidate(4,colors=[...colors,Color.fromHex("#77c5fa")]),"click_handler_3"),click_handler_4=__name(()=>$$invalidate(4,colors=[...colors.slice(0,colors.length-1)]),"click_handler_4");return $$self.$$set=$$props2=>{"onPaletteSave"in $$props2&&$$invalidate(0,onPaletteSave=$$props2.onPaletteSave),"onPaletteExport"in $$props2&&$$invalidate(1,onPaletteExport=$$props2.onPaletteExport),"onPaletteDelete"in $$props2&&$$invalidate(2,onPaletteDelete=$$props2.onPaletteDelete),"initialPalette"in $$props2&&$$invalidate(6,initialPalette=$$props2.initialPalette)},[onPaletteSave,onPaletteExport,onPaletteDelete,name,colors,columns,initialPalette,input0_input_handler,input1_input_handler,colorpickerbutton_color_binding,click_handler2,click_handler_1,click_handler_2,click_handler_3,click_handler_4]}__name(instance$w,"instance$w");const _Color_palette_builder=class _Color_palette_builder extends SvelteComponent{constructor(options){super(),init(this,options,instance$w,create_fragment$A,safe_not_equal,{onPaletteSave:0,onPaletteExport:1,onPaletteDelete:2,initialPalette:6})}};__name(_Color_palette_builder,"Color_palette_builder");let Color_palette_builder=_Color_palette_builder;function get_each_context$j(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[15]=list[i],child_ctx}__name(get_each_context$j,"get_each_context$j");function get_each_context_1$4(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[15]=list[i],child_ctx}__name(get_each_context_1$4,"get_each_context_1$4");function get_each_context_2(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[15]=list[i],child_ctx}__name(get_each_context_2,"get_each_context_2");function get_each_context_3(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[15]=list[i],child_ctx}__name(get_each_context_3,"get_each_context_3");function create_each_block_3(ctx){let option,t_value=ctx[15].name+"",t,option_selected_value;return{c(){option=element$1("option"),t=text(t_value),option.__value=ctx[15]===ctx[5].skribblPalette?void 0:ctx[15].name,set_input_value(option,option.__value),option.selected=option_selected_value=ctx[15]===ctx[5].skribblPalette&&ctx[2]===void 0||ctx[2]===ctx[15].name},m(target,anchor){insert(target,option,anchor),append(option,t)},p(ctx2,dirty){dirty&44&&option_selected_value!==(option_selected_value=ctx2[15]===ctx2[5].skribblPalette&&ctx2[2]===void 0||ctx2[2]===ctx2[15].name)&&(option.selected=option_selected_value)},d(detaching){detaching&&detach(option)}}}__name(create_each_block_3,"create_each_block_3");function create_each_block_2(ctx){let option,t_value=ctx[15].name+"",t,option_value_value,option_selected_value;return{c(){option=element$1("option"),t=text(t_value),option.__value=option_value_value=ctx[15].name,set_input_value(option,option.__value),option.selected=option_selected_value=ctx[2]===ctx[15].name},m(target,anchor){insert(target,option,anchor),append(option,t)},p(ctx2,dirty){dirty&8&&t_value!==(t_value=ctx2[15].name+"")&&set_data(t,t_value),dirty&8&&option_value_value!==(option_value_value=ctx2[15].name)&&(option.__value=option_value_value,set_input_value(option,option.__value)),dirty&44&&option_selected_value!==(option_selected_value=ctx2[2]===ctx2[15].name)&&(option.selected=option_selected_value)},d(detaching){detaching&&detach(option)}}}__name(create_each_block_2,"create_each_block_2");function create_key_block$1(ctx){let colorpalettebuilder,current;function func2(...args){return ctx[9](ctx[15],...args)}__name(func2,"func");function func_22(){return ctx[11](ctx[15])}return __name(func_22,"func_2"),colorpalettebuilder=new Color_palette_builder({props:{initialPalette:ctx[15],onPaletteSave:func2,onPaletteExport:ctx[10],onPaletteDelete:func_22}}),{c(){create_component(colorpalettebuilder.$$.fragment)},m(target,anchor){mount_component(colorpalettebuilder,target,anchor),current=!0},p(new_ctx,dirty){ctx=new_ctx;const colorpalettebuilder_changes={};dirty&8&&(colorpalettebuilder_changes.initialPalette=ctx[15]),dirty&9&&(colorpalettebuilder_changes.onPaletteSave=func2),dirty&1&&(colorpalettebuilder_changes.onPaletteExport=ctx[10]),dirty&9&&(colorpalettebuilder_changes.onPaletteDelete=func_22),colorpalettebuilder.$set(colorpalettebuilder_changes)},i(local){current||(transition_in(colorpalettebuilder.$$.fragment,local),current=!0)},o(local){transition_out(colorpalettebuilder.$$.fragment,local),current=!1},d(detaching){destroy_component(colorpalettebuilder,detaching)}}}__name(create_key_block$1,"create_key_block$1");function create_each_block_1$4(ctx){let previous_key=ctx[15],key_block_anchor,current,key_block=create_key_block$1(ctx);return{c(){key_block.c(),key_block_anchor=empty()},m(target,anchor){key_block.m(target,anchor),insert(target,key_block_anchor,anchor),current=!0},p(ctx2,dirty){dirty&8&&safe_not_equal(previous_key,previous_key=ctx2[15])?(group_outros(),transition_out(key_block,1,1,noop$1),check_outros(),key_block=create_key_block$1(ctx2),key_block.c(),transition_in(key_block,1),key_block.m(key_block_anchor.parentNode,key_block_anchor)):key_block.p(ctx2,dirty)},i(local){current||(transition_in(key_block),current=!0)},o(local){transition_out(key_block),current=!1},d(detaching){detaching&&detach(key_block_anchor),key_block.d(detaching)}}}__name(create_each_block_1$4,"create_each_block_1$4");function create_each_block$j(ctx){let colorpalettebuilder,current;function func_3(){return ctx[12](ctx[15])}return __name(func_3,"func_3"),colorpalettebuilder=new Color_palette_builder({props:{initialPalette:ctx[15],onPaletteExport:func_3}}),{c(){create_component(colorpalettebuilder.$$.fragment)},m(target,anchor){mount_component(colorpalettebuilder,target,anchor),current=!0},p(new_ctx,dirty){ctx=new_ctx;const colorpalettebuilder_changes={};dirty&1&&(colorpalettebuilder_changes.onPaletteExport=func_3),colorpalettebuilder.$set(colorpalettebuilder_changes)},i(local){current||(transition_in(colorpalettebuilder.$$.fragment,local),current=!0)},o(local){transition_out(colorpalettebuilder.$$.fragment,local),current=!1},d(detaching){destroy_component(colorpalettebuilder,detaching)}}}__name(create_each_block$j,"create_each_block$j");function create_fragment$z(ctx){let h30,t1,br0,t2,select,each0_anchor,br1,t3,br2,t4,h31,t6,br3,t7,br4,t8,br5,t9,br6,t10,br7,t11,flatbutton0,br8,t12,br9,t13,h32,t15,br10,t16,div,t17,t18,br11,t19,h33,t21,br12,t22,br13,t23,br14,t24,i,br15,t26,br16,t27,input,br17,t28,br18,t29,flatbutton1,br19,t30,br20,current,mounted,dispose,each_value_3=ensure_array_like(Object.values(ctx[5])),each_blocks_3=[];for(let i2=0;i2<each_value_3.length;i2+=1)each_blocks_3[i2]=create_each_block_3(get_each_context_3(ctx,each_value_3,i2));let each_value_2=ensure_array_like(ctx[3]),each_blocks_2=[];for(let i2=0;i2<each_value_2.length;i2+=1)each_blocks_2[i2]=create_each_block_2(get_each_context_2(ctx,each_value_2,i2));flatbutton0=new Flat_button({props:{color:"green",content:"Add new palette"}}),flatbutton0.$on("click",ctx[8]);let each_value_1=ensure_array_like(ctx[3]),each_blocks_1=[];for(let i2=0;i2<each_value_1.length;i2+=1)each_blocks_1[i2]=create_each_block_1$4(get_each_context_1$4(ctx,each_value_1,i2));const out=__name(i2=>transition_out(each_blocks_1[i2],1,1,()=>{each_blocks_1[i2]=null}),"out");let each_value=ensure_array_like(Object.values(ctx[5])),each_blocks=[];for(let i2=0;i2<each_value.length;i2+=1)each_blocks[i2]=create_each_block$j(get_each_context$j(ctx,each_value,i2));const out_1=__name(i2=>transition_out(each_blocks[i2],1,1,()=>{each_blocks[i2]=null}),"out_1");return flatbutton1=new Flat_button({props:{color:"green",content:"Import palette"}}),flatbutton1.$on("click",ctx[14]),{c(){h30=element$1("h3"),h30.textContent="Active palette",t1=text(`
Select one of the saved palettes to customize the colors available in the skribbl toolbar.`),br0=element$1("br"),t2=space(),select=element$1("select");for(let i2=0;i2<each_blocks_3.length;i2+=1)each_blocks_3[i2].c();each0_anchor=empty();for(let i2=0;i2<each_blocks_2.length;i2+=1)each_blocks_2[i2].c();br1=element$1("br"),t3=space(),br2=element$1("br"),t4=space(),h31=element$1("h3"),h31.textContent="Create a new empty palette",t6=text(`
Create a new palette to customize the colors available in the skribbl toolbar.`),br3=element$1("br"),t7=text(`
You can enter a name to identify the palette, choose a number of columns for the palette layout and add as many colors as you like.`),br4=element$1("br"),t8=text(`
Click a color box to change it, remove the last color with "Remove Color" or add a new color with "Add Color".`),br5=element$1("br"),t9=text(`
When you are done, click "Save Palette" to save the changes.`),br6=element$1("br"),t10=space(),br7=element$1("br"),t11=space(),create_component(flatbutton0.$$.fragment),br8=element$1("br"),t12=space(),br9=element$1("br"),t13=space(),h32=element$1("h3"),h32.textContent="Saved palettes",t15=space(),br10=element$1("br"),t16=space(),div=element$1("div");for(let i2=0;i2<each_blocks_1.length;i2+=1)each_blocks_1[i2].c();t17=space();for(let i2=0;i2<each_blocks.length;i2+=1)each_blocks[i2].c();t18=space(),br11=element$1("br"),t19=space(),h33=element$1("h3"),h33.textContent="Import a palette",t21=text(`
You can import existing palettes by pasting their data here.`),br12=element$1("br"),t22=text(`
Existing palettes can be exported by clicking the "Export to clipboard" button on the palette.`),br13=element$1("br"),t23=text(`
The data is a JSON string that represents the palette; you can also create a new palette without the typo palette builder.`),br14=element$1("br"),t24=text(`
The palette has to satisfy following interface: `),i=element$1("i"),i.textContent="{ name: string; columns: number; colorHexCodes: string[] }",br15=element$1("br"),t26=space(),br16=element$1("br"),t27=space(),input=element$1("input"),br17=element$1("br"),t28=space(),br18=element$1("br"),t29=space(),create_component(flatbutton1.$$.fragment),br19=element$1("br"),t30=space(),br20=element$1("br"),set_style(select,"width","auto"),ctx[2]===void 0&&add_render_callback(()=>ctx[7].call(select)),attr(div,"class","typo-color-palette-manage-list svelte-vvz4gm"),attr(input,"type","text"),attr(input,"placeholder","Paste palette data"),set_style(input,"width","auto")},m(target,anchor){insert(target,h30,anchor),insert(target,t1,anchor),insert(target,br0,anchor),insert(target,t2,anchor),insert(target,select,anchor);for(let i2=0;i2<each_blocks_3.length;i2+=1)each_blocks_3[i2]&&each_blocks_3[i2].m(select,null);append(select,each0_anchor);for(let i2=0;i2<each_blocks_2.length;i2+=1)each_blocks_2[i2]&&each_blocks_2[i2].m(select,null);select_option(select,ctx[2],!0),insert(target,br1,anchor),insert(target,t3,anchor),insert(target,br2,anchor),insert(target,t4,anchor),insert(target,h31,anchor),insert(target,t6,anchor),insert(target,br3,anchor),insert(target,t7,anchor),insert(target,br4,anchor),insert(target,t8,anchor),insert(target,br5,anchor),insert(target,t9,anchor),insert(target,br6,anchor),insert(target,t10,anchor),insert(target,br7,anchor),insert(target,t11,anchor),mount_component(flatbutton0,target,anchor),insert(target,br8,anchor),insert(target,t12,anchor),insert(target,br9,anchor),insert(target,t13,anchor),insert(target,h32,anchor),insert(target,t15,anchor),insert(target,br10,anchor),insert(target,t16,anchor),insert(target,div,anchor);for(let i2=0;i2<each_blocks_1.length;i2+=1)each_blocks_1[i2]&&each_blocks_1[i2].m(div,null);append(div,t17);for(let i2=0;i2<each_blocks.length;i2+=1)each_blocks[i2]&&each_blocks[i2].m(div,null);insert(target,t18,anchor),insert(target,br11,anchor),insert(target,t19,anchor),insert(target,h33,anchor),insert(target,t21,anchor),insert(target,br12,anchor),insert(target,t22,anchor),insert(target,br13,anchor),insert(target,t23,anchor),insert(target,br14,anchor),insert(target,t24,anchor),insert(target,i,anchor),insert(target,br15,anchor),insert(target,t26,anchor),insert(target,br16,anchor),insert(target,t27,anchor),insert(target,input,anchor),set_input_value(input,ctx[1]),insert(target,br17,anchor),insert(target,t28,anchor),insert(target,br18,anchor),insert(target,t29,anchor),mount_component(flatbutton1,target,anchor),insert(target,br19,anchor),insert(target,t30,anchor),insert(target,br20,anchor),current=!0,mounted||(dispose=[listen(select,"change",ctx[7]),listen(input,"input",ctx[13])],mounted=!0)},p(ctx2,[dirty]){if(dirty&36){each_value_3=ensure_array_like(Object.values(ctx2[5]));let i2;for(i2=0;i2<each_value_3.length;i2+=1){const child_ctx=get_each_context_3(ctx2,each_value_3,i2);each_blocks_3[i2]?each_blocks_3[i2].p(child_ctx,dirty):(each_blocks_3[i2]=create_each_block_3(child_ctx),each_blocks_3[i2].c(),each_blocks_3[i2].m(select,each0_anchor))}for(;i2<each_blocks_3.length;i2+=1)each_blocks_3[i2].d(1);each_blocks_3.length=each_value_3.length}if(dirty&12){each_value_2=ensure_array_like(ctx2[3]);let i2;for(i2=0;i2<each_value_2.length;i2+=1){const child_ctx=get_each_context_2(ctx2,each_value_2,i2);each_blocks_2[i2]?each_blocks_2[i2].p(child_ctx,dirty):(each_blocks_2[i2]=create_each_block_2(child_ctx),each_blocks_2[i2].c(),each_blocks_2[i2].m(select,null))}for(;i2<each_blocks_2.length;i2+=1)each_blocks_2[i2].d(1);each_blocks_2.length=each_value_2.length}if(dirty&44&&select_option(select,ctx2[2]),dirty&9){each_value_1=ensure_array_like(ctx2[3]);let i2;for(i2=0;i2<each_value_1.length;i2+=1){const child_ctx=get_each_context_1$4(ctx2,each_value_1,i2);each_blocks_1[i2]?(each_blocks_1[i2].p(child_ctx,dirty),transition_in(each_blocks_1[i2],1)):(each_blocks_1[i2]=create_each_block_1$4(child_ctx),each_blocks_1[i2].c(),transition_in(each_blocks_1[i2],1),each_blocks_1[i2].m(div,t17))}for(group_outros(),i2=each_value_1.length;i2<each_blocks_1.length;i2+=1)out(i2);check_outros()}if(dirty&33){each_value=ensure_array_like(Object.values(ctx2[5]));let i2;for(i2=0;i2<each_value.length;i2+=1){const child_ctx=get_each_context$j(ctx2,each_value,i2);each_blocks[i2]?(each_blocks[i2].p(child_ctx,dirty),transition_in(each_blocks[i2],1)):(each_blocks[i2]=create_each_block$j(child_ctx),each_blocks[i2].c(),transition_in(each_blocks[i2],1),each_blocks[i2].m(div,null))}for(group_outros(),i2=each_value.length;i2<each_blocks.length;i2+=1)out_1(i2);check_outros()}dirty&2&&input.value!==ctx2[1]&&set_input_value(input,ctx2[1])},i(local){if(!current){transition_in(flatbutton0.$$.fragment,local);for(let i2=0;i2<each_value_1.length;i2+=1)transition_in(each_blocks_1[i2]);for(let i2=0;i2<each_value.length;i2+=1)transition_in(each_blocks[i2]);transition_in(flatbutton1.$$.fragment,local),current=!0}},o(local){transition_out(flatbutton0.$$.fragment,local),each_blocks_1=each_blocks_1.filter(Boolean);for(let i2=0;i2<each_blocks_1.length;i2+=1)transition_out(each_blocks_1[i2]);each_blocks=each_blocks.filter(Boolean);for(let i2=0;i2<each_blocks.length;i2+=1)transition_out(each_blocks[i2]);transition_out(flatbutton1.$$.fragment,local),current=!1},d(detaching){detaching&&(detach(h30),detach(t1),detach(br0),detach(t2),detach(select),detach(br1),detach(t3),detach(br2),detach(t4),detach(h31),detach(t6),detach(br3),detach(t7),detach(br4),detach(t8),detach(br5),detach(t9),detach(br6),detach(t10),detach(br7),detach(t11),detach(br8),detach(t12),detach(br9),detach(t13),detach(h32),detach(t15),detach(br10),detach(t16),detach(div),detach(t18),detach(br11),detach(t19),detach(h33),detach(t21),detach(br12),detach(t22),detach(br13),detach(t23),detach(br14),detach(t24),detach(i),detach(br15),detach(t26),detach(br16),detach(t27),detach(input),detach(br17),detach(t28),detach(br18),detach(t29),detach(br19),detach(t30),detach(br20)),destroy_each(each_blocks_3,detaching),destroy_each(each_blocks_2,detaching),destroy_component(flatbutton0,detaching),destroy_each(each_blocks_1,detaching),destroy_each(each_blocks,detaching),destroy_component(flatbutton1,detaching),mounted=!1,run_all(dispose)}}}__name(create_fragment$z,"create_fragment$z");function instance$v($$self,$$props,$$invalidate){let $activePalette,$palettes,{feature}=$$props,paletteImport="";const palettes=feature.savedPalettesStore;component_subscribe($$self,palettes,value=>$$invalidate(3,$palettes=value));const defaultPalettes2=feature.defaultPalettes,activePalette=feature.activePaletteStore;component_subscribe($$self,activePalette,value=>$$invalidate(2,$activePalette=value));function select_change_handler(){$activePalette=select_value(this),activePalette.set($activePalette),$$invalidate(5,defaultPalettes2)}__name(select_change_handler,"select_change_handler");const click_handler2=__name(()=>feature.savePalette({name:"palette-"+Date.now(),columns:10,colorHexCodes:["#77c5fa"]}),"click_handler"),func2=__name((palette,newPalette)=>feature.savePalette(newPalette,palette.name),"func"),func_1=__name(newPalette=>feature.exportPalette(newPalette),"func_1"),func_22=__name(palette=>feature.removePalette(palette.name),"func_2"),func_3=__name(palette=>feature.exportPalette(palette),"func_3");function input_input_handler(){paletteImport=this.value,$$invalidate(1,paletteImport)}__name(input_input_handler,"input_input_handler");const click_handler_1=__name(()=>feature.savePalette(feature.parsePalette(paletteImport)),"click_handler_1");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},[feature,paletteImport,$activePalette,$palettes,palettes,defaultPalettes2,activePalette,select_change_handler,click_handler2,func2,func_1,func_22,func_3,input_input_handler,click_handler_1]}__name(instance$v,"instance$v");const _Drawing_color_palettes_manage=class _Drawing_color_palettes_manage extends SvelteComponent{constructor(options){super(),init(this,options,instance$v,create_fragment$z,safe_not_equal,{feature:0})}};__name(_Drawing_color_palettes_manage,"Drawing_color_palettes_manage");let Drawing_color_palettes_manage=_Drawing_color_palettes_manage;function get_each_context$i(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[3]=list[i],child_ctx}__name(get_each_context$i,"get_each_context$i");function create_each_block$i(ctx){let div,mounted,dispose;function click_handler2(){return ctx[2](ctx[3])}return __name(click_handler2,"click_handler"),{c(){div=element$1("div"),attr(div,"class","typo-palette-picker-item svelte-1a44tq"),set_style(div,"background-color",ctx[3])},m(target,anchor){insert(target,div,anchor),mounted||(dispose=listen(div,"click",click_handler2),mounted=!0)},p(new_ctx,dirty){ctx=new_ctx,dirty&1&&set_style(div,"background-color",ctx[3])},d(detaching){detaching&&detach(div),mounted=!1,dispose()}}}__name(create_each_block$i,"create_each_block$i");function create_fragment$y(ctx){let div1,div0,each_value=ensure_array_like(ctx[0].colorHexCodes),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$i(get_each_context$i(ctx,each_value,i));return{c(){div1=element$1("div"),div0=element$1("div");for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();attr(div0,"class","typo-palette-picker svelte-1a44tq"),set_style(div0,"grid-template-columns","repeat("+ctx[0].columns+", auto)"),attr(div1,"class","colors typo-palette svelte-1a44tq")},m(target,anchor){insert(target,div1,anchor),append(div1,div0);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div0,null)},p(ctx2,[dirty]){if(dirty&3){each_value=ensure_array_like(ctx2[0].colorHexCodes);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$i(ctx2,each_value,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block$i(child_ctx),each_blocks[i].c(),each_blocks[i].m(div0,null))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value.length}dirty&1&&set_style(div0,"grid-template-columns","repeat("+ctx2[0].columns+", auto)")},i:noop$1,o:noop$1,d(detaching){detaching&&detach(div1),destroy_each(each_blocks,detaching)}}}__name(create_fragment$y,"create_fragment$y");function instance$u($$self,$$props,$$invalidate){let{palette}=$$props,{feature}=$$props;const click_handler2=__name(color=>feature.setColor(color),"click_handler");return $$self.$$set=$$props2=>{"palette"in $$props2&&$$invalidate(0,palette=$$props2.palette),"feature"in $$props2&&$$invalidate(1,feature=$$props2.feature)},[palette,feature,click_handler2]}__name(instance$u,"instance$u");const _Color_palette_picker=class _Color_palette_picker extends SvelteComponent{constructor(options){super(),init(this,options,instance$u,create_fragment$y,safe_not_equal,{palette:0,feature:1})}};__name(_Color_palette_picker,"Color_palette_picker");let Color_palette_picker=_Color_palette_picker;const defaultPalettes={skribblPalette:{name:"Skribbl.io Original",columns:13,colorHexCodes:["#ffffff","#c1c1c1","#ef130b","#ff7100","#ffe400","#00cc00","#00ff91","#00b2ff","#231fd3","#a300ba","#df69a7","#ffac8e","#a0522d","#000000","#505050","#740b07","#c23800","#e8a200","#004619","#00785d","#00569e","#0e0865","#550069","#873554","#cc774d","#63300d"]}};var __defProp$A=Object.defineProperty,__decorateClass$A=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$A(target,key,result),result},"__decorateClass$A");const _DrawingColorPalettesFeature=class _DrawingColorPalettesFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elementsSetup");__publicField(this,"_toastService");__publicField(this,"_drawingService");__publicField(this,"name","Color Palettes");__publicField(this,"description","Use custom color palettes instead of the default skribbl colors");__publicField(this,"featureId",32);__publicField(this,"_savedPalettesSetting",new ExtensionSetting("saved_palettes",[],this).withName("Auto Focus Chat Input").withDescription("Automatically focus the chat input when someone else starts drawing"));__publicField(this,"_activePaletteSetting",new ExtensionSetting("active_palette",void 0,this).withName("Active Palette").withDescription("The name of the currently active palette"));__publicField(this,"_hideOriginalPaletteStyle",createElement(`<style>
    #game #game-toolbar .colors:has(.top) {
      display: none;
    }
  </style>`));__publicField(this,"_activePaletteSubscription");__publicField(this,"_colorPalettePicker")}get featureInfoComponent(){return{componentType:Drawing_color_palettes_info,props:{}}}get featureManagementComponent(){return{componentType:Drawing_color_palettes_manage,props:{feature:this}}}async onActivate(){this._activePaletteSubscription=this._activePaletteSetting.changes$.pipe(combineLatestWith(this._savedPalettesSetting.changes$),tap(([activePalette,savedPalettes])=>{activePalette!==void 0&&![...savedPalettes,...Object.values(defaultPalettes)].some(p=>p.name===activePalette)&&this._activePaletteSetting.setValue(void 0)}),map(([activePalette,savedPalettes])=>activePalette!==void 0?[...savedPalettes,...Object.values(defaultPalettes)].find(p=>p.name===activePalette):void 0),distinctUntilChanged()).subscribe(palette=>this.updatePaletteStyle(palette))}async onDestroy(){var _a81,_b;this._hideOriginalPaletteStyle.remove(),(_a81=this._activePaletteSubscription)==null||_a81.unsubscribe(),this._activePaletteSubscription=void 0,(_b=this._colorPalettePicker)==null||_b.$destroy()}async updatePaletteStyle(palette){var _a81;if(this._logger.info("Updating palette style",palette),(_a81=this._colorPalettePicker)==null||_a81.$destroy(),palette===void 0){this._hideOriginalPaletteStyle.remove();return}const elements2=await this._elementsSetup.complete();this._hideOriginalPaletteStyle.parentElement===null&&document.body.appendChild(this._hideOriginalPaletteStyle),this._colorPalettePicker=new Color_palette_picker({target:elements2.skribblToolbar,anchor:elements2.colorContainer,props:{feature:this,palette}})}async removePalette(name){this._logger.info(`Removing palette ${name}`);const toast=await this._toastService.showLoadingToast(`Removing palette ${name}`),palettes=await this._savedPalettesSetting.getValue(),index=palettes.findIndex(p=>p.name===name);if(index===-1){this._logger.error(`Palette with name ${name} does not exist`),toast.reject(`Palette with name ${name} does not exist`);return}try{palettes.splice(index,1),await this._savedPalettesSetting.setValue(palettes)}catch(e){this._logger.error(`Failed to remove palette ${name}`,e),toast.reject(`Failed to remove palette ${name}`);return}toast.resolve()}parsePalette(json){this._logger.info("Parsing palette from json",json);try{const palette=JSON.parse(json);if(typeof palette.name!="string"||typeof palette.columns!="number"||!Array.isArray(palette.colorHexCodes)||!palette.colorHexCodes.every(c=>typeof c=="string"))throw this._logger.error("Invalid palette format",palette),new Error("Invalid palette format");return palette}catch(e){throw this._logger.error("Failed to parse palette from json",e),this._toastService.showToast("Failed to read palette","Invalid palette format. Check the JSON data!"),e}}async savePalette(palette,overwrite=void 0){this._logger.info(`Saving palette ${palette.name}`,palette);const toast=await this._toastService.showLoadingToast(`Saving palette ${palette.name}`);if(palette.colorHexCodes.length===0){this._logger.error(`Palette ${palette.name} has no colors`),toast.reject(`Palette ${palette.name} has no colors`);return}if(palette.name.trim()===""){this._logger.error("Palette has no name set"),toast.reject("Palette has no name set");return}if(palette.columns<1){this._logger.error(`Palette ${palette.name} has less than 1 column`),toast.reject(`Palette ${palette.name} cannot have less than 1 column`);return}let palettes=await this._savedPalettesSetting.getValue();if(palettes.some(p=>p.name===palette.name&&p.name!==overwrite)){this._logger.error(`Palette with name ${palette.name} already exists`),toast.reject(`Palette with name ${palette.name} already exists`);return}try{palettes=palettes.filter(p=>p.name!==overwrite),palettes.push(palette),await this._savedPalettesSetting.setValue(palettes)}catch(e){this._logger.error(`Failed to save palette ${palette.name}`,e),toast.reject(`Failed to save palette ${palette.name}`);return}toast.resolve()}async exportPalette(palette){this._logger.info(`Exporting palette ${palette.name} to clipboard`,palette);const toast=await this._toastService.showLoadingToast(`Exporting palette ${palette.name} to clipboard`);try{const json=JSON.stringify(palette);await navigator.clipboard.writeText(json)}catch(e){this._logger.error(`Failed to export palette ${palette.name} to clipboard`,e),toast.reject(`Failed to export palette ${palette.name} to clipboard`);return}toast.resolve()}setColor(colorHex){this._logger.info(`Setting color to ${colorHex}`);const color=Color.fromHex(colorHex);this._drawingService.setColor(color)}get savedPalettesStore(){return this._savedPalettesSetting.store}get activePaletteStore(){return this._activePaletteSetting.store}get defaultPalettes(){return defaultPalettes}};__name(_DrawingColorPalettesFeature,"DrawingColorPalettesFeature");let DrawingColorPalettesFeature=_DrawingColorPalettesFeature;__decorateClass$A([inject(ElementsSetup)],DrawingColorPalettesFeature.prototype,"_elementsSetup");__decorateClass$A([inject(ToastService)],DrawingColorPalettesFeature.prototype,"_toastService");__decorateClass$A([inject(DrawingService)],DrawingColorPalettesFeature.prototype,"_drawingService");var __defProp$z=Object.defineProperty,__decorateClass$z=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$z(target,key,result),result},"__decorateClass$z");const _PipetteTool=class _PipetteTool extends TypoDrawTool{constructor(){super(...arguments);__publicField(this,"_elementsSetup");__publicField(this,"createCommands",this.noCommands)}createCursor(){return{source:"var(--file-img-pipette_cur-png)",x:7,y:37}}async applyConstantEffect(line,pressure,style){const ctx=(await this._elementsSetup.complete()).canvas.getContext("2d");if(ctx!==null){const rgb=ctx.getImageData(line.to[0],line.to[1],1,1).data.slice(0,3);style.color=Color.fromRgb(rgb[0],rgb[1],rgb[2])}return this.noConstantEffect(line,pressure,style)}};__name(_PipetteTool,"PipetteTool");let PipetteTool=_PipetteTool;__decorateClass$z([inject(ElementsSetup)],PipetteTool.prototype,"_elementsSetup");function create_fragment$x(ctx){let t0,br0,t1,br1;return{c(){t0=text("Add a hotkey to quickly focus the chat input, so you can start guessing right away. "),br0=element$1("br"),t1=text(`
If the auto-focus setting is enabled, the chat input will be focused automatically when someone else starts drawing. `),br1=element$1("br")},m(target,anchor){insert(target,t0,anchor),insert(target,br0,anchor),insert(target,t1,anchor),insert(target,br1,anchor)},p:noop$1,i:noop$1,o:noop$1,d(detaching){detaching&&(detach(t0),detach(br0),detach(t1),detach(br1))}}}__name(create_fragment$x,"create_fragment$x");const _Drawing_color_tools_info=class _Drawing_color_tools_info extends SvelteComponent{constructor(options){super(),init(this,options,null,create_fragment$x,safe_not_equal,{})}};__name(_Drawing_color_tools_info,"Drawing_color_tools_info");let Drawing_color_tools_info=_Drawing_color_tools_info;function create_fragment$w(ctx){let div2,div0,t,div1,colorpickerbutton,current,mounted,dispose;return colorpickerbutton=new Color_picker_button({props:{color:ctx[2],allowAlpha:!1,useBackground:!1,height:"auto",borderRadius:"0",colorChanged:ctx[6],description:"Warning: Only typo users can see custom colors."}}),{c(){div2=element$1("div"),div0=element$1("div"),t=space(),div1=element$1("div"),create_component(colorpickerbutton.$$.fragment),attr(div0,"class","pipette svelte-iqw7hb"),toggle_class(div0,"selected",ctx[1]instanceof PipetteTool),attr(div1,"class","picker svelte-iqw7hb"),attr(div2,"class","color-tools svelte-iqw7hb")},m(target,anchor){insert(target,div2,anchor),append(div2,div0),append(div2,t),append(div2,div1),mount_component(colorpickerbutton,div1,null),current=!0,mounted||(dispose=[listen(div0,"click",ctx[5]),action_destroyer(ctx[0].createTooltip(div0,{title:"Pipette",lock:"Y"})),action_destroyer(ctx[0].createTooltip(div1,{title:"Picker",lock:"Y"}))],mounted=!0)},p(ctx2,[dirty]){(!current||dirty&2)&&toggle_class(div0,"selected",ctx2[1]instanceof PipetteTool);const colorpickerbutton_changes={};dirty&4&&(colorpickerbutton_changes.color=ctx2[2]),dirty&1&&(colorpickerbutton_changes.colorChanged=ctx2[6]),colorpickerbutton.$set(colorpickerbutton_changes)},i(local){current||(transition_in(colorpickerbutton.$$.fragment,local),current=!0)},o(local){transition_out(colorpickerbutton.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div2),destroy_component(colorpickerbutton),mounted=!1,run_all(dispose)}}}__name(create_fragment$w,"create_fragment$w");function instance$t($$self,$$props,$$invalidate){let $selectedTool,$color,{feature}=$$props;const selectedTool=feature.selectedToolStore;component_subscribe($$self,selectedTool,value=>$$invalidate(1,$selectedTool=value));const color=feature.colorStore;component_subscribe($$self,color,value=>$$invalidate(2,$color=value));const click_handler2=__name(()=>feature.selectPipetteTool(),"click_handler"),func2=__name(c=>feature.updatePickedColor(c),"func");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},[feature,$selectedTool,$color,selectedTool,color,click_handler2,func2]}__name(instance$t,"instance$t");const _Drawing_color_tools=class _Drawing_color_tools extends SvelteComponent{constructor(options){super(),init(this,options,instance$t,create_fragment$w,safe_not_equal,{feature:0})}};__name(_Drawing_color_tools,"Drawing_color_tools");let Drawing_color_tools=_Drawing_color_tools;var __defProp$y=Object.defineProperty,__decorateClass$y=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$y(target,key,result),result},"__decorateClass$y");const _DrawingColorToolsFeature=class _DrawingColorToolsFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"elementsSetup");__publicField(this,"_toolsService");__publicField(this,"_drawingService");__publicField(this,"_colorChangedListener");__publicField(this,"name","Color Tools");__publicField(this,"description","Add a pipette and color picker to the toolbar");__publicField(this,"featureId",31);__publicField(this,"pipetteHotkey",this.useHotkey(new HotkeyAction("activate_pipette","Use Pipette","Activate the pipette tool to select a color from the canvas",this,()=>this.selectPipetteTool(),void 0)));__publicField(this,"_component");__publicField(this,"_pipetteTool");__publicField(this,"_colorChangeSubscription");__publicField(this,"_currentColor$",new Subject$1)}get featureInfoComponent(){return{componentType:Drawing_color_tools_info,props:{}}}async onActivate(){const elements2=await this.elementsSetup.complete();this._pipetteTool=this._toolsService.resolveModOrTool(PipetteTool),this._colorChangedListener.events$.pipe(withLatestFrom(this._currentColor$),filter(([event,currentColor])=>event.data.hex!==currentColor.hex),map(([event])=>event)).subscribe(event=>{this._currentColor$.next(event.data)}),this._component=new Drawing_color_tools({target:elements2.skribblTools,anchor:elements2.skribblBrushTools,props:{feature:this}})}async onDestroy(){var _a81,_b;(_a81=this._component)==null||_a81.$destroy(),this._component=void 0,(_b=this._colorChangeSubscription)==null||_b.unsubscribe(),this._colorChangeSubscription=void 0,this._pipetteTool=void 0}selectPipetteTool(){if(!this._pipetteTool)throw this._logger.error("Pipette tool not initialized"),new Error("Pipette tool not initialized yet");this._logger.info("Pipette tool selected"),this._toolsService.activateTool(this._pipetteTool)}get selectedToolStore(){return fromObservable(this._toolsService.activeTool$,skribblTool.brush)}get colorStore(){return fromObservable(this._currentColor$,new Color(0,0,0))}updatePickedColor(color){this._logger.info("Color picked",color),this._drawingService.setColor(color)}};__name(_DrawingColorToolsFeature,"DrawingColorToolsFeature");let DrawingColorToolsFeature=_DrawingColorToolsFeature;__decorateClass$y([inject(ElementsSetup)],DrawingColorToolsFeature.prototype,"elementsSetup");__decorateClass$y([inject(ToolsService)],DrawingColorToolsFeature.prototype,"_toolsService");__decorateClass$y([inject(DrawingService)],DrawingColorToolsFeature.prototype,"_drawingService");__decorateClass$y([inject(ColorChangedEventListener)],DrawingColorToolsFeature.prototype,"_colorChangedListener");const calculatePressurePoint=__name((p,s,b)=>{const A=1/(1+Math.exp(b*s)),B=1/(1+Math.exp(-s*(p-b))),C=1/(1+Math.exp(-s*(1-b)));return(B-A)/(C-A)},"calculatePressurePoint"),_PressureMod=class _PressureMod extends ConstantDrawMod{constructor(){super(...arguments);__publicField(this,"_maxSize",40);__publicField(this,"_minSize",4);__publicField(this,"_sensitivity",6);__publicField(this,"_balance",.5)}async applyConstantEffect(line,pressure,style){if(pressure===void 0)return{style,line};const point=calculatePressurePoint(pressure,this._sensitivity,this._balance),size=Math.floor(this._minSize+(this._maxSize-this._minSize)*point);return style.size=size,{style,line}}setParams(sensitivity,balance){this._sensitivity=sensitivity,this._balance=balance}};__name(_PressureMod,"PressureMod");let PressureMod=_PressureMod;function create_fragment$v(ctx){let div,p0,t2,br1,t3,b0,t5,p1,t7,br2,t8,b1,t10,p2,t13,br4,t14,canvas_1;return{c(){div=element$1("div"),p0=element$1("p"),p0.innerHTML=`Typo modifies pressure so that you can use the full brush size range without switching brush sizes in skribbl.<br/>
    Additionally, you can customize the sensitivity of the pen pressure.`,t2=space(),br1=element$1("br"),t3=space(),b0=element$1("b"),b0.textContent="Attention!",t5=space(),p1=element$1("p"),p1.textContent="You need to disable skribbl pressure in the skribbl settings to make typo pressure work.",t7=space(),br2=element$1("br"),t8=space(),b1=element$1("b"),b1.textContent="Current sensitivity curve:",t10=space(),p2=element$1("p"),p2.innerHTML=`The sensitivity curve shows how the brush size changes depending on pen pressure.<br/>
    The x-axis represents the pressure (from light to hard), and the y-axis represents the brush size (small to big).`,t13=space(),br4=element$1("br"),t14=space(),canvas_1=element$1("canvas"),attr(canvas_1,"width","100"),attr(canvas_1,"height","100"),attr(canvas_1,"class","svelte-18097wc")},m(target,anchor){insert(target,div,anchor),append(div,p0),append(div,t2),append(div,br1),append(div,t3),append(div,b0),append(div,t5),append(div,p1),append(div,t7),append(div,br2),append(div,t8),append(div,b1),append(div,t10),append(div,p2),append(div,t13),append(div,br4),append(div,t14),append(div,canvas_1),ctx[6](canvas_1)},p:noop$1,i:noop$1,o:noop$1,d(detaching){detaching&&detach(div),ctx[6](null)}}}__name(create_fragment$v,"create_fragment$v");function instance$s($$self,$$props,$$invalidate){let $balance,$sensitivity,{feature}=$$props;const sensitivity=feature.sensitivitySettingStore;component_subscribe($$self,sensitivity,value=>$$invalidate(5,$sensitivity=value));const balance=feature.balanceSettingStore;component_subscribe($$self,balance,value=>$$invalidate(4,$balance=value));let canvas;function canvas_1_binding($$value){binding_callbacks[$$value?"unshift":"push"](()=>{canvas=$$value,$$invalidate(0,canvas)})}return __name(canvas_1_binding,"canvas_1_binding"),$$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(3,feature=$$props2.feature)},$$self.$$.update=()=>{if($$self.$$.dirty&49){let s=$sensitivity,v=$balance;const ctx=canvas==null?void 0:canvas.getContext("2d");if(ctx){ctx.imageSmoothingEnabled=!1,ctx.clearRect(0,0,100,100),ctx.fillStyle="white",ctx.lineWidth=2,ctx.fillRect(0,0,100,100),ctx.strokeStyle="rgb(0, 0, 0)",ctx.beginPath();for(let x=0;x<100;x++)ctx.lineTo(x,100-calculatePressurePoint(x/100,s,v)*100);ctx.stroke()}}},[canvas,sensitivity,balance,feature,$balance,$sensitivity,canvas_1_binding]}__name(instance$s,"instance$s");const _Drawing_pressure_info=class _Drawing_pressure_info extends SvelteComponent{constructor(options){super(),init(this,options,instance$s,create_fragment$v,safe_not_equal,{feature:3})}};__name(_Drawing_pressure_info,"Drawing_pressure_info");let Drawing_pressure_info=_Drawing_pressure_info;var __defProp$x=Object.defineProperty,__decorateClass$x=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$x(target,key,result),result},"__decorateClass$x");const _DrawingPressureFeature=class _DrawingPressureFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_toolsService");__publicField(this,"name","Modified Pen Pressure");__publicField(this,"description","Use the full size range and custom sensitivity for pen pressure");__publicField(this,"featureId",37);__publicField(this,"_paramsSubscription");__publicField(this,"_pressureParamSensitivitySetting",this.useSetting(new NumericExtensionSetting("pressure_sensitivity",6,this).withName("Pressure Sensitivity").withDescription("The sensitivity of pressure change. A higher value means a more dense pressure range.").withBounds(1,20).withSlider(1)));__publicField(this,"_pressureParamBalanceSetting",this.useSetting(new NumericExtensionSetting("pressure_balance",.5,this).withName("Pressure Balance").withDescription("The balance of pressure increase. A higher value moves the size range to a higher pressure range.").withBounds(0,1).withSlider(1/20)));__publicField(this,"_pressureMod")}get featureInfoComponent(){return{componentType:Drawing_pressure_info,props:{feature:this}}}async onActivate(){const mod=this._pressureMod=this._toolsService.resolveModOrTool(PressureMod);this._toolsService.activateMod(this._pressureMod),this._paramsSubscription=this._pressureParamSensitivitySetting.changes$.pipe(combineLatestWith(this._pressureParamBalanceSetting.changes$)).subscribe(([sensitivity,balance])=>{mod.setParams(sensitivity,balance)})}async onDestroy(){var _a81;this._pressureMod&&(this._toolsService.removeMod(this._pressureMod),this._pressureMod=void 0),(_a81=this._paramsSubscription)==null||_a81.unsubscribe(),this._paramsSubscription=void 0}get balanceSettingStore(){return this._pressureParamBalanceSetting.store}get sensitivitySettingStore(){return this._pressureParamSensitivitySetting.store}};__name(_DrawingPressureFeature,"DrawingPressureFeature");let DrawingPressureFeature=_DrawingPressureFeature;__decorateClass$x([inject(ToolsService)],DrawingPressureFeature.prototype,"_toolsService");const _ReceiverMethodSubscription=class _ReceiverMethodSubscription{constructor(connection,receiverMethod){__publicField(this,"dispose",__name(()=>{for(const it of this.receiverMethod)this.connection.off(it.methodName,it.method)},"dispose"));this.connection=connection,this.receiverMethod=receiverMethod}};__name(_ReceiverMethodSubscription,"ReceiverMethodSubscription");let ReceiverMethodSubscription=_ReceiverMethodSubscription;const getHubProxyFactory=__name(hubType=>{if(hubType==="IGuildLobbiesHub")return IGuildLobbiesHub_HubProxyFactory.Instance;if(hubType==="ILobbyHub")return ILobbyHub_HubProxyFactory.Instance;if(hubType==="IOnlineItemsHub")return IOnlineItemsHub_HubProxyFactory.Instance},"getHubProxyFactory"),getReceiverRegister=__name(receiverType=>{if(receiverType==="IGuildLobbiesReceiver")return IGuildLobbiesReceiver_Binder.Instance;if(receiverType==="ILobbyReceiver")return ILobbyReceiver_Binder.Instance;if(receiverType==="IOnlineItemsReceiver")return IOnlineItemsReceiver_Binder.Instance},"getReceiverRegister"),_IGuildLobbiesHub_HubProxyFactory=class _IGuildLobbiesHub_HubProxyFactory{constructor(){__publicField(this,"createHubProxy",__name(connection=>new IGuildLobbiesHub_HubProxy(connection),"createHubProxy"))}};__name(_IGuildLobbiesHub_HubProxyFactory,"IGuildLobbiesHub_HubProxyFactory"),__publicField(_IGuildLobbiesHub_HubProxyFactory,"Instance",new _IGuildLobbiesHub_HubProxyFactory);let IGuildLobbiesHub_HubProxyFactory=_IGuildLobbiesHub_HubProxyFactory;const _IGuildLobbiesHub_HubProxy=class _IGuildLobbiesHub_HubProxy{constructor(connection){__publicField(this,"subscribeGuildLobbies",__name(async guildId=>await this.connection.invoke("SubscribeGuildLobbies",guildId),"subscribeGuildLobbies"));this.connection=connection}};__name(_IGuildLobbiesHub_HubProxy,"IGuildLobbiesHub_HubProxy");let IGuildLobbiesHub_HubProxy=_IGuildLobbiesHub_HubProxy;const _ILobbyHub_HubProxyFactory=class _ILobbyHub_HubProxyFactory{constructor(){__publicField(this,"createHubProxy",__name(connection=>new ILobbyHub_HubProxy(connection),"createHubProxy"))}};__name(_ILobbyHub_HubProxyFactory,"ILobbyHub_HubProxyFactory"),__publicField(_ILobbyHub_HubProxyFactory,"Instance",new _ILobbyHub_HubProxyFactory);let ILobbyHub_HubProxyFactory=_ILobbyHub_HubProxyFactory;const _ILobbyHub_HubProxy=class _ILobbyHub_HubProxy{constructor(connection){__publicField(this,"lobbyDiscovered",__name(async lobbyDiscovery=>await this.connection.invoke("LobbyDiscovered",lobbyDiscovery),"lobbyDiscovered"));__publicField(this,"claimLobbyOwnership",__name(async()=>await this.connection.invoke("ClaimLobbyOwnership"),"claimLobbyOwnership"));__publicField(this,"updateSkribblLobbyState",__name(async state=>await this.connection.invoke("UpdateSkribblLobbyState",state),"updateSkribblLobbyState"));__publicField(this,"updateTypoLobbySettings",__name(async typoSettings=>await this.connection.invoke("UpdateTypoLobbySettings",typoSettings),"updateTypoLobbySettings"));__publicField(this,"claimDrop",__name(async dropClaim=>await this.connection.invoke("ClaimDrop",dropClaim),"claimDrop"));__publicField(this,"giftAward",__name(async awardGift=>await this.connection.invoke("GiftAward",awardGift),"giftAward"));this.connection=connection}};__name(_ILobbyHub_HubProxy,"ILobbyHub_HubProxy");let ILobbyHub_HubProxy=_ILobbyHub_HubProxy;const _IOnlineItemsHub_HubProxyFactory=class _IOnlineItemsHub_HubProxyFactory{constructor(){__publicField(this,"createHubProxy",__name(connection=>new IOnlineItemsHub_HubProxy(connection),"createHubProxy"))}};__name(_IOnlineItemsHub_HubProxyFactory,"IOnlineItemsHub_HubProxyFactory"),__publicField(_IOnlineItemsHub_HubProxyFactory,"Instance",new _IOnlineItemsHub_HubProxyFactory);let IOnlineItemsHub_HubProxyFactory=_IOnlineItemsHub_HubProxyFactory;const _IOnlineItemsHub_HubProxy=class _IOnlineItemsHub_HubProxy{constructor(connection){this.connection=connection}};__name(_IOnlineItemsHub_HubProxy,"IOnlineItemsHub_HubProxy");let IOnlineItemsHub_HubProxy=_IOnlineItemsHub_HubProxy;const _IGuildLobbiesReceiver_Binder=class _IGuildLobbiesReceiver_Binder{constructor(){__publicField(this,"register",__name((connection,receiver)=>{const __guildLobbiesUpdated=__name((...args)=>receiver.guildLobbiesUpdated(...args),"__guildLobbiesUpdated");connection.on("GuildLobbiesUpdated",__guildLobbiesUpdated);const methodList=[{methodName:"GuildLobbiesUpdated",method:__guildLobbiesUpdated}];return new ReceiverMethodSubscription(connection,methodList)},"register"))}};__name(_IGuildLobbiesReceiver_Binder,"IGuildLobbiesReceiver_Binder"),__publicField(_IGuildLobbiesReceiver_Binder,"Instance",new _IGuildLobbiesReceiver_Binder);let IGuildLobbiesReceiver_Binder=_IGuildLobbiesReceiver_Binder;const _ILobbyReceiver_Binder=class _ILobbyReceiver_Binder{constructor(){__publicField(this,"register",__name((connection,receiver)=>{const __typoLobbySettingsUpdated=__name((...args)=>receiver.typoLobbySettingsUpdated(...args),"__typoLobbySettingsUpdated"),__lobbyOwnershipResigned=__name(()=>receiver.lobbyOwnershipResigned(),"__lobbyOwnershipResigned"),__dropAnnounced=__name((...args)=>receiver.dropAnnounced(...args),"__dropAnnounced"),__awardGifted=__name((...args)=>receiver.awardGifted(...args),"__awardGifted"),__dropClaimed=__name((...args)=>receiver.dropClaimed(...args),"__dropClaimed"),__dropCleared=__name((...args)=>receiver.dropCleared(...args),"__dropCleared");connection.on("TypoLobbySettingsUpdated",__typoLobbySettingsUpdated),connection.on("LobbyOwnershipResigned",__lobbyOwnershipResigned),connection.on("DropAnnounced",__dropAnnounced),connection.on("AwardGifted",__awardGifted),connection.on("DropClaimed",__dropClaimed),connection.on("DropCleared",__dropCleared);const methodList=[{methodName:"TypoLobbySettingsUpdated",method:__typoLobbySettingsUpdated},{methodName:"LobbyOwnershipResigned",method:__lobbyOwnershipResigned},{methodName:"DropAnnounced",method:__dropAnnounced},{methodName:"AwardGifted",method:__awardGifted},{methodName:"DropClaimed",method:__dropClaimed},{methodName:"DropCleared",method:__dropCleared}];return new ReceiverMethodSubscription(connection,methodList)},"register"))}};__name(_ILobbyReceiver_Binder,"ILobbyReceiver_Binder"),__publicField(_ILobbyReceiver_Binder,"Instance",new _ILobbyReceiver_Binder);let ILobbyReceiver_Binder=_ILobbyReceiver_Binder;const _IOnlineItemsReceiver_Binder=class _IOnlineItemsReceiver_Binder{constructor(){__publicField(this,"register",__name((connection,receiver)=>{const __onlineItemsUpdated=__name((...args)=>receiver.onlineItemsUpdated(...args),"__onlineItemsUpdated");connection.on("OnlineItemsUpdated",__onlineItemsUpdated);const methodList=[{methodName:"OnlineItemsUpdated",method:__onlineItemsUpdated}];return new ReceiverMethodSubscription(connection,methodList)},"register"))}};__name(_IOnlineItemsReceiver_Binder,"IOnlineItemsReceiver_Binder"),__publicField(_IOnlineItemsReceiver_Binder,"Instance",new _IOnlineItemsReceiver_Binder);let IOnlineItemsReceiver_Binder=_IOnlineItemsReceiver_Binder;const _HttpError=class _HttpError extends Error{constructor(errorMessage,statusCode){const trueProto=new.target.prototype;super(`${errorMessage}: Status code '${statusCode}'`),this.statusCode=statusCode,this.__proto__=trueProto}};__name(_HttpError,"HttpError");let HttpError=_HttpError;const _TimeoutError=class _TimeoutError extends Error{constructor(errorMessage="A timeout occurred."){const trueProto=new.target.prototype;super(errorMessage),this.__proto__=trueProto}};__name(_TimeoutError,"TimeoutError");let TimeoutError=_TimeoutError;const _AbortError=class _AbortError extends Error{constructor(errorMessage="An abort occurred."){const trueProto=new.target.prototype;super(errorMessage),this.__proto__=trueProto}};__name(_AbortError,"AbortError");let AbortError=_AbortError;const _UnsupportedTransportError=class _UnsupportedTransportError extends Error{constructor(message,transport){const trueProto=new.target.prototype;super(message),this.transport=transport,this.errorType="UnsupportedTransportError",this.__proto__=trueProto}};__name(_UnsupportedTransportError,"UnsupportedTransportError");let UnsupportedTransportError=_UnsupportedTransportError;const _DisabledTransportError=class _DisabledTransportError extends Error{constructor(message,transport){const trueProto=new.target.prototype;super(message),this.transport=transport,this.errorType="DisabledTransportError",this.__proto__=trueProto}};__name(_DisabledTransportError,"DisabledTransportError");let DisabledTransportError=_DisabledTransportError;const _FailedToStartTransportError=class _FailedToStartTransportError extends Error{constructor(message,transport){const trueProto=new.target.prototype;super(message),this.transport=transport,this.errorType="FailedToStartTransportError",this.__proto__=trueProto}};__name(_FailedToStartTransportError,"FailedToStartTransportError");let FailedToStartTransportError=_FailedToStartTransportError;const _FailedToNegotiateWithServerError=class _FailedToNegotiateWithServerError extends Error{constructor(message){const trueProto=new.target.prototype;super(message),this.errorType="FailedToNegotiateWithServerError",this.__proto__=trueProto}};__name(_FailedToNegotiateWithServerError,"FailedToNegotiateWithServerError");let FailedToNegotiateWithServerError=_FailedToNegotiateWithServerError;const _AggregateErrors=class _AggregateErrors extends Error{constructor(message,innerErrors){const trueProto=new.target.prototype;super(message),this.innerErrors=innerErrors,this.__proto__=trueProto}};__name(_AggregateErrors,"AggregateErrors");let AggregateErrors=_AggregateErrors;const _HttpResponse=class _HttpResponse{constructor(statusCode,statusText,content){this.statusCode=statusCode,this.statusText=statusText,this.content=content}};__name(_HttpResponse,"HttpResponse");let HttpResponse=_HttpResponse;const _HttpClient=class _HttpClient{get(url,options){return this.send({...options,method:"GET",url})}post(url,options){return this.send({...options,method:"POST",url})}delete(url,options){return this.send({...options,method:"DELETE",url})}getCookieString(url){return""}};__name(_HttpClient,"HttpClient");let HttpClient=_HttpClient;var LogLevel;(function(LogLevel2){LogLevel2[LogLevel2.Trace=0]="Trace",LogLevel2[LogLevel2.Debug=1]="Debug",LogLevel2[LogLevel2.Information=2]="Information",LogLevel2[LogLevel2.Warning=3]="Warning",LogLevel2[LogLevel2.Error=4]="Error",LogLevel2[LogLevel2.Critical=5]="Critical",LogLevel2[LogLevel2.None=6]="None"})(LogLevel||(LogLevel={}));const _NullLogger=class _NullLogger{constructor(){}log(_logLevel,_message){}};__name(_NullLogger,"NullLogger");let NullLogger=_NullLogger;NullLogger.instance=new NullLogger;const VERSION="8.0.7",_Arg=class _Arg{static isRequired(val,name){if(val==null)throw new Error(`The '${name}' argument is required.`)}static isNotEmpty(val,name){if(!val||val.match(/^\s*$/))throw new Error(`The '${name}' argument should not be empty.`)}static isIn(val,values,name){if(!(val in values))throw new Error(`Unknown ${name} value: ${val}.`)}};__name(_Arg,"Arg");let Arg=_Arg;const _Platform=class _Platform{static get isBrowser(){return!_Platform.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!_Platform.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!_Platform.isNode&&typeof window=="object"&&typeof window.document>"u"}static get isNode(){return typeof process<"u"&&process.release&&process.release.name==="node"}};__name(_Platform,"Platform");let Platform=_Platform;function getDataDetail(data,includeContent){let detail="";return isArrayBuffer(data)?(detail=`Binary data of length ${data.byteLength}`,includeContent&&(detail+=`. Content: '${formatArrayBuffer(data)}'`)):typeof data=="string"&&(detail=`String data of length ${data.length}`,includeContent&&(detail+=`. Content: '${data}'`)),detail}__name(getDataDetail,"getDataDetail");function formatArrayBuffer(data){const view=new Uint8Array(data);let str="";return view.forEach(num=>{const pad=num<16?"0":"";str+=`0x${pad}${num.toString(16)} `}),str.substr(0,str.length-1)}__name(formatArrayBuffer,"formatArrayBuffer");function isArrayBuffer(val){return val&&typeof ArrayBuffer<"u"&&(val instanceof ArrayBuffer||val.constructor&&val.constructor.name==="ArrayBuffer")}__name(isArrayBuffer,"isArrayBuffer");async function sendMessage(logger,transportName,httpClient,url,content,options){const headers={},[name,value]=getUserAgentHeader();headers[name]=value,logger.log(LogLevel.Trace,`(${transportName} transport) sending data. ${getDataDetail(content,options.logMessageContent)}.`);const responseType=isArrayBuffer(content)?"arraybuffer":"text",response=await httpClient.post(url,{content,headers:{...headers,...options.headers},responseType,timeout:options.timeout,withCredentials:options.withCredentials});logger.log(LogLevel.Trace,`(${transportName} transport) request complete. Response status: ${response.statusCode}.`)}__name(sendMessage,"sendMessage");function createLogger(logger){return logger===void 0?new ConsoleLogger(LogLevel.Information):logger===null?NullLogger.instance:logger.log!==void 0?logger:new ConsoleLogger(logger)}__name(createLogger,"createLogger");const _SubjectSubscription=class _SubjectSubscription{constructor(subject,observer){this._subject=subject,this._observer=observer}dispose(){const index=this._subject.observers.indexOf(this._observer);index>-1&&this._subject.observers.splice(index,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(_=>{})}};__name(_SubjectSubscription,"SubjectSubscription");let SubjectSubscription=_SubjectSubscription;const _ConsoleLogger=class _ConsoleLogger{constructor(minimumLogLevel){this._minLevel=minimumLogLevel,this.out=console}log(logLevel,message){if(logLevel>=this._minLevel){const msg=`[${new Date().toISOString()}] ${LogLevel[logLevel]}: ${message}`;switch(logLevel){case LogLevel.Critical:case LogLevel.Error:this.out.error(msg);break;case LogLevel.Warning:this.out.warn(msg);break;case LogLevel.Information:this.out.info(msg);break;default:this.out.log(msg);break}}}};__name(_ConsoleLogger,"ConsoleLogger");let ConsoleLogger=_ConsoleLogger;function getUserAgentHeader(){let userAgentHeaderName="X-SignalR-User-Agent";return Platform.isNode&&(userAgentHeaderName="User-Agent"),[userAgentHeaderName,constructUserAgent(VERSION,getOsName(),getRuntime(),getRuntimeVersion())]}__name(getUserAgentHeader,"getUserAgentHeader");function constructUserAgent(version,os,runtime,runtimeVersion){let userAgent="Microsoft SignalR/";const majorAndMinor=version.split(".");return userAgent+=`${majorAndMinor[0]}.${majorAndMinor[1]}`,userAgent+=` (${version}; `,os&&os!==""?userAgent+=`${os}; `:userAgent+="Unknown OS; ",userAgent+=`${runtime}`,runtimeVersion?userAgent+=`; ${runtimeVersion}`:userAgent+="; Unknown Runtime Version",userAgent+=")",userAgent}__name(constructUserAgent,"constructUserAgent");function getOsName(){if(Platform.isNode)switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}else return""}__name(getOsName,"getOsName");function getRuntimeVersion(){if(Platform.isNode)return process.versions.node}__name(getRuntimeVersion,"getRuntimeVersion");function getRuntime(){return Platform.isNode?"NodeJS":"Browser"}__name(getRuntime,"getRuntime");function getErrorString(e){return e.stack?e.stack:e.message?e.message:`${e}`}__name(getErrorString,"getErrorString");function getGlobalThis(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}__name(getGlobalThis,"getGlobalThis");const _FetchHttpClient=class _FetchHttpClient extends HttpClient{constructor(logger){if(super(),this._logger=logger,typeof fetch>"u"||Platform.isNode){const requireFunc=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._jar=new(requireFunc("tough-cookie")).CookieJar,typeof fetch>"u"?this._fetchType=requireFunc("node-fetch"):this._fetchType=fetch,this._fetchType=requireFunc("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(getGlobalThis());if(typeof AbortController>"u"){const requireFunc=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._abortControllerType=requireFunc("abort-controller")}else this._abortControllerType=AbortController}async send(request){if(request.abortSignal&&request.abortSignal.aborted)throw new AbortError;if(!request.method)throw new Error("No method defined.");if(!request.url)throw new Error("No url defined.");const abortController=new this._abortControllerType;let error;request.abortSignal&&(request.abortSignal.onabort=()=>{abortController.abort(),error=new AbortError});let timeoutId=null;if(request.timeout){const msTimeout=request.timeout;timeoutId=setTimeout(()=>{abortController.abort(),this._logger.log(LogLevel.Warning,"Timeout from HTTP request."),error=new TimeoutError},msTimeout)}request.content===""&&(request.content=void 0),request.content&&(request.headers=request.headers||{},isArrayBuffer(request.content)?request.headers["Content-Type"]="application/octet-stream":request.headers["Content-Type"]="text/plain;charset=UTF-8");let response;try{response=await this._fetchType(request.url,{body:request.content,cache:"no-cache",credentials:request.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...request.headers},method:request.method,mode:"cors",redirect:"follow",signal:abortController.signal})}catch(e){throw error||(this._logger.log(LogLevel.Warning,`Error from HTTP request. ${e}.`),e)}finally{timeoutId&&clearTimeout(timeoutId),request.abortSignal&&(request.abortSignal.onabort=null)}if(!response.ok){const errorMessage=await deserializeContent(response,"text");throw new HttpError(errorMessage||response.statusText,response.status)}const payload=await deserializeContent(response,request.responseType);return new HttpResponse(response.status,response.statusText,payload)}getCookieString(url){let cookies="";return Platform.isNode&&this._jar&&this._jar.getCookies(url,(e,c)=>cookies=c.join("; ")),cookies}};__name(_FetchHttpClient,"FetchHttpClient");let FetchHttpClient=_FetchHttpClient;function deserializeContent(response,responseType){let content;switch(responseType){case"arraybuffer":content=response.arrayBuffer();break;case"text":content=response.text();break;case"blob":case"document":case"json":throw new Error(`${responseType} is not supported.`);default:content=response.text();break}return content}__name(deserializeContent,"deserializeContent");const _XhrHttpClient=class _XhrHttpClient extends HttpClient{constructor(logger){super(),this._logger=logger}send(request){return request.abortSignal&&request.abortSignal.aborted?Promise.reject(new AbortError):request.method?request.url?new Promise((resolve2,reject)=>{const xhr=new XMLHttpRequest;xhr.open(request.method,request.url,!0),xhr.withCredentials=request.withCredentials===void 0?!0:request.withCredentials,xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),request.content===""&&(request.content=void 0),request.content&&(isArrayBuffer(request.content)?xhr.setRequestHeader("Content-Type","application/octet-stream"):xhr.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const headers=request.headers;headers&&Object.keys(headers).forEach(header=>{xhr.setRequestHeader(header,headers[header])}),request.responseType&&(xhr.responseType=request.responseType),request.abortSignal&&(request.abortSignal.onabort=()=>{xhr.abort(),reject(new AbortError)}),request.timeout&&(xhr.timeout=request.timeout),xhr.onload=()=>{request.abortSignal&&(request.abortSignal.onabort=null),xhr.status>=200&&xhr.status<300?resolve2(new HttpResponse(xhr.status,xhr.statusText,xhr.response||xhr.responseText)):reject(new HttpError(xhr.response||xhr.responseText||xhr.statusText,xhr.status))},xhr.onerror=()=>{this._logger.log(LogLevel.Warning,`Error from HTTP request. ${xhr.status}: ${xhr.statusText}.`),reject(new HttpError(xhr.statusText,xhr.status))},xhr.ontimeout=()=>{this._logger.log(LogLevel.Warning,"Timeout from HTTP request."),reject(new TimeoutError)},xhr.send(request.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}};__name(_XhrHttpClient,"XhrHttpClient");let XhrHttpClient=_XhrHttpClient;const _DefaultHttpClient=class _DefaultHttpClient extends HttpClient{constructor(logger){if(super(),typeof fetch<"u"||Platform.isNode)this._httpClient=new FetchHttpClient(logger);else if(typeof XMLHttpRequest<"u")this._httpClient=new XhrHttpClient(logger);else throw new Error("No usable HttpClient found.")}send(request){return request.abortSignal&&request.abortSignal.aborted?Promise.reject(new AbortError):request.method?request.url?this._httpClient.send(request):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(url){return this._httpClient.getCookieString(url)}};__name(_DefaultHttpClient,"DefaultHttpClient");let DefaultHttpClient=_DefaultHttpClient;const _TextMessageFormat=class _TextMessageFormat{static write(output){return`${output}${_TextMessageFormat.RecordSeparator}`}static parse(input){if(input[input.length-1]!==_TextMessageFormat.RecordSeparator)throw new Error("Message is incomplete.");const messages=input.split(_TextMessageFormat.RecordSeparator);return messages.pop(),messages}};__name(_TextMessageFormat,"TextMessageFormat");let TextMessageFormat=_TextMessageFormat;TextMessageFormat.RecordSeparatorCode=30;TextMessageFormat.RecordSeparator=String.fromCharCode(TextMessageFormat.RecordSeparatorCode);const _HandshakeProtocol=class _HandshakeProtocol{writeHandshakeRequest(handshakeRequest){return TextMessageFormat.write(JSON.stringify(handshakeRequest))}parseHandshakeResponse(data){let messageData,remainingData;if(isArrayBuffer(data)){const binaryData=new Uint8Array(data),separatorIndex=binaryData.indexOf(TextMessageFormat.RecordSeparatorCode);if(separatorIndex===-1)throw new Error("Message is incomplete.");const responseLength=separatorIndex+1;messageData=String.fromCharCode.apply(null,Array.prototype.slice.call(binaryData.slice(0,responseLength))),remainingData=binaryData.byteLength>responseLength?binaryData.slice(responseLength).buffer:null}else{const textData=data,separatorIndex=textData.indexOf(TextMessageFormat.RecordSeparator);if(separatorIndex===-1)throw new Error("Message is incomplete.");const responseLength=separatorIndex+1;messageData=textData.substring(0,responseLength),remainingData=textData.length>responseLength?textData.substring(responseLength):null}const messages=TextMessageFormat.parse(messageData),response=JSON.parse(messages[0]);if(response.type)throw new Error("Expected a handshake response from the server.");return[remainingData,response]}};__name(_HandshakeProtocol,"HandshakeProtocol");let HandshakeProtocol=_HandshakeProtocol;var MessageType;(function(MessageType2){MessageType2[MessageType2.Invocation=1]="Invocation",MessageType2[MessageType2.StreamItem=2]="StreamItem",MessageType2[MessageType2.Completion=3]="Completion",MessageType2[MessageType2.StreamInvocation=4]="StreamInvocation",MessageType2[MessageType2.CancelInvocation=5]="CancelInvocation",MessageType2[MessageType2.Ping=6]="Ping",MessageType2[MessageType2.Close=7]="Close",MessageType2[MessageType2.Ack=8]="Ack",MessageType2[MessageType2.Sequence=9]="Sequence"})(MessageType||(MessageType={}));const _Subject=class _Subject{constructor(){this.observers=[]}next(item){for(const observer of this.observers)observer.next(item)}error(err){for(const observer of this.observers)observer.error&&observer.error(err)}complete(){for(const observer of this.observers)observer.complete&&observer.complete()}subscribe(observer){return this.observers.push(observer),new SubjectSubscription(this,observer)}};__name(_Subject,"Subject");let Subject=_Subject;const _MessageBuffer=class _MessageBuffer{constructor(protocol,connection,bufferSize){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=protocol,this._connection=connection,this._bufferSize=bufferSize}async _send(message){const serializedMessage=this._protocol.writeMessage(message);let backpressurePromise=Promise.resolve();if(this._isInvocationMessage(message)){this._totalMessageCount++;let backpressurePromiseResolver=__name(()=>{},"backpressurePromiseResolver"),backpressurePromiseRejector=__name(()=>{},"backpressurePromiseRejector");isArrayBuffer(serializedMessage)?this._bufferedByteCount+=serializedMessage.byteLength:this._bufferedByteCount+=serializedMessage.length,this._bufferedByteCount>=this._bufferSize&&(backpressurePromise=new Promise((resolve2,reject)=>{backpressurePromiseResolver=resolve2,backpressurePromiseRejector=reject})),this._messages.push(new BufferedItem(serializedMessage,this._totalMessageCount,backpressurePromiseResolver,backpressurePromiseRejector))}try{this._reconnectInProgress||await this._connection.send(serializedMessage)}catch{this._disconnected()}await backpressurePromise}_ack(ackMessage){let newestAckedMessage=-1;for(let index=0;index<this._messages.length;index++){const element2=this._messages[index];if(element2._id<=ackMessage.sequenceId)newestAckedMessage=index,isArrayBuffer(element2._message)?this._bufferedByteCount-=element2._message.byteLength:this._bufferedByteCount-=element2._message.length,element2._resolver();else if(this._bufferedByteCount<this._bufferSize)element2._resolver();else break}newestAckedMessage!==-1&&(this._messages=this._messages.slice(newestAckedMessage+1))}_shouldProcessMessage(message){if(this._waitForSequenceMessage)return message.type!==MessageType.Sequence?!1:(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(message))return!0;const currentId=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,currentId<=this._latestReceivedSequenceId?(currentId===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=currentId,this._ackTimer(),!0)}_resetSequence(message){if(message.sequenceId>this._nextReceivingSequenceId){this._connection.stop(new Error("Sequence ID greater than amount of messages we've received."));return}this._nextReceivingSequenceId=message.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}async _resend(){const sequenceId=this._messages.length!==0?this._messages[0]._id:this._totalMessageCount+1;await this._connection.send(this._protocol.writeMessage({type:MessageType.Sequence,sequenceId}));const messages=this._messages;for(const element2 of messages)await this._connection.send(element2._message);this._reconnectInProgress=!1}_dispose(error){error??(error=new Error("Unable to reconnect to server."));for(const element2 of this._messages)element2._rejector(error)}_isInvocationMessage(message){switch(message.type){case MessageType.Invocation:case MessageType.StreamItem:case MessageType.Completion:case MessageType.StreamInvocation:case MessageType.CancelInvocation:return!0;case MessageType.Close:case MessageType.Sequence:case MessageType.Ping:case MessageType.Ack:return!1}}_ackTimer(){this._ackTimerHandle===void 0&&(this._ackTimerHandle=setTimeout(async()=>{try{this._reconnectInProgress||await this._connection.send(this._protocol.writeMessage({type:MessageType.Ack,sequenceId:this._latestReceivedSequenceId}))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0},1e3))}};__name(_MessageBuffer,"MessageBuffer");let MessageBuffer=_MessageBuffer;const _BufferedItem=class _BufferedItem{constructor(message,id2,resolver,rejector){this._message=message,this._id=id2,this._resolver=resolver,this._rejector=rejector}};__name(_BufferedItem,"BufferedItem");let BufferedItem=_BufferedItem;const DEFAULT_TIMEOUT_IN_MS=30*1e3,DEFAULT_PING_INTERVAL_IN_MS=15*1e3,DEFAULT_STATEFUL_RECONNECT_BUFFER_SIZE=1e5;var HubConnectionState;(function(HubConnectionState2){HubConnectionState2.Disconnected="Disconnected",HubConnectionState2.Connecting="Connecting",HubConnectionState2.Connected="Connected",HubConnectionState2.Disconnecting="Disconnecting",HubConnectionState2.Reconnecting="Reconnecting"})(HubConnectionState||(HubConnectionState={}));const _HubConnection=class _HubConnection{static create(connection,logger,protocol,reconnectPolicy,serverTimeoutInMilliseconds,keepAliveIntervalInMilliseconds,statefulReconnectBufferSize){return new _HubConnection(connection,logger,protocol,reconnectPolicy,serverTimeoutInMilliseconds,keepAliveIntervalInMilliseconds,statefulReconnectBufferSize)}constructor(connection,logger,protocol,reconnectPolicy,serverTimeoutInMilliseconds,keepAliveIntervalInMilliseconds,statefulReconnectBufferSize){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(LogLevel.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},Arg.isRequired(connection,"connection"),Arg.isRequired(logger,"logger"),Arg.isRequired(protocol,"protocol"),this.serverTimeoutInMilliseconds=serverTimeoutInMilliseconds??DEFAULT_TIMEOUT_IN_MS,this.keepAliveIntervalInMilliseconds=keepAliveIntervalInMilliseconds??DEFAULT_PING_INTERVAL_IN_MS,this._statefulReconnectBufferSize=statefulReconnectBufferSize??DEFAULT_STATEFUL_RECONNECT_BUFFER_SIZE,this._logger=logger,this._protocol=protocol,this.connection=connection,this._reconnectPolicy=reconnectPolicy,this._handshakeProtocol=new HandshakeProtocol,this.connection.onreceive=data=>this._processIncomingData(data),this.connection.onclose=error=>this._connectionClosed(error),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=HubConnectionState.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:MessageType.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(url){if(this._connectionState!==HubConnectionState.Disconnected&&this._connectionState!==HubConnectionState.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!url)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=url}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==HubConnectionState.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=HubConnectionState.Connecting,this._logger.log(LogLevel.Debug,"Starting HubConnection.");try{await this._startInternal(),Platform.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=HubConnectionState.Connected,this._connectionStarted=!0,this._logger.log(LogLevel.Debug,"HubConnection connected successfully.")}catch(e){return this._connectionState=HubConnectionState.Disconnected,this._logger.log(LogLevel.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;const handshakePromise=new Promise((resolve2,reject)=>{this._handshakeResolver=resolve2,this._handshakeRejecter=reject});await this.connection.start(this._protocol.transferFormat);try{let version=this._protocol.version;this.connection.features.reconnect||(version=1);const handshakeRequest={protocol:this._protocol.name,version};if(this._logger.log(LogLevel.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(handshakeRequest)),this._logger.log(LogLevel.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await handshakePromise,this._stopDuringStartError)throw this._stopDuringStartError;(this.connection.features.reconnect||!1)&&(this._messageBuffer=new MessageBuffer(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(e){throw this._logger.log(LogLevel.Debug,`Hub handshake failed with error '${e}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(e),e}}async stop(){const startPromise=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),await this._stopPromise;try{await startPromise}catch{}}_stopInternal(error){if(this._connectionState===HubConnectionState.Disconnected)return this._logger.log(LogLevel.Debug,`Call to HubConnection.stop(${error}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===HubConnectionState.Disconnecting)return this._logger.log(LogLevel.Debug,`Call to HttpConnection.stop(${error}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;const state=this._connectionState;return this._connectionState=HubConnectionState.Disconnecting,this._logger.log(LogLevel.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(LogLevel.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(state===HubConnectionState.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=error||new AbortError("The connection was stopped before the hub handshake could complete."),this.connection.stop(error))}async _sendCloseMessage(){try{await this._sendWithProtocol(this._createCloseMessage())}catch{}}stream(methodName,...args){const[streams,streamIds]=this._replaceStreamingParams(args),invocationDescriptor=this._createStreamInvocation(methodName,args,streamIds);let promiseQueue;const subject=new Subject;return subject.cancelCallback=()=>{const cancelInvocation=this._createCancelInvocation(invocationDescriptor.invocationId);return delete this._callbacks[invocationDescriptor.invocationId],promiseQueue.then(()=>this._sendWithProtocol(cancelInvocation))},this._callbacks[invocationDescriptor.invocationId]=(invocationEvent,error)=>{if(error){subject.error(error);return}else invocationEvent&&(invocationEvent.type===MessageType.Completion?invocationEvent.error?subject.error(new Error(invocationEvent.error)):subject.complete():subject.next(invocationEvent.item))},promiseQueue=this._sendWithProtocol(invocationDescriptor).catch(e=>{subject.error(e),delete this._callbacks[invocationDescriptor.invocationId]}),this._launchStreams(streams,promiseQueue),subject}_sendMessage(message){return this._resetKeepAliveInterval(),this.connection.send(message)}_sendWithProtocol(message){return this._messageBuffer?this._messageBuffer._send(message):this._sendMessage(this._protocol.writeMessage(message))}send(methodName,...args){const[streams,streamIds]=this._replaceStreamingParams(args),sendPromise=this._sendWithProtocol(this._createInvocation(methodName,args,!0,streamIds));return this._launchStreams(streams,sendPromise),sendPromise}invoke(methodName,...args){const[streams,streamIds]=this._replaceStreamingParams(args),invocationDescriptor=this._createInvocation(methodName,args,!1,streamIds);return new Promise((resolve2,reject)=>{this._callbacks[invocationDescriptor.invocationId]=(invocationEvent,error)=>{if(error){reject(error);return}else invocationEvent&&(invocationEvent.type===MessageType.Completion?invocationEvent.error?reject(new Error(invocationEvent.error)):resolve2(invocationEvent.result):reject(new Error(`Unexpected message type: ${invocationEvent.type}`)))};const promiseQueue=this._sendWithProtocol(invocationDescriptor).catch(e=>{reject(e),delete this._callbacks[invocationDescriptor.invocationId]});this._launchStreams(streams,promiseQueue)})}on(methodName,newMethod){!methodName||!newMethod||(methodName=methodName.toLowerCase(),this._methods[methodName]||(this._methods[methodName]=[]),this._methods[methodName].indexOf(newMethod)===-1&&this._methods[methodName].push(newMethod))}off(methodName,method){if(!methodName)return;methodName=methodName.toLowerCase();const handlers=this._methods[methodName];if(handlers)if(method){const removeIdx=handlers.indexOf(method);removeIdx!==-1&&(handlers.splice(removeIdx,1),handlers.length===0&&delete this._methods[methodName])}else delete this._methods[methodName]}onclose(callback){callback&&this._closedCallbacks.push(callback)}onreconnecting(callback){callback&&this._reconnectingCallbacks.push(callback)}onreconnected(callback){callback&&this._reconnectedCallbacks.push(callback)}_processIncomingData(data){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(data=this._processHandshakeResponse(data),this._receivedHandshakeResponse=!0),data){const messages=this._protocol.parseMessages(data,this._logger);for(const message of messages)if(!(this._messageBuffer&&!this._messageBuffer._shouldProcessMessage(message)))switch(message.type){case MessageType.Invocation:this._invokeClientMethod(message).catch(e=>{this._logger.log(LogLevel.Error,`Invoke client method threw error: ${getErrorString(e)}`)});break;case MessageType.StreamItem:case MessageType.Completion:{const callback=this._callbacks[message.invocationId];if(callback){message.type===MessageType.Completion&&delete this._callbacks[message.invocationId];try{callback(message)}catch(e){this._logger.log(LogLevel.Error,`Stream callback threw error: ${getErrorString(e)}`)}}break}case MessageType.Ping:break;case MessageType.Close:{this._logger.log(LogLevel.Information,"Close message received from server.");const error=message.error?new Error("Server returned an error on close: "+message.error):void 0;message.allowReconnect===!0?this.connection.stop(error):this._stopPromise=this._stopInternal(error);break}case MessageType.Ack:this._messageBuffer&&this._messageBuffer._ack(message);break;case MessageType.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(message);break;default:this._logger.log(LogLevel.Warning,`Invalid message type: ${message.type}.`);break}}this._resetTimeoutPeriod()}_processHandshakeResponse(data){let responseMessage,remainingData;try{[remainingData,responseMessage]=this._handshakeProtocol.parseHandshakeResponse(data)}catch(e){const message="Error parsing handshake response: "+e;this._logger.log(LogLevel.Error,message);const error=new Error(message);throw this._handshakeRejecter(error),error}if(responseMessage.error){const message="Server returned handshake error: "+responseMessage.error;this._logger.log(LogLevel.Error,message);const error=new Error(message);throw this._handshakeRejecter(error),error}else this._logger.log(LogLevel.Debug,"Server handshake complete.");return this._handshakeResolver(),remainingData}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if((!this.connection.features||!this.connection.features.inherentKeepAlive)&&(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this._pingServerHandle===void 0)){let nextPing=this._nextKeepAlive-new Date().getTime();nextPing<0&&(nextPing=0),this._pingServerHandle=setTimeout(async()=>{if(this._connectionState===HubConnectionState.Connected)try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}},nextPing)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(invocationMessage){const methodName=invocationMessage.target.toLowerCase(),methods=this._methods[methodName];if(!methods){this._logger.log(LogLevel.Warning,`No client method with the name '${methodName}' found.`),invocationMessage.invocationId&&(this._logger.log(LogLevel.Warning,`No result given for '${methodName}' method and invocation ID '${invocationMessage.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(invocationMessage.invocationId,"Client didn't provide a result.",null)));return}const methodsCopy=methods.slice(),expectsResponse=!!invocationMessage.invocationId;let res,exception,completionMessage;for(const m of methodsCopy)try{const prevRes=res;res=await m.apply(this,invocationMessage.arguments),expectsResponse&&res&&prevRes&&(this._logger.log(LogLevel.Error,`Multiple results provided for '${methodName}'. Sending error to server.`),completionMessage=this._createCompletionMessage(invocationMessage.invocationId,"Client provided multiple results.",null)),exception=void 0}catch(e){exception=e,this._logger.log(LogLevel.Error,`A callback for the method '${methodName}' threw error '${e}'.`)}completionMessage?await this._sendWithProtocol(completionMessage):expectsResponse?(exception?completionMessage=this._createCompletionMessage(invocationMessage.invocationId,`${exception}`,null):res!==void 0?completionMessage=this._createCompletionMessage(invocationMessage.invocationId,null,res):(this._logger.log(LogLevel.Warning,`No result given for '${methodName}' method and invocation ID '${invocationMessage.invocationId}'.`),completionMessage=this._createCompletionMessage(invocationMessage.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(completionMessage)):res&&this._logger.log(LogLevel.Error,`Result given for '${methodName}' method but server is not expecting a result.`)}_connectionClosed(error){this._logger.log(LogLevel.Debug,`HubConnection.connectionClosed(${error}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||error||new AbortError("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(error||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===HubConnectionState.Disconnecting?this._completeClose(error):this._connectionState===HubConnectionState.Connected&&this._reconnectPolicy?this._reconnect(error):this._connectionState===HubConnectionState.Connected&&this._completeClose(error)}_completeClose(error){if(this._connectionStarted){this._connectionState=HubConnectionState.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(error??new Error("Connection closed.")),this._messageBuffer=void 0),Platform.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(c=>c.apply(this,[error]))}catch(e){this._logger.log(LogLevel.Error,`An onclose callback called with error '${error}' threw error '${e}'.`)}}}async _reconnect(error){const reconnectStartTime=Date.now();let previousReconnectAttempts=0,retryError=error!==void 0?error:new Error("Attempting to reconnect due to a unknown error."),nextRetryDelay=this._getNextRetryDelay(previousReconnectAttempts++,0,retryError);if(nextRetryDelay===null){this._logger.log(LogLevel.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this._completeClose(error);return}if(this._connectionState=HubConnectionState.Reconnecting,error?this._logger.log(LogLevel.Information,`Connection reconnecting because of error '${error}'.`):this._logger.log(LogLevel.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(c=>c.apply(this,[error]))}catch(e){this._logger.log(LogLevel.Error,`An onreconnecting callback called with error '${error}' threw error '${e}'.`)}if(this._connectionState!==HubConnectionState.Reconnecting){this._logger.log(LogLevel.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");return}}for(;nextRetryDelay!==null;){if(this._logger.log(LogLevel.Information,`Reconnect attempt number ${previousReconnectAttempts} will start in ${nextRetryDelay} ms.`),await new Promise(resolve2=>{this._reconnectDelayHandle=setTimeout(resolve2,nextRetryDelay)}),this._reconnectDelayHandle=void 0,this._connectionState!==HubConnectionState.Reconnecting){this._logger.log(LogLevel.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");return}try{if(await this._startInternal(),this._connectionState=HubConnectionState.Connected,this._logger.log(LogLevel.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(c=>c.apply(this,[this.connection.connectionId]))}catch(e){this._logger.log(LogLevel.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${e}'.`)}return}catch(e){if(this._logger.log(LogLevel.Information,`Reconnect attempt failed because of error '${e}'.`),this._connectionState!==HubConnectionState.Reconnecting){this._logger.log(LogLevel.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),this._connectionState===HubConnectionState.Disconnecting&&this._completeClose();return}retryError=e instanceof Error?e:new Error(e.toString()),nextRetryDelay=this._getNextRetryDelay(previousReconnectAttempts++,Date.now()-reconnectStartTime,retryError)}}this._logger.log(LogLevel.Information,`Reconnect retries have been exhausted after ${Date.now()-reconnectStartTime} ms and ${previousReconnectAttempts} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(previousRetryCount,elapsedMilliseconds,retryReason){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds,previousRetryCount,retryReason})}catch(e){return this._logger.log(LogLevel.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${previousRetryCount}, ${elapsedMilliseconds}) threw error '${e}'.`),null}}_cancelCallbacksWithError(error){const callbacks=this._callbacks;this._callbacks={},Object.keys(callbacks).forEach(key=>{const callback=callbacks[key];try{callback(null,error)}catch(e){this._logger.log(LogLevel.Error,`Stream 'error' callback called with '${error}' threw error: ${getErrorString(e)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(methodName,args,nonblocking,streamIds){if(nonblocking)return streamIds.length!==0?{arguments:args,streamIds,target:methodName,type:MessageType.Invocation}:{arguments:args,target:methodName,type:MessageType.Invocation};{const invocationId=this._invocationId;return this._invocationId++,streamIds.length!==0?{arguments:args,invocationId:invocationId.toString(),streamIds,target:methodName,type:MessageType.Invocation}:{arguments:args,invocationId:invocationId.toString(),target:methodName,type:MessageType.Invocation}}}_launchStreams(streams,promiseQueue){if(streams.length!==0){promiseQueue||(promiseQueue=Promise.resolve());for(const streamId in streams)streams[streamId].subscribe({complete:__name(()=>{promiseQueue=promiseQueue.then(()=>this._sendWithProtocol(this._createCompletionMessage(streamId)))},"complete"),error:__name(err=>{let message;err instanceof Error?message=err.message:err&&err.toString?message=err.toString():message="Unknown error",promiseQueue=promiseQueue.then(()=>this._sendWithProtocol(this._createCompletionMessage(streamId,message)))},"error"),next:__name(item=>{promiseQueue=promiseQueue.then(()=>this._sendWithProtocol(this._createStreamItemMessage(streamId,item)))},"next")})}}_replaceStreamingParams(args){const streams=[],streamIds=[];for(let i=0;i<args.length;i++){const argument=args[i];if(this._isObservable(argument)){const streamId=this._invocationId;this._invocationId++,streams[streamId]=argument,streamIds.push(streamId.toString()),args.splice(i,1)}}return[streams,streamIds]}_isObservable(arg){return arg&&arg.subscribe&&typeof arg.subscribe=="function"}_createStreamInvocation(methodName,args,streamIds){const invocationId=this._invocationId;return this._invocationId++,streamIds.length!==0?{arguments:args,invocationId:invocationId.toString(),streamIds,target:methodName,type:MessageType.StreamInvocation}:{arguments:args,invocationId:invocationId.toString(),target:methodName,type:MessageType.StreamInvocation}}_createCancelInvocation(id2){return{invocationId:id2,type:MessageType.CancelInvocation}}_createStreamItemMessage(id2,item){return{invocationId:id2,item,type:MessageType.StreamItem}}_createCompletionMessage(id2,error,result){return error?{error,invocationId:id2,type:MessageType.Completion}:{invocationId:id2,result,type:MessageType.Completion}}_createCloseMessage(){return{type:MessageType.Close}}};__name(_HubConnection,"HubConnection");let HubConnection=_HubConnection;const DEFAULT_RETRY_DELAYS_IN_MILLISECONDS=[0,2e3,1e4,3e4,null],_DefaultReconnectPolicy=class _DefaultReconnectPolicy{constructor(retryDelays){this._retryDelays=retryDelays!==void 0?[...retryDelays,null]:DEFAULT_RETRY_DELAYS_IN_MILLISECONDS}nextRetryDelayInMilliseconds(retryContext){return this._retryDelays[retryContext.previousRetryCount]}};__name(_DefaultReconnectPolicy,"DefaultReconnectPolicy");let DefaultReconnectPolicy=_DefaultReconnectPolicy;const _HeaderNames=class _HeaderNames{};__name(_HeaderNames,"HeaderNames");let HeaderNames=_HeaderNames;HeaderNames.Authorization="Authorization";HeaderNames.Cookie="Cookie";const _AccessTokenHttpClient=class _AccessTokenHttpClient extends HttpClient{constructor(innerClient,accessTokenFactory){super(),this._innerClient=innerClient,this._accessTokenFactory=accessTokenFactory}async send(request){let allowRetry=!0;this._accessTokenFactory&&(!this._accessToken||request.url&&request.url.indexOf("/negotiate?")>0)&&(allowRetry=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(request);const response=await this._innerClient.send(request);return allowRetry&&response.statusCode===401&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(request),await this._innerClient.send(request)):response}_setAuthorizationHeader(request){request.headers||(request.headers={}),this._accessToken?request.headers[HeaderNames.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&request.headers[HeaderNames.Authorization]&&delete request.headers[HeaderNames.Authorization]}getCookieString(url){return this._innerClient.getCookieString(url)}};__name(_AccessTokenHttpClient,"AccessTokenHttpClient");let AccessTokenHttpClient=_AccessTokenHttpClient;var HttpTransportType;(function(HttpTransportType2){HttpTransportType2[HttpTransportType2.None=0]="None",HttpTransportType2[HttpTransportType2.WebSockets=1]="WebSockets",HttpTransportType2[HttpTransportType2.ServerSentEvents=2]="ServerSentEvents",HttpTransportType2[HttpTransportType2.LongPolling=4]="LongPolling"})(HttpTransportType||(HttpTransportType={}));var TransferFormat;(function(TransferFormat2){TransferFormat2[TransferFormat2.Text=1]="Text",TransferFormat2[TransferFormat2.Binary=2]="Binary"})(TransferFormat||(TransferFormat={}));var _a76;let AbortController$1=(_a76=class{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}},__name(_a76,"AbortController"),_a76);const _LongPollingTransport=class _LongPollingTransport{get pollAborted(){return this._pollAbort.aborted}constructor(httpClient,logger,options){this._httpClient=httpClient,this._logger=logger,this._pollAbort=new AbortController$1,this._options=options,this._running=!1,this.onreceive=null,this.onclose=null}async connect(url,transferFormat){if(Arg.isRequired(url,"url"),Arg.isRequired(transferFormat,"transferFormat"),Arg.isIn(transferFormat,TransferFormat,"transferFormat"),this._url=url,this._logger.log(LogLevel.Trace,"(LongPolling transport) Connecting."),transferFormat===TransferFormat.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[name,value]=getUserAgentHeader(),headers={[name]:value,...this._options.headers},pollOptions={abortSignal:this._pollAbort.signal,headers,timeout:1e5,withCredentials:this._options.withCredentials};transferFormat===TransferFormat.Binary&&(pollOptions.responseType="arraybuffer");const pollUrl=`${url}&_=${Date.now()}`;this._logger.log(LogLevel.Trace,`(LongPolling transport) polling: ${pollUrl}.`);const response=await this._httpClient.get(pollUrl,pollOptions);response.statusCode!==200?(this._logger.log(LogLevel.Error,`(LongPolling transport) Unexpected response code: ${response.statusCode}.`),this._closeError=new HttpError(response.statusText||"",response.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,pollOptions)}async _poll(url,pollOptions){try{for(;this._running;)try{const pollUrl=`${url}&_=${Date.now()}`;this._logger.log(LogLevel.Trace,`(LongPolling transport) polling: ${pollUrl}.`);const response=await this._httpClient.get(pollUrl,pollOptions);response.statusCode===204?(this._logger.log(LogLevel.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):response.statusCode!==200?(this._logger.log(LogLevel.Error,`(LongPolling transport) Unexpected response code: ${response.statusCode}.`),this._closeError=new HttpError(response.statusText||"",response.statusCode),this._running=!1):response.content?(this._logger.log(LogLevel.Trace,`(LongPolling transport) data received. ${getDataDetail(response.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(response.content)):this._logger.log(LogLevel.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(e){this._running?e instanceof TimeoutError?this._logger.log(LogLevel.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=e,this._running=!1):this._logger.log(LogLevel.Trace,`(LongPolling transport) Poll errored after shutdown: ${e.message}`)}}finally{this._logger.log(LogLevel.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(data){return this._running?sendMessage(this._logger,"LongPolling",this._httpClient,this._url,data,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(LogLevel.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(LogLevel.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);const headers={},[name,value]=getUserAgentHeader();headers[name]=value;const deleteOptions={headers:{...headers,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials};let error;try{await this._httpClient.delete(this._url,deleteOptions)}catch(err){error=err}error?error instanceof HttpError&&(error.statusCode===404?this._logger.log(LogLevel.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this._logger.log(LogLevel.Trace,`(LongPolling transport) Error sending a DELETE request: ${error}`)):this._logger.log(LogLevel.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this._logger.log(LogLevel.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let logMessage="(LongPolling transport) Firing onclose event.";this._closeError&&(logMessage+=" Error: "+this._closeError),this._logger.log(LogLevel.Trace,logMessage),this.onclose(this._closeError)}}};__name(_LongPollingTransport,"LongPollingTransport");let LongPollingTransport=_LongPollingTransport;const _ServerSentEventsTransport=class _ServerSentEventsTransport{constructor(httpClient,accessToken,logger,options){this._httpClient=httpClient,this._accessToken=accessToken,this._logger=logger,this._options=options,this.onreceive=null,this.onclose=null}async connect(url,transferFormat){return Arg.isRequired(url,"url"),Arg.isRequired(transferFormat,"transferFormat"),Arg.isIn(transferFormat,TransferFormat,"transferFormat"),this._logger.log(LogLevel.Trace,"(SSE transport) Connecting."),this._url=url,this._accessToken&&(url+=(url.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((resolve2,reject)=>{let opened=!1;if(transferFormat!==TransferFormat.Text){reject(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));return}let eventSource;if(Platform.isBrowser||Platform.isWebWorker)eventSource=new this._options.EventSource(url,{withCredentials:this._options.withCredentials});else{const cookies=this._httpClient.getCookieString(url),headers={};headers.Cookie=cookies;const[name,value]=getUserAgentHeader();headers[name]=value,eventSource=new this._options.EventSource(url,{withCredentials:this._options.withCredentials,headers:{...headers,...this._options.headers}})}try{eventSource.onmessage=e=>{if(this.onreceive)try{this._logger.log(LogLevel.Trace,`(SSE transport) data received. ${getDataDetail(e.data,this._options.logMessageContent)}.`),this.onreceive(e.data)}catch(error){this._close(error);return}},eventSource.onerror=e=>{opened?this._close():reject(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},eventSource.onopen=()=>{this._logger.log(LogLevel.Information,`SSE connected to ${this._url}`),this._eventSource=eventSource,opened=!0,resolve2()}}catch(e){reject(e);return}})}async send(data){return this._eventSource?sendMessage(this._logger,"SSE",this._httpClient,this._url,data,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(e){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(e))}};__name(_ServerSentEventsTransport,"ServerSentEventsTransport");let ServerSentEventsTransport=_ServerSentEventsTransport;const _WebSocketTransport=class _WebSocketTransport{constructor(httpClient,accessTokenFactory,logger,logMessageContent,webSocketConstructor,headers){this._logger=logger,this._accessTokenFactory=accessTokenFactory,this._logMessageContent=logMessageContent,this._webSocketConstructor=webSocketConstructor,this._httpClient=httpClient,this.onreceive=null,this.onclose=null,this._headers=headers}async connect(url,transferFormat){Arg.isRequired(url,"url"),Arg.isRequired(transferFormat,"transferFormat"),Arg.isIn(transferFormat,TransferFormat,"transferFormat"),this._logger.log(LogLevel.Trace,"(WebSockets transport) Connecting.");let token;return this._accessTokenFactory&&(token=await this._accessTokenFactory()),new Promise((resolve2,reject)=>{url=url.replace(/^http/,"ws");let webSocket;const cookies=this._httpClient.getCookieString(url);let opened=!1;if(Platform.isNode||Platform.isReactNative){const headers={},[name,value]=getUserAgentHeader();headers[name]=value,token&&(headers[HeaderNames.Authorization]=`Bearer ${token}`),cookies&&(headers[HeaderNames.Cookie]=cookies),webSocket=new this._webSocketConstructor(url,void 0,{headers:{...headers,...this._headers}})}else token&&(url+=(url.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(token)}`);webSocket||(webSocket=new this._webSocketConstructor(url)),transferFormat===TransferFormat.Binary&&(webSocket.binaryType="arraybuffer"),webSocket.onopen=_event=>{this._logger.log(LogLevel.Information,`WebSocket connected to ${url}.`),this._webSocket=webSocket,opened=!0,resolve2()},webSocket.onerror=event=>{let error=null;typeof ErrorEvent<"u"&&event instanceof ErrorEvent?error=event.error:error="There was an error with the transport",this._logger.log(LogLevel.Information,`(WebSockets transport) ${error}.`)},webSocket.onmessage=message=>{if(this._logger.log(LogLevel.Trace,`(WebSockets transport) data received. ${getDataDetail(message.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(message.data)}catch(error){this._close(error);return}},webSocket.onclose=event=>{if(opened)this._close(event);else{let error=null;typeof ErrorEvent<"u"&&event instanceof ErrorEvent?error=event.error:error="WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",reject(new Error(error))}}})}send(data){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(LogLevel.Trace,`(WebSockets transport) sending data. ${getDataDetail(data,this._logMessageContent)}.`),this._webSocket.send(data),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(event){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(LogLevel.Trace,"(WebSockets transport) socket closed."),this.onclose&&(this._isCloseEvent(event)&&(event.wasClean===!1||event.code!==1e3)?this.onclose(new Error(`WebSocket closed with status code: ${event.code} (${event.reason||"no reason given"}).`)):event instanceof Error?this.onclose(event):this.onclose())}_isCloseEvent(event){return event&&typeof event.wasClean=="boolean"&&typeof event.code=="number"}};__name(_WebSocketTransport,"WebSocketTransport");let WebSocketTransport=_WebSocketTransport;const MAX_REDIRECTS=100,_HttpConnection=class _HttpConnection{constructor(url,options={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,Arg.isRequired(url,"url"),this._logger=createLogger(options.logger),this.baseUrl=this._resolveUrl(url),options=options||{},options.logMessageContent=options.logMessageContent===void 0?!1:options.logMessageContent,typeof options.withCredentials=="boolean"||options.withCredentials===void 0)options.withCredentials=options.withCredentials===void 0?!0:options.withCredentials;else throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");options.timeout=options.timeout===void 0?100*1e3:options.timeout;let webSocketModule=null,eventSourceModule=null;if(Platform.isNode&&typeof require<"u"){const requireFunc=typeof __webpack_require__=="function"?__non_webpack_require__:require;webSocketModule=requireFunc("ws"),eventSourceModule=requireFunc("eventsource")}!Platform.isNode&&typeof WebSocket<"u"&&!options.WebSocket?options.WebSocket=WebSocket:Platform.isNode&&!options.WebSocket&&webSocketModule&&(options.WebSocket=webSocketModule),!Platform.isNode&&typeof EventSource<"u"&&!options.EventSource?options.EventSource=EventSource:Platform.isNode&&!options.EventSource&&typeof eventSourceModule<"u"&&(options.EventSource=eventSourceModule),this._httpClient=new AccessTokenHttpClient(options.httpClient||new DefaultHttpClient(this._logger),options.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=options,this.onreceive=null,this.onclose=null}async start(transferFormat){if(transferFormat=transferFormat||TransferFormat.Binary,Arg.isIn(transferFormat,TransferFormat,"transferFormat"),this._logger.log(LogLevel.Debug,`Starting connection with transfer format '${TransferFormat[transferFormat]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(transferFormat),await this._startInternalPromise,this._connectionState==="Disconnecting"){const message="Failed to start the HttpConnection before stop() was called.";return this._logger.log(LogLevel.Error,message),await this._stopPromise,Promise.reject(new AbortError(message))}else if(this._connectionState!=="Connected"){const message="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(LogLevel.Error,message),Promise.reject(new AbortError(message))}this._connectionStarted=!0}send(data){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new TransportSendQueue(this.transport)),this._sendQueue.send(data))}async stop(error){if(this._connectionState==="Disconnected")return this._logger.log(LogLevel.Debug,`Call to HttpConnection.stop(${error}) ignored because the connection is already in the disconnected state.`),Promise.resolve();if(this._connectionState==="Disconnecting")return this._logger.log(LogLevel.Debug,`Call to HttpConnection.stop(${error}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;this._connectionState="Disconnecting",this._stopPromise=new Promise(resolve2=>{this._stopPromiseResolver=resolve2}),await this._stopInternal(error),await this._stopPromise}async _stopInternal(error){this._stopError=error;try{await this._startInternalPromise}catch{}if(this.transport){try{await this.transport.stop()}catch(e){this._logger.log(LogLevel.Error,`HttpConnection.transport.stop() threw error '${e}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(LogLevel.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(transferFormat){let url=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation)if(this._options.transport===HttpTransportType.WebSockets)this.transport=this._constructTransport(HttpTransportType.WebSockets),await this._startTransport(url,transferFormat);else throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");else{let negotiateResponse=null,redirects=0;do{if(negotiateResponse=await this._getNegotiationResponse(url),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new AbortError("The connection was stopped during negotiation.");if(negotiateResponse.error)throw new Error(negotiateResponse.error);if(negotiateResponse.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(negotiateResponse.url&&(url=negotiateResponse.url),negotiateResponse.accessToken){const accessToken=negotiateResponse.accessToken;this._accessTokenFactory=()=>accessToken,this._httpClient._accessToken=accessToken,this._httpClient._accessTokenFactory=void 0}redirects++}while(negotiateResponse.url&&redirects<MAX_REDIRECTS);if(redirects===MAX_REDIRECTS&&negotiateResponse.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(url,this._options.transport,negotiateResponse,transferFormat)}this.transport instanceof LongPollingTransport&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(LogLevel.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(e){return this._logger.log(LogLevel.Error,"Failed to start the connection: "+e),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(e)}}async _getNegotiationResponse(url){const headers={},[name,value]=getUserAgentHeader();headers[name]=value;const negotiateUrl=this._resolveNegotiateUrl(url);this._logger.log(LogLevel.Debug,`Sending negotiation request: ${negotiateUrl}.`);try{const response=await this._httpClient.post(negotiateUrl,{content:"",headers:{...headers,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(response.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${response.statusCode}'`));const negotiateResponse=JSON.parse(response.content);return(!negotiateResponse.negotiateVersion||negotiateResponse.negotiateVersion<1)&&(negotiateResponse.connectionToken=negotiateResponse.connectionId),negotiateResponse.useStatefulReconnect&&this._options._useStatefulReconnect!==!0?Promise.reject(new FailedToNegotiateWithServerError("Client didn't negotiate Stateful Reconnect but the server did.")):negotiateResponse}catch(e){let errorMessage="Failed to complete negotiation with the server: "+e;return e instanceof HttpError&&e.statusCode===404&&(errorMessage=errorMessage+" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(LogLevel.Error,errorMessage),Promise.reject(new FailedToNegotiateWithServerError(errorMessage))}}_createConnectUrl(url,connectionToken){return connectionToken?url+(url.indexOf("?")===-1?"?":"&")+`id=${connectionToken}`:url}async _createTransport(url,requestedTransport,negotiateResponse,requestedTransferFormat){let connectUrl=this._createConnectUrl(url,negotiateResponse.connectionToken);if(this._isITransport(requestedTransport)){this._logger.log(LogLevel.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=requestedTransport,await this._startTransport(connectUrl,requestedTransferFormat),this.connectionId=negotiateResponse.connectionId;return}const transportExceptions=[],transports=negotiateResponse.availableTransports||[];let negotiate=negotiateResponse;for(const endpoint of transports){const transportOrError=this._resolveTransportOrError(endpoint,requestedTransport,requestedTransferFormat,(negotiate==null?void 0:negotiate.useStatefulReconnect)===!0);if(transportOrError instanceof Error)transportExceptions.push(`${endpoint.transport} failed:`),transportExceptions.push(transportOrError);else if(this._isITransport(transportOrError)){if(this.transport=transportOrError,!negotiate){try{negotiate=await this._getNegotiationResponse(url)}catch(ex){return Promise.reject(ex)}connectUrl=this._createConnectUrl(url,negotiate.connectionToken)}try{await this._startTransport(connectUrl,requestedTransferFormat),this.connectionId=negotiate.connectionId;return}catch(ex){if(this._logger.log(LogLevel.Error,`Failed to start the transport '${endpoint.transport}': ${ex}`),negotiate=void 0,transportExceptions.push(new FailedToStartTransportError(`${endpoint.transport} failed: ${ex}`,HttpTransportType[endpoint.transport])),this._connectionState!=="Connecting"){const message="Failed to select transport before stop() was called.";return this._logger.log(LogLevel.Debug,message),Promise.reject(new AbortError(message))}}}}return transportExceptions.length>0?Promise.reject(new AggregateErrors(`Unable to connect to the server with any of the available transports. ${transportExceptions.join(" ")}`,transportExceptions)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(transport){switch(transport){case HttpTransportType.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new WebSocketTransport(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case HttpTransportType.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new ServerSentEventsTransport(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case HttpTransportType.LongPolling:return new LongPollingTransport(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${transport}.`)}}_startTransport(url,transferFormat){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async e=>{let callStop=!1;if(this.features.reconnect)try{this.features.disconnected(),await this.transport.connect(url,transferFormat),await this.features.resend()}catch{callStop=!0}else{this._stopConnection(e);return}callStop&&this._stopConnection(e)}:this.transport.onclose=e=>this._stopConnection(e),this.transport.connect(url,transferFormat)}_resolveTransportOrError(endpoint,requestedTransport,requestedTransferFormat,useStatefulReconnect){const transport=HttpTransportType[endpoint.transport];if(transport==null)return this._logger.log(LogLevel.Debug,`Skipping transport '${endpoint.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${endpoint.transport}' because it is not supported by this client.`);if(transportMatches(requestedTransport,transport))if(endpoint.transferFormats.map(s=>TransferFormat[s]).indexOf(requestedTransferFormat)>=0){if(transport===HttpTransportType.WebSockets&&!this._options.WebSocket||transport===HttpTransportType.ServerSentEvents&&!this._options.EventSource)return this._logger.log(LogLevel.Debug,`Skipping transport '${HttpTransportType[transport]}' because it is not supported in your environment.'`),new UnsupportedTransportError(`'${HttpTransportType[transport]}' is not supported in your environment.`,transport);this._logger.log(LogLevel.Debug,`Selecting transport '${HttpTransportType[transport]}'.`);try{return this.features.reconnect=transport===HttpTransportType.WebSockets?useStatefulReconnect:void 0,this._constructTransport(transport)}catch(ex){return ex}}else return this._logger.log(LogLevel.Debug,`Skipping transport '${HttpTransportType[transport]}' because it does not support the requested transfer format '${TransferFormat[requestedTransferFormat]}'.`),new Error(`'${HttpTransportType[transport]}' does not support ${TransferFormat[requestedTransferFormat]}.`);else return this._logger.log(LogLevel.Debug,`Skipping transport '${HttpTransportType[transport]}' because it was disabled by the client.`),new DisabledTransportError(`'${HttpTransportType[transport]}' is disabled by the client.`,transport)}_isITransport(transport){return transport&&typeof transport=="object"&&"connect"in transport}_stopConnection(error){if(this._logger.log(LogLevel.Debug,`HttpConnection.stopConnection(${error}) called while in state ${this._connectionState}.`),this.transport=void 0,error=this._stopError||error,this._stopError=void 0,this._connectionState==="Disconnected"){this._logger.log(LogLevel.Debug,`Call to HttpConnection.stopConnection(${error}) was ignored because the connection is already in the disconnected state.`);return}if(this._connectionState==="Connecting")throw this._logger.log(LogLevel.Warning,`Call to HttpConnection.stopConnection(${error}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${error}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),error?this._logger.log(LogLevel.Error,`Connection disconnected with error '${error}'.`):this._logger.log(LogLevel.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(e=>{this._logger.log(LogLevel.Error,`TransportSendQueue.stop() threw error '${e}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(error)}catch(e){this._logger.log(LogLevel.Error,`HttpConnection.onclose(${error}) threw error '${e}'.`)}}}_resolveUrl(url){if(url.lastIndexOf("https://",0)===0||url.lastIndexOf("http://",0)===0)return url;if(!Platform.isBrowser)throw new Error(`Cannot resolve '${url}'.`);const aTag=window.document.createElement("a");return aTag.href=url,this._logger.log(LogLevel.Information,`Normalizing '${url}' to '${aTag.href}'.`),aTag.href}_resolveNegotiateUrl(url){const negotiateUrl=new URL(url);negotiateUrl.pathname.endsWith("/")?negotiateUrl.pathname+="negotiate":negotiateUrl.pathname+="/negotiate";const searchParams=new URLSearchParams(negotiateUrl.searchParams);return searchParams.has("negotiateVersion")||searchParams.append("negotiateVersion",this._negotiateVersion.toString()),searchParams.has("useStatefulReconnect")?searchParams.get("useStatefulReconnect")==="true"&&(this._options._useStatefulReconnect=!0):this._options._useStatefulReconnect===!0&&searchParams.append("useStatefulReconnect","true"),negotiateUrl.search=searchParams.toString(),negotiateUrl.toString()}};__name(_HttpConnection,"HttpConnection");let HttpConnection=_HttpConnection;function transportMatches(requestedTransport,actualTransport){return!requestedTransport||(actualTransport&requestedTransport)!==0}__name(transportMatches,"transportMatches");const _TransportSendQueue=class _TransportSendQueue{constructor(_transport){this._transport=_transport,this._buffer=[],this._executing=!0,this._sendBufferedData=new PromiseSource,this._transportResult=new PromiseSource,this._sendLoopPromise=this._sendLoop()}send(data){return this._bufferData(data),this._transportResult||(this._transportResult=new PromiseSource),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(data){if(this._buffer.length&&typeof this._buffer[0]!=typeof data)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof data}`);this._buffer.push(data),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new PromiseSource;const transportResult=this._transportResult;this._transportResult=void 0;const data=typeof this._buffer[0]=="string"?this._buffer.join(""):_TransportSendQueue._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(data),transportResult.resolve()}catch(error){transportResult.reject(error)}}}static _concatBuffers(arrayBuffers){const totalLength=arrayBuffers.map(b=>b.byteLength).reduce((a,b)=>a+b),result=new Uint8Array(totalLength);let offset=0;for(const item of arrayBuffers)result.set(new Uint8Array(item),offset),offset+=item.byteLength;return result.buffer}};__name(_TransportSendQueue,"TransportSendQueue");let TransportSendQueue=_TransportSendQueue;const _PromiseSource=class _PromiseSource{constructor(){this.promise=new Promise((resolve2,reject)=>[this._resolver,this._rejecter]=[resolve2,reject])}resolve(){this._resolver()}reject(reason){this._rejecter(reason)}};__name(_PromiseSource,"PromiseSource");let PromiseSource=_PromiseSource;const JSON_HUB_PROTOCOL_NAME="json",_JsonHubProtocol=class _JsonHubProtocol{constructor(){this.name=JSON_HUB_PROTOCOL_NAME,this.version=2,this.transferFormat=TransferFormat.Text}parseMessages(input,logger){if(typeof input!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!input)return[];logger===null&&(logger=NullLogger.instance);const messages=TextMessageFormat.parse(input),hubMessages=[];for(const message of messages){const parsedMessage=JSON.parse(message);if(typeof parsedMessage.type!="number")throw new Error("Invalid payload.");switch(parsedMessage.type){case MessageType.Invocation:this._isInvocationMessage(parsedMessage);break;case MessageType.StreamItem:this._isStreamItemMessage(parsedMessage);break;case MessageType.Completion:this._isCompletionMessage(parsedMessage);break;case MessageType.Ping:break;case MessageType.Close:break;case MessageType.Ack:this._isAckMessage(parsedMessage);break;case MessageType.Sequence:this._isSequenceMessage(parsedMessage);break;default:logger.log(LogLevel.Information,"Unknown message type '"+parsedMessage.type+"' ignored.");continue}hubMessages.push(parsedMessage)}return hubMessages}writeMessage(message){return TextMessageFormat.write(JSON.stringify(message))}_isInvocationMessage(message){this._assertNotEmptyString(message.target,"Invalid payload for Invocation message."),message.invocationId!==void 0&&this._assertNotEmptyString(message.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(message){if(this._assertNotEmptyString(message.invocationId,"Invalid payload for StreamItem message."),message.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(message){if(message.result&&message.error)throw new Error("Invalid payload for Completion message.");!message.result&&message.error&&this._assertNotEmptyString(message.error,"Invalid payload for Completion message."),this._assertNotEmptyString(message.invocationId,"Invalid payload for Completion message.")}_isAckMessage(message){if(typeof message.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(message){if(typeof message.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(value,errorMessage){if(typeof value!="string"||value==="")throw new Error(errorMessage)}};__name(_JsonHubProtocol,"JsonHubProtocol");let JsonHubProtocol=_JsonHubProtocol;const LogLevelNameMapping={trace:LogLevel.Trace,debug:LogLevel.Debug,info:LogLevel.Information,information:LogLevel.Information,warn:LogLevel.Warning,warning:LogLevel.Warning,error:LogLevel.Error,critical:LogLevel.Critical,none:LogLevel.None};function parseLogLevel(name){const mapping=LogLevelNameMapping[name.toLowerCase()];if(typeof mapping<"u")return mapping;throw new Error(`Unknown log level: ${name}`)}__name(parseLogLevel,"parseLogLevel");const _HubConnectionBuilder=class _HubConnectionBuilder{configureLogging(logging){if(Arg.isRequired(logging,"logging"),isLogger(logging))this.logger=logging;else if(typeof logging=="string"){const logLevel=parseLogLevel(logging);this.logger=new ConsoleLogger(logLevel)}else this.logger=new ConsoleLogger(logging);return this}withUrl(url,transportTypeOrOptions){return Arg.isRequired(url,"url"),Arg.isNotEmpty(url,"url"),this.url=url,typeof transportTypeOrOptions=="object"?this.httpConnectionOptions={...this.httpConnectionOptions,...transportTypeOrOptions}:this.httpConnectionOptions={...this.httpConnectionOptions,transport:transportTypeOrOptions},this}withHubProtocol(protocol){return Arg.isRequired(protocol,"protocol"),this.protocol=protocol,this}withAutomaticReconnect(retryDelaysOrReconnectPolicy){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return retryDelaysOrReconnectPolicy?Array.isArray(retryDelaysOrReconnectPolicy)?this.reconnectPolicy=new DefaultReconnectPolicy(retryDelaysOrReconnectPolicy):this.reconnectPolicy=retryDelaysOrReconnectPolicy:this.reconnectPolicy=new DefaultReconnectPolicy,this}withServerTimeout(milliseconds){return Arg.isRequired(milliseconds,"milliseconds"),this._serverTimeoutInMilliseconds=milliseconds,this}withKeepAliveInterval(milliseconds){return Arg.isRequired(milliseconds,"milliseconds"),this._keepAliveIntervalInMilliseconds=milliseconds,this}withStatefulReconnect(options){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=options==null?void 0:options.bufferSize,this}build(){const httpConnectionOptions=this.httpConnectionOptions||{};if(httpConnectionOptions.logger===void 0&&(httpConnectionOptions.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const connection=new HttpConnection(this.url,httpConnectionOptions);return HubConnection.create(connection,this.logger||NullLogger.instance,this.protocol||new JsonHubProtocol,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}};__name(_HubConnectionBuilder,"HubConnectionBuilder");let HubConnectionBuilder=_HubConnectionBuilder;function isLogger(logger){return logger.log!==void 0}__name(isLogger,"isLogger");var __defProp$w=Object.defineProperty,__getOwnPropDesc$3=Object.getOwnPropertyDescriptor,__decorateClass$w=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$3(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$w(target,key,result),result},"__decorateClass$w"),__decorateParam$2=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$2");const hubTypeMap={IGuildLobbiesHub:{url:"guildLobbies"},ILobbyHub:{url:"lobby"},IOnlineItemsHub:{url:"onlineItems"}};var _a77;let SocketService=(_a77=class{constructor(loggerFactory2,tokenService){__publicField(this,"_logger");__publicField(this,"_baseUrl","https://sockets.typo.rip");__publicField(this,"_token","");__publicField(this,"createHub",getHubProxyFactory);__publicField(this,"createReceiver",getReceiverRegister);this._logger=loggerFactory2(this),tokenService.token.subscribe(token=>this._token=token??"")}createSignalRConfig(){return{withCredentials:!1,accessTokenFactory:__name(()=>this._token,"accessTokenFactory")}}createConnection(hubType){return new HubConnectionBuilder().withUrl(`${this._baseUrl}/${hubTypeMap[hubType].url}`,this.createSignalRConfig()).configureLogging({log:__name((logLevel,message)=>{(logLevel==LogLevel.Trace||logLevel==LogLevel.Debug)&&this._logger.debug(message),(logLevel==LogLevel.Information||logLevel==LogLevel.Warning)&&this._logger.info(message),logLevel==LogLevel.Critical&&this._logger.warn(message),logLevel==LogLevel.Error&&this._logger.error(message)},"log")}).build()}set baseUrl(url){this._baseUrl=url}},__name(_a77,"SocketService"),_a77);SocketService=__decorateClass$w([injectable(),__decorateParam$2(0,inject(loggerFactory)),__decorateParam$2(1,inject(TokenService))],SocketService);var __defProp$v=Object.defineProperty,__getOwnPropDesc$2=Object.getOwnPropertyDescriptor,__decorateClass$v=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$2(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$v(target,key,result),result},"__decorateClass$v"),__decorateParam$1=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam$1"),_a78;let LobbyConnectionService=(_a78=class{constructor(loggerFactory2){__publicField(this,"_socketService");__publicField(this,"_logger");__publicField(this,"_connection$",new BehaviorSubject(void 0));__publicField(this,"_existingTypoLobbyStates",new Map);__publicField(this,"_abortConnecting");__publicField(this,"_dropAnnounced$",new Subject$1);__publicField(this,"_dropClaimed$",new Subject$1);__publicField(this,"_dropCleared$",new Subject$1);__publicField(this,"_awardGifted$",new Subject$1);this._logger=loggerFactory2(this)}onFeatureActivate(){return Promise.resolve(void 0)}async onFeatureDestroy(){await this.destroyConnection(),this._existingTypoLobbyStates.clear()}get dropAnnounced$(){return this._dropAnnounced$.asObservable()}get dropClaimed$(){return this._dropClaimed$.asObservable()}get awardGifted$(){return this._awardGifted$.asObservable()}get dropCleared$(){return this._dropCleared$.asObservable()}get connection(){const connection=this._connection$.value;if(connection===void 0||connection==="unauthorized")throw this._logger.error("connection is not initialized"),new Error("connection is not initialized");return connection}get connection$(){return this._connection$.asObservable()}get isConnected(){return this._connection$.value!==void 0&&this._connection$.value!=="unauthorized"}async setupConnection(lobbyId,lobby,playerId,member){var _a81;const claim=(_a81=this._existingTypoLobbyStates.get(lobbyId))==null?void 0:_a81.ownershipClaimToken,connection=this._socketService.createConnection("ILobbyHub"),hub=this._socketService.createHub("ILobbyHub").createHubProxy(connection);this._socketService.createReceiver("ILobbyReceiver").register(connection,{lobbyOwnershipResigned:this.lobbyOwnershipResigned.bind(this),typoLobbySettingsUpdated:this.typoLobbySettingsUpdated.bind(this),dropAnnounced:__name(async drop=>this._dropAnnounced$.next(drop),"dropAnnounced"),dropClaimed:__name(async result=>this._dropClaimed$.next(result),"dropClaimed"),awardGifted:__name(async award=>this._awardGifted$.next(award),"awardGifted"),dropCleared:__name(async clear=>this._dropCleared$.next(clear),"dropCleared")}),connection.onclose(async error=>{this._logger.debug("SignalR Connection closed",error),this._connection$.next(void 0)}),this._abortConnecting=async()=>{this._logger.info("Aborting connection while still in setup phase"),await connection.stop()};try{await connection.start()}catch(e){throw this._logger.error("Failed to setup socket connection",e),await this.destroyConnection(),this._connection$.next(void 0),e}const state=await hub.lobbyDiscovered({ownerClaimToken:claim,lobby,playerId});return this._logger.info("Lobby discovered",state),this._connection$.next({connection,hub,typoLobbyState:state,member}),this._existingTypoLobbyStates.set(state.lobbyId,state),this._abortConnecting=void 0,claim?"reconnected":"connected"}async destroyConnection(setUnauthorizedStatus=!1){this._connection$.value!==void 0&&this._connection$.value!=="unauthorized"&&await this._connection$.value.connection.stop(),this._abortConnecting&&this._abortConnecting(),setUnauthorizedStatus?this._connection$.next("unauthorized"):this._connection$.next(void 0)}async typoLobbySettingsUpdated(state){const savedSettings=this._existingTypoLobbyStates.get(this.connection.typoLobbyState.lobbyId);savedSettings&&(savedSettings.lobbySettings=state),this.connection.typoLobbyState.lobbySettings=state,this.connection.typoLobbyState.playerIsOwner=state.lobbyOwnershipClaim===this.connection.typoLobbyState.ownershipClaim,this._connection$.next(this.connection),this._logger.info("Lobby state updated",this.connection.typoLobbyState)}async lobbyOwnershipResigned(){this._logger.info("Lobby ownership resigned, claiming now"),await this.connection.hub.claimLobbyOwnership()}},__name(_a78,"LobbyConnectionService"),_a78);__decorateClass$v([inject(SocketService)],LobbyConnectionService.prototype,"_socketService",2);LobbyConnectionService=__decorateClass$v([injectable(),__decorateParam$1(0,inject(loggerFactory))],LobbyConnectionService);const parseSignalRError=__name(error=>{if(!(error instanceof Error))throw error;const matches=error==null?void 0:error.message.match(/.*'(.*)'.*\. (.*): (.*)/);if(matches){if(matches.length<3)throw error;const[,hub,exception,message]=matches;return{hub,exception,message}}else throw error},"parseSignalRError");function create_if_block$g(ctx){let div,mounted,dispose;return{c(){div=element$1("div"),attr(div,"class","typo-drop svelte-15kb90n"),set_style(div,"left","calc((100% - 48px) * ("+ctx[1].drop.position+" / 100))"),set_style(div,"background-image",ctx[3](ctx[1].drop.eventDropId))},m(target,anchor){insert(target,div,anchor),mounted||(dispose=listen(div,"click",ctx[5]),mounted=!0)},p(ctx2,dirty){dirty&2&&set_style(div,"left","calc((100% - 48px) * ("+ctx2[1].drop.position+" / 100))"),dirty&2&&set_style(div,"background-image",ctx2[3](ctx2[1].drop.eventDropId))},d(detaching){detaching&&detach(div),mounted=!1,dispose()}}}__name(create_if_block$g,"create_if_block$g");function create_fragment$u(ctx){let if_block_anchor,if_block=ctx[1]!==void 0&&ctx[1].ownClaimed===!1&&create_if_block$g(ctx);return{c(){if_block&&if_block.c(),if_block_anchor=empty()},m(target,anchor){if_block&&if_block.m(target,anchor),insert(target,if_block_anchor,anchor)},p(ctx2,[dirty]){ctx2[1]!==void 0&&ctx2[1].ownClaimed===!1?if_block?if_block.p(ctx2,dirty):(if_block=create_if_block$g(ctx2),if_block.c(),if_block.m(if_block_anchor.parentNode,if_block_anchor)):if_block&&(if_block.d(1),if_block=null)},i:noop$1,o:noop$1,d(detaching){detaching&&detach(if_block_anchor),if_block&&if_block.d(detaching)}}}__name(create_fragment$u,"create_fragment$u");function instance$r($$self,$$props,$$invalidate){let $currentDrop,{feature}=$$props,{drops}=$$props;const currentDrop=feature.currentDropStore;component_subscribe($$self,currentDrop,value=>$$invalidate(1,$currentDrop=value));function getDropUrl(id2){const drop=drops.find(drop2=>drop2.id===id2);return drop?`url(${drop.url})`:"var(--file-img-drop-gif)"}__name(getDropUrl,"getDropUrl");const click_handler2=__name(async()=>{if($currentDrop){const claim=await feature.claimDrop($currentDrop.drop,$currentDrop.timestamp);claim!==void 0&&feature.processClaim(claim,!0)}},"click_handler");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature),"drops"in $$props2&&$$invalidate(4,drops=$$props2.drops)},[feature,$currentDrop,currentDrop,getDropUrl,drops,click_handler2]}__name(instance$r,"instance$r");const _Drops=class _Drops extends SvelteComponent{constructor(options){super(),init(this,options,instance$r,create_fragment$u,safe_not_equal,{feature:0,drops:4})}};__name(_Drops,"Drops");let Drops=_Drops;function get_each_context$h(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[3]=list[i],child_ctx}__name(get_each_context$h,"get_each_context$h");function create_each_block$h(ctx){let div,b,t0,t1_value=ctx[3].dropId+"",t1,t2,span0,t3_value=ctx[3].username+"",t3,t4,span1,t5_value=ctx[3].catchTime+"",t5,t6,t7,span2,t8_value=Math.round(ctx[3].leagueWeight*100)+"",t8,t9;return{c(){div=element$1("div"),b=element$1("b"),t0=text("#"),t1=text(t1_value),t2=space(),span0=element$1("span"),t3=text(t3_value),t4=space(),span1=element$1("span"),t5=text(t5_value),t6=text("ms"),t7=space(),span2=element$1("span"),t8=text(t8_value),t9=text("%"),attr(div,"class","typo-drop-claims-claim svelte-qhyy9")},m(target,anchor){insert(target,div,anchor),append(div,b),append(b,t0),append(b,t1),append(div,t2),append(div,span0),append(span0,t3),append(div,t4),append(div,span1),append(span1,t5),append(span1,t6),append(div,t7),append(div,span2),append(span2,t8),append(span2,t9)},p(ctx2,dirty){dirty&1&&t1_value!==(t1_value=ctx2[3].dropId+"")&&set_data(t1,t1_value),dirty&1&&t3_value!==(t3_value=ctx2[3].username+"")&&set_data(t3,t3_value),dirty&1&&t5_value!==(t5_value=ctx2[3].catchTime+"")&&set_data(t5,t5_value),dirty&1&&t8_value!==(t8_value=Math.round(ctx2[3].leagueWeight*100)+"")&&set_data(t8,t8_value)},d(detaching){detaching&&detach(div)}}}__name(create_each_block$h,"create_each_block$h");function create_if_block$f(ctx){let p;return{c(){p=element$1("p"),p.textContent="No drop claims yet."},m(target,anchor){insert(target,p,anchor)},d(detaching){detaching&&detach(p)}}}__name(create_if_block$f,"create_if_block$f");function create_fragment$t(ctx){let h3,t1,p,t4,br1,t5,div,t6,each_value=ensure_array_like(ctx[0]),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$h(get_each_context$h(ctx,each_value,i));let if_block=ctx[0].length===0&&create_if_block$f();return{c(){h3=element$1("h3"),h3.textContent="Drop Log",t1=space(),p=element$1("p"),p.innerHTML=`In the drop log, you can find all drops claims that happened while you were in lobbies.<br/>
  To report a suspicious drop claim, copy the catch time and drop ID and send it on the typo server.`,t4=space(),br1=element$1("br"),t5=space(),div=element$1("div");for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();t6=space(),if_block&&if_block.c(),attr(div,"class","typo-drop-claims svelte-qhyy9")},m(target,anchor){insert(target,h3,anchor),insert(target,t1,anchor),insert(target,p,anchor),insert(target,t4,anchor),insert(target,br1,anchor),insert(target,t5,anchor),insert(target,div,anchor);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div,null);append(div,t6),if_block&&if_block.m(div,null)},p(ctx2,[dirty]){if(dirty&1){each_value=ensure_array_like(ctx2[0]);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$h(ctx2,each_value,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block$h(child_ctx),each_blocks[i].c(),each_blocks[i].m(div,t6))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value.length}ctx2[0].length===0?if_block||(if_block=create_if_block$f(),if_block.c(),if_block.m(div,null)):if_block&&(if_block.d(1),if_block=null)},i:noop$1,o:noop$1,d(detaching){detaching&&(detach(h3),detach(t1),detach(p),detach(t4),detach(br1),detach(t5),detach(div)),destroy_each(each_blocks,detaching),if_block&&if_block.d()}}}__name(create_fragment$t,"create_fragment$t");function instance$q($$self,$$props,$$invalidate){let $claims,{feature}=$$props;const claims=feature.recordedClaimsStore;return component_subscribe($$self,claims,value=>$$invalidate(0,$claims=value)),$$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(2,feature=$$props2.feature)},[$claims,claims,feature]}__name(instance$q,"instance$q");const _Drops_info=class _Drops_info extends SvelteComponent{constructor(options){super(),init(this,options,instance$q,create_fragment$t,safe_not_equal,{feature:2})}};__name(_Drops_info,"Drops_info");let Drops_info=_Drops_info;var __defProp$u=Object.defineProperty,__decorateClass$u=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$u(target,key,result),result},"__decorateClass$u");const _DropsFeature=class _DropsFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elementsSetup");__publicField(this,"_apiDataSetup");__publicField(this,"_lobbyConnectionService");__publicField(this,"_chatService");__publicField(this,"_toastService");__publicField(this,"name","Drops");__publicField(this,"description","Show drops to collect extra bubbles when you're playing");__publicField(this,"featureId",40);__publicField(this,"_component");__publicField(this,"_recordedClaims$",new BehaviorSubject([]));__publicField(this,"_currentDrop$",new Subject$1);__publicField(this,"_dropSummarySubscription");__publicField(this,"_dropAnnouncedSubscription");__publicField(this,"_enableDropSummary",this.useSetting(new BooleanExtensionSetting("drop_summary",!0,this).withName("Drop Summary").withDescription("Show a chat message with all drop catches after a drop")));__publicField(this,"_enableOtherDropNotifications",this.useSetting(new BooleanExtensionSetting("drop_notifications",!0,this).withName("Drop Notifications").withDescription("Show a chat message when someone else catches a drop")))}get featureManagementComponent(){return{componentType:Drops_info,props:{feature:this}}}async onActivate(){const elements2=await this._elementsSetup.complete(),apiData=await this._apiDataSetup.complete();this._component=new Drops({target:elements2.canvasWrapper,props:{feature:this,drops:apiData.drops}}),this._dropAnnouncedSubscription=this._lobbyConnectionService.dropAnnounced$.pipe(switchMap(drop=>of(drop).pipe(mergeWith(this._lobbyConnectionService.dropCleared$.pipe(filter(clear=>clear.dropId===drop.dropId),tap(()=>this._logger.info("Drop cleared by server event",drop)),map(()=>{}),delay(1e3)),this._lobbyConnectionService.dropClaimed$.pipe(tap(claim=>this._logger.info("Other claim arrived",claim)),mergeMap(async claim=>(await this.processClaim(claim,!1),claim)),filter(claim=>claim.clearedDrop),map(()=>{}))))),tap(drop=>this._logger.info("Setting drop",drop))).subscribe(drop=>this._currentDrop$.next(drop===void 0?void 0:{drop,timestamp:Date.now(),ownClaimed:!1})),this._dropSummarySubscription=this._currentDrop$.pipe(startWith(void 0),distinctUntilChanged(),pairwise(),withLatestFrom(this._recordedClaims$,this._enableDropSummary.changes$)).subscribe(([[prev,current],claims,summaryEnabled])=>{if(summaryEnabled&&prev!==void 0&&current===void 0){const getEmoji=__name(claim=>claim.clearedDrop?"🛡️":claim.firstClaim?"💎":claim.leagueMode?"🧿":"💧","getEmoji"),currentClaims=claims.filter(c=>c.dropId===(prev==null?void 0:prev.drop.dropId)),title="Drop Summary",content=`
`+(currentClaims.length===0?"The drop timed out :(":currentClaims.map(c=>`${getEmoji(c)} ${c.username}: ${c.catchTime}ms (${Math.round(c.leagueWeight*100)}%)`).join(`
`));this._chatService.addChatMessage(content,title,"info")}})}onDestroy(){var _a81,_b,_c;(_a81=this._component)==null||_a81.$destroy(),this._recordedClaims$.next([]),(_b=this._dropSummarySubscription)==null||_b.unsubscribe(),(_c=this._dropAnnouncedSubscription)==null||_c.unsubscribe(),this._dropSummarySubscription=void 0,this._dropAnnouncedSubscription=void 0}get currentDropStore(){return fromObservable(this._currentDrop$,void 0)}get recordedClaimsStore(){return fromObservable(this._recordedClaims$,[])}async claimDrop(drop,timestamp){this._logger.info("Claiming drop after delay",Date.now()-timestamp),this._currentDrop$.next({drop,ownClaimed:!0,timestamp});try{return await this._lobbyConnectionService.connection.hub.claimDrop({dropToken:drop.dropToken})}catch(e){const error=parseSignalRError(e);this._logger.error("Failed to claim drop",error),await this._toastService.showToast(error.message);return}}async processClaim(claim,ownClaim){this._logger.debug("Processing claim",claim);const recordedClaims=[...this._recordedClaims$.value,{...claim,own:ownClaim}];this._recordedClaims$.next(recordedClaims);const enabledOtherNotifications=await this._enableOtherDropNotifications.getValue();if(ownClaim||enabledOtherNotifications){const previouslyClaimed=recordedClaims.some(c=>c.own),title=ownClaim?"Yeee!":claim.clearedDrop&&!previouslyClaimed?"Oops..":"",message=ownClaim?`You ${claim.clearedDrop?"cleared":"caught"} the drop after ${claim.catchTime}ms (${Math.round(claim.leagueWeight*100)}%)`:claim.clearedDrop?`${claim.username} cleared the drop after ${claim.catchTime}ms`:`${claim.username} caught the drop after ${claim.catchTime}ms`;await this._chatService.addChatMessage(message,title,"info")}ownClaim&&claim.clearedDrop&&this._currentDrop$.next(void 0)}};__name(_DropsFeature,"DropsFeature");let DropsFeature=_DropsFeature;__decorateClass$u([inject(ElementsSetup)],DropsFeature.prototype,"_elementsSetup");__decorateClass$u([inject(ApiDataSetup)],DropsFeature.prototype,"_apiDataSetup");__decorateClass$u([inject(LobbyConnectionService)],DropsFeature.prototype,"_lobbyConnectionService");__decorateClass$u([inject(ChatService)],DropsFeature.prototype,"_chatService");__decorateClass$u([inject(ToastService)],DropsFeature.prototype,"_toastService");function get_each_context$g(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[3]=list[i],child_ctx}__name(get_each_context$g,"get_each_context$g");function get_each_context_1$3(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[6]=list[i],child_ctx[8]=i,child_ctx}__name(get_each_context_1$3,"get_each_context_1$3");function create_if_block$e(ctx){let each_1_anchor,each_value_1=ensure_array_like(ctx[1].overlayContent),each_blocks=[];for(let i=0;i<each_value_1.length;i+=1)each_blocks[i]=create_each_block_1$3(get_each_context_1$3(ctx,each_value_1,i));return{c(){for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();each_1_anchor=empty()},m(target,anchor){for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(target,anchor);insert(target,each_1_anchor,anchor)},p(ctx2,dirty){if(dirty&3){each_value_1=ensure_array_like(ctx2[1].overlayContent);let i;for(i=0;i<each_value_1.length;i+=1){const child_ctx=get_each_context_1$3(ctx2,each_value_1,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block_1$3(child_ctx),each_blocks[i].c(),each_blocks[i].m(each_1_anchor.parentNode,each_1_anchor))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value_1.length}},d(detaching){detaching&&detach(each_1_anchor),destroy_each(each_blocks,detaching)}}}__name(create_if_block$e,"create_if_block$e");function create_each_block_1$3(ctx){let span,t0_value=ctx[6]+"",t0,t1;return{c(){span=element$1("span"),t0=text(t0_value),t1=space(),attr(span,"class","overlay-character svelte-dq3z80"),toggle_class(span,"hidden",ctx[0].guessCorrectHint(ctx[6],ctx[8],ctx[1].hints)),toggle_class(span,"warning",!ctx[0].guessMatchesHint(ctx[6],ctx[8],ctx[1].hints))},m(target,anchor){insert(target,span,anchor),append(span,t0),append(span,t1)},p(ctx2,dirty){dirty&2&&t0_value!==(t0_value=ctx2[6]+"")&&set_data(t0,t0_value),dirty&3&&toggle_class(span,"hidden",ctx2[0].guessCorrectHint(ctx2[6],ctx2[8],ctx2[1].hints)),dirty&3&&toggle_class(span,"warning",!ctx2[0].guessMatchesHint(ctx2[6],ctx2[8],ctx2[1].hints))},d(detaching){detaching&&detach(span)}}}__name(create_each_block_1$3,"create_each_block_1$3");function create_each_block$g(ctx){let div,t,if_block=ctx[1]!==null&&create_if_block$e(ctx);return{c(){div=element$1("div"),if_block&&if_block.c(),t=space(),attr(div,"class","typo-hints-overlay "+ctx[3]+" svelte-dq3z80")},m(target,anchor){insert(target,div,anchor),if_block&&if_block.m(div,null),append(div,t)},p(ctx2,dirty){ctx2[1]!==null?if_block?if_block.p(ctx2,dirty):(if_block=create_if_block$e(ctx2),if_block.c(),if_block.m(div,t)):if_block&&(if_block.d(1),if_block=null)},d(detaching){detaching&&detach(div),if_block&&if_block.d()}}}__name(create_each_block$g,"create_each_block$g");function create_fragment$s(ctx){let each_1_anchor,each_value=ensure_array_like(["warning","correct"]),each_blocks=[];for(let i=0;i<2;i+=1)each_blocks[i]=create_each_block$g(get_each_context$g(ctx,each_value,i));return{c(){for(let i=0;i<2;i+=1)each_blocks[i].c();each_1_anchor=empty()},m(target,anchor){for(let i=0;i<2;i+=1)each_blocks[i]&&each_blocks[i].m(target,anchor);insert(target,each_1_anchor,anchor)},p(ctx2,[dirty]){if(dirty&3){each_value=ensure_array_like(["warning","correct"]);let i;for(i=0;i<2;i+=1){const child_ctx=get_each_context$g(ctx2,each_value,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block$g(child_ctx),each_blocks[i].c(),each_blocks[i].m(each_1_anchor.parentNode,each_1_anchor))}for(;i<2;i+=1)each_blocks[i].d(1)}},i:noop$1,o:noop$1,d(detaching){detaching&&detach(each_1_anchor),destroy_each(each_blocks,detaching)}}}__name(create_fragment$s,"create_fragment$s");function instance$p($$self,$$props,$$invalidate){let $guess,{feature}=$$props;const guess=feature.guessChangedStore;return component_subscribe($$self,guess,value=>$$invalidate(1,$guess=value)),$$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},[feature,$guess,guess]}__name(instance$p,"instance$p");const _Guess_check=class _Guess_check extends SvelteComponent{constructor(options){super(),init(this,options,instance$p,create_fragment$s,safe_not_equal,{feature:0})}};__name(_Guess_check,"Guess_check");let Guess_check=_Guess_check;var __defProp$t=Object.defineProperty,__decorateClass$t=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$t(target,key,result),result},"__decorateClass$t");const _GuessCheckFeature=class _GuessCheckFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elementsSetup");__publicField(this,"_chatTypedEventListener");__publicField(this,"_lobbyLeftEventListener");__publicField(this,"_drawingService");__publicField(this,"name","Guess Check");__publicField(this,"description","Shows an overlay over the word hints to compare your current guess");__publicField(this,"featureId",18);__publicField(this,"_component")}async onActivate(){const elements2=await this._elementsSetup.complete();this._component=new Guess_check({target:elements2.hints,props:{feature:this}})}onDestroy(){var _a81;(_a81=this._component)==null||_a81.$destroy()}get guessChangedStore(){const events=this._chatTypedEventListener.events$.pipe(mergeWith(this._lobbyLeftEventListener.events$.pipe(map(()=>null))),map(event=>(event==null?void 0:event.data.toLowerCase().trim())??""),distinctUntilChanged(),combineLatestWith(this._drawingService.imageState$.pipe(map(image=>image===null||image.word.solution!==void 0?null:image.word.hints.toLowerCase()),distinctUntilChanged())),map(([guess,hints])=>hints===null?null:{guess,hints,overlayContent:this.getOverlayContent(guess,hints)}),tap(data=>this._logger.debug("Guess Check data update",data)));return fromObservable(events,null)}getOverlayContent(guess,hints){guess=guess.slice(0,hints.length);const filler="‎".repeat(hints.length-guess.length);return guess+filler}guessMatchesHint(character,index,hints){return hints[index]===character||character==="‎"||hints[index]==="_"}guessCorrectHint(character,index,hints){return hints[index]===character&&hints[index]!=="_"}};__name(_GuessCheckFeature,"GuessCheckFeature");let GuessCheckFeature=_GuessCheckFeature;__decorateClass$t([inject(ElementsSetup)],GuessCheckFeature.prototype,"_elementsSetup");__decorateClass$t([inject(ChatTypedEventListener)],GuessCheckFeature.prototype,"_chatTypedEventListener");__decorateClass$t([inject(LobbyLeftEventListener)],GuessCheckFeature.prototype,"_lobbyLeftEventListener");__decorateClass$t([inject(DrawingService)],GuessCheckFeature.prototype,"_drawingService");const _HotkeysFeature=class _HotkeysFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"name","Hotkeys");__publicField(this,"description","Activate actions of features with key combinations");__publicField(this,"featureId",25);__publicField(this,"_pressedKeys",new Set);__publicField(this,"_releaseCandidates",new Set);__publicField(this,"_keysReleased$",new Subject$1);__publicField(this,"_keysPressed$",new Subject$1);__publicField(this,"_pressedSubscription");__publicField(this,"_releasedSubscription");__publicField(this,"keydownListener",this.handleKeydown.bind(this));__publicField(this,"keyupListener",this.handleKeyup.bind(this));__publicField(this,"visibilityChangeListener",this.handleDocumentVisibilityChange.bind(this));__publicField(this,"inactiveListener",this.handleDocumentInactive.bind(this))}async onActivate(){document.addEventListener("keydown",this.keydownListener),document.addEventListener("keyup",this.keyupListener),document.addEventListener("visibilitychange",this.visibilityChangeListener),window.addEventListener("blur",this.inactiveListener),window.addEventListener("focusout",this.inactiveListener),this._pressedSubscription=this._keysPressed$.pipe(tap(keys=>this._logger.debug("Keys pressed",keys)),distinctUntilChanged((a,b)=>a.length===b.length&&a.every((v,i)=>v===b[i]))).subscribe(keys=>{var _a81;this._logger.info("Keys pressed event",keys);const hotkeys=this._hotkeysService.registeredHotkeys,inputActive=((_a81=document.activeElement)==null?void 0:_a81.tagName)==="INPUT";forkJoin(hotkeys.map(h=>this._releaseCandidates.has(h)?of({executed:!1,hotkey:h}):h.executeIfMatches(keys,inputActive).pipe(tap(executed=>{executed&&this._releaseCandidates.add(h)}),map(executed=>({hotkey:h,executed}))))).subscribe(result=>{const executed=result.filter(r=>r.executed);executed.length>0&&this._logger.info("Executed hotkeys",executed.map(r=>r.hotkey.name))})}),this._releasedSubscription=this._keysReleased$.subscribe(keys=>{this._logger.info("Keys released",keys),this._releaseCandidates.forEach(hotkey=>{hotkey.releaseIfNotMatches(keys).subscribe(released=>{released&&(this._releaseCandidates.delete(hotkey),this._logger.info("Released hotkey",hotkey.name))})})})}async onDestroy(){var _a81,_b;document.removeEventListener("keydown",this.keydownListener),document.removeEventListener("keyup",this.keyupListener),document.removeEventListener("visibilitychange",this.visibilityChangeListener),window.removeEventListener("blur",this.inactiveListener),window.removeEventListener("focusout",this.inactiveListener),(_a81=this._pressedSubscription)==null||_a81.unsubscribe(),this._pressedSubscription=void 0,(_b=this._releasedSubscription)==null||_b.unsubscribe(),this._releasedSubscription=void 0}handleKeydown(event){event.altKey&&(this._logger.debug("Alt key pressed; preventing default"),event.preventDefault()),this._logger.debug("Keydown",event.code),this._pressedKeys.add(event.code),this._keysPressed$.next([...this._pressedKeys])}handleKeyup(event){this._logger.debug("Keyup",event.code),this._pressedKeys.delete(event.code),this._keysReleased$.next([...this._pressedKeys]),this._keysPressed$.next([...this._pressedKeys])}handleDocumentVisibilityChange(){if(!document.hidden)return;this._logger.info("Document hidden; releasing all keys");const released=[...this._pressedKeys];this._pressedKeys.clear(),this._keysReleased$.next(released),this._keysPressed$.next([])}handleDocumentInactive(){this._logger.info("Document inactive; releasing all keys");const released=[...this._pressedKeys];this._pressedKeys.clear(),this._keysReleased$.next(released),this._keysPressed$.next([])}};__name(_HotkeysFeature,"HotkeysFeature");let HotkeysFeature=_HotkeysFeature;function create_catch_block(ctx){return{c:noop$1,m:noop$1,p:noop$1,i:noop$1,o:noop$1,d:noop$1}}__name(create_catch_block,"create_catch_block");function create_then_block(ctx){let if_block_anchor,if_block=ctx[4]!==void 0&&ctx[5].length>0&&create_if_block$d(ctx);return{c(){if_block&&if_block.c(),if_block_anchor=empty()},m(target,anchor){if_block&&if_block.m(target,anchor),insert(target,if_block_anchor,anchor)},p(ctx2,dirty){ctx2[4]!==void 0&&ctx2[5].length>0?if_block?if_block.p(ctx2,dirty):(if_block=create_if_block$d(ctx2),if_block.c(),if_block.m(if_block_anchor.parentNode,if_block_anchor)):if_block&&(if_block.d(1),if_block=null)},i:noop$1,o:noop$1,d(detaching){detaching&&detach(if_block_anchor),if_block&&if_block.d(detaching)}}}__name(create_then_block,"create_then_block");function create_if_block$d(ctx){let img,img_src_value,mounted,dispose;function mousedown_handler(...args){return ctx[10](ctx[5],...args)}return __name(mousedown_handler,"mousedown_handler"),{c(){var _a81;img=element$1("img"),src_url_equal(img.src,img_src_value=((_a81=ctx[5])==null?void 0:_a81[ctx[4]??0])??"")||attr(img,"src",img_src_value),attr(img,"alt","Image Agent Result"),attr(img,"class","svelte-1d6izv1")},m(target,anchor){insert(target,img,anchor),mounted||(dispose=[listen(img,"contextmenu",contextmenu_handler),listen(img,"mousedown",mousedown_handler)],mounted=!0)},p(new_ctx,dirty){var _a81;ctx=new_ctx,dirty&48&&!src_url_equal(img.src,img_src_value=((_a81=ctx[5])==null?void 0:_a81[ctx[4]??0])??"")&&attr(img,"src",img_src_value)},d(detaching){detaching&&detach(img),mounted=!1,run_all(dispose)}}}__name(create_if_block$d,"create_if_block$d");function create_pending_block(ctx){let bounceload,current;return bounceload=new Bounceload({}),{c(){create_component(bounceload.$$.fragment)},m(target,anchor){mount_component(bounceload,target,anchor),current=!0},p:noop$1,i(local){current||(transition_in(bounceload.$$.fragment,local),current=!0)},o(local){transition_out(bounceload.$$.fragment,local),current=!1},d(detaching){destroy_component(bounceload,detaching)}}}__name(create_pending_block,"create_pending_block");function create_fragment$r(ctx){let div2,div1,h3,t2,div0,input,t3,promise,t4,span1,current,mounted,dispose,info={ctx,current:null,token:null,hasCatch:!1,pending:create_pending_block,then:create_then_block,catch:create_catch_block,value:5,blocks:[,,,]};return handle_promise(promise=ctx[5],info),{c(){div2=element$1("div"),div1=element$1("div"),h3=element$1("h3"),h3.innerHTML='<img src="" alt="agent-icon" style="content: var(--file-img-light-gif)" class="svelte-1d6izv1"/> <span>Image Agent</span>',t2=space(),div0=element$1("div"),input=element$1("input"),t3=space(),info.block.c(),t4=space(),span1=element$1("span"),span1.textContent="×",attr(h3,"class","svelte-1d6izv1"),attr(input,"type","text"),attr(input,"class","typo svelte-1d6izv1"),attr(input,"placeholder","Custom image name"),attr(div0,"class","agent-inputs svelte-1d6izv1"),attr(div1,"class","agent-content svelte-1d6izv1"),attr(span1,"class","close-agent svelte-1d6izv1"),attr(div2,"class","typo-image-agent svelte-1d6izv1"),toggle_class(div2,"closed",ctx[1]===null||ctx[2]===!0)},m(target,anchor){insert(target,div2,anchor),append(div2,div1),append(div1,h3),append(div1,t2),append(div1,div0),append(div0,input),set_input_value(input,ctx[3]),append(div1,t3),info.block.m(div1,info.anchor=null),info.mount=()=>div1,info.anchor=null,append(div2,t4),append(div2,span1),current=!0,mounted||(dispose=[listen(input,"input",ctx[8]),listen(input,"keydown",ctx[9]),listen(span1,"click",ctx[11])],mounted=!0)},p(new_ctx,[dirty]){ctx=new_ctx,dirty&8&&input.value!==ctx[3]&&set_input_value(input,ctx[3]),info.ctx=ctx,dirty&32&&promise!==(promise=ctx[5])&&handle_promise(promise,info)||update_await_block_branch(info,ctx,dirty),(!current||dirty&6)&&toggle_class(div2,"closed",ctx[1]===null||ctx[2]===!0)},i(local){current||(transition_in(info.block),current=!0)},o(local){for(let i=0;i<3;i+=1){const block=info.blocks[i];transition_out(block)}current=!1},d(detaching){detaching&&detach(div2),info.block.d(),info.token=null,info=null,mounted=!1,run_all(dispose)}}}__name(create_fragment$r,"create_fragment$r");const contextmenu_handler=__name(event=>event.preventDefault(),"contextmenu_handler");function instance$o($$self,$$props,$$invalidate){let images,$word,$hidden,{feature}=$$props;const word=feature.wordStore;component_subscribe($$self,word,value=>$$invalidate(1,$word=value));const hidden=feature.hiddenSettingStore;component_subscribe($$self,hidden,value=>$$invalidate(2,$hidden=value));let textInput,imageIndex;function input_input_handler(){textInput=this.value,$$invalidate(3,textInput),$$invalidate(1,$word)}__name(input_input_handler,"input_input_handler");const keydown_handler=__name(event=>{event.key==="Enter"&&word.set(textInput)},"keydown_handler"),mousedown_handler=__name((images2,event)=>{imageIndex!==void 0&&event.button===2?$$invalidate(4,imageIndex=imageIndex===0?images2.length-1:imageIndex-1):imageIndex!==void 0&&event.button===0&&$$invalidate(4,imageIndex=imageIndex===images2.length-1?0:imageIndex+1)},"mousedown_handler"),click_handler2=__name(()=>feature.setHiddenState(!0),"click_handler");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},$$self.$$.update=()=>{$$self.$$.dirty&2&&$$invalidate(3,textInput=$word??void 0),$$self.$$.dirty&2&&$$invalidate(4,imageIndex=0),$$self.$$.dirty&7&&$$invalidate(5,images=!$hidden&&$word?feature.getImages($word):[])},[feature,$word,$hidden,textInput,imageIndex,images,word,hidden,input_input_handler,keydown_handler,mousedown_handler,click_handler2]}__name(instance$o,"instance$o");const _Image_agent=class _Image_agent extends SvelteComponent{constructor(options){super(),init(this,options,instance$o,create_fragment$r,safe_not_equal,{feature:0})}};__name(_Image_agent,"Image_agent");let Image_agent=_Image_agent;var __defProp$s=Object.defineProperty,__decorateClass$s=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$s(target,key,result),result},"__decorateClass$s");const _ImageAgentFeature=class _ImageAgentFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elementsSetup");__publicField(this,"_lobbyService");__publicField(this,"_drawingService");__publicField(this,"_hiddenSetting",new ExtensionSetting("hidden",!1,this));__publicField(this,"_element");__publicField(this,"_iconElement");__publicField(this,"name","Image Agent");__publicField(this,"description","Displays a reference image of the word when it's your turn to draw");__publicField(this,"featureId",14);__publicField(this,"featureEnabledDefault",!1)}async onActivate(){const elements2=await this._elementsSetup.complete();this._element=new Image_agent({target:elements2.gameWrapper,props:{feature:this}}),this._iconElement=new Icon_button({target:elements2.chatControls,props:{icon:"file-img-light-gif",name:"Image Agent",order:1,size:"2rem",hoverMove:!1,greyscaleInactive:!0,tooltipAction:this.createTooltip}}),this._iconElement.click$.subscribe(()=>{this.setHiddenState(!1)})}onDestroy(){var _a81,_b;(_a81=this._element)==null||_a81.$destroy(),(_b=this._iconElement)==null||_b.$destroy()}get wordStore(){const ownWordChanges=this._drawingService.drawingState$.pipe(delay(100),withLatestFrom(this._lobbyService.lobby$,this._drawingService.imageState$),map(([state,lobby,image])=>{if(state==="idle"||lobby===null||image===null)return null;const drawer=lobby==null?void 0:lobby.players.find(p=>p.id===image.drawerId);return(drawer==null?void 0:drawer.id)===lobby.meId?image.word.solution:null}),tap(word=>this._logger.debug("Word change",word)));return fromObservable(ownWordChanges,null)}async getImages(word){return await(await fetch(`https://agent.typo.rip/${word}`)).json()}get hiddenSettingStore(){return fromObservable(this._hiddenSetting.changes$,!1)}setHiddenState(hidden){this._hiddenSetting.setValue(hidden)}};__name(_ImageAgentFeature,"ImageAgentFeature");let ImageAgentFeature=_ImageAgentFeature;__decorateClass$s([inject(ElementsSetup)],ImageAgentFeature.prototype,"_elementsSetup");__decorateClass$s([inject(LobbyService)],ImageAgentFeature.prototype,"_lobbyService");__decorateClass$s([inject(DrawingService)],ImageAgentFeature.prototype,"_drawingService");function create_fragment$q(ctx){let t0,br0,t1,br1,t2,br2,br3,t3,br4,br5,t4,br6;return{c(){t0=text("The Line Tool helps you draw perfectly straight lines on the canvas. "),br0=element$1("br"),t1=text(`
To start the tool, press the configured start hotkey and keep it down. `),br1=element$1("br"),t2=text(`
The tool can only be used when you are drawing. `),br2=element$1("br"),br3=element$1("br"),t3=text(`
Now, you can drag lines onto the canvas by pressing the mouse button and releasing it somewhere else. `),br4=element$1("br"),br5=element$1("br"),t4=text(`
You can also use the Line Tool to connect click positions; to do so, simply click two or more points on the canvas with the mouse to connect them.`),br6=element$1("br")},m(target,anchor){insert(target,t0,anchor),insert(target,br0,anchor),insert(target,t1,anchor),insert(target,br1,anchor),insert(target,t2,anchor),insert(target,br2,anchor),insert(target,br3,anchor),insert(target,t3,anchor),insert(target,br4,anchor),insert(target,br5,anchor),insert(target,t4,anchor),insert(target,br6,anchor)},p:noop$1,i:noop$1,o:noop$1,d(detaching){detaching&&(detach(t0),detach(br0),detach(t1),detach(br1),detach(t2),detach(br2),detach(br3),detach(t3),detach(br4),detach(br5),detach(t4),detach(br6))}}}__name(create_fragment$q,"create_fragment$q");const _Line_tool_info=class _Line_tool_info extends SvelteComponent{constructor(options){super(),init(this,options,null,create_fragment$q,safe_not_equal,{})}};__name(_Line_tool_info,"Line_tool_info");let Line_tool_info=_Line_tool_info;var __defProp$r=Object.defineProperty,__decorateClass$r=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$r(target,key,result),result},"__decorateClass$r");const _LineToolFeature=class _LineToolFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_toastService");__publicField(this,"_prioritizedCanvasEventsSetup");__publicField(this,"_elementsSetup");__publicField(this,"_lobbyService");__publicField(this,"_drawingService");__publicField(this,"_toolsService");__publicField(this,"name","Line Tool");__publicField(this,"description","Draw straight lines between two points");__publicField(this,"featureId",27);__publicField(this,"_startLineHotkey",this.useHotkey(new HotkeyAction("start_line","Start Line","While pressed, straight lines can be drawn. Press twice to enable horizontal/vertical snap.",this,()=>{this._originCoordinates$.next(void 0),this._targetCoordinates$.next(void 0),this._lineListenToggle$.next(!0)},!0,["ShiftLeft"],()=>{this._lineListenToggle$.next(!1)})));__publicField(this,"_lineListenToggle$",new BehaviorSubject(!1));__publicField(this,"_originCoordinates$",new BehaviorSubject(void 0));__publicField(this,"_targetCoordinates$",new BehaviorSubject(void 0));__publicField(this,"_lineAccept$",new Subject$1);__publicField(this,"_toastHandle");__publicField(this,"_lineStateSubscription");__publicField(this,"_linePreview");__publicField(this,"_canvasClickListener",this.onCanvasDown.bind(this));__publicField(this,"_canvasMoveListener",this.onCanvasMove.bind(this));__publicField(this,"_documentUpListener",this.onDocumentUp.bind(this))}get featureInfoComponent(){return{componentType:Line_tool_info,props:{}}}async onActivate(){const elements2=await this._elementsSetup.complete();this._linePreview=document.createElement("canvas"),this._linePreview.width=elements2.canvas.width,this._linePreview.height=elements2.canvas.height,this._linePreview.style.position="absolute",this._linePreview.style.pointerEvents="none",elements2.canvasWrapper.appendChild(this._linePreview);const{add}=await this._prioritizedCanvasEventsSetup.complete();add("preDraw")("pointerdown",this._canvasClickListener),add("preDraw")("pointermove",this._canvasMoveListener),document.addEventListener("pointerup",this._documentUpListener);const listenPipe$=this._lineListenToggle$.pipe(exhaustMap(value=>value?of("free").pipe(mergeWith(this._lineListenToggle$.pipe(filter(v=>v),skip(1),take(1),map(()=>"snap"),timeout(500),catchError(()=>this._lineListenToggle$.pipe(take(1),map(state=>state?"free":"disabled")))))):of("disabled")),distinctUntilChanged(),combineLatestWith(this._lobbyService.lobby$.pipe(map(lobby=>((lobby==null?void 0:lobby.drawerId)??void 0)!==void 0&&(lobby==null?void 0:lobby.drawerId)===(lobby==null?void 0:lobby.meId)))),map(([mode,isDrawer])=>isDrawer?mode:"disabled"),distinctUntilChanged(),tap(mode=>this._logger.info("Mode changed",mode))),originPipe$=this._originCoordinates$.pipe(withLatestFrom(this._lineListenToggle$),map(([origin,listening])=>listening?origin:void 0),distinctUntilChanged(),tap(origin=>this._logger.debug("Origin changed",origin))),targetPipe$=this._targetCoordinates$.pipe(withLatestFrom(listenPipe$,originPipe$),map(([target,mode,origin])=>mode=="disabled"||origin===void 0||target===void 0?void 0:mode==="free"?target:this.calculateSnap(origin,target)),distinctUntilChanged(),tap(target=>this._logger.debug("Target changed",target)));this._lineStateSubscription=listenPipe$.pipe(combineLatestWith(originPipe$,targetPipe$),startWith(["disabled",void 0,void 0]),pairwise(),tap(([prev,current])=>this.processUiStateUpdate(prev,current)),map(([,current])=>current),debounce(()=>this._lineAccept$.pipe(take(1),tap(()=>this._logger.debug("Line accept debounce emitted")))),startWith(["disabled",void 0,void 0]),pairwise(),tap(data=>this._logger.debug("Line accepted",data))).pipe(withLatestFrom(this._toolsService.activeBrushStyle$)).subscribe(async([[[,prevOrigin,prevTarget],[listening,origin,target]],style])=>{!origin||listening==="disabled"||(this._logger.info("Line accepted",origin,target),target===void 0||target[0]===origin[0]&&target[1]===origin[1]?(this._logger.info("Line accepted without or same target - connecting with last origin or target, if existing",origin,target),prevTarget?(this._logger.info("Connecting with last drag end",prevTarget),await this.drawLine(prevTarget,origin,style)):prevOrigin?(this._logger.info("Connecting with last click",prevOrigin),await this.drawLine(prevOrigin,origin,style)):this._logger.info("No previous line to connect to; waiting for next"),this._originCoordinates$.next(void 0)):await this.drawLine(origin,target,style))})}async onDestroy(){var _a81,_b,_c;const{remove}=await this._prioritizedCanvasEventsSetup.complete();remove("pointerdown",this._canvasClickListener),remove("pointermove",this._canvasMoveListener),document.removeEventListener("pointerup",this._documentUpListener),(_a81=this._linePreview)==null||_a81.remove(),this._linePreview=void 0,(_b=this._toastHandle)==null||_b.close(),(_c=this._lineStateSubscription)==null||_c.unsubscribe(),this._lineStateSubscription=void 0,this._toastHandle=void 0,this._lineListenToggle$.next(!1),this._originCoordinates$.next(void 0),this._targetCoordinates$.next(void 0)}calculateSnap(origin,target){const dx=Math.abs(target[0]-origin[0]),dy=Math.abs(target[1]-origin[1]);return dx>dy?[target[0],origin[1]]:dy>dx?[origin[0],target[1]]:target}async setPreview(coordinates){if(this._logger.debug("Updating preview",coordinates),this._linePreview===void 0){this._logger.error("Line preview canvas not initialized");return}if(coordinates===void 0||coordinates[2]===void 0||coordinates[3]===void 0){this._linePreview.style.display="none";return}this._linePreview.style.display="block";const ctx=this._linePreview.getContext("2d");if(ctx===null){this._logger.error("Line preview context not found");return}ctx.clearRect(0,0,this._linePreview.width,this._linePreview.height),ctx.beginPath(),ctx.moveTo(coordinates[0],coordinates[1]),ctx.lineTo(coordinates[2],coordinates[3]),ctx.stroke()}onCanvasDown(event){if(this._logger.debug("Canvas clicked",event),this._lineListenToggle$.value)return event.target.setPointerCapture(event.pointerId),event.preventDefault(),event.stopImmediatePropagation(),this._originCoordinates$.next([event.offsetX,event.offsetY]),!1}async onCanvasMove(event){if(this._lineListenToggle$.value){this._logger.debug("Document pointer moved",event);const boundingRect=(await this._elementsSetup.complete()).canvas.getBoundingClientRect(),offsetX=event.clientX-boundingRect.left,offsetY=event.clientY-boundingRect.top;this._targetCoordinates$.next([offsetX,offsetY])}}async onDocumentUp(event){this._logger.debug("Document pointer up",event),this._lineAccept$.next(!0)}async processUiStateUpdate([prevListening,prevOrigin,prevTarget],[listening,origin,target]){var _a81;if(this._logger.debug("Line state processing",{prevListening,prevOrigin,prevTarget},{listening,origin,target},this._toastHandle),await this.setPreview(listening!=="disabled"&&origin!==void 0?[...origin,...target??[void 0,void 0]]:void 0),prevListening==="disabled"&&listening!=="disabled")this._toastHandle&&(this._logger.warn("Toast handle unexpected existing when entering line tool"),this._toastHandle.close()),this._toastHandle=await this._toastService.showStickyToast("Line Tool: "+(listening==="snap"?"Snap":"Free"),"Click to start line, release to finish");else if(prevListening!=="disabled"&&listening!=="disabled"&&listening!==prevListening){if(!this._toastHandle){this._logger.error("Toast handle unexpected not existing when changing mode",{prevListening,listening});return}this._toastHandle.update("Line Tool: "+(listening==="snap"?"Snap":"Free"),"Click to start line, release to finish")}else prevListening!=="disabled"&&listening==="disabled"&&(this._toastHandle||this._logger.warn("Toast handle unexpected not existing when exiting line tool"),(_a81=this._toastHandle)==null||_a81.close(),this._toastHandle=void 0)}async drawLine(origin,target,style){!origin||!target||(await this._drawingService.drawLine([...origin,...target],style.color.skribblCode,style.size),this._originCoordinates$.next(void 0),this._targetCoordinates$.next(void 0))}};__name(_LineToolFeature,"LineToolFeature");let LineToolFeature=_LineToolFeature;__decorateClass$r([inject(ToastService)],LineToolFeature.prototype,"_toastService");__decorateClass$r([inject(PrioritizedCanvasEventsSetup)],LineToolFeature.prototype,"_prioritizedCanvasEventsSetup");__decorateClass$r([inject(ElementsSetup)],LineToolFeature.prototype,"_elementsSetup");__decorateClass$r([inject(LobbyService)],LineToolFeature.prototype,"_lobbyService");__decorateClass$r([inject(DrawingService)],LineToolFeature.prototype,"_drawingService");__decorateClass$r([inject(ToolsService)],LineToolFeature.prototype,"_toolsService");function repeatAfterDelay(source$,delayMs){return source$.pipe(timeout({each:delayMs,with:__name(()=>source$.pipe(takeUntil(timer(delayMs))),"with")}),repeat({delay:__name(()=>timer(delayMs),"delay")}))}__name(repeatAfterDelay,"repeatAfterDelay");function get_each_context$f(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[14]=list[i],child_ctx[15]=list,child_ctx[16]=i,child_ctx}__name(get_each_context$f,"get_each_context$f");function create_else_block$7(ctx){let b,t1,br;return{c(){b=element$1("b"),b.textContent="Lobby Connected:",t1=text(" Your lobby is connected to typo and will be visible on Discord."),br=element$1("br")},m(target,anchor){insert(target,b,anchor),insert(target,t1,anchor),insert(target,br,anchor)},i:noop$1,o:noop$1,d(detaching){detaching&&(detach(b),detach(t1),detach(br))}}}__name(create_else_block$7,"create_else_block$7");function create_if_block_5(ctx){let b,t1,br;return{c(){b=element$1("b"),b.textContent="Log-in required:",t1=text(" You need to log in with typo to use the lobby status feature."),br=element$1("br")},m(target,anchor){insert(target,b,anchor),insert(target,t1,anchor),insert(target,br,anchor)},i:noop$1,o:noop$1,d(detaching){detaching&&(detach(b),detach(t1),detach(br))}}}__name(create_if_block_5,"create_if_block_5");function create_if_block_4$2(ctx){let bounceload,current;return bounceload=new Bounceload({props:{content:"Connecting lobby..."}}),{c(){create_component(bounceload.$$.fragment)},m(target,anchor){mount_component(bounceload,target,anchor),current=!0},i(local){current||(transition_in(bounceload.$$.fragment,local),current=!0)},o(local){transition_out(bounceload.$$.fragment,local),current=!1},d(detaching){destroy_component(bounceload,detaching)}}}__name(create_if_block_4$2,"create_if_block_4$2");function create_if_block_3$2(ctx){let div2,span,t1,div0,b0,t3,input,t4,div1,b1,t6,checkbox,updating_checked,t7,t8,flatbutton,current,mounted,dispose;function checkbox_checked_binding(value){ctx[9](value)}__name(checkbox_checked_binding,"checkbox_checked_binding");let checkbox_props={description:"Share link on all servers"};ctx[2]!==void 0&&(checkbox_props.checked=ctx[2]),checkbox=new Checkbox({props:checkbox_props}),binding_callbacks.push(()=>bind$1(checkbox,"checked",checkbox_checked_binding));let each_value=ensure_array_like(ctx[4].member.guilds),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$f(get_each_context$f(ctx,each_value,i));const out=__name(i=>transition_out(each_blocks[i],1,1,()=>{each_blocks[i]=null}),"out");return flatbutton=new Flat_button({props:{content:"Save Settings",color:"green"}}),flatbutton.$on("click",ctx[11]),{c(){div2=element$1("div"),span=element$1("span"),span.textContent="You are the typo lobby owner. Only you can change these settings.",t1=space(),div0=element$1("div"),b0=element$1("b"),b0.textContent="Lobby Description:",t3=space(),input=element$1("input"),t4=space(),div1=element$1("div"),b1=element$1("b"),b1.textContent="Lobby Link Privacy:",t6=space(),create_component(checkbox.$$.fragment),t7=space();for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();t8=space(),create_component(flatbutton.$$.fragment),attr(input,"type","text"),attr(input,"placeholder","Description in the Palantir Bot"),attr(div2,"class","status-settings svelte-1iaxigp")},m(target,anchor){insert(target,div2,anchor),append(div2,span),append(div2,t1),append(div2,div0),append(div0,b0),append(div0,t3),append(div0,input),set_input_value(input,ctx[1]),append(div2,t4),append(div2,div1),append(div1,b1),append(div1,t6),mount_component(checkbox,div1,null),append(div1,t7);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div1,null);append(div2,t8),mount_component(flatbutton,div2,null),current=!0,mounted||(dispose=listen(input,"input",ctx[8]),mounted=!0)},p(ctx2,dirty){dirty&2&&input.value!==ctx2[1]&&set_input_value(input,ctx2[1]);const checkbox_changes={};if(!updating_checked&&dirty&4&&(updating_checked=!0,checkbox_changes.checked=ctx2[2],add_flush_callback(()=>updating_checked=!1)),checkbox.$set(checkbox_changes),dirty&28){each_value=ensure_array_like(ctx2[4].member.guilds);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$f(ctx2,each_value,i);each_blocks[i]?(each_blocks[i].p(child_ctx,dirty),transition_in(each_blocks[i],1)):(each_blocks[i]=create_each_block$f(child_ctx),each_blocks[i].c(),transition_in(each_blocks[i],1),each_blocks[i].m(div1,null))}for(group_outros(),i=each_value.length;i<each_blocks.length;i+=1)out(i);check_outros()}},i(local){if(!current){transition_in(checkbox.$$.fragment,local);for(let i=0;i<each_value.length;i+=1)transition_in(each_blocks[i]);transition_in(flatbutton.$$.fragment,local),current=!0}},o(local){transition_out(checkbox.$$.fragment,local),each_blocks=each_blocks.filter(Boolean);for(let i=0;i<each_blocks.length;i+=1)transition_out(each_blocks[i]);transition_out(flatbutton.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div2),destroy_component(checkbox),destroy_each(each_blocks,detaching),destroy_component(flatbutton),mounted=!1,dispose()}}}__name(create_if_block_3$2,"create_if_block_3$2");function create_each_block$f(ctx){let checkbox,updating_checked,current;function checkbox_checked_binding_1(value){ctx[10](value,ctx[14])}__name(checkbox_checked_binding_1,"checkbox_checked_binding_1");let checkbox_props={disabled:ctx[2],description:ctx[14].guildName};return ctx[3][ctx[14].guildID]!==void 0&&(checkbox_props.checked=ctx[3][ctx[14].guildID]),checkbox=new Checkbox({props:checkbox_props}),binding_callbacks.push(()=>bind$1(checkbox,"checked",checkbox_checked_binding_1)),{c(){create_component(checkbox.$$.fragment)},m(target,anchor){mount_component(checkbox,target,anchor),current=!0},p(new_ctx,dirty){ctx=new_ctx;const checkbox_changes={};dirty&4&&(checkbox_changes.disabled=ctx[2]),dirty&16&&(checkbox_changes.description=ctx[14].guildName),!updating_checked&&dirty&24&&(updating_checked=!0,checkbox_changes.checked=ctx[3][ctx[14].guildID],add_flush_callback(()=>updating_checked=!1)),checkbox.$set(checkbox_changes)},i(local){current||(transition_in(checkbox.$$.fragment,local),current=!0)},o(local){transition_out(checkbox.$$.fragment,local),current=!1},d(detaching){destroy_component(checkbox,detaching)}}}__name(create_each_block$f,"create_each_block$f");function create_if_block_1$7(ctx){let div1,t0,div0,b,br,t2,t3_value=ctx[4].typoLobbyState.lobbySettings.whitelistAllowedServers?"Only on selected servers by the lobby owner":"On all servers",t3,if_block=ctx[4].typoLobbyState.lobbySettings.description!==""&&create_if_block_2$4(ctx);return{c(){div1=element$1("div"),if_block&&if_block.c(),t0=space(),div0=element$1("div"),b=element$1("b"),b.textContent="Lobby Link Privacy:",br=element$1("br"),t2=space(),t3=text(t3_value),attr(div1,"class","status-settings svelte-1iaxigp")},m(target,anchor){insert(target,div1,anchor),if_block&&if_block.m(div1,null),append(div1,t0),append(div1,div0),append(div0,b),append(div0,br),append(div0,t2),append(div0,t3)},p(ctx2,dirty){ctx2[4].typoLobbyState.lobbySettings.description!==""?if_block?if_block.p(ctx2,dirty):(if_block=create_if_block_2$4(ctx2),if_block.c(),if_block.m(div1,t0)):if_block&&(if_block.d(1),if_block=null),dirty&16&&t3_value!==(t3_value=ctx2[4].typoLobbyState.lobbySettings.whitelistAllowedServers?"Only on selected servers by the lobby owner":"On all servers")&&set_data(t3,t3_value)},d(detaching){detaching&&detach(div1),if_block&&if_block.d()}}}__name(create_if_block_1$7,"create_if_block_1$7");function create_if_block_2$4(ctx){let b,br,t1,t2_value=ctx[4].typoLobbyState.lobbySettings.description+"",t2;return{c(){b=element$1("b"),b.textContent="Lobby Description:",br=element$1("br"),t1=space(),t2=text(t2_value)},m(target,anchor){insert(target,b,anchor),insert(target,br,anchor),insert(target,t1,anchor),insert(target,t2,anchor)},p(ctx2,dirty){dirty&16&&t2_value!==(t2_value=ctx2[4].typoLobbyState.lobbySettings.description+"")&&set_data(t2,t2_value)},d(detaching){detaching&&(detach(b),detach(br),detach(t1),detach(t2))}}}__name(create_if_block_2$4,"create_if_block_2$4");function create_if_block$c(ctx){var _a81,_b;let div1,div0,b0,t1,t2_value=(ctx[4]===void 0?"/":ctx[4]==="unauthorized"?"not logged in":(_a81=ctx[4])==null?void 0:_a81.typoLobbyState.lobbyId)+"",t2,t3,br,t4,b1,t6,t7_value=(ctx[4]===void 0?"/":ctx[4]==="unauthorized"?"not logged in":(_b=ctx[4])==null?void 0:_b.typoLobbyState.ownershipClaim)+"",t7,t8,flatbutton0,t9,flatbutton1,current;return flatbutton0=new Flat_button({props:{content:"Reset Connection",color:"orange"}}),flatbutton0.$on("click",ctx[12]),flatbutton1=new Flat_button({props:{content:"Trigger refresh",color:"orange"}}),flatbutton1.$on("click",ctx[13]),{c(){div1=element$1("div"),div0=element$1("div"),b0=element$1("b"),b0.textContent="Lobby ID:",t1=space(),t2=text(t2_value),t3=space(),br=element$1("br"),t4=space(),b1=element$1("b"),b1.textContent="Ownership Claim:",t6=space(),t7=text(t7_value),t8=space(),create_component(flatbutton0.$$.fragment),t9=space(),create_component(flatbutton1.$$.fragment),attr(div1,"class","status-settings svelte-1iaxigp")},m(target,anchor){insert(target,div1,anchor),append(div1,div0),append(div0,b0),append(div0,t1),append(div0,t2),append(div0,t3),append(div0,br),append(div0,t4),append(div0,b1),append(div0,t6),append(div0,t7),append(div1,t8),mount_component(flatbutton0,div1,null),append(div1,t9),mount_component(flatbutton1,div1,null),current=!0},p(ctx2,dirty){var _a82,_b2;(!current||dirty&16)&&t2_value!==(t2_value=(ctx2[4]===void 0?"/":ctx2[4]==="unauthorized"?"not logged in":(_a82=ctx2[4])==null?void 0:_a82.typoLobbyState.lobbyId)+"")&&set_data(t2,t2_value),(!current||dirty&16)&&t7_value!==(t7_value=(ctx2[4]===void 0?"/":ctx2[4]==="unauthorized"?"not logged in":(_b2=ctx2[4])==null?void 0:_b2.typoLobbyState.ownershipClaim)+"")&&set_data(t7,t7_value)},i(local){current||(transition_in(flatbutton0.$$.fragment,local),transition_in(flatbutton1.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton0.$$.fragment,local),transition_out(flatbutton1.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div1),destroy_component(flatbutton0),destroy_component(flatbutton1)}}}__name(create_if_block$c,"create_if_block$c");function create_fragment$p(ctx){let div1,div0,current_block_type_index,if_block0,t0,t1,t2,current;const if_block_creators=[create_if_block_4$2,create_if_block_5,create_else_block$7],if_blocks=[];function select_block_type(ctx2,dirty){return ctx2[4]===void 0?0:ctx2[4]==="unauthorized"?1:2}__name(select_block_type,"select_block_type"),current_block_type_index=select_block_type(ctx),if_block0=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);let if_block1=ctx[4]!==void 0&&ctx[4]!=="unauthorized"&&ctx[4].typoLobbyState.playerIsOwner&&create_if_block_3$2(ctx),if_block2=ctx[4]!==void 0&&ctx[4]!=="unauthorized"&&ctx[4].typoLobbyState.playerIsOwner===!1&&create_if_block_1$7(ctx),if_block3=ctx[5]===!0&&create_if_block$c(ctx);return{c(){div1=element$1("div"),div0=element$1("div"),if_block0.c(),t0=space(),if_block1&&if_block1.c(),t1=space(),if_block2&&if_block2.c(),t2=space(),if_block3&&if_block3.c(),attr(div0,"class","status-info"),attr(div1,"class","typo-lobby-status-settings svelte-1iaxigp")},m(target,anchor){insert(target,div1,anchor),append(div1,div0),if_blocks[current_block_type_index].m(div0,null),append(div1,t0),if_block1&&if_block1.m(div1,null),append(div1,t1),if_block2&&if_block2.m(div1,null),append(div1,t2),if_block3&&if_block3.m(div1,null),current=!0},p(ctx2,[dirty]){let previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx2),current_block_type_index!==previous_block_index&&(group_outros(),transition_out(if_blocks[previous_block_index],1,1,()=>{if_blocks[previous_block_index]=null}),check_outros(),if_block0=if_blocks[current_block_type_index],if_block0||(if_block0=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx2),if_block0.c()),transition_in(if_block0,1),if_block0.m(div0,null)),ctx2[4]!==void 0&&ctx2[4]!=="unauthorized"&&ctx2[4].typoLobbyState.playerIsOwner?if_block1?(if_block1.p(ctx2,dirty),dirty&16&&transition_in(if_block1,1)):(if_block1=create_if_block_3$2(ctx2),if_block1.c(),transition_in(if_block1,1),if_block1.m(div1,t1)):if_block1&&(group_outros(),transition_out(if_block1,1,1,()=>{if_block1=null}),check_outros()),ctx2[4]!==void 0&&ctx2[4]!=="unauthorized"&&ctx2[4].typoLobbyState.playerIsOwner===!1?if_block2?if_block2.p(ctx2,dirty):(if_block2=create_if_block_1$7(ctx2),if_block2.c(),if_block2.m(div1,t2)):if_block2&&(if_block2.d(1),if_block2=null),ctx2[5]===!0?if_block3?(if_block3.p(ctx2,dirty),dirty&32&&transition_in(if_block3,1)):(if_block3=create_if_block$c(ctx2),if_block3.c(),transition_in(if_block3,1),if_block3.m(div1,null)):if_block3&&(group_outros(),transition_out(if_block3,1,1,()=>{if_block3=null}),check_outros())},i(local){current||(transition_in(if_block0),transition_in(if_block1),transition_in(if_block3),current=!0)},o(local){transition_out(if_block0),transition_out(if_block1),transition_out(if_block3),current=!1},d(detaching){detaching&&detach(div1),if_blocks[current_block_type_index].d(),if_block1&&if_block1.d(),if_block2&&if_block2.d(),if_block3&&if_block3.d()}}}__name(create_fragment$p,"create_fragment$p");function instance$n($$self,$$props,$$invalidate){let $connection,$devmode,{feature}=$$props,lobbyDescription="",lobbyDisableWhitelistAllowedServers=!1,lobbyAllowedServers={};const connection=feature.connectionStore;component_subscribe($$self,connection,value=>$$invalidate(4,$connection=value));const devmode=feature.isDevmodeStore;component_subscribe($$self,devmode,value=>$$invalidate(5,$devmode=value)),connection.subscribe(conn=>{conn&&conn!=="unauthorized"&&($$invalidate(1,lobbyDescription=conn.typoLobbyState.lobbySettings.description),$$invalidate(2,lobbyDisableWhitelistAllowedServers=!conn.typoLobbyState.lobbySettings.whitelistAllowedServers),$$invalidate(3,lobbyAllowedServers=Object.fromEntries(conn.typoLobbyState.lobbySettings.allowedServers.map(s=>[s,!0]))))});function input_input_handler(){lobbyDescription=this.value,$$invalidate(1,lobbyDescription)}__name(input_input_handler,"input_input_handler");function checkbox_checked_binding(value){lobbyDisableWhitelistAllowedServers=value,$$invalidate(2,lobbyDisableWhitelistAllowedServers)}__name(checkbox_checked_binding,"checkbox_checked_binding");function checkbox_checked_binding_1(value,guild){$$self.$$.not_equal(lobbyAllowedServers[guild.guildID],value)&&(lobbyAllowedServers[guild.guildID]=value,$$invalidate(3,lobbyAllowedServers))}__name(checkbox_checked_binding_1,"checkbox_checked_binding_1");const click_handler2=__name(()=>{feature.updateLobbySettings(lobbyDescription,!lobbyDisableWhitelistAllowedServers,lobbyAllowedServers)},"click_handler"),click_handler_1=__name(()=>{feature.resetConnection()},"click_handler_1"),click_handler_2=__name(()=>{feature.triggerManualRefresh()},"click_handler_2");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},[feature,lobbyDescription,lobbyDisableWhitelistAllowedServers,lobbyAllowedServers,$connection,$devmode,connection,devmode,input_input_handler,checkbox_checked_binding,checkbox_checked_binding_1,click_handler2,click_handler_1,click_handler_2]}__name(instance$n,"instance$n");const _Lobby_status=class _Lobby_status extends SvelteComponent{constructor(options){super(),init(this,options,instance$n,create_fragment$p,safe_not_equal,{feature:0})}};__name(_Lobby_status,"Lobby_status");let Lobby_status=_Lobby_status;var __defProp$q=Object.defineProperty,__decorateClass$q=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$q(target,key,result),result},"__decorateClass$q");const _LobbyStatusFeature=class _LobbyStatusFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_lobbyService");__publicField(this,"_elementsSetup");__publicField(this,"_memberService");__publicField(this,"_toastService");__publicField(this,"_settingsService");__publicField(this,"_lobbyConnectionService");__publicField(this,"_privateLobbyWhitelistEnabledSetting",new ExtensionSetting("private_whitelist_enabled",!1,this));__publicField(this,"_publicLobbyWhitelistEnabledSetting",new ExtensionSetting("public_whitelist_enabled",!1,this));__publicField(this,"_privateLobbyWhitelistedServersSetting",new ExtensionSetting("private_whitelisted_servers",[],this));__publicField(this,"_publicLobbyWhitelistedServersSetting",new ExtensionSetting("public_whitelisted_servers",[],this));__publicField(this,"_lobbySubscription");__publicField(this,"_currentBackendProcessing");__publicField(this,"_triggerManualRefresh$",new BehaviorSubject(void 0));__publicField(this,"_controlIcon");__publicField(this,"_controlIconSubscription");__publicField(this,"_flyoutComponent");__publicField(this,"_flyoutSubscription");__publicField(this,"_lobbyTypeSubscription");__publicField(this,"name","Lobby Status");__publicField(this,"description","Share your current lobby with typo to use avatar decorations, give awards and catch drops.");__publicField(this,"featureId",19)}get boundServices(){return[this._lobbyConnectionService]}get connectionStore(){return fromObservable(this._lobbyConnectionService.connection$,void 0)}get isDevmodeStore(){return this._settingsService.settings.devMode.store}async onActivate(){this._lobbyTypeSubscription=this._lobbyService.lobby$.pipe(map(lobby=>lobby===null?null:lobby.id===null?"practice":lobby.private?"custom":"public"),distinctUntilChanged()).subscribe(async type=>{var _a81;type==="public"||type==="custom"?await this.setupSettings():(this.destroySettings(),(_a81=this._flyoutComponent)==null||_a81.close())}),this._lobbySubscription=repeatAfterDelay(this._lobbyService.lobby$.pipe(combineLatestWith(this._triggerManualRefresh$),map(([lobby])=>lobby)),30*1e3).pipe(debounce(()=>this._lobbyConnectionService.isConnected?of(null):interval(2e3)),combineLatestWith(this._memberService.member$),debounce(()=>this._currentBackendProcessing??of(0))).subscribe(([lobby,member])=>this._currentBackendProcessing=this.processLobbyUpdate(lobby,member))}async onDestroy(){var _a81,_b;(_a81=this._lobbySubscription)==null||_a81.unsubscribe(),(_b=this._lobbyTypeSubscription)==null||_b.unsubscribe(),this.destroySettings()}async setupSettings(){const elements2=await this._elementsSetup.complete();this._controlIcon=new Icon_button({target:elements2.chatControls,props:{icon:"file-img-connection-gif",name:"Lobby Status",order:2,size:"2rem",hoverMove:!1,greyscaleInactive:!0,tooltipAction:this.createTooltip}}),this._controlIconSubscription=this._controlIcon.click$.subscribe(()=>{if(this._flyoutComponent)return;const flyoutContent={componentType:Lobby_status,props:{feature:this}};this._flyoutComponent=new Area_flyout({target:elements2.gameWrapper,props:{componentData:flyoutContent,areaName:"chat",maxHeight:"600px",maxWidth:"300px",title:"Lobby Status",closeStrategy:"explicit",iconName:"file-img-connection-gif",alignment:"top"}}),this._flyoutSubscription=this._flyoutComponent.closed$.subscribe(()=>{var _a81,_b;this._logger.info("Destroyed flyout"),(_a81=this._flyoutComponent)==null||_a81.$destroy(),(_b=this._flyoutSubscription)==null||_b.unsubscribe(),this._flyoutComponent=void 0})})}destroySettings(){var _a81,_b,_c,_d;(_a81=this._controlIcon)==null||_a81.$destroy(),(_b=this._controlIconSubscription)==null||_b.unsubscribe(),this._controlIcon=void 0,(_c=this._flyoutComponent)==null||_c.$destroy(),(_d=this._flyoutSubscription)==null||_d.unsubscribe(),this._flyoutComponent=void 0}async processLobbyUpdate(lobby,member){if(this._logger.info("processing lobby status update",lobby,member==null?void 0:member.userName),member==null){await this._lobbyConnectionService.destroyConnection(!0);return}if(lobby===null||lobby.id===null){await this._lobbyConnectionService.destroyConnection();return}if(lobby&&!this._lobbyConnectionService.isConnected){const lobbyDto=this.mapLobbyToDto(lobby),result=await this._lobbyConnectionService.setupConnection(lobby.id,lobbyDto,lobby.meId,member),{typoLobbyState,hub}=this._lobbyConnectionService.connection;if(typoLobbyState.playerIsOwner&&result==="connected"){const defaults=lobby.private?{whitelistEnabled:await this._privateLobbyWhitelistEnabledSetting.getValue(),whitelist:await this._privateLobbyWhitelistedServersSetting.getValue()}:{whitelistEnabled:await this._publicLobbyWhitelistEnabledSetting.getValue(),whitelist:await this._publicLobbyWhitelistedServersSetting.getValue()};try{await hub.updateTypoLobbySettings({description:"",whitelistAllowedServers:defaults.whitelistEnabled,allowedServers:defaults.whitelist})}catch(e){this._logger.error("Failed to set defaults",e)}}}if(lobby&&this._lobbyConnectionService.isConnected){if(lobby.id!==this._lobbyConnectionService.connection.typoLobbyState.lobbyId)return this._logger.info("Lobby changed, reconnecting"),await this._lobbyConnectionService.destroyConnection(),this.processLobbyUpdate(lobby,member);await this._lobbyConnectionService.connection.hub.updateSkribblLobbyState(this.mapLobbyToDto(lobby))}this._logger.info("Lobby status processed")}mapLobbyToDto(lobby){if(lobby.id===null)throw new Error("cannot map practice lobby to state dto");return{link:lobby.id,ownerId:lobby.ownerId??void 0,round:lobby.round,players:lobby.players.map(player=>({name:player.name,isDrawing:player.id===lobby.drawerId,score:player.score,playerId:player.id,hasGuessed:player.guessed})),settings:{language:lobby.settings.language,players:lobby.settings.players,rounds:lobby.settings.rounds,drawTime:lobby.settings.drawTime}}}async updateLobbySettings(description,whitelistAllowedServers,allowedServers){const toast=await this._toastService.showLoadingToast("Updating lobby settings");this._lobbyService.lobby$.subscribe(lobby=>{lobby&&(lobby.private?(this._privateLobbyWhitelistEnabledSetting.setValue(whitelistAllowedServers),this._privateLobbyWhitelistedServersSetting.setValue(Object.keys(allowedServers).filter(key=>allowedServers[key]))):(this._publicLobbyWhitelistEnabledSetting.setValue(whitelistAllowedServers),this._publicLobbyWhitelistedServersSetting.setValue(Object.keys(allowedServers).filter(key=>allowedServers[key]))))});try{await this._lobbyConnectionService.connection.hub.updateTypoLobbySettings({description,whitelistAllowedServers,allowedServers:Object.entries(allowedServers).filter(([,value])=>value).map(([key])=>key)}),toast.resolve()}catch(e){this._logger.error("Failed to update lobby settings",e),toast.reject()}}async resetConnection(){await this._lobbyConnectionService.destroyConnection(),await this._toastService.showToast(void 0,"Connection reset; reconnecting in next update cycle")}async triggerManualRefresh(){this._triggerManualRefresh$.next(void 0),await this._toastService.showToast(void 0,"Manual refresh triggered")}};__name(_LobbyStatusFeature,"LobbyStatusFeature");let LobbyStatusFeature=_LobbyStatusFeature;__decorateClass$q([inject(LobbyService)],LobbyStatusFeature.prototype,"_lobbyService");__decorateClass$q([inject(ElementsSetup)],LobbyStatusFeature.prototype,"_elementsSetup");__decorateClass$q([inject(MemberService)],LobbyStatusFeature.prototype,"_memberService");__decorateClass$q([inject(ToastService)],LobbyStatusFeature.prototype,"_toastService");__decorateClass$q([inject(GlobalSettingsService)],LobbyStatusFeature.prototype,"_settingsService");__decorateClass$q([inject(LobbyConnectionService)],LobbyStatusFeature.prototype,"_lobbyConnectionService");function create_fragment$o(ctx){let t,br;return{c(){t=text("Adds a progress bar at the top of the canvas, visualizing the remaining time for selected actions. "),br=element$1("br")},m(target,anchor){insert(target,t,anchor),insert(target,br,anchor)},p:noop$1,i:noop$1,o:noop$1,d(detaching){detaching&&(detach(t),detach(br))}}}__name(create_fragment$o,"create_fragment$o");const _Lobby_time_visualizer_info=class _Lobby_time_visualizer_info extends SvelteComponent{constructor(options){super(),init(this,options,null,create_fragment$o,safe_not_equal,{})}};__name(_Lobby_time_visualizer_info,"Lobby_time_visualizer_info");let Lobby_time_visualizer_info=_Lobby_time_visualizer_info;var __defProp$p=Object.defineProperty,__decorateClass$p=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$p(target,key,result),result},"__decorateClass$p");const _LobbyTimeVisualizerFeature=class _LobbyTimeVisualizerFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_lobbyStateChangedEventListener");__publicField(this,"_lobbyJoinedEventListener");__publicField(this,"name","Time Visualizer");__publicField(this,"description","Shows a visual representation of time left to draw/choose");__publicField(this,"featureId",30);__publicField(this,"_enableChooseVisualizer",this.useSetting(new BooleanExtensionSetting("choose_visualizer",!0,this).withName("Choose Visualizer").withDescription("Show a visualizer of the remaining time to choose words")));__publicField(this,"_enableDrawVisualizer",this.useSetting(new BooleanExtensionSetting("draw_visualizer",!0,this).withName("Draw Visualizer").withDescription("Show a visualizer of the remaining time to draw a word")));__publicField(this,"_enableGuessVisualizer",this.useSetting(new BooleanExtensionSetting("guess_visualizer",!0,this).withName("Guess Visualizer").withDescription("Show a visualizer of the remaining time to guess a word")));__publicField(this,"visualizerEventSubscription");__publicField(this,"_visualizerStyle")}get featureInfoComponent(){return{componentType:Lobby_time_visualizer_info,props:{}}}async onActivate(){this._visualizerStyle=new CSSStyleSheet,document.adoptedStyleSheets=[...document.adoptedStyleSheets,this._visualizerStyle],this.visualizerEventSubscription=this._lobbyStateChangedEventListener.events$.pipe(withLatestFrom(this._enableDrawVisualizer.changes$,this._enableGuessVisualizer.changes$,this._enableChooseVisualizer.changes$,this._lobbyJoinedEventListener.events$),map(([event,draw,guess,choose,lobby])=>{var _a81;return lobby&&(draw&&((_a81=event.data.drawingStarted)==null?void 0:_a81.drawerId)===lobby.data.meId||guess&&event.data.drawingStarted!==void 0&&event.data.drawingStarted.drawerId!==lobby.data.meId||choose&&event.data.drawerChoosingWord!==void 0?event:void 0)})).subscribe(event=>{this.visualizeEvent(event)})}async onDestroy(){var _a81;(_a81=this.visualizerEventSubscription)==null||_a81.unsubscribe(),this.visualizerEventSubscription=void 0,document.adoptedStyleSheets=document.adoptedStyleSheets.filter(sheet=>sheet!==this._visualizerStyle)}async visualizeEvent(event){var _a81,_b;if(this._logger.debug("Visualize event",event),this._visualizerStyle===void 0){this._logger.error("Visualizer style not set");return}if(await this._visualizerStyle.replace(""),event===void 0)return;const time=((_a81=event.data.drawingStarted)==null?void 0:_a81.maxTime)??((_b=event.data.drawerChoosingWord)==null?void 0:_b.maxTime);if(time===void 0){this._logger.error("No time set for visualizer",event);return}await firstValueFrom(of(1).pipe(delay(10))),await this._visualizerStyle.replace(`  
      @keyframes countdown {
        from { width: 100%; }
        to { width: 0%; }
      }
    
      #game-canvas:after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 0;
        height: .3rem;
        background-color: LightGreen;
        animation: countdown ${time*1e3}ms linear;
      }
    `)}get enableChooseVisualizerStore(){return this._enableChooseVisualizer.store}get enableDrawVisualizerStore(){return this._enableDrawVisualizer.store}get enableGuessVisualizerStore(){return this._enableGuessVisualizer.store}};__name(_LobbyTimeVisualizerFeature,"LobbyTimeVisualizerFeature");let LobbyTimeVisualizerFeature=_LobbyTimeVisualizerFeature;__decorateClass$p([inject(LobbyStateChangedEventListener)],LobbyTimeVisualizerFeature.prototype,"_lobbyStateChangedEventListener");__decorateClass$p([inject(LobbyJoinedEventListener)],LobbyTimeVisualizerFeature.prototype,"_lobbyJoinedEventListener");function get_each_context$e(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[10]=list[i],child_ctx}__name(get_each_context$e,"get_each_context$e");function create_each_block$e(ctx){let div,b,t0_value=ctx[10].boundTo+"",t0,t1,select,option0,t2,option0_selected_value,option1,t3,option1_selected_value,option2,t4,option2_selected_value,option3,t5,option3_selected_value,t6,mounted,dispose;function change_handler(...args){return ctx[9](ctx[10],...args)}return __name(change_handler,"change_handler"),{c(){div=element$1("div"),b=element$1("b"),t0=text(t0_value),t1=space(),select=element$1("select"),option0=element$1("option"),t2=text("Debug"),option1=element$1("option"),t3=text("Information"),option2=element$1("option"),t4=text("Warn"),option3=element$1("option"),t5=text("Error"),t6=space(),option0.__value="debug",set_input_value(option0,option0.__value),option0.selected=option0_selected_value=ctx[10].level==="debug",option1.__value="info",set_input_value(option1,option1.__value),option1.selected=option1_selected_value=ctx[10].level==="info",option2.__value="warn",set_input_value(option2,option2.__value),option2.selected=option2_selected_value=ctx[10].level==="warn",option3.__value="error",set_input_value(option3,option3.__value),option3.selected=option3_selected_value=ctx[10].level==="error",attr(div,"class","typo-logs-logger svelte-oun24t"),toggle_class(div,"hidden",!ctx[10].boundTo.toLowerCase().includes(ctx[3].toLowerCase()))},m(target,anchor){insert(target,div,anchor),append(div,b),append(b,t0),append(div,t1),append(div,select),append(select,option0),append(option0,t2),append(select,option1),append(option1,t3),append(select,option2),append(option2,t4),append(select,option3),append(option3,t5),append(div,t6),mounted||(dispose=listen(select,"change",change_handler),mounted=!0)},p(new_ctx,dirty){ctx=new_ctx,dirty&4&&t0_value!==(t0_value=ctx[10].boundTo+"")&&set_data(t0,t0_value),dirty&4&&option0_selected_value!==(option0_selected_value=ctx[10].level==="debug")&&(option0.selected=option0_selected_value),dirty&4&&option1_selected_value!==(option1_selected_value=ctx[10].level==="info")&&(option1.selected=option1_selected_value),dirty&4&&option2_selected_value!==(option2_selected_value=ctx[10].level==="warn")&&(option2.selected=option2_selected_value),dirty&4&&option3_selected_value!==(option3_selected_value=ctx[10].level==="error")&&(option3.selected=option3_selected_value),dirty&12&&toggle_class(div,"hidden",!ctx[10].boundTo.toLowerCase().includes(ctx[3].toLowerCase()))},d(detaching){detaching&&detach(div),mounted=!1,dispose()}}}__name(create_each_block$e,"create_each_block$e");function create_fragment$n(ctx){let h30,t1,div0,flatbutton0,t2,flatbutton1,t3,h31,t5,div1,select,option0,option1,option2,option3,t10,flatbutton2,t11,h32,t13,div2,input,t14,div3,current,mounted,dispose;flatbutton0=new Flat_button({props:{content:"Copy logs text",color:"blue"}}),flatbutton0.$on("click",ctx[4]),flatbutton1=new Flat_button({props:{content:"Copy logs JSON",color:"blue"}}),flatbutton1.$on("click",ctx[5]),flatbutton2=new Flat_button({props:{content:"Reset to selection",color:"orange"}}),flatbutton2.$on("click",ctx[7]);let each_value=ensure_array_like(ctx[2]),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$e(get_each_context$e(ctx,each_value,i));return{c(){h30=element$1("h3"),h30.textContent="Export Logs",t1=space(),div0=element$1("div"),create_component(flatbutton0.$$.fragment),t2=space(),create_component(flatbutton1.$$.fragment),t3=space(),h31=element$1("h3"),h31.textContent="Reset Log Level",t5=space(),div1=element$1("div"),select=element$1("select"),option0=element$1("option"),option0.textContent="Debug",option1=element$1("option"),option1.textContent="Information",option2=element$1("option"),option2.textContent="Warn",option3=element$1("option"),option3.textContent="Error",t10=space(),create_component(flatbutton2.$$.fragment),t11=space(),h32=element$1("h3"),h32.textContent="Customize Log Level",t13=space(),div2=element$1("div"),input=element$1("input"),t14=space(),div3=element$1("div");for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();attr(div0,"class","typo-logs-export svelte-oun24t"),option0.__value="debug",set_input_value(option0,option0.__value),option1.__value="info",set_input_value(option1,option1.__value),option2.__value="warn",set_input_value(option2,option2.__value),option3.__value="error",set_input_value(option3,option3.__value),set_style(select,"width","auto"),attr(div1,"class","typo-logs-overwrite svelte-oun24t"),set_style(input,"max-width","20rem"),attr(input,"type","text"),attr(input,"placeholder","Filter loggers"),attr(div2,"class","typo-logs-logger-list svelte-oun24t"),attr(div3,"class","typo-logs-logger-list svelte-oun24t")},m(target,anchor){insert(target,h30,anchor),insert(target,t1,anchor),insert(target,div0,anchor),mount_component(flatbutton0,div0,null),append(div0,t2),mount_component(flatbutton1,div0,null),insert(target,t3,anchor),insert(target,h31,anchor),insert(target,t5,anchor),insert(target,div1,anchor),append(div1,select),append(select,option0),append(select,option1),append(select,option2),append(select,option3),ctx[6](select),append(div1,t10),mount_component(flatbutton2,div1,null),insert(target,t11,anchor),insert(target,h32,anchor),insert(target,t13,anchor),insert(target,div2,anchor),append(div2,input),set_input_value(input,ctx[3]),insert(target,t14,anchor),insert(target,div3,anchor);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div3,null);current=!0,mounted||(dispose=listen(input,"input",ctx[8]),mounted=!0)},p(ctx2,[dirty]){if(dirty&8&&input.value!==ctx2[3]&&set_input_value(input,ctx2[3]),dirty&13){each_value=ensure_array_like(ctx2[2]);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$e(ctx2,each_value,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block$e(child_ctx),each_blocks[i].c(),each_blocks[i].m(div3,null))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value.length}},i(local){current||(transition_in(flatbutton0.$$.fragment,local),transition_in(flatbutton1.$$.fragment,local),transition_in(flatbutton2.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton0.$$.fragment,local),transition_out(flatbutton1.$$.fragment,local),transition_out(flatbutton2.$$.fragment,local),current=!1},d(detaching){detaching&&(detach(h30),detach(t1),detach(div0),detach(t3),detach(h31),detach(t5),detach(div1),detach(t11),detach(h32),detach(t13),detach(div2),detach(t14),detach(div3)),destroy_component(flatbutton0),destroy_component(flatbutton1),ctx[6](null),destroy_component(flatbutton2),destroy_each(each_blocks,detaching),mounted=!1,dispose()}}}__name(create_fragment$n,"create_fragment$n");function instance$m($$self,$$props,$$invalidate){let{feature}=$$props,resetAll,loggers=feature.loggers,loggerFilter="";const click_handler2=__name(()=>feature.copyLogsToClipboard(!1),"click_handler"),click_handler_1=__name(()=>feature.copyLogsToClipboard(!0),"click_handler_1");function select_binding($$value){binding_callbacks[$$value?"unshift":"push"](()=>{resetAll=$$value,$$invalidate(1,resetAll)})}__name(select_binding,"select_binding");const click_handler_2=__name(async()=>{await feature.resetAllLogLevels(resetAll.value),$$invalidate(2,loggers=feature.loggers)},"click_handler_2");function input_input_handler(){loggerFilter=this.value,$$invalidate(3,loggerFilter)}__name(input_input_handler,"input_input_handler");const change_handler=__name((logger,e)=>feature.setLogLevelOfLogger(logger,e.currentTarget.value),"change_handler");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},[feature,resetAll,loggers,loggerFilter,click_handler2,click_handler_1,select_binding,click_handler_2,input_input_handler,change_handler]}__name(instance$m,"instance$m");const _Logging_manage=class _Logging_manage extends SvelteComponent{constructor(options){super(),init(this,options,instance$m,create_fragment$n,safe_not_equal,{feature:0})}};__name(_Logging_manage,"Logging_manage");let Logging_manage=_Logging_manage;function create_fragment$m(ctx){let t0,br0,t1,br1,t2,br2,t3,br3,t4;return{c(){t0=text("Logging collects debug data from events of all parts of the typo extension."),br0=element$1("br"),t1=text(`
In case of bugs or unexpected behavior, this data can be used to identify the cause of issues.`),br1=element$1("br"),t2=space(),br2=element$1("br"),t3=text(`
To filter out irrelevant events, the log level of each instance can be adjusted.`),br3=element$1("br"),t4=text(`
Log level is stored permanently in the extension settings across reloads; existing logs are not affected by log level changes.`)},m(target,anchor){insert(target,t0,anchor),insert(target,br0,anchor),insert(target,t1,anchor),insert(target,br1,anchor),insert(target,t2,anchor),insert(target,br2,anchor),insert(target,t3,anchor),insert(target,br3,anchor),insert(target,t4,anchor)},p:noop$1,i:noop$1,o:noop$1,d(detaching){detaching&&(detach(t0),detach(br0),detach(t1),detach(br1),detach(t2),detach(br2),detach(t3),detach(br3),detach(t4))}}}__name(create_fragment$m,"create_fragment$m");const _Logging_info=class _Logging_info extends SvelteComponent{constructor(options){super(),init(this,options,null,create_fragment$m,safe_not_equal,{})}};__name(_Logging_info,"Logging_info");let Logging_info=_Logging_info;var __defProp$o=Object.defineProperty,__decorateClass$o=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$o(target,key,result),result},"__decorateClass$o");const _LoggingFeature=class _LoggingFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"name","Logging");__publicField(this,"description","Collect logs of services, features, setups and event processors.");__publicField(this,"featureId",24);__publicField(this,"toggleEnabled",!1);__publicField(this,"developerFeature",!0);__publicField(this,"_loggingService");__publicField(this,"_toastService")}get featureManagementComponent(){return{componentType:Logging_manage,props:{feature:this}}}get featureInfoComponent(){return{componentType:Logging_info,props:{}}}postConstruct(){this.useSetting(this._loggingService.printEnabledSetting)}get loggers(){return this._loggingService.loggers}async copyLogsToClipboard(asJson){const logs=this._loggingService.recordedEvents,logsText=asJson?JSON.stringify(logs):logs.map(event=>`[${event.date.toISOString()}] [${event.logLevel}] (${event.bindingName}) ${event.message} ${event.data.join(", ")}`).join(`
`);await navigator.clipboard.writeText(logsText),await this._toastService.showToast("Logs copied to clipboard")}async setLogLevelOfLogger(logger,level){if(level!=="debug"&&level!=="info"&&level!=="warn"&&level!=="error"){await this._toastService.showToast("Invalid log level");return}try{await this._loggingService.getLogLevelSetting(logger).setValue(level)}catch(e){this._logger.error("Error updating log level",e),await this._toastService.showToast("Error updating log level");return}await this._toastService.showToast("Updated Logger",`Log level of ${logger.boundTo} set to ${level}`)}async resetAllLogLevels(level){if(level!=="debug"&&level!=="info"&&level!=="warn"&&level!=="error"){await this._toastService.showToast("Invalid log level");return}const toast=await this._toastService.showLoadingToast("Resetting log levels to "+level),promises=this._loggingService.loggers.map(logger=>this._loggingService.getLogLevelSetting(logger).setValue(level));try{await Promise.all(promises)}catch(e){this._logger.error("Error resetting log level to "+level,e),toast.reject("Error resetting log levels");return}toast.resolve()}};__name(_LoggingFeature,"LoggingFeature");let LoggingFeature=_LoggingFeature;__decorateClass$o([inject(LoggingService)],LoggingFeature.prototype,"_loggingService");__decorateClass$o([inject(ToastService)],LoggingFeature.prototype,"_toastService");function get_each_context$d(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[15]=list[i],child_ctx[17]=i,child_ctx}__name(get_each_context$d,"get_each_context$d");function get_each_context_1$2(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[15]=list[i],child_ctx[17]=i,child_ctx}__name(get_each_context_1$2,"get_each_context_1$2");function create_else_block$6(ctx){let div1,div0,t0,t1,if_block=ctx[5]&&create_if_block_3$1(ctx),each_value_1=ensure_array_like({length:ctx[4].memberData.slots.unlockedSlots}),each_blocks_1=[];for(let i=0;i<each_value_1.length;i+=1)each_blocks_1[i]=create_each_block_1$2(get_each_context_1$2(ctx,each_value_1,i));let each_value=ensure_array_like({length:Math.max(9-ctx[4].memberData.slots.unlockedSlots,3-ctx[4].memberData.slots.unlockedSlots%3)}),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$d(get_each_context$d(ctx,each_value,i));return{c(){div1=element$1("div"),div0=element$1("div"),if_block&&if_block.c(),t0=space();for(let i=0;i<each_blocks_1.length;i+=1)each_blocks_1[i].c();t1=space();for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();attr(div0,"class","typo-cabin-picker svelte-10x5c2g"),attr(div1,"class","typo-cabin-scroll svelte-10x5c2g")},m(target,anchor){insert(target,div1,anchor),append(div1,div0),if_block&&if_block.m(div0,null),append(div0,t0);for(let i=0;i<each_blocks_1.length;i+=1)each_blocks_1[i]&&each_blocks_1[i].m(div0,null);append(div0,t1);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div0,null)},p(ctx2,dirty){if(ctx2[5]?if_block?if_block.p(ctx2,dirty):(if_block=create_if_block_3$1(ctx2),if_block.c(),if_block.m(div0,t0)):if_block&&(if_block.d(1),if_block=null),dirty&31){each_value_1=ensure_array_like({length:ctx2[4].memberData.slots.unlockedSlots});let i;for(i=0;i<each_value_1.length;i+=1){const child_ctx=get_each_context_1$2(ctx2,each_value_1,i);each_blocks_1[i]?each_blocks_1[i].p(child_ctx,dirty):(each_blocks_1[i]=create_each_block_1$2(child_ctx),each_blocks_1[i].c(),each_blocks_1[i].m(div0,t1))}for(;i<each_blocks_1.length;i+=1)each_blocks_1[i].d(1);each_blocks_1.length=each_value_1.length}if(dirty&16){each_value=ensure_array_like({length:Math.max(9-ctx2[4].memberData.slots.unlockedSlots,3-ctx2[4].memberData.slots.unlockedSlots%3)});let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$d(ctx2,each_value,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block$d(child_ctx),each_blocks[i].c(),each_blocks[i].m(div0,null))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value.length}},i:noop$1,o:noop$1,d(detaching){detaching&&detach(div1),if_block&&if_block.d(),destroy_each(each_blocks_1,detaching),destroy_each(each_blocks,detaching)}}}__name(create_else_block$6,"create_else_block$6");function create_if_block_1$6(ctx){let div;return{c(){div=element$1("div"),div.textContent="You need to log in to use sprites."},m(target,anchor){insert(target,div,anchor)},p:noop$1,i:noop$1,o:noop$1,d(detaching){detaching&&detach(div)}}}__name(create_if_block_1$6,"create_if_block_1$6");function create_if_block$b(ctx){let bounceload,current;return bounceload=new Bounceload({props:{content:"Loading inventory.."}}),{c(){create_component(bounceload.$$.fragment)},m(target,anchor){mount_component(bounceload,target,anchor),current=!0},p:noop$1,i(local){current||(transition_in(bounceload.$$.fragment,local),current=!0)},o(local){transition_out(bounceload.$$.fragment,local),current=!1},d(detaching){destroy_component(bounceload,detaching)}}}__name(create_if_block$b,"create_if_block$b");function create_if_block_3$1(ctx){let div,mounted,dispose;function select_block_type_1(ctx2,dirty){return ctx2[4].scene&&ctx2[4].scene.scene?create_if_block_4$1:create_else_block_2}__name(select_block_type_1,"select_block_type_1");let current_block_type=select_block_type_1(ctx),if_block=current_block_type(ctx);return{c(){div=element$1("div"),if_block.c(),attr(div,"class","typo-cabin-scene svelte-10x5c2g")},m(target,anchor){insert(target,div,anchor),if_block.m(div,null),mounted||(dispose=[listen(div,"click",ctx[8]),listen(div,"contextmenu",ctx[9])],mounted=!0)},p(ctx2,dirty){current_block_type===(current_block_type=select_block_type_1(ctx2))&&if_block?if_block.p(ctx2,dirty):(if_block.d(1),if_block=current_block_type(ctx2),if_block&&(if_block.c(),if_block.m(div,null)))},d(detaching){detaching&&detach(div),if_block.d(),mounted=!1,run_all(dispose)}}}__name(create_if_block_3$1,"create_if_block_3$1");function create_else_block_2(ctx){let div;return{c(){div=element$1("div"),div.textContent="No scene selected",attr(div,"class","typo-cabin-scene-info visible svelte-10x5c2g")},m(target,anchor){insert(target,div,anchor)},p:noop$1,d(detaching){detaching&&detach(div)}}}__name(create_else_block_2,"create_else_block_2");function create_if_block_4$1(ctx){let div0,t0_value=ctx[4].scene.scene.name+"",t0,t1,t2_value=ctx[4].scene.scene.id+"",t2,t3,t4,div1;return{c(){div0=element$1("div"),t0=text(t0_value),t1=text(" (#"),t2=text(t2_value),t3=text(")"),t4=space(),div1=element$1("div"),attr(div0,"class","typo-cabin-scene-info svelte-10x5c2g"),attr(div1,"class","typo-cabin-scene-thumb svelte-10x5c2g"),set_style(div1,"background-image","url("+ctx[0].getItemThumbnailUrl(ctx[4].scene.scene,ctx[4].scene.shift)+")")},m(target,anchor){insert(target,div0,anchor),append(div0,t0),append(div0,t1),append(div0,t2),append(div0,t3),insert(target,t4,anchor),insert(target,div1,anchor)},p(ctx2,dirty){dirty&16&&t0_value!==(t0_value=ctx2[4].scene.scene.name+"")&&set_data(t0,t0_value),dirty&16&&t2_value!==(t2_value=ctx2[4].scene.scene.id+"")&&set_data(t2,t2_value),dirty&17&&set_style(div1,"background-image","url("+ctx2[0].getItemThumbnailUrl(ctx2[4].scene.scene,ctx2[4].scene.shift)+")")},d(detaching){detaching&&(detach(div0),detach(t4),detach(div1))}}}__name(create_if_block_4$1,"create_if_block_4$1");function create_else_block_1(ctx){let div0,t2,div1;return{c(){div0=element$1("div"),div0.textContent=`Slot #${ctx[17]+1}`,t2=space(),div1=element$1("div"),div1.textContent="Empty",attr(div0,"class","typo-cabin-slot-info visible svelte-10x5c2g"),attr(div1,"class","typo-cabin-slot-info visible svelte-10x5c2g")},m(target,anchor){insert(target,div0,anchor),insert(target,t2,anchor),insert(target,div1,anchor)},p:noop$1,d(detaching){detaching&&(detach(div0),detach(t2),detach(div1))}}}__name(create_else_block_1,"create_else_block_1");function create_if_block_2$3(ctx){var _a81,_b,_c;let div0,t2,div1,t3_value=(((_b=(_a81=ctx[4].slots.get(ctx[17]))==null?void 0:_a81.sprite)==null?void 0:_b.name)??"Unknown")+"",t3,t4,t5_value=((_c=ctx[4].slots.get(ctx[17]))==null?void 0:_c.spriteId)+"",t5,t6,t7,div2;return{c(){var _a82,_b2;div0=element$1("div"),div0.textContent=`Slot #${ctx[17]+1}`,t2=space(),div1=element$1("div"),t3=text(t3_value),t4=text(`
              (#`),t5=text(t5_value),t6=text(")"),t7=space(),div2=element$1("div"),attr(div0,"class","typo-cabin-slot-info svelte-10x5c2g"),attr(div1,"class","typo-cabin-slot-info svelte-10x5c2g"),attr(div2,"class","typo-cabin-slot-thumb svelte-10x5c2g"),set_style(div2,"background-image","url("+ctx[0].getItemThumbnailUrl((_a82=ctx[4].slots.get(ctx[17]))==null?void 0:_a82.sprite,(_b2=ctx[4].slots.get(ctx[17]))==null?void 0:_b2.colorShift)+")")},m(target,anchor){insert(target,div0,anchor),insert(target,t2,anchor),insert(target,div1,anchor),append(div1,t3),append(div1,t4),append(div1,t5),append(div1,t6),insert(target,t7,anchor),insert(target,div2,anchor)},p(ctx2,dirty){var _a82,_b2,_c2,_d,_e;dirty&16&&t3_value!==(t3_value=(((_b2=(_a82=ctx2[4].slots.get(ctx2[17]))==null?void 0:_a82.sprite)==null?void 0:_b2.name)??"Unknown")+"")&&set_data(t3,t3_value),dirty&16&&t5_value!==(t5_value=((_c2=ctx2[4].slots.get(ctx2[17]))==null?void 0:_c2.spriteId)+"")&&set_data(t5,t5_value),dirty&17&&set_style(div2,"background-image","url("+ctx2[0].getItemThumbnailUrl((_d=ctx2[4].slots.get(ctx2[17]))==null?void 0:_d.sprite,(_e=ctx2[4].slots.get(ctx2[17]))==null?void 0:_e.colorShift)+")")},d(detaching){detaching&&(detach(div0),detach(t2),detach(div1),detach(t7),detach(div2))}}}__name(create_if_block_2$3,"create_if_block_2$3");function create_each_block_1$2(ctx){let div,show_if,t,mounted,dispose;function select_block_type_2(ctx2,dirty){return dirty&16&&(show_if=null),show_if==null&&(show_if=!!ctx2[4].slots.has(ctx2[17])),show_if?create_if_block_2$3:create_else_block_1}__name(select_block_type_2,"select_block_type_2");let current_block_type=select_block_type_2(ctx,-1),if_block=current_block_type(ctx);function dragenter_handler(...args){return ctx[10](ctx[17],...args)}__name(dragenter_handler,"dragenter_handler");function dragstart_handler(){return ctx[11](ctx[17])}__name(dragstart_handler,"dragstart_handler");function click_handler_1(){return ctx[13](ctx[17])}__name(click_handler_1,"click_handler_1");function contextmenu_handler_1(...args){return ctx[14](ctx[17],...args)}return __name(contextmenu_handler_1,"contextmenu_handler_1"),{c(){div=element$1("div"),if_block.c(),t=space(),attr(div,"class","typo-cabin-slot svelte-10x5c2g"),attr(div,"role","gridcell"),attr(div,"tabindex",ctx[17]),attr(div,"draggable","true"),set_style(div,"order",ctx[2]?ctx[2][ctx[17]]:ctx[17]),toggle_class(div,"dragging",ctx[1]!==void 0)},m(target,anchor){insert(target,div,anchor),if_block.m(div,null),append(div,t),mounted||(dispose=[listen(div,"dragenter",dragenter_handler),listen(div,"dragstart",dragstart_handler),listen(div,"dragend",ctx[12]),listen(div,"click",click_handler_1),listen(div,"contextmenu",contextmenu_handler_1)],mounted=!0)},p(new_ctx,dirty){ctx=new_ctx,current_block_type===(current_block_type=select_block_type_2(ctx,dirty))&&if_block?if_block.p(ctx,dirty):(if_block.d(1),if_block=current_block_type(ctx),if_block&&(if_block.c(),if_block.m(div,t))),dirty&4&&set_style(div,"order",ctx[2]?ctx[2][ctx[17]]:ctx[17]),dirty&2&&toggle_class(div,"dragging",ctx[1]!==void 0)},d(detaching){detaching&&detach(div),if_block.d(),mounted=!1,run_all(dispose)}}}__name(create_each_block_1$2,"create_each_block_1$2");function create_each_block$d(ctx){let div2,div0,t0,t1_value=ctx[17]+ctx[4].memberData.slots.unlockedSlots+1+"",t1,t2,div1,t4;return{c(){div2=element$1("div"),div0=element$1("div"),t0=text("Slot #"),t1=text(t1_value),t2=space(),div1=element$1("div"),div1.textContent="Locked",t4=space(),attr(div0,"class","typo-cabin-slot-info svelte-10x5c2g"),attr(div1,"class","typo-cabin-slot-info svelte-10x5c2g"),attr(div2,"class","typo-cabin-slot locked svelte-10x5c2g"),set_style(div2,"order",ctx[17]+ctx[4].memberData.slots.unlockedSlots+1)},m(target,anchor){insert(target,div2,anchor),append(div2,div0),append(div0,t0),append(div0,t1),append(div2,t2),append(div2,div1),append(div2,t4)},p(ctx2,dirty){dirty&16&&t1_value!==(t1_value=ctx2[17]+ctx2[4].memberData.slots.unlockedSlots+1+"")&&set_data(t1,t1_value),dirty&16&&set_style(div2,"order",ctx2[17]+ctx2[4].memberData.slots.unlockedSlots+1)},d(detaching){detaching&&detach(div2)}}}__name(create_each_block$d,"create_each_block$d");function create_fragment$l(ctx){let div1,div0,bounceload,t,current_block_type_index,if_block,current;bounceload=new Bounceload({props:{content:"Saving.."}});const if_block_creators=[create_if_block$b,create_if_block_1$6,create_else_block$6],if_blocks=[];function select_block_type(ctx2,dirty){return ctx2[4]===void 0?0:ctx2[4]===null?1:2}return __name(select_block_type,"select_block_type"),current_block_type_index=select_block_type(ctx),if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx),{c(){div1=element$1("div"),div0=element$1("div"),create_component(bounceload.$$.fragment),t=space(),if_block.c(),attr(div0,"class","typo-cabin-saving svelte-10x5c2g"),attr(div1,"class","typo-cabin svelte-10x5c2g"),toggle_class(div1,"loading",ctx[3])},m(target,anchor){insert(target,div1,anchor),append(div1,div0),mount_component(bounceload,div0,null),append(div1,t),if_blocks[current_block_type_index].m(div1,null),current=!0},p(ctx2,[dirty]){let previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx2),current_block_type_index===previous_block_index?if_blocks[current_block_type_index].p(ctx2,dirty):(group_outros(),transition_out(if_blocks[previous_block_index],1,1,()=>{if_blocks[previous_block_index]=null}),check_outros(),if_block=if_blocks[current_block_type_index],if_block?if_block.p(ctx2,dirty):(if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx2),if_block.c()),transition_in(if_block,1),if_block.m(div1,null)),(!current||dirty&8)&&toggle_class(div1,"loading",ctx2[3])},i(local){current||(transition_in(bounceload.$$.fragment,local),transition_in(if_block),current=!0)},o(local){transition_out(bounceload.$$.fragment,local),transition_out(if_block),current=!1},d(detaching){detaching&&detach(div1),destroy_component(bounceload),if_blocks[current_block_type_index].d()}}}__name(create_fragment$l,"create_fragment$l");function instance$l($$self,$$props,$$invalidate){let $memberStore,$scenePickerEnabled,{feature}=$$props;const memberStore=feature.memberStore;component_subscribe($$self,memberStore,value=>$$invalidate(4,$memberStore=value));const scenePickerEnabled=feature.scenePickerSettingStore;component_subscribe($$self,scenePickerEnabled,value=>$$invalidate(5,$scenePickerEnabled=value));let dndTargetSlot,dndTrack,loading=!1;const click_handler2=__name(async()=>{const scene=await feature.promptSceneSelection($memberStore.memberData.sceneInventory);scene!==void 0&&($$invalidate(3,loading=!0),await feature.setScene((scene==null?void 0:scene.scene)??null,scene==null?void 0:scene.shift,$memberStore.memberData.member.userLogin),$$invalidate(3,loading=!1))},"click_handler"),contextmenu_handler2=__name(async event=>{event.preventDefault(),$$invalidate(3,loading=!0),await feature.setScene(null,void 0,$memberStore.memberData.member.userLogin),$$invalidate(3,loading=!1)},"contextmenu_handler"),dragenter_handler=__name((slot,event)=>{if(dndTargetSlot===slot||dndTrack===void 0||dndTargetSlot===void 0)return;const newTrack=[...Array($memberStore.memberData.slots.unlockedSlots).keys()];for(let i=0;i<dndTrack.length;i++)i>=slot&&i<dndTargetSlot&&(newTrack[i]=i+1),i<=slot&&i>dndTargetSlot&&(newTrack[i]=i-1);newTrack[dndTargetSlot]=dndTrack[slot],$$invalidate(2,dndTrack=newTrack)},"dragenter_handler"),dragstart_handler=__name(slot=>{$$invalidate(1,dndTargetSlot=slot),$$invalidate(2,dndTrack=[...Array($memberStore.memberData.slots.unlockedSlots).keys()])},"dragstart_handler"),dragend_handler=__name(async()=>{$$invalidate(3,loading=!0),await feature.reorderSlots(dndTrack,$memberStore.memberData.spriteInventory,Number($memberStore.memberData.member.userLogin)),$$invalidate(1,dndTargetSlot=void 0),$$invalidate(2,dndTrack=void 0),$$invalidate(3,loading=!1)},"dragend_handler"),click_handler_1=__name(async slot=>{const sprite=await feature.promptSpriteSelection($memberStore.memberData.spriteInventory);sprite!==void 0&&($$invalidate(3,loading=!0),await feature.setSpriteOnSlot(slot+1,sprite,$memberStore.memberData.member.userLogin),$$invalidate(3,loading=!1))},"click_handler_1"),contextmenu_handler_1=__name(async(slot,event)=>{event.preventDefault(),$$invalidate(3,loading=!0),await feature.setSpriteOnSlot(slot+1,null,$memberStore.memberData.member.userLogin),$$invalidate(3,loading=!1)},"contextmenu_handler_1");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},[feature,dndTargetSlot,dndTrack,loading,$memberStore,$scenePickerEnabled,memberStore,scenePickerEnabled,click_handler2,contextmenu_handler2,dragenter_handler,dragstart_handler,dragend_handler,click_handler_1,contextmenu_handler_1]}__name(instance$l,"instance$l");const _Panel_cabin=class _Panel_cabin extends SvelteComponent{constructor(options){super(),init(this,options,instance$l,create_fragment$l,safe_not_equal,{feature:0})}};__name(_Panel_cabin,"Panel_cabin");let Panel_cabin=_Panel_cabin;function get_each_context$c(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[7]=list[i],child_ctx}__name(get_each_context$c,"get_each_context$c");function create_if_block$a(ctx){var _a81,_b;let div1,div0,t0,span0,t1,t2_value=((_a81=ctx[2].get(ctx[7].spriteId))==null?void 0:_a81.id)+"",t2,t3,span1,t4_value=((_b=ctx[2].get(ctx[7].spriteId))==null?void 0:_b.name)+"",t4,t5,mounted,dispose;function click_handler_1(){return ctx[6](ctx[7])}return __name(click_handler_1,"click_handler_1"),{c(){var _a82;div1=element$1("div"),div0=element$1("div"),t0=space(),span0=element$1("span"),t1=text("#"),t2=text(t2_value),t3=space(),span1=element$1("span"),t4=text(t4_value),t5=space(),attr(div0,"class","typo-scene-picker-scene-thumb svelte-1mybs9w"),set_style(div0,"background-image","url("+((_a82=ctx[2].get(ctx[7].spriteId))==null?void 0:_a82.url)+")"),attr(span0,"class","svelte-1mybs9w"),attr(span1,"class","svelte-1mybs9w"),attr(div1,"class","typo-scene-picker-scene svelte-1mybs9w"),set_style(div1,"order",ctx[7].spriteId)},m(target,anchor){insert(target,div1,anchor),append(div1,div0),append(div1,t0),append(div1,span0),append(span0,t1),append(span0,t2),append(div1,t3),append(div1,span1),append(span1,t4),append(div1,t5),mounted||(dispose=listen(div1,"click",click_handler_1),mounted=!0)},p(new_ctx,dirty){var _a82,_b2,_c;ctx=new_ctx,dirty&6&&set_style(div0,"background-image","url("+((_a82=ctx[2].get(ctx[7].spriteId))==null?void 0:_a82.url)+")"),dirty&6&&t2_value!==(t2_value=((_b2=ctx[2].get(ctx[7].spriteId))==null?void 0:_b2.id)+"")&&set_data(t2,t2_value),dirty&6&&t4_value!==(t4_value=((_c=ctx[2].get(ctx[7].spriteId))==null?void 0:_c.name)+"")&&set_data(t4,t4_value),dirty&2&&set_style(div1,"order",ctx[7].spriteId)},d(detaching){detaching&&detach(div1),mounted=!1,dispose()}}}__name(create_if_block$a,"create_if_block$a");function create_each_block$c(ctx){let if_block_anchor,if_block=ctx[7].slot===void 0&&create_if_block$a(ctx);return{c(){if_block&&if_block.c(),if_block_anchor=empty()},m(target,anchor){if_block&&if_block.m(target,anchor),insert(target,if_block_anchor,anchor)},p(ctx2,dirty){ctx2[7].slot===void 0?if_block?if_block.p(ctx2,dirty):(if_block=create_if_block$a(ctx2),if_block.c(),if_block.m(if_block_anchor.parentNode,if_block_anchor)):if_block&&(if_block.d(1),if_block=null)},d(detaching){detaching&&detach(if_block_anchor),if_block&&if_block.d(detaching)}}}__name(create_each_block$c,"create_each_block$c");function create_fragment$k(ctx){let div3,span0,t2,div2,div1,t5,mounted,dispose,each_value=ensure_array_like(ctx[1]),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$c(get_each_context$c(ctx,each_value,i));return{c(){div3=element$1("div"),span0=element$1("span"),span0.innerHTML=`Choose a sprite from your inventory which will be used on the selected slot.<br/>
    You can only choose sprites that are not already in use.`,t2=space(),div2=element$1("div"),div1=element$1("div"),div1.innerHTML='<div class="typo-scene-picker-scene-thumb svelte-1mybs9w"></div> <span class="svelte-1mybs9w">Empty</span>',t5=space();for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();attr(span0,"class","svelte-1mybs9w"),attr(div1,"class","typo-scene-picker-scene svelte-1mybs9w"),attr(div2,"class","typo-scene-picker-list color-scrollbar svelte-1mybs9w"),attr(div3,"class","typo-scene-picker svelte-1mybs9w")},m(target,anchor){insert(target,div3,anchor),append(div3,span0),append(div3,t2),append(div3,div2),append(div2,div1),append(div2,t5);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div2,null);mounted||(dispose=listen(div1,"click",ctx[5]),mounted=!0)},p(ctx2,[dirty]){if(dirty&7){each_value=ensure_array_like(ctx2[1]);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$c(ctx2,each_value,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block$c(child_ctx),each_blocks[i].c(),each_blocks[i].m(div2,null))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value.length}},i:noop$1,o:noop$1,d(detaching){detaching&&detach(div3),destroy_each(each_blocks,detaching),mounted=!1,dispose()}}}__name(create_fragment$k,"create_fragment$k");function instance$k($$self,$$props,$$invalidate){let{feature}=$$props,{onPick}=$$props,{sprites}=$$props,{inventory}=$$props,spritesMap=new Map;const click_handler2=__name(()=>onPick(null),"click_handler"),click_handler_1=__name(sprite=>onPick(spritesMap.get(sprite.spriteId)),"click_handler_1");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(3,feature=$$props2.feature),"onPick"in $$props2&&$$invalidate(0,onPick=$$props2.onPick),"sprites"in $$props2&&$$invalidate(4,sprites=$$props2.sprites),"inventory"in $$props2&&$$invalidate(1,inventory=$$props2.inventory)},$$self.$$.update=()=>{$$self.$$.dirty&16&&$$invalidate(2,spritesMap=new Map(sprites.map(sprite=>[sprite.id,sprite])))},[onPick,inventory,spritesMap,feature,sprites,click_handler2,click_handler_1]}__name(instance$k,"instance$k");const _Panel_cabin_sprite_picker=class _Panel_cabin_sprite_picker extends SvelteComponent{constructor(options){super(),init(this,options,instance$k,create_fragment$k,safe_not_equal,{feature:3,onPick:0,sprites:4,inventory:1})}};__name(_Panel_cabin_sprite_picker,"Panel_cabin_sprite_picker");let Panel_cabin_sprite_picker=_Panel_cabin_sprite_picker;function get_each_context$b(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[9]=list[i],child_ctx}__name(get_each_context$b,"get_each_context$b");function create_else_block$5(ctx){var _a81,_b;let div1,div0,t0,span0,t1,t2_value=((_a81=ctx[3].get(ctx[9].sceneId))==null?void 0:_a81.id)+"",t2,t3,span1,t4_value=((_b=ctx[3].get(ctx[9].sceneId))==null?void 0:_b.name)+"",t4,t5,mounted,dispose;function click_handler_2(){return ctx[8](ctx[9])}return __name(click_handler_2,"click_handler_2"),{c(){var _a82;div1=element$1("div"),div0=element$1("div"),t0=space(),span0=element$1("span"),t1=text("#"),t2=text(t2_value),t3=space(),span1=element$1("span"),t4=text(t4_value),t5=space(),attr(div0,"class","typo-scene-picker-scene-thumb svelte-y0mvh1"),set_style(div0,"background-image","url("+((_a82=ctx[3].get(ctx[9].sceneId))==null?void 0:_a82.url)+")"),attr(span0,"class","svelte-y0mvh1"),attr(span1,"class","svelte-y0mvh1"),attr(div1,"class","typo-scene-picker-scene svelte-y0mvh1"),set_style(div1,"order",ctx[9].sceneId)},m(target,anchor){insert(target,div1,anchor),append(div1,div0),append(div1,t0),append(div1,span0),append(span0,t1),append(span0,t2),append(div1,t3),append(div1,span1),append(span1,t4),append(div1,t5),mounted||(dispose=listen(div1,"click",click_handler_2),mounted=!0)},p(new_ctx,dirty){var _a82,_b2,_c;ctx=new_ctx,dirty&12&&set_style(div0,"background-image","url("+((_a82=ctx[3].get(ctx[9].sceneId))==null?void 0:_a82.url)+")"),dirty&12&&t2_value!==(t2_value=((_b2=ctx[3].get(ctx[9].sceneId))==null?void 0:_b2.id)+"")&&set_data(t2,t2_value),dirty&12&&t4_value!==(t4_value=((_c=ctx[3].get(ctx[9].sceneId))==null?void 0:_c.name)+"")&&set_data(t4,t4_value),dirty&4&&set_style(div1,"order",ctx[9].sceneId)},d(detaching){detaching&&detach(div1),mounted=!1,dispose()}}}__name(create_else_block$5,"create_else_block$5");function create_if_block$9(ctx){var _a81,_b,_c;let div1,div0,t0,span0,t1,t2_value=((_a81=ctx[3].get(ctx[9].sceneId))==null?void 0:_a81.id)+"",t2,t3,t4_value=ctx[9].sceneShift+"",t4,t5,span1,t6_value=((_c=(_b=ctx[3].get(ctx[9].sceneId))==null?void 0:_b.themes.find(func2))==null?void 0:_c.name)+"",t6,t7,mounted,dispose;function func2(...args){return ctx[6](ctx[9],...args)}__name(func2,"func");function click_handler_1(){return ctx[7](ctx[9])}return __name(click_handler_1,"click_handler_1"),{c(){div1=element$1("div"),div0=element$1("div"),t0=space(),span0=element$1("span"),t1=text("#"),t2=text(t2_value),t3=text(" / "),t4=text(t4_value),t5=space(),span1=element$1("span"),t6=text(t6_value),t7=space(),attr(div0,"class","typo-scene-picker-scene-thumb svelte-y0mvh1"),set_style(div0,"background-image","url("+ctx[0].getItemThumbnailUrl(ctx[3].get(ctx[9].sceneId),ctx[9].sceneShift)+")"),attr(span0,"class","svelte-y0mvh1"),attr(span1,"class","svelte-y0mvh1"),attr(div1,"class","typo-scene-picker-scene svelte-y0mvh1"),set_style(div1,"order",ctx[9].sceneId)},m(target,anchor){insert(target,div1,anchor),append(div1,div0),append(div1,t0),append(div1,span0),append(span0,t1),append(span0,t2),append(span0,t3),append(span0,t4),append(div1,t5),append(div1,span1),append(span1,t6),insert(target,t7,anchor),mounted||(dispose=listen(div1,"click",click_handler_1),mounted=!0)},p(new_ctx,dirty){var _a82,_b2,_c2;ctx=new_ctx,dirty&13&&set_style(div0,"background-image","url("+ctx[0].getItemThumbnailUrl(ctx[3].get(ctx[9].sceneId),ctx[9].sceneShift)+")"),dirty&12&&t2_value!==(t2_value=((_a82=ctx[3].get(ctx[9].sceneId))==null?void 0:_a82.id)+"")&&set_data(t2,t2_value),dirty&4&&t4_value!==(t4_value=ctx[9].sceneShift+"")&&set_data(t4,t4_value),dirty&12&&t6_value!==(t6_value=((_c2=(_b2=ctx[3].get(ctx[9].sceneId))==null?void 0:_b2.themes.find(func2))==null?void 0:_c2.name)+"")&&set_data(t6,t6_value),dirty&4&&set_style(div1,"order",ctx[9].sceneId)},d(detaching){detaching&&(detach(div1),detach(t7)),mounted=!1,dispose()}}}__name(create_if_block$9,"create_if_block$9");function create_each_block$b(ctx){let if_block_anchor;function select_block_type(ctx2,dirty){return ctx2[9].sceneShift?create_if_block$9:create_else_block$5}__name(select_block_type,"select_block_type");let current_block_type=select_block_type(ctx),if_block=current_block_type(ctx);return{c(){if_block.c(),if_block_anchor=empty()},m(target,anchor){if_block.m(target,anchor),insert(target,if_block_anchor,anchor)},p(ctx2,dirty){current_block_type===(current_block_type=select_block_type(ctx2))&&if_block?if_block.p(ctx2,dirty):(if_block.d(1),if_block=current_block_type(ctx2),if_block&&(if_block.c(),if_block.m(if_block_anchor.parentNode,if_block_anchor)))},d(detaching){detaching&&detach(if_block_anchor),if_block.d(detaching)}}}__name(create_each_block$b,"create_each_block$b");function create_fragment$j(ctx){let div3,span0,t1,div2,div1,t4,mounted,dispose,each_value=ensure_array_like(ctx[2].scenes),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$b(get_each_context$b(ctx,each_value,i));return{c(){div3=element$1("div"),span0=element$1("span"),span0.textContent="Choose a scene from your inventory which will be used as your avatar background.",t1=space(),div2=element$1("div"),div1=element$1("div"),div1.innerHTML='<div class="typo-scene-picker-scene-thumb svelte-y0mvh1"></div> <span class="svelte-y0mvh1">Empty</span>',t4=space();for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();attr(span0,"class","svelte-y0mvh1"),attr(div1,"class","typo-scene-picker-scene svelte-y0mvh1"),attr(div2,"class","typo-scene-picker-list color-scrollbar svelte-y0mvh1"),attr(div3,"class","typo-scene-picker svelte-y0mvh1")},m(target,anchor){insert(target,div3,anchor),append(div3,span0),append(div3,t1),append(div3,div2),append(div2,div1),append(div2,t4);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div2,null);mounted||(dispose=listen(div1,"click",ctx[5]),mounted=!0)},p(ctx2,[dirty]){if(dirty&15){each_value=ensure_array_like(ctx2[2].scenes);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$b(ctx2,each_value,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block$b(child_ctx),each_blocks[i].c(),each_blocks[i].m(div2,null))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value.length}},i:noop$1,o:noop$1,d(detaching){detaching&&detach(div3),destroy_each(each_blocks,detaching),mounted=!1,dispose()}}}__name(create_fragment$j,"create_fragment$j");function instance$j($$self,$$props,$$invalidate){let{feature}=$$props,{onPick}=$$props,{scenes}=$$props,{inventory}=$$props,scenesMap=new Map;const click_handler2=__name(()=>onPick(null,void 0),"click_handler"),func2=__name((scene,t)=>t.shift===scene.sceneShift,"func"),click_handler_1=__name(scene=>onPick(scenesMap.get(scene.sceneId),scene.sceneShift),"click_handler_1"),click_handler_2=__name(scene=>onPick(scenesMap.get(scene.sceneId),void 0),"click_handler_2");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature),"onPick"in $$props2&&$$invalidate(1,onPick=$$props2.onPick),"scenes"in $$props2&&$$invalidate(4,scenes=$$props2.scenes),"inventory"in $$props2&&$$invalidate(2,inventory=$$props2.inventory)},$$self.$$.update=()=>{$$self.$$.dirty&16&&$$invalidate(3,scenesMap=new Map(scenes.map(scene=>[scene.id,scene])))},[feature,onPick,inventory,scenesMap,scenes,click_handler2,func2,click_handler_1,click_handler_2]}__name(instance$j,"instance$j");const _Panel_cabin_scene_picker=class _Panel_cabin_scene_picker extends SvelteComponent{constructor(options){super(),init(this,options,instance$j,create_fragment$j,safe_not_equal,{feature:0,onPick:1,scenes:4,inventory:2})}};__name(_Panel_cabin_scene_picker,"Panel_cabin_scene_picker");let Panel_cabin_scene_picker=_Panel_cabin_scene_picker;var __defProp$n=Object.defineProperty,__decorateClass$n=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$n(target,key,result),result},"__decorateClass$n");const _PanelCabinFeature=class _PanelCabinFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elements");__publicField(this,"_apiDataSetup");__publicField(this,"_memberService");__publicField(this,"_apiService");__publicField(this,"_modalService");__publicField(this,"_toastService");__publicField(this,"_component");__publicField(this,"name","Outfit Cabin");__publicField(this,"description","Displays a drag-n-drop interface on the start page to customize your sprite combo");__publicField(this,"featureId",3);__publicField(this,"_enableScenePickerSetting",this.useSetting(new BooleanExtensionSetting("enable_scene_picker",!0,this).withName("Enable Scene Picker").withDescription("Show the scene picker at the top of the sprite cabin")))}async onActivate(){const elements2=await this._elements.complete();this._component=new Panel_cabin({target:elements2.cabinTab,props:{feature:this}})}onDestroy(){var _a81;(_a81=this._component)==null||_a81.$destroy()}get scenePickerSettingStore(){return this._enableScenePickerSetting.store}get memberStore(){return fromObservable(this._memberService.memberData$.pipe(switchMap(async memberData=>{if(memberData==null)return null;const apiData=await this._apiDataSetup.complete(),slots=new Map(memberData.spriteInventory.filter(i=>i.slot!==void 0).map(i=>({...i,sprite:apiData.sprites.find(s=>s.id===i.spriteId)})).map(i=>[(i.slot??0)-1,i])),scene=memberData.sceneInventory.activeId?{id:memberData.sceneInventory.activeId,shift:memberData.sceneInventory.activeShift,scene:apiData.scenes.find(s=>s.id===memberData.sceneInventory.activeId)}:void 0;return{memberData,slots,scene}})),void 0)}getItemThumbnailUrl(item,shift){return item?shift?`https://static.typo.rip/sprites/rainbow/modulate.php?url=${item.url}&hue=${shift}`:item.url:""}async reorderSlots(slotMap,inventory,login){if(this._logger.debug("Reordering slots",slotMap,inventory),slotMap.every((v,i)=>v===i)){this._logger.info("No change in slot order");return}const slots=[];inventory.forEach(item=>{item.slot!==void 0&&slots.push({slotId:slotMap[item.slot-1]+1,spriteId:item.spriteId})}),await this._apiService.getApi(InventoryApi).setMemberSpriteCombo({login,spriteComboDto:{slots}}),await this._memberService.refreshInventory(),this._logger.info("Reordered slots",slots)}async promptSpriteSelection(inventory){this._logger.debug("Opening sprite picker");const sprites=(await this._apiDataSetup.complete()).sprites,pickerComponent={componentType:Panel_cabin_sprite_picker,propsFactory:__name(submit=>({feature:this,inventory,sprites,onPick:submit.bind(this)}),"propsFactory")},sprite=await this._modalService.showPrompt(pickerComponent.componentType,pickerComponent.propsFactory,"Sprite Picker","document");return this._logger.debug("Sprite picker closed",sprite),sprite}async setSpriteOnSlot(slot,sprite,login){this._logger.debug("Setting sprite on slot",slot,sprite);try{await this._apiService.getApi(InventoryApi).setMemberSpriteSlot({login,spriteSlotDto:{slotId:slot,spriteId:(sprite==null?void 0:sprite.id)??0}}),await this._memberService.refreshInventory()}catch(e){this._logger.error("Failed to set sprite on slot",e),await this._toastService.showToast("Failed to set sprite on slot")}}async promptSceneSelection(inventory){this._logger.debug("Opening scene picker");const scenes=(await this._apiDataSetup.complete()).scenes,pickerComponent={componentType:Panel_cabin_scene_picker,propsFactory:__name(submit=>({feature:this,inventory,scenes,onPick:__name((scene2,shift)=>submit(scene2&&{scene:scene2,shift}),"onPick")}),"propsFactory")},scene=await this._modalService.showPrompt(pickerComponent.componentType,pickerComponent.propsFactory,"Scene Picker","document");return this._logger.debug("Scene picker closed",scene),scene}async setScene(scene,shift,login){this._logger.debug("Setting scene",scene,shift);try{await this._apiService.getApi(InventoryApi).setMemberScene({login,setActiveSceneDto:{scene:scene?{sceneId:scene.id,sceneShift:shift}:void 0}}),await this._memberService.refreshInventory()}catch(e){this._logger.error("Failed to set scene",e),await this._toastService.showToast("Failed to set scene")}}};__name(_PanelCabinFeature,"PanelCabinFeature");let PanelCabinFeature=_PanelCabinFeature;__decorateClass$n([inject(ElementsSetup)],PanelCabinFeature.prototype,"_elements");__decorateClass$n([inject(ApiDataSetup)],PanelCabinFeature.prototype,"_apiDataSetup");__decorateClass$n([inject(MemberService)],PanelCabinFeature.prototype,"_memberService");__decorateClass$n([inject(ApiService)],PanelCabinFeature.prototype,"_apiService");__decorateClass$n([inject(ModalService)],PanelCabinFeature.prototype,"_modalService");__decorateClass$n([inject(ToastService)],PanelCabinFeature.prototype,"_toastService");function get_each_context$a(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[4]=list[i],child_ctx}__name(get_each_context$a,"get_each_context$a");function create_if_block_1$5(ctx){let p,t0,t1_value=ctx[0].getVersion()+"",t1;return{c(){p=element$1("p"),t0=text("Typo version: "),t1=text(t1_value),attr(p,"class","typo-version svelte-1fbg7r5")},m(target,anchor){insert(target,p,anchor),append(p,t0),append(p,t1)},p(ctx2,dirty){dirty&1&&t1_value!==(t1_value=ctx2[0].getVersion()+"")&&set_data(t1,t1_value)},d(detaching){detaching&&detach(p)}}}__name(create_if_block_1$5,"create_if_block_1$5");function create_else_block$4(ctx){let each_1_anchor,each_value=ensure_array_like(ctx[1]),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$a(get_each_context$a(ctx,each_value,i));return{c(){for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();each_1_anchor=empty()},m(target,anchor){for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(target,anchor);insert(target,each_1_anchor,anchor)},p(ctx2,dirty){if(dirty&2){each_value=ensure_array_like(ctx2[1]);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$a(ctx2,each_value,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block$a(child_ctx),each_blocks[i].c(),each_blocks[i].m(each_1_anchor.parentNode,each_1_anchor))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value.length}},i:noop$1,o:noop$1,d(detaching){detaching&&detach(each_1_anchor),destroy_each(each_blocks,detaching)}}}__name(create_else_block$4,"create_else_block$4");function create_if_block$8(ctx){let bounceload,current;return bounceload=new Bounceload({props:{content:"Loading changelog.."}}),{c(){create_component(bounceload.$$.fragment)},m(target,anchor){mount_component(bounceload,target,anchor),current=!0},p:noop$1,i(local){current||(transition_in(bounceload.$$.fragment,local),current=!0)},o(local){transition_out(bounceload.$$.fragment,local),current=!1},d(detaching){destroy_component(bounceload,detaching)}}}__name(create_if_block$8,"create_if_block$8");function create_each_block$a(ctx){let div1,div0,b,t0_value=ctx[4].title+"",t0,t1,span,t2_value=ctx[4].affectedTypoVersion+"",t2,t3,t4_value=new Date(Number(ctx[4].date)).toLocaleDateString()+"",t4,t5,t6,p,t7_value=ctx[4].content+"",t7,t8;return{c(){div1=element$1("div"),div0=element$1("div"),b=element$1("b"),t0=text(t0_value),t1=space(),span=element$1("span"),t2=text(t2_value),t3=text(" ("),t4=text(t4_value),t5=text(")"),t6=space(),p=element$1("p"),t7=text(t7_value),t8=space(),attr(span,"class","svelte-1fbg7r5"),attr(div0,"class","title svelte-1fbg7r5"),attr(div1,"class","change svelte-1fbg7r5")},m(target,anchor){insert(target,div1,anchor),append(div1,div0),append(div0,b),append(b,t0),append(div0,t1),append(div0,span),append(span,t2),append(span,t3),append(span,t4),append(span,t5),append(div1,t6),append(div1,p),append(p,t7),append(div1,t8)},p(ctx2,dirty){dirty&2&&t0_value!==(t0_value=ctx2[4].title+"")&&set_data(t0,t0_value),dirty&2&&t2_value!==(t2_value=ctx2[4].affectedTypoVersion+"")&&set_data(t2,t2_value),dirty&2&&t4_value!==(t4_value=new Date(Number(ctx2[4].date)).toLocaleDateString()+"")&&set_data(t4,t4_value),dirty&2&&t7_value!==(t7_value=ctx2[4].content+"")&&set_data(t7,t7_value)},d(detaching){detaching&&detach(div1)}}}__name(create_each_block$a,"create_each_block$a");function create_fragment$i(ctx){let div1,t,div0,current_block_type_index,if_block1,current,if_block0=ctx[2]&&create_if_block_1$5(ctx);const if_block_creators=[create_if_block$8,create_else_block$4],if_blocks=[];function select_block_type(ctx2,dirty){return ctx2[1]===void 0?0:1}return __name(select_block_type,"select_block_type"),current_block_type_index=select_block_type(ctx),if_block1=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx),{c(){div1=element$1("div"),if_block0&&if_block0.c(),t=space(),div0=element$1("div"),if_block1.c(),attr(div0,"class","changelog svelte-1fbg7r5"),attr(div1,"class","panel-changelog svelte-1fbg7r5")},m(target,anchor){insert(target,div1,anchor),if_block0&&if_block0.m(div1,null),append(div1,t),append(div1,div0),if_blocks[current_block_type_index].m(div0,null),current=!0},p(ctx2,[dirty]){ctx2[2]?if_block0?if_block0.p(ctx2,dirty):(if_block0=create_if_block_1$5(ctx2),if_block0.c(),if_block0.m(div1,t)):if_block0&&(if_block0.d(1),if_block0=null);let previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx2),current_block_type_index===previous_block_index?if_blocks[current_block_type_index].p(ctx2,dirty):(group_outros(),transition_out(if_blocks[previous_block_index],1,1,()=>{if_blocks[previous_block_index]=null}),check_outros(),if_block1=if_blocks[current_block_type_index],if_block1?if_block1.p(ctx2,dirty):(if_block1=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx2),if_block1.c()),transition_in(if_block1,1),if_block1.m(div0,null))},i(local){current||(transition_in(if_block1),current=!0)},o(local){transition_out(if_block1),current=!1},d(detaching){detaching&&detach(div1),if_block0&&if_block0.d(),if_blocks[current_block_type_index].d()}}}__name(create_fragment$i,"create_fragment$i");function instance$i($$self,$$props,$$invalidate){let $devmode,{feature}=$$props,{changes=void 0}=$$props;const devmode=feature.devmodeStore;return component_subscribe($$self,devmode,value=>$$invalidate(2,$devmode=value)),$$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature),"changes"in $$props2&&$$invalidate(1,changes=$$props2.changes)},[feature,changes,$devmode,devmode]}__name(instance$i,"instance$i");const _Panel_changelog=class _Panel_changelog extends SvelteComponent{constructor(options){super(),init(this,options,instance$i,create_fragment$i,safe_not_equal,{feature:0,changes:1})}};__name(_Panel_changelog,"Panel_changelog");let Panel_changelog=_Panel_changelog;var __defProp$m=Object.defineProperty,__decorateClass$m=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$m(target,key,result),result},"__decorateClass$m");const _PanelChangelogFeature=class _PanelChangelogFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elements");__publicField(this,"_apiDataSetup");__publicField(this,"_globalSettingsService");__publicField(this,"_component");__publicField(this,"name","Changelog");__publicField(this,"description","Displays a list of changes since the last updates on the start page");__publicField(this,"featureId",4);__publicField(this,"changelog","I am the changelog :)")}async onActivate(){const elements2=await this._elements.complete();this._component=new Panel_changelog({target:elements2.changelogTab,props:{feature:this}});const changes=(await this._apiDataSetup.complete()).announcements.filter(announcement=>announcement.type===AnnouncementDtoTypeEnum.Changelog).sort((a,b)=>Number(b.date)-Number(a.date));this._component.$set({changes})}onDestroy(){var _a81;(_a81=this._component)==null||_a81.$destroy()}get devmodeStore(){return this._globalSettingsService.settings.devMode.store}getVersion(){return chrome.runtime.getManifest().version_name}};__name(_PanelChangelogFeature,"PanelChangelogFeature");let PanelChangelogFeature=_PanelChangelogFeature;__decorateClass$m([inject(ElementsSetup)],PanelChangelogFeature.prototype,"_elements");__decorateClass$m([inject(ApiDataSetup)],PanelChangelogFeature.prototype,"_apiDataSetup");__decorateClass$m([inject(GlobalSettingsService)],PanelChangelogFeature.prototype,"_globalSettingsService");var __defProp$l=Object.defineProperty,__getOwnPropDesc$1=Object.getOwnPropertyDescriptor,__decorateClass$l=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc$1(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$l(target,key,result),result},"__decorateClass$l"),__decorateParam=__name((index,decorator)=>(target,key)=>decorator(target,key,index),"__decorateParam"),_a79;let LobbyItemsService=(_a79=class{constructor(loggerFactory2){__publicField(this,"_socketService");__publicField(this,"_logger");__publicField(this,"_onlineItems$",new BehaviorSubject([]));this._logger=loggerFactory2(this)}postConstruct(){this.setupConnection()}async setupConnection(){const connection=this._socketService.createConnection("IOnlineItemsHub");this._socketService.createReceiver("IOnlineItemsReceiver").register(connection,{onlineItemsUpdated:this.onOnlineItemsUpdated.bind(this)}),await connection.start()}async onOnlineItemsUpdated(update){this._logger.info("Online items updated",update),this._onlineItems$.next(update.items)}get onlineItems$(){return this._onlineItems$.asObservable()}},__name(_a79,"LobbyItemsService"),_a79);__decorateClass$l([inject(SocketService)],LobbyItemsService.prototype,"_socketService",2);__decorateClass$l([postConstruct()],LobbyItemsService.prototype,"postConstruct",1);LobbyItemsService=__decorateClass$l([injectable(),__decorateParam(0,inject(loggerFactory))],LobbyItemsService);function get_each_context$9(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[10]=list[i],child_ctx[12]=i,child_ctx}__name(get_each_context$9,"get_each_context$9");function create_if_block$7(ctx){let div;return{c(){div=element$1("div"),div.textContent="No filters saved."},m(target,anchor){insert(target,div,anchor)},d(detaching){detaching&&detach(div)}}}__name(create_if_block$7,"create_if_block$7");function create_each_block$9(ctx){let div1,checkbox,t0,div0,iconbutton,t1,feature_createTooltip_action,current,mounted,dispose;function change_handler(...args){return ctx[6](ctx[10],...args)}__name(change_handler,"change_handler"),checkbox=new Checkbox({props:{description:ctx[10].name,checked:ctx[3][ctx[12]]}}),checkbox.$on("change",change_handler);function click_handler2(){return ctx[7](ctx[10])}return __name(click_handler2,"click_handler"),iconbutton=new Icon_button({props:{icon:"file-img-trash-gif",name:"Remove Filter",greyscaleInactive:!0,hoverMove:!1,size:"1.5rem"}}),iconbutton.$on("click",click_handler2),{c(){div1=element$1("div"),create_component(checkbox.$$.fragment),t0=space(),div0=element$1("div"),create_component(iconbutton.$$.fragment),t1=space(),attr(div0,"class","typo-lobby-filters-item-remove svelte-lqoucf"),attr(div1,"class","typo-lobby-filters-item svelte-lqoucf"),set_style(div1,"order",ctx[10].createdAt)},m(target,anchor){insert(target,div1,anchor),mount_component(checkbox,div1,null),append(div1,t0),append(div1,div0),mount_component(iconbutton,div0,null),append(div1,t1),current=!0,mounted||(dispose=action_destroyer(feature_createTooltip_action=ctx[0].createTooltip(div1,{title:`${ctx[0].buildFilterTooltipText(ctx[10])}`})),mounted=!0)},p(new_ctx,dirty){ctx=new_ctx;const checkbox_changes={};dirty&4&&(checkbox_changes.description=ctx[10].name),dirty&8&&(checkbox_changes.checked=ctx[3][ctx[12]]),checkbox.$set(checkbox_changes),(!current||dirty&4)&&set_style(div1,"order",ctx[10].createdAt),feature_createTooltip_action&&is_function(feature_createTooltip_action.update)&&dirty&5&&feature_createTooltip_action.update.call(null,{title:`${ctx[0].buildFilterTooltipText(ctx[10])}`})},i(local){current||(transition_in(checkbox.$$.fragment,local),transition_in(iconbutton.$$.fragment,local),current=!0)},o(local){transition_out(checkbox.$$.fragment,local),transition_out(iconbutton.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div1),destroy_component(checkbox),destroy_component(iconbutton),mounted=!1,dispose()}}}__name(create_each_block$9,"create_each_block$9");function create_fragment$h(ctx){let div2,div0,t0,t1,div1,flatbutton0,t2,flatbutton1,current,if_block=ctx[2].length===0&&create_if_block$7(),each_value=ensure_array_like(ctx[2]),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$9(get_each_context$9(ctx,each_value,i));const out=__name(i=>transition_out(each_blocks[i],1,1,()=>{each_blocks[i]=null}),"out");return flatbutton0=new Flat_button({props:{content:"Start Search",color:"green"}}),flatbutton0.$on("click",ctx[8]),flatbutton1=new Flat_button({props:{content:"Add Lobby Filter",color:"blue"}}),flatbutton1.$on("click",ctx[9]),{c(){div2=element$1("div"),div0=element$1("div"),if_block&&if_block.c(),t0=space();for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();t1=space(),div1=element$1("div"),create_component(flatbutton0.$$.fragment),t2=space(),create_component(flatbutton1.$$.fragment),attr(div0,"class","typo-lobby-filters-list svelte-lqoucf"),attr(div1,"class","typo-lobby-filters-header svelte-lqoucf"),attr(div2,"class","typo-lobby-filters svelte-lqoucf")},m(target,anchor){insert(target,div2,anchor),append(div2,div0),if_block&&if_block.m(div0,null),append(div0,t0);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div0,null);append(div2,t1),append(div2,div1),mount_component(flatbutton0,div1,null),append(div1,t2),mount_component(flatbutton1,div1,null),current=!0},p(ctx2,[dirty]){if(ctx2[2].length===0?if_block||(if_block=create_if_block$7(),if_block.c(),if_block.m(div0,t0)):if_block&&(if_block.d(1),if_block=null),dirty&47){each_value=ensure_array_like(ctx2[2]);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$9(ctx2,each_value,i);each_blocks[i]?(each_blocks[i].p(child_ctx,dirty),transition_in(each_blocks[i],1)):(each_blocks[i]=create_each_block$9(child_ctx),each_blocks[i].c(),transition_in(each_blocks[i],1),each_blocks[i].m(div0,null))}for(group_outros(),i=each_value.length;i<each_blocks.length;i+=1)out(i);check_outros()}},i(local){if(!current){for(let i=0;i<each_value.length;i+=1)transition_in(each_blocks[i]);transition_in(flatbutton0.$$.fragment,local),transition_in(flatbutton1.$$.fragment,local),current=!0}},o(local){each_blocks=each_blocks.filter(Boolean);for(let i=0;i<each_blocks.length;i+=1)transition_out(each_blocks[i]);transition_out(flatbutton0.$$.fragment,local),transition_out(flatbutton1.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div2),if_block&&if_block.d(),destroy_each(each_blocks,detaching),destroy_component(flatbutton0),destroy_component(flatbutton1)}}}__name(create_fragment$h,"create_fragment$h");function instance$h($$self,$$props,$$invalidate){let filterStates,$selectedFilters,$filters,{feature}=$$props;const filters=feature.savedFiltersStore;component_subscribe($$self,filters,value=>$$invalidate(2,$filters=value));const selectedFilters=feature.selectedFiltersStore;component_subscribe($$self,selectedFilters,value=>$$invalidate(1,$selectedFilters=value));const change_handler=__name((filter2,checked)=>{const other=$selectedFilters.filter(f=>f!==filter2.createdAt);selectedFilters.set(checked.detail?[...other,filter2.createdAt]:other)},"change_handler"),click_handler2=__name(filter2=>feature.removeFilter(filter2),"click_handler"),click_handler_1=__name(async()=>{await feature.startSearch()},"click_handler_1"),click_handler_2=__name(async()=>{const filter2=await feature.promptFilterCreation();filter2&&await feature.addFilter(filter2)},"click_handler_2");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},$$self.$$.update=()=>{$$self.$$.dirty&6&&$$invalidate(3,filterStates=$filters.map(filter2=>$selectedFilters.includes(filter2.createdAt)))},[feature,$selectedFilters,$filters,filterStates,filters,selectedFilters,change_handler,click_handler2,click_handler_1,click_handler_2]}__name(instance$h,"instance$h");const _Panel_filters=class _Panel_filters extends SvelteComponent{constructor(options){super(),init(this,options,instance$h,create_fragment$h,safe_not_equal,{feature:0})}};__name(_Panel_filters,"Panel_filters");let Panel_filters=_Panel_filters;function create_fragment$g(ctx){let div9,div0,t3,div2,div1,input0,t4,flatbutton,t5,div8,div3,b0,t7,span0,t9,input1,t10,div4,b1,t12,span1,t14,input2,t15,span2,t17,input3,t18,span3,t20,div5,b2,t22,span4,t24,input4,t25,span5,t27,input5,t28,div6,b3,t30,span6,t32,input6,t33,span7,t35,input7,t36,span8,t38,div7,checkbox,updating_checked,current,mounted,dispose;flatbutton=new Flat_button({props:{content:"Add Filter",color:"blue"}}),flatbutton.$on("click",ctx[4]);function checkbox_checked_binding(value){ctx[12](value)}__name(checkbox_checked_binding,"checkbox_checked_binding");let checkbox_props={description:"Match only lobbies with typo players"};return ctx[1].containsTypoPlayers!==void 0&&(checkbox_props.checked=ctx[1].containsTypoPlayers),checkbox=new Checkbox({props:checkbox_props}),binding_callbacks.push(()=>bind$1(checkbox,"checked",checkbox_checked_binding)),{c(){div9=element$1("div"),div0=element$1("div"),div0.innerHTML=`A lobby filter checks if a lobby matches the filter criteria and skips automatically until a lobby is found.<br/>
    You can add multiple filters; at least one of them has to be matched for a lobby to be accepted.<br/>
    If you leave filter criteria empty, it will be ignored.`,t3=space(),div2=element$1("div"),div1=element$1("div"),input0=element$1("input"),t4=space(),create_component(flatbutton.$$.fragment),t5=space(),div8=element$1("div"),div3=element$1("div"),b0=element$1("b"),b0.textContent="Names:",t7=space(),span0=element$1("span"),span0.textContent="Match lobbies with names containing one of the comma-separated names",t9=space(),input1=element$1("input"),t10=space(),div4=element$1("div"),b1=element$1("b"),b1.textContent="Players:",t12=space(),span1=element$1("span"),span1.textContent="Match lobbies having at least",t14=space(),input2=element$1("input"),t15=space(),span2=element$1("span"),span2.textContent="and at most",t17=space(),input3=element$1("input"),t18=space(),span3=element$1("span"),span3.textContent="players.",t20=space(),div5=element$1("div"),b2=element$1("b"),b2.textContent="Round:",t22=space(),span4=element$1("span"),span4.textContent="Match lobbies that are currently at least in round",t24=space(),input4=element$1("input"),t25=space(),span5=element$1("span"),span5.textContent="and at most in round",t27=space(),input5=element$1("input"),t28=space(),div6=element$1("div"),b3=element$1("b"),b3.textContent="Average Score:",t30=space(),span6=element$1("span"),span6.textContent="Match lobbies where the average player score is at least",t32=space(),input6=element$1("input"),t33=space(),span7=element$1("span"),span7.textContent="points and at most",t35=space(),input7=element$1("input"),t36=space(),span8=element$1("span"),span8.textContent="points.",t38=space(),div7=element$1("div"),create_component(checkbox.$$.fragment),attr(input0,"type","text"),attr(input0,"placeholder","Filter name"),attr(input0,"class","svelte-9ect24"),attr(div1,"class","typo-filter-form-row svelte-9ect24"),attr(div2,"class","typo-filter-form-inputs svelte-9ect24"),attr(input1,"type","text"),attr(input1,"placeholder","ice king, princess bubblegum, finn"),attr(input1,"class","svelte-9ect24"),attr(div3,"class","typo-filter-form-row svelte-9ect24"),attr(input2,"type","number"),attr(input2,"placeholder","1"),attr(input2,"class","svelte-9ect24"),attr(input3,"type","number"),attr(input3,"placeholder","8"),attr(input3,"class","svelte-9ect24"),attr(div4,"class","typo-filter-form-row svelte-9ect24"),attr(input4,"type","number"),attr(input4,"placeholder","1"),attr(input4,"class","svelte-9ect24"),attr(input5,"type","number"),attr(input5,"placeholder","3"),attr(input5,"class","svelte-9ect24"),attr(div5,"class","typo-filter-form-row svelte-9ect24"),attr(input6,"type","number"),attr(input6,"placeholder","500"),attr(input6,"class","svelte-9ect24"),attr(input7,"type","number"),attr(input7,"placeholder","3000"),attr(input7,"class","svelte-9ect24"),attr(div6,"class","typo-filter-form-row svelte-9ect24"),attr(div7,"class","typo-filter-form-row svelte-9ect24"),attr(div8,"class","typo-filter-form-inputs svelte-9ect24"),attr(div9,"class","typo-filter-form svelte-9ect24")},m(target,anchor){insert(target,div9,anchor),append(div9,div0),append(div9,t3),append(div9,div2),append(div2,div1),append(div1,input0),set_input_value(input0,ctx[1].name),append(div1,t4),mount_component(flatbutton,div1,null),append(div9,t5),append(div9,div8),append(div8,div3),append(div3,b0),append(div3,t7),append(div3,span0),append(div3,t9),append(div3,input1),append(div8,t10),append(div8,div4),append(div4,b1),append(div4,t12),append(div4,span1),append(div4,t14),append(div4,input2),set_input_value(input2,ctx[1].minAmountPlayers),append(div4,t15),append(div4,span2),append(div4,t17),append(div4,input3),set_input_value(input3,ctx[1].maxAmountPlayers),append(div4,t18),append(div4,span3),append(div8,t20),append(div8,div5),append(div5,b2),append(div5,t22),append(div5,span4),append(div5,t24),append(div5,input4),set_input_value(input4,ctx[1].minRound),append(div5,t25),append(div5,span5),append(div5,t27),append(div5,input5),set_input_value(input5,ctx[1].maxRound),append(div8,t28),append(div8,div6),append(div6,b3),append(div6,t30),append(div6,span6),append(div6,t32),append(div6,input6),set_input_value(input6,ctx[1].minAverageScore),append(div6,t33),append(div6,span7),append(div6,t35),append(div6,input7),set_input_value(input7,ctx[1].maxAverageScore),append(div6,t36),append(div6,span8),append(div8,t38),append(div8,div7),mount_component(checkbox,div7,null),current=!0,mounted||(dispose=[listen(input0,"input",ctx[3]),listen(input1,"change",ctx[5]),listen(input2,"input",ctx[6]),listen(input3,"input",ctx[7]),listen(input4,"input",ctx[8]),listen(input5,"input",ctx[9]),listen(input6,"input",ctx[10]),listen(input7,"input",ctx[11])],mounted=!0)},p(ctx2,[dirty]){dirty&2&&input0.value!==ctx2[1].name&&set_input_value(input0,ctx2[1].name),dirty&2&&to_number(input2.value)!==ctx2[1].minAmountPlayers&&set_input_value(input2,ctx2[1].minAmountPlayers),dirty&2&&to_number(input3.value)!==ctx2[1].maxAmountPlayers&&set_input_value(input3,ctx2[1].maxAmountPlayers),dirty&2&&to_number(input4.value)!==ctx2[1].minRound&&set_input_value(input4,ctx2[1].minRound),dirty&2&&to_number(input5.value)!==ctx2[1].maxRound&&set_input_value(input5,ctx2[1].maxRound),dirty&2&&to_number(input6.value)!==ctx2[1].minAverageScore&&set_input_value(input6,ctx2[1].minAverageScore),dirty&2&&to_number(input7.value)!==ctx2[1].maxAverageScore&&set_input_value(input7,ctx2[1].maxAverageScore);const checkbox_changes={};!updating_checked&&dirty&2&&(updating_checked=!0,checkbox_changes.checked=ctx2[1].containsTypoPlayers,add_flush_callback(()=>updating_checked=!1)),checkbox.$set(checkbox_changes)},i(local){current||(transition_in(flatbutton.$$.fragment,local),transition_in(checkbox.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton.$$.fragment,local),transition_out(checkbox.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div9),destroy_component(flatbutton),destroy_component(checkbox),mounted=!1,run_all(dispose)}}}__name(create_fragment$g,"create_fragment$g");function instance$g($$self,$$props,$$invalidate){let{feature}=$$props,{onCreate}=$$props;const filter2={name:"",createdAt:new Date().getTime()};function input0_input_handler(){filter2.name=this.value,$$invalidate(1,filter2)}__name(input0_input_handler,"input0_input_handler");const click_handler2=__name(async()=>{onCreate(filter2)},"click_handler"),change_handler=__name(e=>{const names=e.currentTarget.value.split(",").map(name=>name.trim());$$invalidate(1,filter2.containsUsernames=names.length>0?names:void 0,filter2)},"change_handler");function input2_input_handler(){filter2.minAmountPlayers=to_number(this.value),$$invalidate(1,filter2)}__name(input2_input_handler,"input2_input_handler");function input3_input_handler(){filter2.maxAmountPlayers=to_number(this.value),$$invalidate(1,filter2)}__name(input3_input_handler,"input3_input_handler");function input4_input_handler(){filter2.minRound=to_number(this.value),$$invalidate(1,filter2)}__name(input4_input_handler,"input4_input_handler");function input5_input_handler(){filter2.maxRound=to_number(this.value),$$invalidate(1,filter2)}__name(input5_input_handler,"input5_input_handler");function input6_input_handler(){filter2.minAverageScore=to_number(this.value),$$invalidate(1,filter2)}__name(input6_input_handler,"input6_input_handler");function input7_input_handler(){filter2.maxAverageScore=to_number(this.value),$$invalidate(1,filter2)}__name(input7_input_handler,"input7_input_handler");function checkbox_checked_binding(value){$$self.$$.not_equal(filter2.containsTypoPlayers,value)&&(filter2.containsTypoPlayers=value,$$invalidate(1,filter2))}return __name(checkbox_checked_binding,"checkbox_checked_binding"),$$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(2,feature=$$props2.feature),"onCreate"in $$props2&&$$invalidate(0,onCreate=$$props2.onCreate)},[onCreate,filter2,feature,input0_input_handler,click_handler2,change_handler,input2_input_handler,input3_input_handler,input4_input_handler,input5_input_handler,input6_input_handler,input7_input_handler,checkbox_checked_binding]}__name(instance$g,"instance$g");const _Filter_form=class _Filter_form extends SvelteComponent{constructor(options){super(),init(this,options,instance$g,create_fragment$g,safe_not_equal,{feature:2,onCreate:0})}};__name(_Filter_form,"Filter_form");let Filter_form=_Filter_form;function get_each_context$8(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[7]=list[i],child_ctx}__name(get_each_context$8,"get_each_context$8");function get_each_context_1$1(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[10]=list[i],child_ctx}__name(get_each_context_1$1,"get_each_context_1$1");function create_each_block_1$1(ctx){let div1,b,t0_value=ctx[10].name+"",t0,t1,div0,t2_value=ctx[0].buildFilterTooltipText(ctx[10])+"",t2,t3;return{c(){div1=element$1("div"),b=element$1("b"),t0=text(t0_value),t1=space(),div0=element$1("div"),t2=text(t2_value),t3=space(),attr(b,"class","svelte-1apd7dj"),attr(div0,"class","typo-filter-search-list-item-description svelte-1apd7dj"),attr(div1,"class","typo-filter-search-list-item svelte-1apd7dj")},m(target,anchor){insert(target,div1,anchor),append(div1,b),append(b,t0),append(div1,t1),append(div1,div0),append(div0,t2),append(div1,t3)},p(ctx2,dirty){dirty&2&&t0_value!==(t0_value=ctx2[10].name+"")&&set_data(t0,t0_value),dirty&3&&t2_value!==(t2_value=ctx2[0].buildFilterTooltipText(ctx2[10])+"")&&set_data(t2,t2_value)},d(detaching){detaching&&detach(div1)}}}__name(create_each_block_1$1,"create_each_block_1$1");function create_each_block$8(ctx){let div1,b,t0_value=ctx[7].players.length-1+"",t0,t1,t2_value=ctx[7].round+"",t2,t3,div0,t4_value=ctx[7].players.filter(func_1).map(func_2).join(", ")+"",t4,t5,mounted,dispose;function func_1(...args){return ctx[5](ctx[7],...args)}__name(func_1,"func_1");function click_handler2(){return ctx[6](ctx[7])}return __name(click_handler2,"click_handler"),{c(){div1=element$1("div"),b=element$1("b"),t0=text(t0_value),t1=text(" players, round "),t2=text(t2_value),t3=space(),div0=element$1("div"),t4=text(t4_value),t5=space(),attr(b,"class","svelte-1apd7dj"),attr(div0,"class","typo-filter-search-list-item-description svelte-1apd7dj"),attr(div1,"class","typo-filter-search-list-item lobby svelte-1apd7dj")},m(target,anchor){insert(target,div1,anchor),append(div1,b),append(b,t0),append(b,t1),append(b,t2),append(div1,t3),append(div1,div0),append(div0,t4),append(div1,t5),mounted||(dispose=listen(div1,"click",click_handler2),mounted=!0)},p(new_ctx,dirty){ctx=new_ctx,dirty&8&&t0_value!==(t0_value=ctx[7].players.length-1+"")&&set_data(t0,t0_value),dirty&8&&t2_value!==(t2_value=ctx[7].round+"")&&set_data(t2,t2_value),dirty&8&&t4_value!==(t4_value=ctx[7].players.filter(func_1).map(func_2).join(", ")+"")&&set_data(t4,t4_value)},d(detaching){detaching&&detach(div1),mounted=!1,dispose()}}}__name(create_each_block$8,"create_each_block$8");function create_fragment$f(ctx){let div4,div0,t2,div1,t3,div2,t4,t5_value=ctx[3].length+"",t5,br1,t6,br2,t7,t8,div3,each_value_1=ensure_array_like(ctx[1]),each_blocks_1=[];for(let i=0;i<each_value_1.length;i+=1)each_blocks_1[i]=create_each_block_1$1(get_each_context_1$1(ctx,each_value_1,i));let each_value=ensure_array_like(ctx[3].filter(func$1)),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$8(get_each_context$8(ctx,each_value,i));return{c(){div4=element$1("div"),div0=element$1("div"),div0.innerHTML=`Lobby search is currently running and joining through lobbies.<br/>
    The search will stop once a lobby is found that matches one of the filters:`,t2=space(),div1=element$1("div");for(let i=0;i<each_blocks_1.length;i+=1)each_blocks_1[i].c();t3=space(),div2=element$1("div"),t4=text("Discovered lobbies: "),t5=text(t5_value),br1=element$1("br"),t6=text(`
    If you click on a lobby, the search will stop and join the selected lobby instead.`),br2=element$1("br"),t7=text(`
    A lobby might have changed since it was discovered.`),t8=space(),div3=element$1("div");for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();attr(div1,"class","typo-filter-search-list svelte-1apd7dj"),attr(div3,"class","typo-filter-search-list svelte-1apd7dj"),attr(div4,"class","typo-filter-search svelte-1apd7dj")},m(target,anchor){insert(target,div4,anchor),append(div4,div0),append(div4,t2),append(div4,div1);for(let i=0;i<each_blocks_1.length;i+=1)each_blocks_1[i]&&each_blocks_1[i].m(div1,null);append(div4,t3),append(div4,div2),append(div2,t4),append(div2,t5),append(div2,br1),append(div2,t6),append(div2,br2),append(div2,t7),append(div4,t8),append(div4,div3);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div3,null)},p(ctx2,[dirty]){if(dirty&3){each_value_1=ensure_array_like(ctx2[1]);let i;for(i=0;i<each_value_1.length;i+=1){const child_ctx=get_each_context_1$1(ctx2,each_value_1,i);each_blocks_1[i]?each_blocks_1[i].p(child_ctx,dirty):(each_blocks_1[i]=create_each_block_1$1(child_ctx),each_blocks_1[i].c(),each_blocks_1[i].m(div1,null))}for(;i<each_blocks_1.length;i+=1)each_blocks_1[i].d(1);each_blocks_1.length=each_value_1.length}if(dirty&8&&t5_value!==(t5_value=ctx2[3].length+"")&&set_data(t5,t5_value),dirty&12){each_value=ensure_array_like(ctx2[3].filter(func$1));let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$8(ctx2,each_value,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block$8(child_ctx),each_blocks[i].c(),each_blocks[i].m(div3,null))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value.length}},i:noop$1,o:noop$1,d(detaching){detaching&&detach(div4),destroy_each(each_blocks_1,detaching),destroy_each(each_blocks,detaching)}}}__name(create_fragment$f,"create_fragment$f");const func$1=__name(lobby=>lobby.players.length>1,"func$1"),func_2=__name(p=>p.name,"func_2");function instance$f($$self,$$props,$$invalidate){let $visitedLobbies,{feature}=$$props,{filters}=$$props,{lobbySelected}=$$props;const visitedLobbies=feature.visitedLobbiesStore;component_subscribe($$self,visitedLobbies,value=>$$invalidate(3,$visitedLobbies=value));const func_1=__name((lobby,p)=>p.id!==lobby.meId,"func_1"),click_handler2=__name(lobby=>lobbySelected(lobby.id??""),"click_handler");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature),"filters"in $$props2&&$$invalidate(1,filters=$$props2.filters),"lobbySelected"in $$props2&&$$invalidate(2,lobbySelected=$$props2.lobbySelected)},[feature,filters,lobbySelected,$visitedLobbies,visitedLobbies,func_1,click_handler2]}__name(instance$f,"instance$f");const _Filter_search=class _Filter_search extends SvelteComponent{constructor(options){super(),init(this,options,instance$f,create_fragment$f,safe_not_equal,{feature:0,filters:1,lobbySelected:2})}};__name(_Filter_search,"Filter_search");let Filter_search=_Filter_search;var __defProp$k=Object.defineProperty,__decorateClass$k=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$k(target,key,result),result},"__decorateClass$k");const _PanelFiltersFeature=class _PanelFiltersFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elements");__publicField(this,"_lobbyService");__publicField(this,"_modalService");__publicField(this,"_toastService");__publicField(this,"_lobbyItemsService");__publicField(this,"name","Lobby Filters");__publicField(this,"description","Lets you create custom filters for a quick lobby search");__publicField(this,"featureId",5);__publicField(this,"_component");__publicField(this,"_savedFiltersSetting",new ExtensionSetting("saved_filters",[],this));__publicField(this,"_selectedFiltersSetting",new ExtensionSetting("selected_filters",[],this));__publicField(this,"_currentSearch",new Subject$1);__publicField(this,"_overrideSearch",new Subject$1);__publicField(this,"_visitedLobbies",new BehaviorSubject([]));__publicField(this,"_searchSubscription")}async onActivate(){const elements2=await this._elements.complete();this._component=new Panel_filters({target:elements2.filterTab,props:{feature:this}}),this._searchSubscription=this._currentSearch.pipe(startWith(null),distinctUntilChanged(),combineLatestWith(this._lobbyService.lobby$),pairwise(),withLatestFrom(this._overrideSearch.pipe(startWith(void 0)))).subscribe(([[[previousFilter,previousLobby],[currentFilter,currentLobby]],override])=>this.handleSearchChange(previousFilter,previousLobby,currentFilter,currentLobby,override))}onDestroy(){var _a81,_b;(_a81=this._component)==null||_a81.$destroy(),(_b=this._searchSubscription)==null||_b.unsubscribe(),this._visitedLobbies.next([])}get savedFiltersStore(){return this._savedFiltersSetting.store}get selectedFiltersStore(){return this._selectedFiltersSetting.store}get visitedLobbiesStore(){return fromObservable(this._visitedLobbies,[])}async handleSearchChange(previousFilter,previousLobby,currentFilter,currentLobby,override){if(this._logger.debug("Search changed",previousFilter,previousLobby,currentFilter,currentLobby,override),currentLobby){if(currentFilter!==null){this._visitedLobbies.next([currentLobby,...this._visitedLobbies.value.filter(lobby=>lobby.id!==currentLobby.id)]);const items=await firstValueFrom(this._lobbyItemsService.onlineItems$);currentFilter.some(filter2=>this.checkLobbyFilterMatch(filter2,currentLobby,items))?(this._logger.info("Lobby found"),this._currentSearch.next(null)):(this._logger.info("Lobby does not match filter, leaving"),this._lobbyService.leaveLobby())}}else{if(override!==void 0)if(override===null){this._overrideSearch.next(void 0),this._currentSearch.next(null);return}else{this._overrideSearch.next(void 0),this._currentSearch.next(null),await this._lobbyService.joinLobby(override);return}previousFilter===null&&currentFilter!==null&&(this._logger.info("Starting search"),await this._lobbyService.joinLobby(),await this.promptFilterSearch(currentFilter)),currentFilter!==null&&(this._logger.info("Joining next lobby"),await this._lobbyService.joinLobby())}currentFilter===null&&this._visitedLobbies.next([])}checkLobbyFilterMatch(filter2,lobby,items){if(this._logger.info("Checking lobby filter match",filter2,lobby),filter2.minAmountPlayers!==void 0&&lobby.players.length<filter2.minAmountPlayers||filter2.maxAmountPlayers!==void 0&&lobby.players.length>filter2.maxAmountPlayers)return!1;const averageScore=lobby.players.map(p=>p.score).reduce((a,b)=>a+b,0)/lobby.players.length;if(filter2.minAverageScore!==void 0&&averageScore<filter2.minAverageScore||filter2.maxAverageScore!==void 0&&averageScore>filter2.maxAverageScore||filter2.minRound!==void 0&&lobby.round<filter2.minRound||filter2.maxRound!==void 0&&lobby.round>filter2.maxRound)return!1;if(filter2.containsUsernames&&filter2.containsUsernames.length){const usernames=lobby.players.map(p=>p.name);if(!filter2.containsUsernames.some(name=>usernames.includes(name)))return!1}if(filter2.containsTypoPlayers===!0){const lobbyKey=calculateLobbyKey(lobby.id??"");return items.some(item=>item.lobbyKey===lobbyKey)}return!0}async startSearch(){let filters=await this._savedFiltersSetting.getValue();const selectedFilters=await this._selectedFiltersSetting.getValue();if(filters=filters.filter(filter2=>selectedFilters.includes(filter2.createdAt)),filters.length===0){await this._toastService.showToast("No filters selected",`Select search filters from the list above
 or create a new filter`);return}this._logger.debug("Starting search",filters),this._currentSearch.next(filters)}async promptFilterSearch(filters){let finishSubscription;const formComponent={componentType:Filter_search,propsFactory:__name(submit=>(finishSubscription=this._currentSearch.pipe(filter(filters2=>filters2===null)).subscribe(()=>submit(null)),{feature:this,filters,lobbySelected:__name(id2=>submit(id2),"lobbySelected")}),"propsFactory")},result=await this._modalService.showPrompt(formComponent.componentType,formComponent.propsFactory,"Lobby Search","card");finishSubscription==null||finishSubscription.unsubscribe(),result===void 0&&(await this._toastService.showToast("Search aborted"),this._overrideSearch.next(null)),typeof result=="string"&&(await this._toastService.showToast("Lobby selected",`Joining lobby ${result}`),this._overrideSearch.next(result)),result===null&&await this._toastService.showToast("Search finished")}async promptFilterCreation(){const formComponent={componentType:Filter_form,propsFactory:__name(submit=>({feature:this,onCreate:submit.bind(this)}),"propsFactory"),validate:__name(filter2=>this.validateFilter(filter2),"validate")};return await this._modalService.showPrompt(formComponent.componentType,formComponent.propsFactory,"Add Lobby Filter","card",formComponent.validate)}async removeFilter(filter2){this._logger.debug("Removing filter",filter2);const toast=await this._toastService.showLoadingToast("Removing filter");try{let filters=await this._savedFiltersSetting.getValue();filters=filters.filter(f=>f.createdAt!==filter2.createdAt),await this._savedFiltersSetting.setValue(filters);const activeFilters=await this._selectedFiltersSetting.getValue();await this._selectedFiltersSetting.setValue(activeFilters.filter(id2=>id2!==filter2.createdAt)),toast.resolve(`Filter "${filter2.name}" removed`)}catch(e){this._logger.error("Failed to remove filter",e),toast.reject("Failed to remove filter")}}async addFilter(filter2){this._logger.debug("Adding filter",filter2);const toast=await this._toastService.showLoadingToast("Adding filter");try{let filters=await this._savedFiltersSetting.getValue();filters=[filter2,...filters],await this._savedFiltersSetting.setValue(filters);const activeFilters=await this._selectedFiltersSetting.getValue();await this._selectedFiltersSetting.setValue([filter2.createdAt,...activeFilters]),toast.resolve(`Filter "${filter2.name}" added`)}catch(e){return this._logger.error("Failed to add filter",e),toast.reject("Failed to add filter"),!1}return!0}async validateFilter(filter2){var _a81;return this._logger.debug("Validating filter",filter2),filter2.name=filter2.name.trim(),filter2.name.length===0?(await this._toastService.showToast("Invalid Filter","Filter name cannot be empty"),!1):(((_a81=filter2.containsUsernames)==null?void 0:_a81.length)===0&&(filter2.containsUsernames=void 0),filter2.minRound!==void 0&&filter2.minRound<=0&&(filter2.minRound=void 0),filter2.maxRound!==void 0&&filter2.maxRound<=0&&(filter2.maxRound=void 0),filter2.minAmountPlayers!==void 0&&filter2.minAmountPlayers<=0&&(filter2.minAmountPlayers=void 0),filter2.maxAmountPlayers!==void 0&&filter2.maxAmountPlayers<=0&&(filter2.maxAmountPlayers=void 0),filter2.minAverageScore!==void 0&&filter2.minAverageScore<=0&&(filter2.minAverageScore=void 0),filter2.maxAverageScore!==void 0&&filter2.maxAverageScore<=0&&(filter2.maxAverageScore=void 0),filter2.minAverageScore!==void 0&&filter2.maxAverageScore!==void 0&&filter2.minAverageScore>filter2.maxAverageScore?(await this._toastService.showToast("Invalid Filter","Minimum average score cannot be higher than maximum average score"),!1):filter2.minRound!==void 0&&filter2.maxRound!==void 0&&filter2.minRound>filter2.maxRound?(await this._toastService.showToast("Invalid Filter","Minimum round cannot be higher than maximum round"),!1):filter2.minAmountPlayers!==void 0&&filter2.maxAmountPlayers!==void 0&&filter2.minAmountPlayers>filter2.maxAmountPlayers?(await this._toastService.showToast("Invalid Filter","Minimum amount of players cannot be higher than maximum amount of players"),!1):!0)}buildFilterTooltipText(filter2){var _a81;let desc="";return(filter2.minAmountPlayers!=null||filter2.maxAmountPlayers!==void 0)&&(desc+=`
👤 ${filter2.minAmountPlayers??"x"} - ${filter2.maxAmountPlayers??"x"} players`),(filter2.minAverageScore!=null||filter2.maxAverageScore!==void 0)&&(desc+=`
🏆 ${filter2.minAverageScore??"x"} - ${filter2.maxAverageScore??"x"} average score`),(filter2.minRound!=null||filter2.maxRound!==void 0)&&(desc+=`
🔄 round ${filter2.minRound??"x"} - ${filter2.maxRound??"x"}`),(_a81=filter2.containsUsernames)!=null&&_a81.length&&(desc+=`
🔎 ${filter2.containsUsernames.join(", ")}`),filter2.containsTypoPlayers&&(desc+=`
🤖 Typo players`),desc.length===0?"Empty filter :(":desc.trim()}};__name(_PanelFiltersFeature,"PanelFiltersFeature");let PanelFiltersFeature=_PanelFiltersFeature;__decorateClass$k([inject(ElementsSetup)],PanelFiltersFeature.prototype,"_elements");__decorateClass$k([inject(LobbyService)],PanelFiltersFeature.prototype,"_lobbyService");__decorateClass$k([inject(ModalService)],PanelFiltersFeature.prototype,"_modalService");__decorateClass$k([inject(ToastService)],PanelFiltersFeature.prototype,"_toastService");__decorateClass$k([inject(LobbyItemsService)],PanelFiltersFeature.prototype,"_lobbyItemsService");function get_each_context$7(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[9]=list[i],child_ctx}__name(get_each_context$7,"get_each_context$7");function get_each_context_1(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[9]=list[i],child_ctx}__name(get_each_context_1,"get_each_context_1");function create_else_block$3(ctx){let div,t,current,each_value_1=ensure_array_like(ctx[1]),each_blocks=[];for(let i=0;i<each_value_1.length;i+=1)each_blocks[i]=create_each_block_1(get_each_context_1(ctx,each_value_1,i));const out=__name(i=>transition_out(each_blocks[i],1,1,()=>{each_blocks[i]=null}),"out");let if_block=ctx[1].length===0&&create_if_block_4();return{c(){div=element$1("div");for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();t=space(),if_block&&if_block.c(),attr(div,"class","typo-lobbies-discord-buttons svelte-tkvjrc")},m(target,anchor){insert(target,div,anchor);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div,null);append(div,t),if_block&&if_block.m(div,null),current=!0},p(ctx2,dirty){if(dirty&3){each_value_1=ensure_array_like(ctx2[1]);let i;for(i=0;i<each_value_1.length;i+=1){const child_ctx=get_each_context_1(ctx2,each_value_1,i);each_blocks[i]?(each_blocks[i].p(child_ctx,dirty),transition_in(each_blocks[i],1)):(each_blocks[i]=create_each_block_1(child_ctx),each_blocks[i].c(),transition_in(each_blocks[i],1),each_blocks[i].m(div,t))}for(group_outros(),i=each_value_1.length;i<each_blocks.length;i+=1)out(i);check_outros()}ctx2[1].length===0?if_block||(if_block=create_if_block_4(),if_block.c(),if_block.m(div,null)):if_block&&(if_block.d(1),if_block=null)},i(local){if(!current){for(let i=0;i<each_value_1.length;i+=1)transition_in(each_blocks[i]);current=!0}},o(local){each_blocks=each_blocks.filter(Boolean);for(let i=0;i<each_blocks.length;i+=1)transition_out(each_blocks[i]);current=!1},d(detaching){detaching&&detach(div),destroy_each(each_blocks,detaching),if_block&&if_block.d()}}}__name(create_else_block$3,"create_else_block$3");function create_if_block_3(ctx){let bounceload,current;return bounceload=new Bounceload({props:{content:"Loading connected servers.."}}),{c(){create_component(bounceload.$$.fragment)},m(target,anchor){mount_component(bounceload,target,anchor),current=!0},p:noop$1,i(local){current||(transition_in(bounceload.$$.fragment,local),current=!0)},o(local){transition_out(bounceload.$$.fragment,local),current=!1},d(detaching){destroy_component(bounceload,detaching)}}}__name(create_if_block_3,"create_if_block_3");function create_if_block_2$2(ctx){let span;return{c(){span=element$1("span"),span.innerHTML="You need to log in to see lobbies of your discord friends.<br/>",attr(span,"class","svelte-tkvjrc")},m(target,anchor){insert(target,span,anchor)},p:noop$1,i:noop$1,o:noop$1,d(detaching){detaching&&detach(span)}}}__name(create_if_block_2$2,"create_if_block_2$2");function create_each_block_1(ctx){let div,flatbutton,feature_createTooltip_action,current,mounted,dispose;function click_handler2(){return ctx[7](ctx[9])}return __name(click_handler2,"click_handler"),flatbutton=new Flat_button({props:{content:ctx[9].userName,color:ctx[9].private?"green":"blue"}}),flatbutton.$on("click",click_handler2),{c(){div=element$1("div"),create_component(flatbutton.$$.fragment)},m(target,anchor){insert(target,div,anchor),mount_component(flatbutton,div,null),current=!0,mounted||(dispose=action_destroyer(feature_createTooltip_action=ctx[0].createTooltip(div,{title:ctx[0].buildButtonTooltip(ctx[9]),lock:"Y"})),mounted=!0)},p(new_ctx,dirty){ctx=new_ctx;const flatbutton_changes={};dirty&2&&(flatbutton_changes.content=ctx[9].userName),dirty&2&&(flatbutton_changes.color=ctx[9].private?"green":"blue"),flatbutton.$set(flatbutton_changes),feature_createTooltip_action&&is_function(feature_createTooltip_action.update)&&dirty&3&&feature_createTooltip_action.update.call(null,{title:ctx[0].buildButtonTooltip(ctx[9]),lock:"Y"})},i(local){current||(transition_in(flatbutton.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div),destroy_component(flatbutton),mounted=!1,dispose()}}}__name(create_each_block_1,"create_each_block_1");function create_if_block_4(ctx){let span;return{c(){span=element$1("span"),span.textContent="None of your friends are online.",attr(span,"class","svelte-tkvjrc")},m(target,anchor){insert(target,span,anchor)},d(detaching){detaching&&detach(span)}}}__name(create_if_block_4,"create_if_block_4");function create_if_block$6(ctx){let div1,b,t1,t2,div0,if_block=ctx[3].length===0&&create_if_block_1$4(),each_value=ensure_array_like(ctx[3]),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$7(get_each_context$7(ctx,each_value,i));return{c(){div1=element$1("div"),b=element$1("b"),b.textContent="Discovered Lobbies",t1=space(),if_block&&if_block.c(),t2=space(),div0=element$1("div");for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();attr(b,"class","svelte-tkvjrc"),attr(div0,"class","typo-lobbies-discovered-buttons svelte-tkvjrc"),attr(div1,"class","typo-lobbies-discovered svelte-tkvjrc")},m(target,anchor){insert(target,div1,anchor),append(div1,b),append(div1,t1),if_block&&if_block.m(div1,null),append(div1,t2),append(div1,div0);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div0,null)},p(ctx2,dirty){if(ctx2[3].length===0?if_block||(if_block=create_if_block_1$4(),if_block.c(),if_block.m(div1,t2)):if_block&&(if_block.d(1),if_block=null),dirty&9){each_value=ensure_array_like(ctx2[3]);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$7(ctx2,each_value,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block$7(child_ctx),each_blocks[i].c(),each_blocks[i].m(div0,null))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value.length}},d(detaching){detaching&&detach(div1),if_block&&if_block.d(),destroy_each(each_blocks,detaching)}}}__name(create_if_block$6,"create_if_block$6");function create_if_block_1$4(ctx){let div;return{c(){div=element$1("div"),div.textContent="Join a lobby to see it here afterwards."},m(target,anchor){insert(target,div,anchor)},d(detaching){detaching&&detach(div)}}}__name(create_if_block_1$4,"create_if_block_1$4");function create_each_block$7(ctx){let div,b,t0_value=new Date(Number(ctx[9].seenAt)).toLocaleTimeString()+"",t0,t1,span,t2_value=ctx[9].players.map(func).join(", ")+"",t2,t3,mounted,dispose;function click_handler_1(){return ctx[8](ctx[9])}return __name(click_handler_1,"click_handler_1"),{c(){div=element$1("div"),b=element$1("b"),t0=text(t0_value),t1=space(),span=element$1("span"),t2=text(t2_value),t3=space(),attr(b,"class","svelte-tkvjrc"),attr(span,"class","svelte-tkvjrc"),set_style(div,"order",ctx[9].seenAt%1e8),attr(div,"class","svelte-tkvjrc")},m(target,anchor){insert(target,div,anchor),append(div,b),append(b,t0),append(div,t1),append(div,span),append(span,t2),append(div,t3),mounted||(dispose=listen(div,"click",click_handler_1),mounted=!0)},p(new_ctx,dirty){ctx=new_ctx,dirty&8&&t0_value!==(t0_value=new Date(Number(ctx[9].seenAt)).toLocaleTimeString()+"")&&set_data(t0,t0_value),dirty&8&&t2_value!==(t2_value=ctx[9].players.map(func).join(", ")+"")&&set_data(t2,t2_value),dirty&8&&set_style(div,"order",ctx[9].seenAt%1e8)},d(detaching){detaching&&detach(div),mounted=!1,dispose()}}}__name(create_each_block$7,"create_each_block$7");function create_fragment$e(ctx){let div1,div0,b,t1,current_block_type_index,if_block0,t2,current;const if_block_creators=[create_if_block_2$2,create_if_block_3,create_else_block$3],if_blocks=[];function select_block_type(ctx2,dirty){return ctx2[1]===null?0:ctx2[1]===void 0?1:2}__name(select_block_type,"select_block_type"),current_block_type_index=select_block_type(ctx),if_block0=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);let if_block1=ctx[2]&&create_if_block$6(ctx);return{c(){div1=element$1("div"),div0=element$1("div"),b=element$1("b"),b.textContent="Online Friends",t1=space(),if_block0.c(),t2=space(),if_block1&&if_block1.c(),attr(b,"class","svelte-tkvjrc"),attr(div0,"class","typo-lobbies-discord svelte-tkvjrc"),attr(div1,"class","svelte-tkvjrc")},m(target,anchor){insert(target,div1,anchor),append(div1,div0),append(div0,b),append(div0,t1),if_blocks[current_block_type_index].m(div0,null),append(div1,t2),if_block1&&if_block1.m(div1,null),current=!0},p(ctx2,[dirty]){let previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx2),current_block_type_index===previous_block_index?if_blocks[current_block_type_index].p(ctx2,dirty):(group_outros(),transition_out(if_blocks[previous_block_index],1,1,()=>{if_blocks[previous_block_index]=null}),check_outros(),if_block0=if_blocks[current_block_type_index],if_block0?if_block0.p(ctx2,dirty):(if_block0=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx2),if_block0.c()),transition_in(if_block0,1),if_block0.m(div0,null)),ctx2[2]?if_block1?if_block1.p(ctx2,dirty):(if_block1=create_if_block$6(ctx2),if_block1.c(),if_block1.m(div1,null)):if_block1&&(if_block1.d(1),if_block1=null)},i(local){current||(transition_in(if_block0),current=!0)},o(local){transition_out(if_block0),current=!1},d(detaching){detaching&&detach(div1),if_blocks[current_block_type_index].d(),if_block1&&if_block1.d()}}}__name(create_fragment$e,"create_fragment$e");const func=__name(p=>p.name,"func");function instance$e($$self,$$props,$$invalidate){let $lobbies,$showDiscovered,$discoveredLobbies,{feature}=$$props;const lobbies=feature.lobbiesStore;component_subscribe($$self,lobbies,value=>$$invalidate(1,$lobbies=value));const showDiscovered=feature.showDiscoveredLobbiesStore;component_subscribe($$self,showDiscovered,value=>$$invalidate(2,$showDiscovered=value));const discoveredLobbies=feature.discoveredLobbiesStore;component_subscribe($$self,discoveredLobbies,value=>$$invalidate(3,$discoveredLobbies=value));const click_handler2=__name(lobby=>feature.joinLobby(lobby.lobbyId,lobby.userName),"click_handler"),click_handler_1=__name(lobby=>feature.joinLobby(lobby.id??""),"click_handler_1");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},[feature,$lobbies,$showDiscovered,$discoveredLobbies,lobbies,showDiscovered,discoveredLobbies,click_handler2,click_handler_1]}__name(instance$e,"instance$e");const _Panel_lobbies=class _Panel_lobbies extends SvelteComponent{constructor(options){super(),init(this,options,instance$e,create_fragment$e,safe_not_equal,{feature:0})}};__name(_Panel_lobbies,"Panel_lobbies");let Panel_lobbies=_Panel_lobbies;var __defProp$j=Object.defineProperty,__decorateClass$j=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$j(target,key,result),result},"__decorateClass$j");const _PanelLobbiesFeature=class _PanelLobbiesFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elements");__publicField(this,"_socketService");__publicField(this,"_memberService");__publicField(this,"_lobbyService");__publicField(this,"_toastService");__publicField(this,"_showDiscoveredLobbiesSetting",this.useSetting(new BooleanExtensionSetting("show_discovered",!0,this).withName("Show discovered lobbies").withDescription("Shows a list of lobbies that you were in before")));__publicField(this,"_lobbies$",new BehaviorSubject(void 0));__publicField(this,"_component");__publicField(this,"_connection");__publicField(this,"_memberSubscription");__publicField(this,"name","Lobby List");__publicField(this,"description","Displays online players from your connected discord servers on the start page");__publicField(this,"featureId",6)}async onActivate(){const elements2=await this._elements.complete();this._component=new Panel_lobbies({target:elements2.lobbiesTab,props:{feature:this}}),this._memberSubscription=this._memberService.member$.subscribe(member=>this.processMemberChange(member))}onDestroy(){var _a81,_b,_c;(_a81=this._component)==null||_a81.$destroy(),(_b=this._connection)==null||_b.stop(),(_c=this._memberSubscription)==null||_c.unsubscribe(),this._memberSubscription=void 0}get lobbiesStore(){return fromObservable(this._lobbies$.pipe(map(lobbies=>lobbies==null?lobbies:this.mapLobbiesToPlayerList(lobbies)),tap(lobbies=>this._logger.info("Lobbies updated",lobbies))),[])}get discoveredLobbiesStore(){return fromObservable(this._lobbyService.discoveredLobbies$,[])}get showDiscoveredLobbiesStore(){return this._showDiscoveredLobbiesSetting.store}async processMemberChange(member){var _a81;if(this._logger.debug("Member changed",member),(_a81=this._connection)==null||_a81.stop(),member==null){this._lobbies$.next(member);return}this._lobbies$.next(new Map);const{connection,hubProxy}=await this.setupConnection();this._connection=connection;const promises=member.guilds.map(async guild=>{const currentLobbies=await hubProxy.subscribeGuildLobbies(guild.guildID);await this.onGuildLobbiesUpdated(currentLobbies)});await Promise.all(promises)}async setupConnection(){const connection=this._socketService.createConnection("IGuildLobbiesHub"),hubProxy=this._socketService.createHub("IGuildLobbiesHub").createHubProxy(connection);return this._socketService.createReceiver("IGuildLobbiesReceiver").register(connection,{guildLobbiesUpdated:this.onGuildLobbiesUpdated.bind(this)}),await connection.start(),{connection,hubProxy}}async onGuildLobbiesUpdated(lobbies){this._logger.info("Received guild lobbies for guild",lobbies.guildId);const lastValue=this._lobbies$.value;if(lastValue==null){this._logger.warn("Received guild lobbies but lobbies are not initialized yet",lobbies);return}lastValue.set(lobbies.guildId,lobbies.lobbies),this._lobbies$.next(lastValue)}mapLobbiesToPlayerList(lobbies){const distinct=[];return Array.from(lobbies.values()).flat().forEach(lobby=>{distinct.some(l=>l.lobbyId===lobby.lobbyId&&l.userName===lobby.userName)||distinct.push(lobby)}),distinct}buildButtonTooltip(lobby){return`🔑  ${lobby.private?"Custom":"Public"}
👥 ${lobby.currentPlayers} Players
🏳️ ${lobby.language}`}async joinLobby(id2,targetName){await this._lobbyService.joinLobby(id2),await this._toastService.showToast(targetName?`Joined the lobby of ${targetName}`:"Joined discovered lobby")}};__name(_PanelLobbiesFeature,"PanelLobbiesFeature");let PanelLobbiesFeature=_PanelLobbiesFeature;__decorateClass$j([inject(ElementsSetup)],PanelLobbiesFeature.prototype,"_elements");__decorateClass$j([inject(SocketService)],PanelLobbiesFeature.prototype,"_socketService");__decorateClass$j([inject(MemberService)],PanelLobbiesFeature.prototype,"_memberService");__decorateClass$j([inject(LobbyService)],PanelLobbiesFeature.prototype,"_lobbyService");__decorateClass$j([inject(ToastService)],PanelLobbiesFeature.prototype,"_toastService");const isAnonymousPlayerIdentification=__name(value=>value.lobbyKey!==void 0&&value.lobbyPlayerId!==void 0,"isAnonymousPlayerIdentification");var OnlineItemTypeDto=(OnlineItemTypeDto2=>(OnlineItemTypeDto2[OnlineItemTypeDto2.Award=3]="Award",OnlineItemTypeDto2[OnlineItemTypeDto2.Sprite=0]="Sprite",OnlineItemTypeDto2[OnlineItemTypeDto2.SpriteShift=1]="SpriteShift",OnlineItemTypeDto2[OnlineItemTypeDto2.Scene=2]="Scene",OnlineItemTypeDto2[OnlineItemTypeDto2.SceneTheme=6]="SceneTheme",OnlineItemTypeDto2[OnlineItemTypeDto2.Rewardee=5]="Rewardee",OnlineItemTypeDto2))(OnlineItemTypeDto||{});function get_each_context$6(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[3]=list[i],child_ctx}__name(get_each_context$6,"get_each_context$6");function create_each_block$6(ctx){let div;return{c(){div=element$1("div"),attr(div,"class","icon visible typo-awards-icon svelte-19i0k4m"),set_style(div,"background-image","url("+ctx[3].url+")")},m(target,anchor){insert(target,div,anchor)},p(ctx2,dirty){dirty&1&&set_style(div,"background-image","url("+ctx2[3].url+")")},d(detaching){detaching&&detach(div)}}}__name(create_each_block$6,"create_each_block$6");function create_fragment$d(ctx){let each_1_anchor,each_value=ensure_array_like(ctx[0]),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$6(get_each_context$6(ctx,each_value,i));return{c(){for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();each_1_anchor=empty()},m(target,anchor){for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(target,anchor);insert(target,each_1_anchor,anchor)},p(ctx2,[dirty]){if(dirty&1){each_value=ensure_array_like(ctx2[0]);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$6(ctx2,each_value,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block$6(child_ctx),each_blocks[i].c(),each_blocks[i].m(each_1_anchor.parentNode,each_1_anchor))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value.length}},i:noop$1,o:noop$1,d(detaching){detaching&&detach(each_1_anchor),destroy_each(each_blocks,detaching)}}}__name(create_fragment$d,"create_fragment$d");function instance$d($$self,$$props,$$invalidate){let{playerDisplay}=$$props,{awards}=$$props;const getAwards=__name(()=>awards,"getAwards");return $$self.$$set=$$props2=>{"playerDisplay"in $$props2&&$$invalidate(1,playerDisplay=$$props2.playerDisplay),"awards"in $$props2&&$$invalidate(0,awards=$$props2.awards)},[awards,playerDisplay,getAwards]}__name(instance$d,"instance$d");const _Awards_display=class _Awards_display extends SvelteComponent{constructor(options){super(),init(this,options,instance$d,create_fragment$d,safe_not_equal,{playerDisplay:1,awards:0,getAwards:2})}get getAwards(){return this.$$.ctx[2]}};__name(_Awards_display,"Awards_display");let Awards_display=_Awards_display;function create_if_block_1$3(ctx){let div,iconbutton,current;return iconbutton=new Icon_button({props:{hoverMove:!1,size:"48px",name:"Award this drawing",tooltipAction:ctx[0].createTooltip,icon:"file-img-award-gif"}}),iconbutton.$on("click",ctx[6]),{c(){div=element$1("div"),create_component(iconbutton.$$.fragment),attr(div,"class","typo-awards-icon svelte-f5k5v9")},m(target,anchor){insert(target,div,anchor),mount_component(iconbutton,div,null),current=!0},p(ctx2,dirty){const iconbutton_changes={};dirty&1&&(iconbutton_changes.tooltipAction=ctx2[0].createTooltip),iconbutton.$set(iconbutton_changes)},i(local){current||(transition_in(iconbutton.$$.fragment,local),current=!0)},o(local){transition_out(iconbutton.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div),destroy_component(iconbutton)}}}__name(create_if_block_1$3,"create_if_block_1$3");function create_if_block$5(ctx){let previous_key=ctx[1],key_block_anchor,key_block=create_key_block(ctx);return{c(){key_block.c(),key_block_anchor=empty()},m(target,anchor){key_block.m(target,anchor),insert(target,key_block_anchor,anchor)},p(ctx2,dirty){dirty&2&&safe_not_equal(previous_key,previous_key=ctx2[1])?(key_block.d(1),key_block=create_key_block(ctx2),key_block.c(),key_block.m(key_block_anchor.parentNode,key_block_anchor)):key_block.p(ctx2,dirty)},d(detaching){detaching&&detach(key_block_anchor),key_block.d(detaching)}}}__name(create_if_block$5,"create_if_block$5");function create_key_block(ctx){let div;return{c(){div=element$1("div"),attr(div,"class","typo-awards-presentation svelte-f5k5v9"),set_style(div,"background-image","url("+ctx[1].url+")")},m(target,anchor){insert(target,div,anchor)},p(ctx2,dirty){dirty&2&&set_style(div,"background-image","url("+ctx2[1].url+")")},d(detaching){detaching&&detach(div)}}}__name(create_key_block,"create_key_block");function create_fragment$c(ctx){let t,if_block1_anchor,current,if_block0=ctx[2]!==void 0&&ctx[2]!==null&&ctx[3]&&create_if_block_1$3(ctx),if_block1=ctx[1]!==void 0&&create_if_block$5(ctx);return{c(){if_block0&&if_block0.c(),t=space(),if_block1&&if_block1.c(),if_block1_anchor=empty()},m(target,anchor){if_block0&&if_block0.m(target,anchor),insert(target,t,anchor),if_block1&&if_block1.m(target,anchor),insert(target,if_block1_anchor,anchor),current=!0},p(ctx2,[dirty]){ctx2[2]!==void 0&&ctx2[2]!==null&&ctx2[3]?if_block0?(if_block0.p(ctx2,dirty),dirty&12&&transition_in(if_block0,1)):(if_block0=create_if_block_1$3(ctx2),if_block0.c(),transition_in(if_block0,1),if_block0.m(t.parentNode,t)):if_block0&&(group_outros(),transition_out(if_block0,1,1,()=>{if_block0=null}),check_outros()),ctx2[1]!==void 0?if_block1?if_block1.p(ctx2,dirty):(if_block1=create_if_block$5(ctx2),if_block1.c(),if_block1.m(if_block1_anchor.parentNode,if_block1_anchor)):if_block1&&(if_block1.d(1),if_block1=null)},i(local){current||(transition_in(if_block0),current=!0)},o(local){transition_out(if_block0),current=!1},d(detaching){detaching&&(detach(t),detach(if_block1_anchor)),if_block0&&if_block0.d(detaching),if_block1&&if_block1.d(detaching)}}}__name(create_fragment$c,"create_fragment$c");function instance$c($$self,$$props,$$invalidate){let $member,$awardable,{feature}=$$props,{currentAwardPresentation=void 0}=$$props;const member=feature.memberStore;component_subscribe($$self,member,value=>$$invalidate(2,$member=value));const awardable=feature.playerAwardableStore;component_subscribe($$self,awardable,value=>$$invalidate(3,$awardable=value));const click_handler2=__name(async()=>{const award=await feature.promptAwardSelection($member);award!==void 0&&award.inventoryIds.length>0&&await feature.giveAward(award.inventoryIds[0])},"click_handler");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature),"currentAwardPresentation"in $$props2&&$$invalidate(1,currentAwardPresentation=$$props2.currentAwardPresentation)},[feature,currentAwardPresentation,$member,$awardable,member,awardable,click_handler2]}__name(instance$c,"instance$c");const _Player_awards=class _Player_awards extends SvelteComponent{constructor(options){super(),init(this,options,instance$c,create_fragment$c,safe_not_equal,{feature:0,currentAwardPresentation:1})}};__name(_Player_awards,"Player_awards");let Player_awards=_Player_awards;function get_each_context$5(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[4]=list[i],child_ctx}__name(get_each_context$5,"get_each_context$5");function create_each_block$5(ctx){let div1,div0,t0,span0,b,t1_value=ctx[4].award.name+"",t1,t2,span1,t3_value=ctx[2](ctx[4].award.rarity)+"",t3,t4,span2,t5,t6_value=ctx[4].inventoryIds.length+"",t6,t7,mounted,dispose;function click_handler2(){return ctx[3](ctx[4])}return __name(click_handler2,"click_handler"),{c(){div1=element$1("div"),div0=element$1("div"),t0=space(),span0=element$1("span"),b=element$1("b"),t1=text(t1_value),t2=space(),span1=element$1("span"),t3=text(t3_value),t4=space(),span2=element$1("span"),t5=text("x"),t6=text(t6_value),t7=space(),attr(div0,"class","typo-award-picker-award-thumb svelte-9q5vog"),set_style(div0,"background-image","url("+ctx[4].award.url+")"),attr(span0,"class","svelte-9q5vog"),attr(span1,"class","svelte-9q5vog"),attr(span2,"class","svelte-9q5vog"),attr(div1,"class","typo-award-picker-award svelte-9q5vog"),set_style(div1,"order",ctx[4].award.id)},m(target,anchor){insert(target,div1,anchor),append(div1,div0),append(div1,t0),append(div1,span0),append(span0,b),append(b,t1),append(div1,t2),append(div1,span1),append(span1,t3),append(div1,t4),append(div1,span2),append(span2,t5),append(span2,t6),append(div1,t7),mounted||(dispose=listen(div1,"click",click_handler2),mounted=!0)},p(new_ctx,dirty){ctx=new_ctx,dirty&2&&set_style(div0,"background-image","url("+ctx[4].award.url+")"),dirty&2&&t1_value!==(t1_value=ctx[4].award.name+"")&&set_data(t1,t1_value),dirty&2&&t3_value!==(t3_value=ctx[2](ctx[4].award.rarity)+"")&&set_data(t3,t3_value),dirty&2&&t6_value!==(t6_value=ctx[4].inventoryIds.length+"")&&set_data(t6,t6_value),dirty&2&&set_style(div1,"order",ctx[4].award.id)},d(detaching){detaching&&detach(div1),mounted=!1,dispose()}}}__name(create_each_block$5,"create_each_block$5");function create_fragment$b(ctx){let div1,span,t1,div0,each_value=ensure_array_like(ctx[1]),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$5(get_each_context$5(ctx,each_value,i));return{c(){div1=element$1("div"),span=element$1("span"),span.textContent="Choose an award from your inventory to award the current drawing.",t1=space(),div0=element$1("div");for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();attr(span,"class","svelte-9q5vog"),attr(div0,"class","typo-award-picker-list color-scrollbar svelte-9q5vog"),attr(div1,"class","typo-award-picker svelte-9q5vog")},m(target,anchor){insert(target,div1,anchor),append(div1,span),append(div1,t1),append(div1,div0);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div0,null)},p(ctx2,[dirty]){if(dirty&7){each_value=ensure_array_like(ctx2[1]);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$5(ctx2,each_value,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block$5(child_ctx),each_blocks[i].c(),each_blocks[i].m(div0,null))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value.length}},i:noop$1,o:noop$1,d(detaching){detaching&&detach(div1),destroy_each(each_blocks,detaching)}}}__name(create_fragment$b,"create_fragment$b");function instance$b($$self,$$props,$$invalidate){let{onPick}=$$props,{awards}=$$props;const getAwardRarityName=__name(rarity=>{switch(rarity){case 0:return"Common";case 1:return"Special";case 2:return"Epic";default:return"Legendary"}},"getAwardRarityName"),click_handler2=__name(award=>onPick(award),"click_handler");return $$self.$$set=$$props2=>{"onPick"in $$props2&&$$invalidate(0,onPick=$$props2.onPick),"awards"in $$props2&&$$invalidate(1,awards=$$props2.awards)},[onPick,awards,getAwardRarityName,click_handler2]}__name(instance$b,"instance$b");const _Player_awards_award_picker=class _Player_awards_award_picker extends SvelteComponent{constructor(options){super(),init(this,options,instance$b,create_fragment$b,safe_not_equal,{onPick:0,awards:1})}};__name(_Player_awards_award_picker,"Player_awards_award_picker");let Player_awards_award_picker=_Player_awards_award_picker;var __defProp$i=Object.defineProperty,__decorateClass$i=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$i(target,key,result),result},"__decorateClass$i");const _PlayerAwardsFeature=class _PlayerAwardsFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elementsSetup");__publicField(this,"_apiDataSetup");__publicField(this,"_lobbyConnectionService");__publicField(this,"_chatService");__publicField(this,"_toastService");__publicField(this,"_lobbyItemsService");__publicField(this,"_lobbyService");__publicField(this,"_lobbyPlayersService");__publicField(this,"_memberService");__publicField(this,"_apiService");__publicField(this,"_modalService");__publicField(this,"_cloudService");__publicField(this,"_lobbyLeftEventListener");__publicField(this,"name","Awards");__publicField(this,"description","Award drawings of other typo players with special awards");__publicField(this,"featureId",41);__publicField(this,"toggleEnabled",!1);__publicField(this,"_enableAwardAnimationSetting",this.useSetting(new BooleanExtensionSetting("animation",!0,this).withName("Award Animation").withDescription("Show an animation over the canvas when a player is awarded")));__publicField(this,"_awardedSubscription");__publicField(this,"_lobbyItemsSubscription");__publicField(this,"_lobbyLeftSubscription");__publicField(this,"_awardsContainers",new Map);__publicField(this,"_awardsComponent")}async onActivate(){const elements2=await this._elementsSetup.complete(),apiData=await this._apiDataSetup.complete(),component=this._awardsComponent=new Player_awards({target:elements2.canvasWrapper,props:{feature:this,currentAwardPresentation:void 0}});this._lobbyLeftSubscription=this._lobbyLeftEventListener.events$.subscribe(()=>{this._cloudService.clearPendingAwardInventoryIds(),component.$set({currentAwardPresentation:void 0})}),this._awardedSubscription=this._lobbyConnectionService.awardGifted$.pipe(withLatestFrom(this._lobbyService.lobby$)).subscribe(([award,lobby])=>{var _a81;const awardDto=apiData.awards.find(a=>a.id===award.awardId),title=`${((_a81=lobby==null?void 0:lobby.players.find(p=>p.id===award.awarderLobbyPlayerId))==null?void 0:_a81.name)??"Unknown"} awarded this with a ${(awardDto==null?void 0:awardDto.name)??"Award"}!`,message=`
${awardDto==null?void 0:awardDto.description}`;this._chatService.addChatMessage(message,title,"info"),component.$set({currentAwardPresentation:structuredClone(awardDto)}),this._cloudService.addPendingAwardInventoryId(award.awardInventoryId)}),this._lobbyItemsSubscription=this._lobbyItemsService.onlineItems$.pipe(withLatestFrom(this._lobbyPlayersService.players$)).subscribe(([items,players])=>{this.updatePlayerAwards(players,items,apiData.awards)})}async onDestroy(){var _a81,_b,_c,_d;(_a81=this._awardsComponent)==null||_a81.$destroy(),(_b=this._awardedSubscription)==null||_b.unsubscribe(),(_c=this._lobbyItemsSubscription)==null||_c.unsubscribe(),(_d=this._lobbyLeftSubscription)==null||_d.unsubscribe(),this._awardedSubscription=void 0,this._lobbyItemsSubscription=void 0,this._awardsComponent=void 0,this._lobbyLeftSubscription=void 0,this._cloudService.clearPendingAwardInventoryIds(),this._awardsContainers.forEach(container=>container.$destroy()),this._awardsContainers.clear()}get memberStore(){return fromObservable(this._memberService.member$,void 0)}get playerAwardableStore(){return fromObservable(this._lobbyItemsService.onlineItems$.pipe(combineLatestWith(this._lobbyService.lobby$),map(([items,lobby])=>{if(lobby===null||lobby.id===null||lobby.drawerId===void 0||lobby.drawerId===lobby.meId)return!1;const lobbyKey=calculateLobbyKey(lobby.id);return items.some(item=>item.lobbyKey===lobbyKey&&item.lobbyPlayerId===lobby.drawerId)})),!1)}get awardsAnimationSettingStore(){return this._enableAwardAnimationSetting.store}async updatePlayerAwards(players,items,awards){this._logger.debug("Updating player awards",players);for(const[playerDisplay,container]of this._awardsContainers)players.includes(playerDisplay)||(container.$destroy(),this._awardsContainers.delete(playerDisplay));for(const player of players){const iconsDisplay=player.iconsContainer;if(iconsDisplay===null)continue;const identification=player.typoId;let container=this._awardsContainers.get(player);container||(container=new Awards_display({target:iconsDisplay,props:{awards:[],playerDisplay:player}}),this._awardsContainers.set(player,container));let playerAwards=[];isAnonymousPlayerIdentification(identification)?playerAwards=this.getAwardsForAnonymousPlayerDisplay(identification,items,awards):isAnonymousPlayerIdentification(identification)?this._logger.warn("Unknown player identification",identification):playerAwards=[];const existingAwards=container.getAwards();(playerAwards.length!==existingAwards.length||playerAwards.some((award,index)=>existingAwards[index].id!==award.id))&&container.$set({awards:playerAwards})}}getAwardsForAnonymousPlayerDisplay(identification,items,awards){return items.filter(item=>item.lobbyPlayerId===identification.lobbyPlayerId&&item.lobbyKey===identification.lobbyKey).filter(item=>item.type===OnlineItemTypeDto.Award).map(awardItem=>awards.find(award=>awardItem.itemId===award.id)).filter(award=>award!==void 0)}async promptAwardSelection(member){this._logger.debug("Opening award picker");const awardInventory=await this._apiService.getApi(InventoryApi).getMemberAvailableAwardInventory({login:Number(member.userLogin)}),pickerComponent={componentType:Player_awards_award_picker,propsFactory:__name(submit=>({awards:awardInventory,onPick:submit.bind(this)}),"propsFactory")},award=await this._modalService.showPrompt(pickerComponent.componentType,pickerComponent.propsFactory,"Award Picker","card");return this._logger.debug("Award picker closed",award),award}async giveAward(inventoryId){this._logger.debug("Giving award to current drawer",inventoryId);try{await this._lobbyConnectionService.connection.hub.giftAward({awardInventoryId:inventoryId})}catch(e){this._logger.error("Failed to gift award",e),await this._toastService.showToast("Failed to gift award")}}};__name(_PlayerAwardsFeature,"PlayerAwardsFeature");let PlayerAwardsFeature=_PlayerAwardsFeature;__decorateClass$i([inject(ElementsSetup)],PlayerAwardsFeature.prototype,"_elementsSetup");__decorateClass$i([inject(ApiDataSetup)],PlayerAwardsFeature.prototype,"_apiDataSetup");__decorateClass$i([inject(LobbyConnectionService)],PlayerAwardsFeature.prototype,"_lobbyConnectionService");__decorateClass$i([inject(ChatService)],PlayerAwardsFeature.prototype,"_chatService");__decorateClass$i([inject(ToastService)],PlayerAwardsFeature.prototype,"_toastService");__decorateClass$i([inject(LobbyItemsService)],PlayerAwardsFeature.prototype,"_lobbyItemsService");__decorateClass$i([inject(LobbyService)],PlayerAwardsFeature.prototype,"_lobbyService");__decorateClass$i([inject(PlayersService)],PlayerAwardsFeature.prototype,"_lobbyPlayersService");__decorateClass$i([inject(MemberService)],PlayerAwardsFeature.prototype,"_memberService");__decorateClass$i([inject(ApiService)],PlayerAwardsFeature.prototype,"_apiService");__decorateClass$i([inject(ModalService)],PlayerAwardsFeature.prototype,"_modalService");__decorateClass$i([inject(CloudService)],PlayerAwardsFeature.prototype,"_cloudService");__decorateClass$i([inject(LobbyLeftEventListener)],PlayerAwardsFeature.prototype,"_lobbyLeftEventListener");var __defProp$h=Object.defineProperty,__decorateClass$h=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$h(target,key,result),result},"__decorateClass$h");const _PlayerIdsFeature=class _PlayerIdsFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_playersService");__publicField(this,"name","Player IDs");__publicField(this,"description","Show player IDs in the lobby to execute commands like kick");__publicField(this,"featureId",29);__publicField(this,"_revealIdsHotkey",this.useHotkey(new HotkeyAction("reveal_id","Reveal IDs","Reveal the lobby player ID of all players",this,()=>this.setRevealState(!0),!0,["AltLeft"],()=>this.setRevealState(!1),!1)))}setRevealState(state){this._playersService.players$.pipe(take(1)).subscribe(players=>{for(const player of players)player.viewPlayerId=state})}onDestroy(){this.setRevealState(!1)}};__name(_PlayerIdsFeature,"PlayerIdsFeature");let PlayerIdsFeature=_PlayerIdsFeature;__decorateClass$h([inject(PlayersService)],PlayerIdsFeature.prototype,"_playersService");function create_if_block$4(ctx){let div;return{c(){div=element$1("div"),attr(div,"class","typo-player-scene svelte-eg9tl1"),set_style(div,"background-image","url('"+ctx[1](ctx[0])+"')")},m(target,anchor){insert(target,div,anchor)},p(ctx2,dirty){dirty&1&&set_style(div,"background-image","url('"+ctx2[1](ctx2[0])+"')")},d(detaching){detaching&&detach(div)}}}__name(create_if_block$4,"create_if_block$4");function create_fragment$a(ctx){let if_block_anchor,if_block=ctx[0]!==void 0&&create_if_block$4(ctx);return{c(){if_block&&if_block.c(),if_block_anchor=empty()},m(target,anchor){if_block&&if_block.m(target,anchor),insert(target,if_block_anchor,anchor)},p(ctx2,[dirty]){ctx2[0]!==void 0?if_block?if_block.p(ctx2,dirty):(if_block=create_if_block$4(ctx2),if_block.c(),if_block.m(if_block_anchor.parentNode,if_block_anchor)):if_block&&(if_block.d(1),if_block=null)},i:noop$1,o:noop$1,d(detaching){detaching&&detach(if_block_anchor),if_block&&if_block.d(detaching)}}}__name(create_fragment$a,"create_fragment$a");function instance$a($$self,$$props,$$invalidate){let{scene=void 0}=$$props,{playerDisplay}=$$props;const getScene=__name(()=>scene,"getScene"),getUrl=__name(scene2=>scene2.shift===void 0?scene2.scene.url:`https://static.typo.rip/sprites/rainbow/modulate.php?url=${scene2.scene.url}&hue=${scene2.shift}`,"getUrl");return onDestroy(()=>{$$invalidate(2,playerDisplay.useSafeColor=!1,playerDisplay),$$invalidate(2,playerDisplay.useBackground=!1,playerDisplay)}),$$self.$$set=$$props2=>{"scene"in $$props2&&$$invalidate(0,scene=$$props2.scene),"playerDisplay"in $$props2&&$$invalidate(2,playerDisplay=$$props2.playerDisplay)},$$self.$$.update=()=>{$$self.$$.dirty&1&&($$invalidate(2,playerDisplay.useSafeColor=scene!==void 0,playerDisplay),$$invalidate(2,playerDisplay.useBackground=scene===void 0,playerDisplay))},[scene,getUrl,playerDisplay,getScene]}__name(instance$a,"instance$a");const _Scene_container=class _Scene_container extends SvelteComponent{constructor(options){super(),init(this,options,instance$a,create_fragment$a,safe_not_equal,{scene:0,playerDisplay:2,getScene:3})}get getScene(){return this.$$.ctx[3]}};__name(_Scene_container,"Scene_container");let Scene_container=_Scene_container;var __defProp$g=Object.defineProperty,__decorateClass$g=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$g(target,key,result),result},"__decorateClass$g");const _PlayerScenesFeature=class _PlayerScenesFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_apiDataSetup");__publicField(this,"_lobbyItemsService");__publicField(this,"_lobbyPlayersService");__publicField(this,"_memberService");__publicField(this,"name","Player Scenes");__publicField(this,"description","Display scenes of typo players in lobbies and on the landing page");__publicField(this,"featureId",21);__publicField(this,"toggleEnabled",!1);__publicField(this,"developerFeature",!0);__publicField(this,"_scenesSubscription");__publicField(this,"_sceneContainers",new Map)}async onActivate(){const scenes=(await this._apiDataSetup.complete()).scenes;this._scenesSubscription=this._lobbyPlayersService.players$.pipe(combineLatestWith(this._lobbyItemsService.onlineItems$,this._memberService.memberData$)).subscribe(([players,items])=>{this.updatePlayerScenes(players,items,scenes)})}async onDestroy(){var _a81;(_a81=this._scenesSubscription)==null||_a81.unsubscribe(),this._sceneContainers.forEach(container=>container.$destroy()),this._sceneContainers.clear()}async updatePlayerScenes(players,lobbyItems,scenes){var _a81,_b;this._logger.debug("Updating player scenes",players);for(const[playerDisplay,container]of this._sceneContainers)players.includes(playerDisplay)||(container.$destroy(),this._sceneContainers.delete(playerDisplay));for(const player of players){const identification=player.typoId;let container=this._sceneContainers.get(player);container||(container=new Scene_container({target:player.backgroundContainer,props:{scene:void 0,playerDisplay:player}}),this._sceneContainers.set(player,container));let playerItems=[];isAnonymousPlayerIdentification(identification)?playerItems=this.getItemsForAnonymousPlayerDisplay(identification,lobbyItems):isAnonymousPlayerIdentification(identification)?this._logger.warn("Unknown player identification",identification):playerItems=await this.getItemsForConcretePlayerDisplay(identification);const scene=this.createSceneFromItems(playerItems,scenes);(((_a81=container.getScene())==null?void 0:_a81.scene.id)!==(scene==null?void 0:scene.scene.id)||((_b=container.getScene())==null?void 0:_b.shift)!==(scene==null?void 0:scene.shift))&&container.$set({scene})}}getItemsForAnonymousPlayerDisplay(identification,items){return items.filter(item=>item.lobbyPlayerId===identification.lobbyPlayerId&&item.lobbyKey===identification.lobbyKey)}async getItemsForConcretePlayerDisplay(identification){return await this.createItemsForMember(identification.login)}createSceneFromItems(playerItems,scenes){const playerScene=playerItems.find(scene2=>scene2.type===OnlineItemTypeDto.Scene),playerShift=playerItems.find(item=>item.type===OnlineItemTypeDto.SceneTheme&&item.slot===(playerScene==null?void 0:playerScene.itemId));if(playerScene===void 0)return;const scene=scenes.find(scene2=>scene2.id===playerScene.itemId);if(scene===void 0){this._logger.warn("Scene not found",playerScene.itemId);return}return{scene,shift:playerShift==null?void 0:playerShift.itemId}}async createItemsForMember(login){var _a81;this._logger.debug("Creating demo scene items for member",login);const sceneInventory=(_a81=await firstValueFrom(this._memberService.memberData$))==null?void 0:_a81.sceneInventory;if(sceneInventory===void 0)return[];const items=[];return sceneInventory.activeId!==void 0&&(items.push({itemId:sceneInventory.activeId,type:OnlineItemTypeDto.Scene,lobbyPlayerId:0,slot:0,lobbyKey:"practice"}),sceneInventory.activeShift!==void 0&&items.push({itemId:sceneInventory.activeShift,type:OnlineItemTypeDto.SceneTheme,lobbyPlayerId:0,slot:sceneInventory.activeId,lobbyKey:"practice"})),items}};__name(_PlayerScenesFeature,"PlayerScenesFeature");let PlayerScenesFeature=_PlayerScenesFeature;__decorateClass$g([inject(ApiDataSetup)],PlayerScenesFeature.prototype,"_apiDataSetup");__decorateClass$g([inject(LobbyItemsService)],PlayerScenesFeature.prototype,"_lobbyItemsService");__decorateClass$g([inject(PlayersService)],PlayerScenesFeature.prototype,"_lobbyPlayersService");__decorateClass$g([inject(MemberService)],PlayerScenesFeature.prototype,"_memberService");function get_each_context$4(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[4]=list[i],child_ctx}__name(get_each_context$4,"get_each_context$4");function create_each_block$4(ctx){let div;return{c(){div=element$1("div"),attr(div,"class","sprite-slot svelte-1uuttlm"),set_style(div,"background-image","url('"+ctx[1](ctx[4])+"')"),set_style(div,"z-index",ctx[4].slot+10)},m(target,anchor){insert(target,div,anchor)},p(ctx2,dirty){dirty&1&&set_style(div,"background-image","url('"+ctx2[1](ctx2[4])+"')"),dirty&1&&set_style(div,"z-index",ctx2[4].slot+10)},d(detaching){detaching&&detach(div)}}}__name(create_each_block$4,"create_each_block$4");function create_fragment$9(ctx){let each_1_anchor,each_value=ensure_array_like(ctx[0]),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$4(get_each_context$4(ctx,each_value,i));return{c(){for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();each_1_anchor=empty()},m(target,anchor){for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(target,anchor);insert(target,each_1_anchor,anchor)},p(ctx2,[dirty]){if(dirty&3){each_value=ensure_array_like(ctx2[0]);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$4(ctx2,each_value,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block$4(child_ctx),each_blocks[i].c(),each_blocks[i].m(each_1_anchor.parentNode,each_1_anchor))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value.length}},i:noop$1,o:noop$1,d(detaching){detaching&&detach(each_1_anchor),destroy_each(each_blocks,detaching)}}}__name(create_fragment$9,"create_fragment$9");function instance$9($$self,$$props,$$invalidate){let{sprites=[]}=$$props,{playerDisplay}=$$props;const getSprites=__name(()=>sprites,"getSprites"),getUrl=__name(slot=>slot.shift===void 0?slot.sprite.url:`https://static.typo.rip/sprites/rainbow/modulate.php?url=${slot.sprite.url}&hue=${slot.shift}`,"getUrl");return onDestroy(()=>{$$invalidate(2,playerDisplay.resizeToFitAvatar=!1,playerDisplay)}),$$self.$$set=$$props2=>{"sprites"in $$props2&&$$invalidate(0,sprites=$$props2.sprites),"playerDisplay"in $$props2&&$$invalidate(2,playerDisplay=$$props2.playerDisplay)},$$self.$$.update=()=>{$$self.$$.dirty&1&&($$invalidate(2,playerDisplay.resizeToFitAvatar=sprites.length>0,playerDisplay),$$invalidate(2,playerDisplay.hideAvatar=sprites.some(sprite=>sprite.sprite.isSpecial),playerDisplay))},[sprites,getUrl,playerDisplay,getSprites]}__name(instance$9,"instance$9");const _Sprite_container=class _Sprite_container extends SvelteComponent{constructor(options){super(),init(this,options,instance$9,create_fragment$9,safe_not_equal,{sprites:0,playerDisplay:2,getSprites:3})}get getSprites(){return this.$$.ctx[3]}};__name(_Sprite_container,"Sprite_container");let Sprite_container=_Sprite_container;var __defProp$f=Object.defineProperty,__decorateClass$f=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$f(target,key,result),result},"__decorateClass$f");const _PlayerSpritesFeature=class _PlayerSpritesFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_apiDataSetup");__publicField(this,"_lobbyItemsService");__publicField(this,"_lobbyPlayersService");__publicField(this,"_memberService");__publicField(this,"name","Player Sprites");__publicField(this,"description","Display sprites of typo players in lobbies and on the landing page");__publicField(this,"featureId",20);__publicField(this,"toggleEnabled",!1);__publicField(this,"developerFeature",!0);__publicField(this,"_spritesSubscription");__publicField(this,"_spriteContainers",new Map)}async onActivate(){const sprites=(await this._apiDataSetup.complete()).sprites;this._spritesSubscription=this._lobbyPlayersService.players$.pipe(combineLatestWith(this._lobbyItemsService.onlineItems$,this._memberService.memberData$)).subscribe(([players,items])=>{this.updatePlayerSprites(players,items,sprites)})}async onDestroy(){var _a81;(_a81=this._spritesSubscription)==null||_a81.unsubscribe(),this._spriteContainers.forEach(container=>container.$destroy()),this._spriteContainers.clear()}async updatePlayerSprites(players,items,sprites){this._logger.debug("Updating player sprites",players);for(const[playerDisplay,container]of this._spriteContainers)players.includes(playerDisplay)||(container.$destroy(),this._spriteContainers.delete(playerDisplay));for(const player of players){const identification=player.typoId;let container=this._spriteContainers.get(player);container||(container=new Sprite_container({target:player.avatarContainer,props:{sprites:[],playerDisplay:player}}),this._spriteContainers.set(player,container));let playerItems=[];isAnonymousPlayerIdentification(identification)?playerItems=this.getItemsForAnonymousPlayerDisplay(identification,items):isAnonymousPlayerIdentification(identification)?this._logger.warn("Unknown player identification",identification):playerItems=await this.getItemsForConcretePlayerDisplay(identification);const slots=this.createSpriteSlotsFromItems(playerItems,sprites),existingPlayerSlots=container.getSprites();(slots.length!==existingPlayerSlots.length||slots.some(slot=>{const existingSlot=existingPlayerSlots.find(s=>s.slot===slot.slot);return!existingSlot||existingSlot.sprite.id!==slot.sprite.id||existingSlot.shift!==slot.shift}))&&container.$set({sprites:slots})}}getItemsForAnonymousPlayerDisplay(identification,items){return items.filter(item=>item.lobbyPlayerId===identification.lobbyPlayerId&&item.lobbyKey===identification.lobbyKey)}async getItemsForConcretePlayerDisplay(identification){return await this.createItemsForMember(identification.login)}createSpriteSlotsFromItems(playerItems,sprites){const playerSprites=playerItems.filter(sprite=>sprite.type===OnlineItemTypeDto.Sprite),playerShifts=playerItems.filter(sprite=>sprite.type===OnlineItemTypeDto.SpriteShift);return playerSprites.map(sprite=>{var _a81;const spriteData=sprites.find(s=>s.id===sprite.itemId);if(spriteData===void 0){this._logger.warn(`Sprite with id ${sprite.itemId} not found`);return}return{sprite:spriteData,slot:sprite.slot,shift:(_a81=playerShifts.find(shift=>shift.slot===sprite.slot))==null?void 0:_a81.itemId}}).filter(slot=>slot!==void 0)}async createItemsForMember(login){var _a81;return this._logger.debug("Creating demo items for member",login),(((_a81=await firstValueFrom(this._memberService.memberData$))==null?void 0:_a81.spriteInventory)??[]).map(sprite=>{const item=sprite.slot?{itemId:sprite.spriteId,type:OnlineItemTypeDto.Sprite,lobbyPlayerId:0,slot:sprite.slot,lobbyKey:"practice"}:void 0,shift=sprite.colorShift&&sprite.slot?{itemId:sprite.colorShift,type:OnlineItemTypeDto.SpriteShift,lobbyPlayerId:0,slot:sprite.slot,lobbyKey:"practice"}:void 0;return[item,shift]}).flat().filter(item=>item!==void 0)}};__name(_PlayerSpritesFeature,"PlayerSpritesFeature");let PlayerSpritesFeature=_PlayerSpritesFeature;__decorateClass$f([inject(ApiDataSetup)],PlayerSpritesFeature.prototype,"_apiDataSetup");__decorateClass$f([inject(LobbyItemsService)],PlayerSpritesFeature.prototype,"_lobbyItemsService");__decorateClass$f([inject(PlayersService)],PlayerSpritesFeature.prototype,"_lobbyPlayersService");__decorateClass$f([inject(MemberService)],PlayerSpritesFeature.prototype,"_memberService");var __defProp$e=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__decorateClass$e=__name((decorators,target,key,kind)=>{for(var result=kind>1?void 0:kind?__getOwnPropDesc(target,key):target,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=(kind?decorator(target,key,result):decorator(result))||result);return kind&&result&&__defProp$e(target,key,result),result},"__decorateClass$e"),_a80;let TypoChallenge=(_a80=class{},__name(_a80,"TypoChallenge"),_a80);TypoChallenge=__decorateClass$e([injectable()],TypoChallenge);var __defProp$d=Object.defineProperty,__decorateClass$d=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$d(target,key,result),result},"__decorateClass$d");const _BlindGuessChallenge=class _BlindGuessChallenge extends TypoChallenge{constructor(){super(...arguments);__publicField(this,"_lobbyService");__publicField(this,"_drawingService");__publicField(this,"_elementsSetup");__publicField(this,"name","Blind Guess");__publicField(this,"description","You don't see what other people are drawing.")}createTriggerObservable(){return this._lobbyService.lobby$.pipe(combineLatestWith(this._drawingService.drawingState$),map(([lobby,drawing])=>drawing==="drawing"&&lobby!==null&&lobby.meId!==lobby.drawerId&&!lobby.players.some(player=>player.id===lobby.meId&&player.guessed)),distinctUntilChanged())}async apply(trigger){const elements2=await this._elementsSetup.complete();trigger?elements2.canvas.style.opacity="0":elements2.canvas.style.opacity=""}destroy(){return this.apply(!1)}};__name(_BlindGuessChallenge,"BlindGuessChallenge");let BlindGuessChallenge=_BlindGuessChallenge;__decorateClass$d([inject(LobbyService)],BlindGuessChallenge.prototype,"_lobbyService");__decorateClass$d([inject(DrawingService)],BlindGuessChallenge.prototype,"_drawingService");__decorateClass$d([inject(ElementsSetup)],BlindGuessChallenge.prototype,"_elementsSetup");var __defProp$c=Object.defineProperty,__decorateClass$c=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$c(target,key,result),result},"__decorateClass$c");const _DeafGuessChallenge=class _DeafGuessChallenge extends TypoChallenge{constructor(){super(...arguments);__publicField(this,"_lobbyService");__publicField(this,"_drawingService");__publicField(this,"_chatService");__publicField(this,"_blurredMessages");__publicField(this,"_style");__publicField(this,"_messagesSubscription");__publicField(this,"name","Deaf Guess");__publicField(this,"description","When guessing, you don't see hints or messages from other people.")}createTriggerObservable(){return this._lobbyService.lobby$.pipe(combineLatestWith(this._drawingService.drawingState$),map(([lobby,drawing])=>drawing==="drawing"&&lobby!==null&&lobby.meId!==lobby.drawerId&&!lobby.players.some(player=>player.id===lobby.meId&&player.guessed)),distinctUntilChanged())}async apply(trigger){var _a81,_b;trigger?(this._messagesSubscription||(this._messagesSubscription=this._chatService.messageReceived$.subscribe(message=>{this._blurredMessages?this._blurredMessages.push(message.contentElement):this._blurredMessages=[message.contentElement],message.element.classList.add("typo-challenge-deaf-guess-hidden")})),this._style||(this._style=new CSSStyleSheet,this._style.insertRule(".typo-challenge-deaf-guess-hidden span, .player-bubble .content .text { filter: blur(3px); }"),this._style.insertRule("#game form.chat-form .characters, #game-word .hints { opacity: 0 }"),document.adoptedStyleSheets=[...document.adoptedStyleSheets,this._style])):((_a81=this._messagesSubscription)==null||_a81.unsubscribe(),this._messagesSubscription=void 0,(_b=this._blurredMessages)==null||_b.forEach(message=>message.classList.remove("typo-challenge-deaf-guess-hidden")),this._blurredMessages=void 0,document.adoptedStyleSheets=document.adoptedStyleSheets.filter(sheet=>sheet!==this._style),this._style=void 0)}destroy(){return this.apply(!1)}};__name(_DeafGuessChallenge,"DeafGuessChallenge");let DeafGuessChallenge=_DeafGuessChallenge;__decorateClass$c([inject(LobbyService)],DeafGuessChallenge.prototype,"_lobbyService");__decorateClass$c([inject(DrawingService)],DeafGuessChallenge.prototype,"_drawingService");__decorateClass$c([inject(ChatService)],DeafGuessChallenge.prototype,"_chatService");var __defProp$b=Object.defineProperty,__decorateClass$b=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$b(target,key,result),result},"__decorateClass$b");const _DontClearChallenge=class _DontClearChallenge extends TypoChallenge{constructor(){super(...arguments);__publicField(this,"_canvasClearedEvent");__publicField(this,"_drawingService");__publicField(this,"_toastService");__publicField(this,"_style");__publicField(this,"_canvasClearedSubscription");__publicField(this,"name","Dont Clear");__publicField(this,"description","The canvas cannot be cleared; you draw over other previous drawings.")}createTriggerObservable(){return of(!0)}async apply(trigger){trigger&&(this._style=new CSSStyleSheet,this._style.insertRule(".tool[data-tooltip='Undo'], .tool[data-tooltip='Clear'] { display: none }"),document.adoptedStyleSheets=[...document.adoptedStyleSheets,this._style],this._canvasClearedSubscription=this._canvasClearedEvent.events$.subscribe(async event=>{await this._drawingService.drawImage(event.data)}),await this._toastService.showToast("Don't Clear active","Attention: Your drawings will look different (likely as nonsense) for other people!"))}destroy(){var _a81;this._style&&(document.adoptedStyleSheets=document.adoptedStyleSheets.filter(style=>style!==this._style),this._style=void 0),(_a81=this._canvasClearedSubscription)==null||_a81.unsubscribe()}};__name(_DontClearChallenge,"DontClearChallenge");let DontClearChallenge=_DontClearChallenge;__decorateClass$b([inject(CanvasClearedEventListener)],DontClearChallenge.prototype,"_canvasClearedEvent");__decorateClass$b([inject(DrawingService)],DontClearChallenge.prototype,"_drawingService");__decorateClass$b([inject(ToastService)],DontClearChallenge.prototype,"_toastService");var __defProp$a=Object.defineProperty,__decorateClass$a=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$a(target,key,result),result},"__decorateClass$a");const _DrunkVisionChallenge=class _DrunkVisionChallenge extends TypoChallenge{constructor(){super(...arguments);__publicField(this,"_lobbyService");__publicField(this,"_drawingService");__publicField(this,"_elementsSetup");__publicField(this,"name","Drunk Vision");__publicField(this,"description","You can only vaguely see what other people draw.");__publicField(this,"_overlay")}createTriggerObservable(){return this._lobbyService.lobby$.pipe(combineLatestWith(this._drawingService.drawingState$),map(([lobby,drawing])=>drawing==="drawing"&&lobby!==null&&lobby.meId!==lobby.drawerId&&!lobby.players.some(player=>player.id===lobby.meId&&player.guessed)),distinctUntilChanged())}async apply(trigger){var _a81;const elements2=await this._elementsSetup.complete();trigger?this._overlay===void 0&&(this._overlay=document.createElement("div"),this._overlay.style.position="absolute",this._overlay.style.width="100%",this._overlay.style.height="100%",this._overlay.style.backdropFilter="blur(40px)",this._overlay.style.pointerEvents="none",this._overlay.style.zIndex="0",elements2.canvasWrapper.appendChild(this._overlay)):((_a81=this._overlay)==null||_a81.remove(),this._overlay=void 0)}destroy(){return this.apply(!1)}};__name(_DrunkVisionChallenge,"DrunkVisionChallenge");let DrunkVisionChallenge=_DrunkVisionChallenge;__decorateClass$a([inject(LobbyService)],DrunkVisionChallenge.prototype,"_lobbyService");__decorateClass$a([inject(DrawingService)],DrunkVisionChallenge.prototype,"_drawingService");__decorateClass$a([inject(ElementsSetup)],DrunkVisionChallenge.prototype,"_elementsSetup");var __defProp$9=Object.defineProperty,__decorateClass$9=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$9(target,key,result),result},"__decorateClass$9");const _MonochromeChallenge=class _MonochromeChallenge extends TypoChallenge{constructor(){super(...arguments);__publicField(this,"_lobbyService");__publicField(this,"_drawingService");__publicField(this,"_style");__publicField(this,"name","Monochrome");__publicField(this,"description","You can only use shades of a random color column.")}createTriggerObservable(){return this._lobbyService.lobby$.pipe(combineLatestWith(this._drawingService.drawingState$),map(([lobby,drawing])=>drawing==="drawing"&&lobby!==null&&lobby.meId===lobby.drawerId),distinctUntilChanged())}apply(trigger){if(document.adoptedStyleSheets=document.adoptedStyleSheets.filter(style=>style!==this._style),!trigger)document.adoptedStyleSheets=document.adoptedStyleSheets.filter(style=>style!==this._style),this._style=void 0;else{this._style=new CSSStyleSheet;const typoPalette=element(".typo-palette-picker");if(typoPalette){const columns=window.getComputedStyle(typoPalette).getPropertyValue("grid-template-columns").split(" ").length,random2=Math.floor(Math.random()*columns)+1;this._style.insertRule(`#game[style*="display: flex"] .typo-palette-picker :not(:nth-child(${columns}n + ${random2} of .typo-palette-picker-item)) { width: 0; overflow: hidden; }`),this._style.insertRule(`#game[style*="display: flex"] .typo-palette-picker :nth-child(${columns}n + ${random2} of .typo-palette-picker-item) { aspect-ratio: ${columns} !important }`)}const defaultColumns=requireElements(".top .color").length,random=Math.floor(Math.random()*defaultColumns)+1;this._style.insertRule(`#game[style*="display: flex"] #game-toolbar .colors > div .color:nth-child(${random}) { width: calc(${defaultColumns} * var(--UNIT) / 2); }`),this._style.insertRule(`#game[style*="display: flex"] #game-toolbar .colors > div .color:not(:nth-child(${random})) { display: none; }`),document.adoptedStyleSheets=[...document.adoptedStyleSheets,this._style]}}destroy(){this.apply(!1)}};__name(_MonochromeChallenge,"MonochromeChallenge");let MonochromeChallenge=_MonochromeChallenge;__decorateClass$9([inject(LobbyService)],MonochromeChallenge.prototype,"_lobbyService");__decorateClass$9([inject(DrawingService)],MonochromeChallenge.prototype,"_drawingService");var __defProp$8=Object.defineProperty,__decorateClass$8=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$8(target,key,result),result},"__decorateClass$8");const _OneShotChallenge=class _OneShotChallenge extends TypoChallenge{constructor(){super(...arguments);__publicField(this,"_lobbyService");__publicField(this,"_drawingService");__publicField(this,"_messageSentEventListener");__publicField(this,"_style");__publicField(this,"name","One Shot");__publicField(this,"description","You have only one try to guess the word.")}createTriggerObservable(){return this._lobbyService.lobby$.pipe(combineLatestWith(this._drawingService.drawingState$),map(([lobby,drawing])=>drawing==="drawing"&&lobby!==null&&lobby.meId!==lobby.drawerId&&!lobby.players.some(player=>player.id===lobby.meId&&player.guessed)),distinctUntilChanged(),switchMap(trigger=>trigger===!1?of(!1):this._messageSentEventListener.events$.pipe(take(1),map(()=>!0))))}async apply(trigger){trigger?this._style||(this._style=new CSSStyleSheet,this._style.insertRule("#game form.chat-form { display: none }"),document.adoptedStyleSheets=[...document.adoptedStyleSheets,this._style]):this._style&&(document.adoptedStyleSheets=document.adoptedStyleSheets.filter(style=>style!==this._style),this._style=void 0)}destroy(){return this.apply(!1)}};__name(_OneShotChallenge,"OneShotChallenge");let OneShotChallenge=_OneShotChallenge;__decorateClass$8([inject(LobbyService)],OneShotChallenge.prototype,"_lobbyService");__decorateClass$8([inject(DrawingService)],OneShotChallenge.prototype,"_drawingService");__decorateClass$8([inject(MessageSentEventListener)],OneShotChallenge.prototype,"_messageSentEventListener");function get_each_context$3(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[5]=list[i],child_ctx}__name(get_each_context$3,"get_each_context$3");function create_each_block$3(ctx){let div,checkbox,t0,span,t2,current;function change_handler(...args){return ctx[4](ctx[5],...args)}return __name(change_handler,"change_handler"),checkbox=new Checkbox({props:{checked:ctx[0].includes(ctx[5].id),description:ctx[5].challenge.name}}),checkbox.$on("change",change_handler),{c(){div=element$1("div"),create_component(checkbox.$$.fragment),t0=space(),span=element$1("span"),span.textContent=`${ctx[5].challenge.description}`,t2=space(),attr(span,"class","svelte-wy9tne"),attr(div,"class","challenge svelte-wy9tne")},m(target,anchor){insert(target,div,anchor),mount_component(checkbox,div,null),append(div,t0),append(div,span),append(div,t2),current=!0},p(new_ctx,dirty){ctx=new_ctx;const checkbox_changes={};dirty&1&&(checkbox_changes.checked=ctx[0].includes(ctx[5].id)),checkbox.$set(checkbox_changes)},i(local){current||(transition_in(checkbox.$$.fragment,local),current=!0)},o(local){transition_out(checkbox.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div),destroy_component(checkbox)}}}__name(create_each_block$3,"create_each_block$3");function create_fragment$8(ctx){let div,current,each_value=ensure_array_like(ctx[1]),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$3(get_each_context$3(ctx,each_value,i));const out=__name(i=>transition_out(each_blocks[i],1,1,()=>{each_blocks[i]=null}),"out");return{c(){div=element$1("div");for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();attr(div,"class","typo-toolbar-challenges-list svelte-wy9tne")},m(target,anchor){insert(target,div,anchor);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div,null);current=!0},p(ctx2,[dirty]){if(dirty&3){each_value=ensure_array_like(ctx2[1]);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$3(ctx2,each_value,i);each_blocks[i]?(each_blocks[i].p(child_ctx,dirty),transition_in(each_blocks[i],1)):(each_blocks[i]=create_each_block$3(child_ctx),each_blocks[i].c(),transition_in(each_blocks[i],1),each_blocks[i].m(div,null))}for(group_outros(),i=each_value.length;i<each_blocks.length;i+=1)out(i);check_outros()}},i(local){if(!current){for(let i=0;i<each_value.length;i+=1)transition_in(each_blocks[i]);current=!0}},o(local){each_blocks=each_blocks.filter(Boolean);for(let i=0;i<each_blocks.length;i+=1)transition_out(each_blocks[i]);current=!1},d(detaching){detaching&&detach(div),destroy_each(each_blocks,detaching)}}}__name(create_fragment$8,"create_fragment$8");function instance$8($$self,$$props,$$invalidate){let $activeIds,{feature}=$$props;const challenges=feature.challenges,activeIds=feature.activatedChallengesSettingStore;component_subscribe($$self,activeIds,value=>$$invalidate(0,$activeIds=value));const change_handler=__name((challenge,event)=>{const other=$activeIds.filter(id2=>id2!==challenge.id);set_store_value(activeIds,$activeIds=event.detail?[...other,challenge.id]:other,$activeIds)},"change_handler");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(3,feature=$$props2.feature)},[$activeIds,challenges,activeIds,feature,change_handler]}__name(instance$8,"instance$8");const _Toolbar_challenges=class _Toolbar_challenges extends SvelteComponent{constructor(options){super(),init(this,options,instance$8,create_fragment$8,safe_not_equal,{feature:3})}};__name(_Toolbar_challenges,"Toolbar_challenges");let Toolbar_challenges=_Toolbar_challenges;var __defProp$7=Object.defineProperty,__decorateClass$7=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$7(target,key,result),result},"__decorateClass$7");const _ToolbarChallengesFeature=class _ToolbarChallengesFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elementsSetup");__publicField(this,"_container");__publicField(this,"name","Challenges");__publicField(this,"description","Adds the option to enable game modifications to make the game more challenging");__publicField(this,"featureId",8);__publicField(this,"_iconComponent");__publicField(this,"_iconClickSubscription");__publicField(this,"_challengeStatesSubscription");__publicField(this,"_challengeStates",new Map);__publicField(this,"_activatedChallenges",new ExtensionSetting("activated_challenges",[],this));__publicField(this,"_challenges",[{challenge:BlindGuessChallenge,id:1},{challenge:DrunkVisionChallenge,id:2},{challenge:DeafGuessChallenge,id:3},{challenge:OneShotChallenge,id:4},{challenge:DontClearChallenge,id:5},{challenge:MonochromeChallenge,id:6}]);__publicField(this,"_flyoutComponent");__publicField(this,"_flyoutSubscription")}async onActivate(){const elements2=await this._elementsSetup.complete();for(const challenge of this._challenges){const instance2=await this.resolveChallenge(challenge.challenge);this._challengeStates.set(challenge.id,{challenge:instance2})}this._challengeStatesSubscription=this.listenChallengeStates(),this._iconComponent=new Icon_button({target:elements2.toolbar,props:{icon:"file-img-challenge-gif",name:"Challenges",order:4,tooltipAction:this.createTooltip,lockTooltip:"Y"}}),this._iconClickSubscription=this._iconComponent.click$.subscribe(()=>{if(this._flyoutComponent)return;const flyoutContent={componentType:Toolbar_challenges,props:{feature:this}};this._flyoutComponent=new Area_flyout({target:elements2.gameWrapper,props:{componentData:flyoutContent,areaName:"chat",maxHeight:"600px",maxWidth:"300px",title:"Challenges",iconName:"file-img-nochallenge-gif"}}),this._flyoutSubscription=this._flyoutComponent.closed$.subscribe(()=>{var _a81,_b;this._logger.info("Destroyed flyout"),(_a81=this._flyoutComponent)==null||_a81.$destroy(),(_b=this._flyoutSubscription)==null||_b.unsubscribe(),this._flyoutComponent=void 0})})}onDestroy(){var _a81,_b,_c,_d,_e;(_a81=this._iconClickSubscription)==null||_a81.unsubscribe(),(_b=this._iconComponent)==null||_b.$destroy(),(_c=this._flyoutComponent)==null||_c.$destroy(),(_d=this._flyoutSubscription)==null||_d.unsubscribe(),this._flyoutSubscription=void 0,this._challengeStates.clear(),(_e=this._challengeStatesSubscription)==null||_e.unsubscribe(),this._challengeStatesSubscription=void 0}get activatedChallengesSettingStore(){return this._activatedChallenges.store}get challenges(){const cs=[...this._challengeStates.entries().map(([id2,{challenge}])=>({id:id2,challenge}))];return this._logger.debug(cs),cs}listenChallengeStates(){return this._activatedChallenges.changes$.subscribe(async ids=>{var _a81;ids.forEach(id2=>{const challenge=this._challengeStates.get(id2);if(!challenge){this._logger.warn(`Challenge with id ${id2} not resolved`);return}challenge.destroy||(this._logger.debug(`Activating challenge ${challenge.challenge.name}`),challenge.destroy=this.activateChallenge(challenge.challenge))}),this._challengeStates.forEach((state,id2)=>{!ids.includes(id2)&&state.destroy&&(this._logger.debug(`Deactivating challenge ${state.challenge.name}`),state.destroy(),state.destroy=void 0)}),(_a81=this._iconComponent)==null||_a81.$set({icon:ids.length>0?"file-img-challenge-gif":"file-img-nochallenge-gif"})})}async resolveChallenge(challenge){const instance2=this._container.resolveService(challenge);return this._logger.debug(`Resolved challenge: ${instance2.name}`),instance2}activateChallenge(challenge){this._logger.debug(`Activating challenge ${challenge.name}`);const subscription=challenge.createTriggerObservable().subscribe(async trigger=>{this._logger.debug(`Challenge trigger: ${trigger}`);try{await challenge.apply(trigger)}catch(error){this._logger.error(`Error applying challenge: ${error}`)}});return()=>{this._logger.debug(`Destroying challenge ${challenge.name}`),subscription.unsubscribe();try{challenge.destroy()}catch(error){this._logger.error(`Error destroying challenge: ${error}`)}}}};__name(_ToolbarChallengesFeature,"ToolbarChallengesFeature");let ToolbarChallengesFeature=_ToolbarChallengesFeature;__decorateClass$7([inject(ElementsSetup)],ToolbarChallengesFeature.prototype,"_elementsSetup");__decorateClass$7([inject(ExtensionContainer)],ToolbarChallengesFeature.prototype,"_container");var __defProp$6=Object.defineProperty,__decorateClass$6=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$6(target,key,result),result},"__decorateClass$6");const _ToolbarFullscreenFeature=class _ToolbarFullscreenFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elementsSetup");__publicField(this,"name","Fullscreen");__publicField(this,"description","Adds a toggle in-game to quickly enter/exit the browser fullscreen mode");__publicField(this,"featureId",9);__publicField(this,"_iconComponent");__publicField(this,"_iconClickSubscription");__publicField(this,"_toggleHotkey",this.useHotkey(new HotkeyAction("toggle_fullscreen","Toggle Fullscreen","Toggle the browser fullscreen mode",this,async()=>await this.toggleFullscreen(),!0,["ShiftLeft","KeyF"])))}async onActivate(){const elements2=await this._elementsSetup.complete();this._iconComponent=new Icon_button({target:elements2.toolbar,props:{icon:"file-img-fullscreen-gif",name:"Fullscreen",order:1,tooltipAction:this.createTooltip,lockTooltip:"Y"}}),this._iconClickSubscription=this._iconComponent.click$.subscribe(async()=>{await this.toggleFullscreen()})}onDestroy(){var _a81,_b;(_a81=this._iconClickSubscription)==null||_a81.unsubscribe(),(_b=this._iconComponent)==null||_b.$destroy()}async toggleFullscreen(){document.fullscreenElement===null?(this._logger.debug("Entering fullscreen"),await document.documentElement.requestFullscreen()):(this._logger.debug("Exiting fullscreen"),await document.exitFullscreen())}};__name(_ToolbarFullscreenFeature,"ToolbarFullscreenFeature");let ToolbarFullscreenFeature=_ToolbarFullscreenFeature;__decorateClass$6([inject(ElementsSetup)],ToolbarFullscreenFeature.prototype,"_elementsSetup");const chooseFile=__name(async(accept,multiple)=>{const input=document.createElement("input");return input.type="file",input.accept=accept,input.multiple=multiple,input.click(),new Promise(resolve2=>{input.onchange=()=>{input.files&&input.files.length>0?resolve2(input.files):resolve2(null)}})},"chooseFile");function get_each_context$2(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[16]=list[i],child_ctx}__name(get_each_context$2,"get_each_context$2");function create_if_block_1$2(ctx){let div,iconbutton,t0,span,current;return iconbutton=new Icon_button({props:{icon:"file-img-disabled-gif",name:"Abort",size:"1.5rem",hoverMove:!1}}),iconbutton.$on("click",ctx[7]),{c(){div=element$1("div"),create_component(iconbutton.$$.fragment),t0=space(),span=element$1("span"),span.textContent="Drawing in progress...",attr(span,"class","svelte-1tv05w9"),attr(div,"class","lockedHint svelte-1tv05w9")},m(target,anchor){insert(target,div,anchor),mount_component(iconbutton,div,null),append(div,t0),append(div,span),current=!0},p:noop$1,i(local){current||(transition_in(iconbutton.$$.fragment,local),current=!0)},o(local){transition_out(iconbutton.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div),destroy_component(iconbutton)}}}__name(create_if_block_1$2,"create_if_block_1$2");function create_each_block$2(ctx){let div1,div0,iconbutton,t,flatbutton,current;function click_handler_1(){return ctx[8](ctx[16])}__name(click_handler_1,"click_handler_1"),iconbutton=new Icon_button({props:{icon:"file-img-trash-gif",name:"Remove",size:"1.5rem",hoverMove:!1}}),iconbutton.$on("click",click_handler_1);function click_handler_2(){return ctx[9](ctx[16])}return __name(click_handler_2,"click_handler_2"),flatbutton=new Flat_button({props:{content:ctx[16].name,color:"blue"}}),flatbutton.$on("click",click_handler_2),{c(){div1=element$1("div"),div0=element$1("div"),create_component(iconbutton.$$.fragment),t=space(),create_component(flatbutton.$$.fragment),attr(div0,"class","remove svelte-1tv05w9"),attr(div1,"class","saved-commands svelte-1tv05w9"),toggle_class(div1,"locked",ctx[1])},m(target,anchor){insert(target,div1,anchor),append(div1,div0),mount_component(iconbutton,div0,null),append(div1,t),mount_component(flatbutton,div1,null),current=!0},p(new_ctx,dirty){ctx=new_ctx;const flatbutton_changes={};dirty&4&&(flatbutton_changes.content=ctx[16].name),flatbutton.$set(flatbutton_changes),(!current||dirty&2)&&toggle_class(div1,"locked",ctx[1])},i(local){current||(transition_in(iconbutton.$$.fragment,local),transition_in(flatbutton.$$.fragment,local),current=!0)},o(local){transition_out(iconbutton.$$.fragment,local),transition_out(flatbutton.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div1),destroy_component(iconbutton),destroy_component(flatbutton)}}}__name(create_each_block$2,"create_each_block$2");function create_if_block$3(ctx){let checkbox,updating_checked,current;function checkbox_checked_binding_1(value){ctx[15](value)}__name(checkbox_checked_binding_1,"checkbox_checked_binding_1");let checkbox_props={description:"Paste instant (practice!)"};return ctx[0].pasteInstant!==void 0&&(checkbox_props.checked=ctx[0].pasteInstant),checkbox=new Checkbox({props:checkbox_props}),binding_callbacks.push(()=>bind$1(checkbox,"checked",checkbox_checked_binding_1)),{c(){create_component(checkbox.$$.fragment)},m(target,anchor){mount_component(checkbox,target,anchor),current=!0},p(ctx2,dirty){const checkbox_changes={};!updating_checked&&dirty&1&&(updating_checked=!0,checkbox_changes.checked=ctx2[0].pasteInstant,add_flush_callback(()=>updating_checked=!1)),checkbox.$set(checkbox_changes)},i(local){current||(transition_in(checkbox.$$.fragment,local),current=!0)},o(local){transition_out(checkbox.$$.fragment,local),current=!1},d(detaching){destroy_component(checkbox,detaching)}}}__name(create_if_block$3,"create_if_block$3");function create_fragment$7(ctx){let div,t0,t1,flatbutton0,t2,flatbutton1,t3,flatbutton2,t4,input,t5,checkbox,updating_checked,t6,current,mounted,dispose,if_block0=ctx[1]&&create_if_block_1$2(ctx),each_value=ensure_array_like(ctx[2]),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$2(get_each_context$2(ctx,each_value,i));const out=__name(i=>transition_out(each_blocks[i],1,1,()=>{each_blocks[i]=null}),"out");flatbutton0=new Flat_button({props:{content:"Paste Image",color:"blue"}}),flatbutton0.$on("click",ctx[10]),flatbutton1=new Flat_button({props:{content:"Load SKD File",color:"green"}}),flatbutton1.$on("click",ctx[11]),flatbutton2=new Flat_button({props:{content:"Save Current Image",color:"green"}}),flatbutton2.$on("click",ctx[12]);function checkbox_checked_binding(value){ctx[14](value)}__name(checkbox_checked_binding,"checkbox_checked_binding");let checkbox_props={description:"Clear before paste"};ctx[0].clearBeforePaste!==void 0&&(checkbox_props.checked=ctx[0].clearBeforePaste),checkbox=new Checkbox({props:checkbox_props}),binding_callbacks.push(()=>bind$1(checkbox,"checked",checkbox_checked_binding));let if_block1=ctx[3]&&create_if_block$3(ctx);return{c(){div=element$1("div"),if_block0&&if_block0.c(),t0=space();for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();t1=space(),create_component(flatbutton0.$$.fragment),t2=space(),create_component(flatbutton1.$$.fragment),t3=space(),create_component(flatbutton2.$$.fragment),t4=space(),input=element$1("input"),t5=space(),create_component(checkbox.$$.fragment),t6=space(),if_block1&&if_block1.c(),attr(input,"type","text"),attr(input,"class","typo"),attr(input,"placeholder","Custom save name"),attr(div,"class","typo-toolbar-imagelab-actions svelte-1tv05w9")},m(target,anchor){insert(target,div,anchor),if_block0&&if_block0.m(div,null),append(div,t0);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(div,null);append(div,t1),mount_component(flatbutton0,div,null),append(div,t2),mount_component(flatbutton1,div,null),append(div,t3),mount_component(flatbutton2,div,null),append(div,t4),append(div,input),set_input_value(input,ctx[0].customName),append(div,t5),mount_component(checkbox,div,null),append(div,t6),if_block1&&if_block1.m(div,null),current=!0,mounted||(dispose=listen(input,"input",ctx[13]),mounted=!0)},p(ctx2,[dirty]){if(ctx2[1]?if_block0?(if_block0.p(ctx2,dirty),dirty&2&&transition_in(if_block0,1)):(if_block0=create_if_block_1$2(ctx2),if_block0.c(),transition_in(if_block0,1),if_block0.m(div,t0)):if_block0&&(group_outros(),transition_out(if_block0,1,1,()=>{if_block0=null}),check_outros()),dirty&7){each_value=ensure_array_like(ctx2[2]);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$2(ctx2,each_value,i);each_blocks[i]?(each_blocks[i].p(child_ctx,dirty),transition_in(each_blocks[i],1)):(each_blocks[i]=create_each_block$2(child_ctx),each_blocks[i].c(),transition_in(each_blocks[i],1),each_blocks[i].m(div,t1))}for(group_outros(),i=each_value.length;i<each_blocks.length;i+=1)out(i);check_outros()}dirty&1&&input.value!==ctx2[0].customName&&set_input_value(input,ctx2[0].customName);const checkbox_changes={};!updating_checked&&dirty&1&&(updating_checked=!0,checkbox_changes.checked=ctx2[0].clearBeforePaste,add_flush_callback(()=>updating_checked=!1)),checkbox.$set(checkbox_changes),ctx2[3]?if_block1?(if_block1.p(ctx2,dirty),dirty&8&&transition_in(if_block1,1)):(if_block1=create_if_block$3(ctx2),if_block1.c(),transition_in(if_block1,1),if_block1.m(div,null)):if_block1&&(group_outros(),transition_out(if_block1,1,1,()=>{if_block1=null}),check_outros())},i(local){if(!current){transition_in(if_block0);for(let i=0;i<each_value.length;i+=1)transition_in(each_blocks[i]);transition_in(flatbutton0.$$.fragment,local),transition_in(flatbutton1.$$.fragment,local),transition_in(flatbutton2.$$.fragment,local),transition_in(checkbox.$$.fragment,local),transition_in(if_block1),current=!0}},o(local){transition_out(if_block0),each_blocks=each_blocks.filter(Boolean);for(let i=0;i<each_blocks.length;i+=1)transition_out(each_blocks[i]);transition_out(flatbutton0.$$.fragment,local),transition_out(flatbutton1.$$.fragment,local),transition_out(flatbutton2.$$.fragment,local),transition_out(checkbox.$$.fragment,local),transition_out(if_block1),current=!1},d(detaching){detaching&&detach(div),if_block0&&if_block0.d(),destroy_each(each_blocks,detaching),destroy_component(flatbutton0),destroy_component(flatbutton1),destroy_component(flatbutton2),destroy_component(checkbox),if_block1&&if_block1.d(),mounted=!1,dispose()}}}__name(create_fragment$7,"create_fragment$7");function instance$7($$self,$$props,$$invalidate){let $locked,$store,$devmode,{feature}=$$props;const store=feature.savedDrawCommandsStore;component_subscribe($$self,store,value=>$$invalidate(2,$store=value));const devmode=feature.devmodeStore;component_subscribe($$self,devmode,value=>$$invalidate(3,$devmode=value)),feature.customName="";const locked=feature.locked;component_subscribe($$self,locked,value=>$$invalidate(1,$locked=value));const click_handler2=__name(()=>feature.abortPaste(),"click_handler"),click_handler_1=__name(image=>feature.removeDrawCommands($store,image),"click_handler_1"),click_handler_2=__name(image=>feature.pasteDrawCommands(image),"click_handler_2"),click_handler_3=__name(async()=>{const data=await feature.pickImageFromLocal();data!=null&&await feature.pasteImageToLocation(data)},"click_handler_3"),click_handler_4=__name(()=>feature.addDrawCommandsFromFile(),"click_handler_4"),click_handler_52=__name(()=>feature.saveCurrentDrawCommands(),"click_handler_5");function input_input_handler(){feature.customName=this.value,$$invalidate(0,feature)}__name(input_input_handler,"input_input_handler");function checkbox_checked_binding(value){$$self.$$.not_equal(feature.clearBeforePaste,value)&&(feature.clearBeforePaste=value,$$invalidate(0,feature))}__name(checkbox_checked_binding,"checkbox_checked_binding");function checkbox_checked_binding_1(value){$$self.$$.not_equal(feature.pasteInstant,value)&&(feature.pasteInstant=value,$$invalidate(0,feature))}return __name(checkbox_checked_binding_1,"checkbox_checked_binding_1"),$$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},[feature,$locked,$store,$devmode,store,devmode,locked,click_handler2,click_handler_1,click_handler_2,click_handler_3,click_handler_4,click_handler_52,input_input_handler,checkbox_checked_binding,checkbox_checked_binding_1]}__name(instance$7,"instance$7");const _Toolbar_imagelab=class _Toolbar_imagelab extends SvelteComponent{constructor(options){super(),init(this,options,instance$7,create_fragment$7,safe_not_equal,{feature:0})}};__name(_Toolbar_imagelab,"Toolbar_imagelab");let Toolbar_imagelab=_Toolbar_imagelab;function create_fragment$6(ctx){let div,p,t6,br4,t7,flatbutton0,t8,flatbutton1,t9,flatbutton2,t10,flatbutton3,current;return flatbutton0=new Flat_button({props:{content:"Fit on canvas",color:"green"}}),flatbutton0.$on("click",ctx[1]),flatbutton1=new Flat_button({props:{content:"Fill canvas",color:"green"}}),flatbutton1.$on("click",ctx[2]),flatbutton2=new Flat_button({props:{content:"Paste top-right on click position",color:"blue"}}),flatbutton2.$on("click",ctx[3]),flatbutton3=new Flat_button({props:{content:"Paste between two click positions",color:"blue"}}),flatbutton3.$on("click",ctx[4]),{c(){div=element$1("div"),p=element$1("p"),p.innerHTML=`Pick a mode to paste the image on the canvas.<br/>
    &quot;Fill on canvas&quot; and &quot;Paste between click&quot; might change the source image ratio.<br/> <br/> <b>Warning: This should be used only in practice mode.</b><br/>
    No one else can see this image, and it will corrupt your drawing for others.`,t6=space(),br4=element$1("br"),t7=space(),create_component(flatbutton0.$$.fragment),t8=space(),create_component(flatbutton1.$$.fragment),t9=space(),create_component(flatbutton2.$$.fragment),t10=space(),create_component(flatbutton3.$$.fragment),attr(div,"class","typo-imagelab-position-picker svelte-zwzp7f")},m(target,anchor){insert(target,div,anchor),append(div,p),append(div,t6),append(div,br4),append(div,t7),mount_component(flatbutton0,div,null),append(div,t8),mount_component(flatbutton1,div,null),append(div,t9),mount_component(flatbutton2,div,null),append(div,t10),mount_component(flatbutton3,div,null),current=!0},p:noop$1,i(local){current||(transition_in(flatbutton0.$$.fragment,local),transition_in(flatbutton1.$$.fragment,local),transition_in(flatbutton2.$$.fragment,local),transition_in(flatbutton3.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton0.$$.fragment,local),transition_out(flatbutton1.$$.fragment,local),transition_out(flatbutton2.$$.fragment,local),transition_out(flatbutton3.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div),destroy_component(flatbutton0),destroy_component(flatbutton1),destroy_component(flatbutton2),destroy_component(flatbutton3)}}}__name(create_fragment$6,"create_fragment$6");function instance$6($$self,$$props,$$invalidate){let{onPick}=$$props;const click_handler2=__name(()=>onPick("fit"),"click_handler"),click_handler_1=__name(()=>onPick("fill"),"click_handler_1"),click_handler_2=__name(()=>onPick("position"),"click_handler_2"),click_handler_3=__name(()=>onPick("range"),"click_handler_3");return $$self.$$set=$$props2=>{"onPick"in $$props2&&$$invalidate(0,onPick=$$props2.onPick)},[onPick,click_handler2,click_handler_1,click_handler_2,click_handler_3]}__name(instance$6,"instance$6");const _Imagelab_position_picker=class _Imagelab_position_picker extends SvelteComponent{constructor(options){super(),init(this,options,instance$6,create_fragment$6,safe_not_equal,{onPick:0})}};__name(_Imagelab_position_picker,"Imagelab_position_picker");let Imagelab_position_picker=_Imagelab_position_picker;var __defProp$5=Object.defineProperty,__decorateClass$5=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$5(target,key,result),result},"__decorateClass$5");const _ToolbarImageLabFeature=class _ToolbarImageLabFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elementsSetup");__publicField(this,"_drawingService");__publicField(this,"_drawCommandsService");__publicField(this,"_toastService");__publicField(this,"_modalService");__publicField(this,"_canvasEventsSetup");__publicField(this,"_lobbyService");__publicField(this,"_globalSettingsService");__publicField(this,"name","Image Laboratory");__publicField(this,"description","Adds an icon to the typo toolbar to save or paste skribbl drawings (SKDs) to a lobby");__publicField(this,"featureId",10);__publicField(this,"_iconComponent");__publicField(this,"_iconClickSubscription");__publicField(this,"_flyoutComponent");__publicField(this,"_flyoutSubscription");__publicField(this,"_customName");__publicField(this,"clearBeforePaste",!1);__publicField(this,"pasteInstant",!1)}get boundServices(){return[this._drawCommandsService]}set customName(value){const val=(value==null?void 0:value.replace(/[^a-z0-9]/gi,"_").toLowerCase())??void 0;this._customName=val&&val.length>0?val:void 0}get customName(){return this._customName}get locked(){return fromObservable(this._drawingService.pasteInProgress$,!1)}get devmodeStore(){return this._globalSettingsService.settings.devMode.store}async onActivate(){const elements2=await this._elementsSetup.complete();this._iconComponent=new Icon_button({target:elements2.toolbar,props:{icon:"file-img-dna-gif",name:"Image Laboratory",order:3,tooltipAction:this.createTooltip,lockTooltip:"Y"}}),this._iconClickSubscription=this._iconComponent.click$.subscribe(()=>{if(this._flyoutComponent)return;const flyoutContent={componentType:Toolbar_imagelab,props:{feature:this}};this._flyoutComponent=new Area_flyout({target:elements2.gameWrapper,props:{componentData:flyoutContent,areaName:"chat",maxHeight:"600px",maxWidth:"300px",title:"Image Laboratory",iconName:"file-img-dna-gif"}}),this._flyoutSubscription=this._flyoutComponent.closed$.subscribe(()=>{var _a81,_b;this._logger.info("Destroyed flyout"),(_a81=this._flyoutComponent)==null||_a81.$destroy(),(_b=this._flyoutSubscription)==null||_b.unsubscribe(),this._flyoutComponent=void 0})})}onDestroy(){var _a81,_b,_c,_d;(_a81=this._iconClickSubscription)==null||_a81.unsubscribe(),(_b=this._iconComponent)==null||_b.$destroy(),(_c=this._flyoutComponent)==null||_c.$destroy(),this._flyoutComponent=void 0,(_d=this._flyoutSubscription)==null||_d.unsubscribe()}async addDrawCommandsFromFile(){const files=await chooseFile(".skd",!0);if(files===null)return;(await Promise.all([...files].map(async file=>{let commands2;try{const text2=await file.text();if(commands2=JSON.parse(text2),typeof commands2!="object"||!Array.isArray(commands2))throw new Error("Invalid format")}catch(e){throw this._logger.error("Failed to read file",file,e),e}return{name:file.name,commands:commands2}}))).forEach(c=>this._drawCommandsService.saveDrawCommands(c.name,c.commands))}saveCurrentDrawCommands(){combineLatest$1({commands:this._drawingService.commands$,state:this._drawingService.imageState$}).pipe(take(1)).subscribe(({commands,state})=>{if(state===null)throw this._logger.warn("Attempted to save commands, but state null. In a lobby?"),new Error("state is null");this._drawCommandsService.saveDrawCommands(this._customName??state.word.hints,commands)})}get savedDrawCommandsStore(){return fromObservable(this._drawCommandsService.savedDrawCommands$,[])}removeDrawCommands(all,remove){const index=all.indexOf(remove);if(index===-1)throw this._logger.warn("Tried to remove commands, but not found"),new Error;this._drawCommandsService.removeSavedDrawCommands(index)}async pasteDrawCommands(commands){const lobby=await firstValueFrom(this._lobbyService.lobby$);if(lobby===null){await this._toastService.showToast("Can't paste outside of a lobby");return}if(lobby.drawerId!==lobby.meId){await this._toastService.showToast("You can only paste while you are drawing");return}this.clearBeforePaste&&this._drawingService.clearImage(),await this._drawingService.pasteDrawCommands(commands.commands,!this.pasteInstant)}abortPaste(){this._drawingService.cancelPendingDrawCommands()}async pickImageFromLocal(){const files=await chooseFile("image/*",!1);if(files===null)return null;const file=files[0],reader=new FileReader,result=new BehaviorSubject(void 0);return reader.onload=async e=>{var _a81;const data=(_a81=e.target)==null?void 0:_a81.result;if(typeof data!="string"){this._logger.error("Failed to read file",file),await this._toastService.showToast("Failed to read file"),result.next(null);return}result.next(data)},reader.readAsDataURL(file),await firstValueFrom(result.pipe(filter(v=>v!==void 0)))}async pasteImageToLocation(base64){this._logger.debug("Pasting image to location");const pickerComponent={componentType:Imagelab_position_picker,propsFactory:__name(submit=>({onPick:submit.bind(this)}),"propsFactory")},mode=await this._modalService.showPrompt(pickerComponent.componentType,pickerComponent.propsFactory,"Paste Image");if(this._logger.debug("Selected mode",mode),mode===void 0)return;let x,y,width,height;const canvas=(await this._elementsSetup.complete()).canvas,img=new Image;if(img.src=base64,await new Promise(resolve2=>img.onload=resolve2),mode==="fit"){const scale=Math.min(canvas.width/img.width,canvas.height/img.height);width=img.width*scale,height=img.height*scale,x=(canvas.width-width)/2,y=(canvas.height-height)/2}else if(mode==="fill")x=0,y=0,width=canvas.width,height=canvas.height;else if(mode==="position"){const toast=await this._toastService.showStickyToast("Paste Image","Click on the canvas to paste the image",!0);let position;try{position=await this.waitForCanvasClick(firstValueFrom(toast.closed$))}catch(e){this._logger.debug("Aborted paste image",e),toast.close();return}x=position.offsetX,y=position.offsetY,width=img.width,height=img.height,toast.close()}else if(mode==="range"){const toast=await this._toastService.showStickyToast("Paste Image","Click on the canvas to select the top-left corner",!0);let start,end;try{start=await this.waitForCanvasClick(firstValueFrom(toast.closed$)),toast.update("Paste Image","Click on the canvas to select the bottom-right corner"),end=await this.waitForCanvasClick(firstValueFrom(toast.closed$))}catch(e){this._logger.debug("Aborted paste image",e),toast.close();return}x=Math.min(start.offsetX,end.offsetX),y=Math.min(start.offsetY,end.offsetY),width=Math.abs(start.offsetX-end.offsetX),height=Math.abs(start.offsetY-end.offsetY),toast.close()}await this._drawingService.drawImage(base64,x,y,width,height)}async waitForCanvasClick(cancel){const click=new Subject$1,listener=__name(e=>(e.stopImmediatePropagation(),click.next(e),!1),"listener");cancel==null||cancel.then(()=>{click.complete(),events.remove("pointerdown",listener)});const events=await this._canvasEventsSetup.complete();events.add("preDraw")("pointerdown",listener);const result=await firstValueFrom(click);return events.remove("pointerdown",listener),result}};__name(_ToolbarImageLabFeature,"ToolbarImageLabFeature");let ToolbarImageLabFeature=_ToolbarImageLabFeature;__decorateClass$5([inject(ElementsSetup)],ToolbarImageLabFeature.prototype,"_elementsSetup");__decorateClass$5([inject(DrawingService)],ToolbarImageLabFeature.prototype,"_drawingService");__decorateClass$5([inject(ImagelabService)],ToolbarImageLabFeature.prototype,"_drawCommandsService");__decorateClass$5([inject(ToastService)],ToolbarImageLabFeature.prototype,"_toastService");__decorateClass$5([inject(ModalService)],ToolbarImageLabFeature.prototype,"_modalService");__decorateClass$5([inject(PrioritizedCanvasEventsSetup)],ToolbarImageLabFeature.prototype,"_canvasEventsSetup");__decorateClass$5([inject(LobbyService)],ToolbarImageLabFeature.prototype,"_lobbyService");__decorateClass$5([inject(GlobalSettingsService)],ToolbarImageLabFeature.prototype,"_globalSettingsService");function get_each_context$1(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[15]=list[i],child_ctx}__name(get_each_context$1,"get_each_context$1");function create_else_block$2(ctx){let div;return{c(){div=element$1("div"),div.textContent="The image history is empty. Check again later!"},m(target,anchor){insert(target,div,anchor)},p:noop$1,i:noop$1,o:noop$1,d(detaching){detaching&&detach(div)}}}__name(create_else_block$2,"create_else_block$2");function create_if_block_1$1(ctx){let input,t0,img,img_src_value,t1,div0,iconbutton0,t2,span,t3_value=ctx[1][ctx[3]].artist+"",t3,t4,t5_value=ctx[1][ctx[3]].date.toLocaleTimeString()+"",t5,t6,iconbutton1,t7,checkbox,updating_checked,t8,div1,t10,select,t11,if_block_anchor,current,mounted,dispose;iconbutton0=new Icon_button({props:{icon:"file-img-arrow-left-gif",name:"Previous",size:"1.5rem",hoverMove:!1,disabled:ctx[3]<=0}}),iconbutton0.$on("click",ctx[10]),iconbutton1=new Icon_button({props:{icon:"file-img-arrow-right-gif",name:"Next",size:"1.5rem",hoverMove:!1,disabled:ctx[3]>=ctx[1].length-1}}),iconbutton1.$on("click",ctx[11]);function checkbox_checked_binding(value){ctx[12](value)}__name(checkbox_checked_binding,"checkbox_checked_binding");let checkbox_props={description:"Send with Discord embed"};ctx[2]!==void 0&&(checkbox_props.checked=ctx[2]),checkbox=new Checkbox({props:checkbox_props}),binding_callbacks.push(()=>bind$1(checkbox,"checked",checkbox_checked_binding));let each_value=ensure_array_like(ctx[6].webhooks),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block$1(get_each_context$1(ctx,each_value,i));let if_block=ctx[5]!==null&&ctx[4]===null&&create_if_block_2$1(ctx);return{c(){input=element$1("input"),t0=space(),img=element$1("img"),t1=space(),div0=element$1("div"),create_component(iconbutton0.$$.fragment),t2=space(),span=element$1("span"),t3=text(t3_value),t4=text(" at  "),t5=text(t5_value),t6=space(),create_component(iconbutton1.$$.fragment),t7=space(),create_component(checkbox.$$.fragment),t8=space(),div1=element$1("div"),div1.textContent="Select one of your connected discord servers. When you submit, the image will appear in a channel on the server!",t10=space(),select=element$1("select");for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();t11=space(),if_block&&if_block.c(),if_block_anchor=empty(),attr(input,"type","text"),attr(input,"class","typo"),attr(input,"placeholder","Custom image name"),src_url_equal(img.src,img_src_value=ctx[1][ctx[3]].image.getBase64())||attr(img,"src",img_src_value),attr(img,"alt","Post image"),attr(img,"class","svelte-f411i0"),attr(div0,"class","navigate-image svelte-f411i0"),attr(div1,"class","typo-post-info svelte-f411i0"),ctx[5]===void 0&&add_render_callback(()=>ctx[13].call(select))},m(target,anchor){insert(target,input,anchor),set_input_value(input,ctx[1][ctx[3]].name),insert(target,t0,anchor),insert(target,img,anchor),insert(target,t1,anchor),insert(target,div0,anchor),mount_component(iconbutton0,div0,null),append(div0,t2),append(div0,span),append(span,t3),append(span,t4),append(span,t5),append(div0,t6),mount_component(iconbutton1,div0,null),insert(target,t7,anchor),mount_component(checkbox,target,anchor),insert(target,t8,anchor),insert(target,div1,anchor),insert(target,t10,anchor),insert(target,select,anchor);for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(select,null);select_option(select,ctx[5],!0),insert(target,t11,anchor),if_block&&if_block.m(target,anchor),insert(target,if_block_anchor,anchor),current=!0,mounted||(dispose=[listen(input,"input",ctx[9]),listen(select,"change",ctx[13])],mounted=!0)},p(ctx2,dirty){dirty&10&&input.value!==ctx2[1][ctx2[3]].name&&set_input_value(input,ctx2[1][ctx2[3]].name),(!current||dirty&10&&!src_url_equal(img.src,img_src_value=ctx2[1][ctx2[3]].image.getBase64()))&&attr(img,"src",img_src_value);const iconbutton0_changes={};dirty&8&&(iconbutton0_changes.disabled=ctx2[3]<=0),iconbutton0.$set(iconbutton0_changes),(!current||dirty&10)&&t3_value!==(t3_value=ctx2[1][ctx2[3]].artist+"")&&set_data(t3,t3_value),(!current||dirty&10)&&t5_value!==(t5_value=ctx2[1][ctx2[3]].date.toLocaleTimeString()+"")&&set_data(t5,t5_value);const iconbutton1_changes={};dirty&10&&(iconbutton1_changes.disabled=ctx2[3]>=ctx2[1].length-1),iconbutton1.$set(iconbutton1_changes);const checkbox_changes={};if(!updating_checked&&dirty&4&&(updating_checked=!0,checkbox_changes.checked=ctx2[2],add_flush_callback(()=>updating_checked=!1)),checkbox.$set(checkbox_changes),dirty&64){each_value=ensure_array_like(ctx2[6].webhooks);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context$1(ctx2,each_value,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block$1(child_ctx),each_blocks[i].c(),each_blocks[i].m(select,null))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value.length}dirty&96&&select_option(select,ctx2[5]),ctx2[5]!==null&&ctx2[4]===null?if_block?(if_block.p(ctx2,dirty),dirty&48&&transition_in(if_block,1)):(if_block=create_if_block_2$1(ctx2),if_block.c(),transition_in(if_block,1),if_block.m(if_block_anchor.parentNode,if_block_anchor)):if_block&&(group_outros(),transition_out(if_block,1,1,()=>{if_block=null}),check_outros())},i(local){current||(transition_in(iconbutton0.$$.fragment,local),transition_in(iconbutton1.$$.fragment,local),transition_in(checkbox.$$.fragment,local),transition_in(if_block),current=!0)},o(local){transition_out(iconbutton0.$$.fragment,local),transition_out(iconbutton1.$$.fragment,local),transition_out(checkbox.$$.fragment,local),transition_out(if_block),current=!1},d(detaching){detaching&&(detach(input),detach(t0),detach(img),detach(t1),detach(div0),detach(t7),detach(t8),detach(div1),detach(t10),detach(select),detach(t11),detach(if_block_anchor)),destroy_component(iconbutton0),destroy_component(iconbutton1),destroy_component(checkbox,detaching),destroy_each(each_blocks,detaching),if_block&&if_block.d(detaching),mounted=!1,run_all(dispose)}}}__name(create_if_block_1$1,"create_if_block_1$1");function create_each_block$1(ctx){let option,t0_value=ctx[15].name+"",t0,t1,t2_value=ctx[15].guild.guildName+"",t2,t3,option_value_value;return{c(){option=element$1("option"),t0=text(t0_value),t1=text(" ("),t2=text(t2_value),t3=text(")"),option.__value=option_value_value=ctx[15],set_input_value(option,option.__value)},m(target,anchor){insert(target,option,anchor),append(option,t0),append(option,t1),append(option,t2),append(option,t3)},p(ctx2,dirty){dirty&64&&t0_value!==(t0_value=ctx2[15].name+"")&&set_data(t0,t0_value),dirty&64&&t2_value!==(t2_value=ctx2[15].guild.guildName+"")&&set_data(t2,t2_value),dirty&64&&option_value_value!==(option_value_value=ctx2[15])&&(option.__value=option_value_value,set_input_value(option,option.__value))},d(detaching){detaching&&detach(option)}}}__name(create_each_block$1,"create_each_block$1");function create_if_block_2$1(ctx){let flatbutton,current;return flatbutton=new Flat_button({props:{content:"Send to Server",color:"green"}}),flatbutton.$on("click",ctx[14]),{c(){create_component(flatbutton.$$.fragment)},m(target,anchor){mount_component(flatbutton,target,anchor),current=!0},p:noop$1,i(local){current||(transition_in(flatbutton.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton.$$.fragment,local),current=!1},d(detaching){destroy_component(flatbutton,detaching)}}}__name(create_if_block_2$1,"create_if_block_2$1");function create_if_block$2(ctx){let div;return{c(){div=element$1("div"),div.textContent="Log in with your typo account to post images to one of your Discord servers!",attr(div,"class","not-logged-in svelte-f411i0")},m(target,anchor){insert(target,div,anchor)},d(detaching){detaching&&detach(div)}}}__name(create_if_block$2,"create_if_block$2");function create_fragment$5(ctx){let div,current_block_type_index,if_block0,t,current;const if_block_creators=[create_if_block_1$1,create_else_block$2],if_blocks=[];function select_block_type(ctx2,dirty){return ctx2[1].length>0&&ctx2[6]!==void 0&&ctx2[6]!==null?0:1}__name(select_block_type,"select_block_type"),current_block_type_index=select_block_type(ctx),if_block0=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx);let if_block1=(ctx[6]===null||ctx[6]===void 0)&&create_if_block$2();return{c(){div=element$1("div"),if_block0.c(),t=space(),if_block1&&if_block1.c(),attr(div,"class","typo-image-post svelte-f411i0")},m(target,anchor){insert(target,div,anchor),if_blocks[current_block_type_index].m(div,null),append(div,t),if_block1&&if_block1.m(div,null),current=!0},p(ctx2,[dirty]){let previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx2),current_block_type_index===previous_block_index?if_blocks[current_block_type_index].p(ctx2,dirty):(group_outros(),transition_out(if_blocks[previous_block_index],1,1,()=>{if_blocks[previous_block_index]=null}),check_outros(),if_block0=if_blocks[current_block_type_index],if_block0?if_block0.p(ctx2,dirty):(if_block0=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx2),if_block0.c()),transition_in(if_block0,1),if_block0.m(div,t)),ctx2[6]===null||ctx2[6]===void 0?if_block1||(if_block1=create_if_block$2(),if_block1.c(),if_block1.m(div,null)):if_block1&&(if_block1.d(1),if_block1=null)},i(local){current||(transition_in(if_block0),current=!0)},o(local){transition_out(if_block0),current=!1},d(detaching){detaching&&detach(div),if_blocks[current_block_type_index].d(),if_block1&&if_block1.d()}}}__name(create_fragment$5,"create_fragment$5");function instance$5($$self,$$props,$$invalidate){let $history,$member,{feature}=$$props,sendAsEmbed=!0,viewIndex=0,loading=null;const history=feature.imageHistoryStore;component_subscribe($$self,history,value=>$$invalidate(1,$history=value));const member=feature.memberStore;component_subscribe($$self,member,value=>$$invalidate(6,$member=value));let selectedWebhook=($member==null?void 0:$member.webhooks[0])??null;function input_input_handler(){$history[viewIndex].name=this.value,history.set($history)}__name(input_input_handler,"input_input_handler");const click_handler2=__name(()=>$$invalidate(3,viewIndex--,viewIndex),"click_handler"),click_handler_1=__name(()=>$$invalidate(3,viewIndex++,viewIndex),"click_handler_1");function checkbox_checked_binding(value){sendAsEmbed=value,$$invalidate(2,sendAsEmbed)}__name(checkbox_checked_binding,"checkbox_checked_binding");function select_change_handler(){selectedWebhook=select_value(this),$$invalidate(5,selectedWebhook)}__name(select_change_handler,"select_change_handler");const click_handler_2=__name(()=>$$invalidate(4,loading=selectedWebhook?feature.postWebhook(selectedWebhook,$history[viewIndex],!sendAsEmbed):null),"click_handler_2");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},$$self.$$.update=()=>{$$self.$$.dirty&2&&$$invalidate(3,viewIndex=$history.length-1)},[feature,$history,sendAsEmbed,viewIndex,loading,selectedWebhook,$member,history,member,input_input_handler,click_handler2,click_handler_1,checkbox_checked_binding,select_change_handler,click_handler_2]}__name(instance$5,"instance$5");const _Toolbar_imagepost=class _Toolbar_imagepost extends SvelteComponent{constructor(options){super(),init(this,options,instance$5,create_fragment$5,safe_not_equal,{feature:0})}};__name(_Toolbar_imagepost,"Toolbar_imagepost");let Toolbar_imagepost=_Toolbar_imagepost;var __defProp$4=Object.defineProperty,__decorateClass$4=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$4(target,key,result),result},"__decorateClass$4");const _ToolbarImagePostFeature=class _ToolbarImagePostFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elementsSetup");__publicField(this,"_imagePostService");__publicField(this,"_imageFinishedService");__publicField(this,"_drawingService");__publicField(this,"_memberService");__publicField(this,"_apiService");__publicField(this,"_toastService");__publicField(this,"name","Image Post");__publicField(this,"description","Adds an icon to the typo toolbar to send images from your lobby directly to one of your connected discord servers");__publicField(this,"featureId",11);__publicField(this,"_iconComponent");__publicField(this,"_iconClickSubscription");__publicField(this,"_flyoutComponent");__publicField(this,"_flyoutSubscription");__publicField(this,"_popoutOpened$",new Subject$1);__publicField(this,"_submitted$",new Subject$1)}get boundServices(){return[this._imagePostService]}async onActivate(){const elements2=await this._elementsSetup.complete();this._iconComponent=new Icon_button({target:elements2.toolbar,props:{icon:"file-img-letter-gif",name:"Post Image",order:5,tooltipAction:this.createTooltip,lockTooltip:"Y"}}),this._iconClickSubscription=this._iconComponent.click$.subscribe(()=>{if(this._flyoutComponent)return;this._popoutOpened$.next();const flyoutContent={componentType:Toolbar_imagepost,props:{feature:this}};this._flyoutComponent=new Area_flyout({target:elements2.gameWrapper,props:{componentData:flyoutContent,areaName:"chat",maxHeight:"600px",maxWidth:"300px",title:"Post Image",iconName:"file-img-letter-gif"}}),this._flyoutSubscription=this._flyoutComponent.closed$.pipe(mergeWith(this._submitted$)).subscribe(()=>{var _a81,_b;this._logger.info("Destroyed flyout"),(_a81=this._flyoutComponent)==null||_a81.$destroy(),(_b=this._flyoutSubscription)==null||_b.unsubscribe(),this._flyoutComponent=void 0})})}onDestroy(){var _a81,_b,_c,_d;(_a81=this._iconClickSubscription)==null||_a81.unsubscribe(),(_b=this._iconComponent)==null||_b.$destroy(),(_c=this._flyoutComponent)==null||_c.$destroy(),(_d=this._flyoutSubscription)==null||_d.unsubscribe(),this._flyoutComponent=void 0}get imageHistoryStore(){const observable2=this._imagePostService.history$.pipe(switchMap(history=>this._drawingService.drawingState$.pipe(take(1),switchMap(state=>state==="drawing"?this._imageFinishedService.mapToImageState(of(1)):of(null)),map(currentImage=>currentImage===null?history:[...history,currentImage]))));return fromObservable(observable2,[])}get memberStore(){return fromObservable(this._memberService.memberData$,null)}async postWebhook(webhook,image,onlyImage){const toast=await this._toastService.showLoadingToast("Posting image to "+webhook.name);try{await this._apiService.getApi(GuildsApi).postImageToGuild({token:webhook.guild.invite,id:webhook.name,postImageDto:{title:image.name,author:image.artist,posterName:image.player,onlyImage,imageBase64:image.image.base64ApiTruncated}}),this._submitted$.next(),toast.resolve()}catch(e){this._logger.error("Failed to post image to discord",e),toast.reject()}}};__name(_ToolbarImagePostFeature,"ToolbarImagePostFeature");let ToolbarImagePostFeature=_ToolbarImagePostFeature;__decorateClass$4([inject(ElementsSetup)],ToolbarImagePostFeature.prototype,"_elementsSetup");__decorateClass$4([inject(ImagePostService)],ToolbarImagePostFeature.prototype,"_imagePostService");__decorateClass$4([inject(ImageFinishedService)],ToolbarImagePostFeature.prototype,"_imageFinishedService");__decorateClass$4([inject(DrawingService)],ToolbarImagePostFeature.prototype,"_drawingService");__decorateClass$4([inject(MemberService)],ToolbarImagePostFeature.prototype,"_memberService");__decorateClass$4([inject(ApiService)],ToolbarImagePostFeature.prototype,"_apiService");__decorateClass$4([inject(ToastService)],ToolbarImagePostFeature.prototype,"_toastService");const _StringOptionalCommandParameter=class _StringOptionalCommandParameter extends ExtensionCommandParameter{constructor(name,description,_mapping){super(name,description);__publicField(this,"typeName","word?");this._mapping=_mapping}readArg(args,dontMarkAsInterpreting){const split=args.trim().split(" "),arg=split[0].trim();if(arg.length<1)return dontMarkAsInterpreting(),{remainder:"",argument:this._mapping(void 0)};const argument=this._mapping(arg);return{remainder:split.slice(1).join(" "),argument}}};__name(_StringOptionalCommandParameter,"StringOptionalCommandParameter");let StringOptionalCommandParameter=_StringOptionalCommandParameter;function create_fragment$4(ctx){let div,input,t0,flatbutton0,t1,flatbutton1,t2,flatbutton2,t3,flatbutton3,current,mounted,dispose;return flatbutton0=new Flat_button({props:{content:"Download PNG",color:"green"}}),flatbutton0.$on("click",ctx[2]),flatbutton1=new Flat_button({props:{content:"Download GIF",color:"green"}}),flatbutton1.$on("click",ctx[3]),flatbutton2=new Flat_button({props:{content:"Download Draw Progress",color:"green"}}),flatbutton2.$on("click",ctx[4]),flatbutton3=new Flat_button({props:{content:"Save in Cloud",color:"blue"}}),flatbutton3.$on("click",ctx[5]),{c(){div=element$1("div"),input=element$1("input"),t0=space(),create_component(flatbutton0.$$.fragment),t1=space(),create_component(flatbutton1.$$.fragment),t2=space(),create_component(flatbutton2.$$.fragment),t3=space(),create_component(flatbutton3.$$.fragment),attr(input,"type","text"),attr(input,"class","typo"),attr(input,"placeholder","Custom image name"),attr(div,"class","typo-toolbar-save-actions svelte-1xyzs78")},m(target,anchor){insert(target,div,anchor),append(div,input),set_input_value(input,ctx[0].customName),append(div,t0),mount_component(flatbutton0,div,null),append(div,t1),mount_component(flatbutton1,div,null),append(div,t2),mount_component(flatbutton2,div,null),append(div,t3),mount_component(flatbutton3,div,null),current=!0,mounted||(dispose=listen(input,"input",ctx[1]),mounted=!0)},p(ctx2,[dirty]){dirty&1&&input.value!==ctx2[0].customName&&set_input_value(input,ctx2[0].customName)},i(local){current||(transition_in(flatbutton0.$$.fragment,local),transition_in(flatbutton1.$$.fragment,local),transition_in(flatbutton2.$$.fragment,local),transition_in(flatbutton3.$$.fragment,local),current=!0)},o(local){transition_out(flatbutton0.$$.fragment,local),transition_out(flatbutton1.$$.fragment,local),transition_out(flatbutton2.$$.fragment,local),transition_out(flatbutton3.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div),destroy_component(flatbutton0),destroy_component(flatbutton1),destroy_component(flatbutton2),destroy_component(flatbutton3),mounted=!1,dispose()}}}__name(create_fragment$4,"create_fragment$4");function instance$4($$self,$$props,$$invalidate){let{feature}=$$props;feature.customName="";function input_input_handler(){feature.customName=this.value,$$invalidate(0,feature)}__name(input_input_handler,"input_input_handler");const click_handler2=__name(()=>feature.saveAsPng(),"click_handler"),click_handler_1=__name(()=>feature.saveAsGif(),"click_handler_1"),click_handler_2=__name(()=>feature.saveAsDrawCommands(),"click_handler_2"),click_handler_3=__name(()=>feature.saveInCloud(),"click_handler_3");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},[feature,input_input_handler,click_handler2,click_handler_1,click_handler_2,click_handler_3]}__name(instance$4,"instance$4");const _Toolbar_save=class _Toolbar_save extends SvelteComponent{constructor(options){super(),init(this,options,instance$4,create_fragment$4,safe_not_equal,{feature:0})}};__name(_Toolbar_save,"Toolbar_save");let Toolbar_save=_Toolbar_save;var __defProp$3=Object.defineProperty,__decorateClass$3=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$3(target,key,result),result},"__decorateClass$3");const _ToolbarSaveFeature=class _ToolbarSaveFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elementsSetup");__publicField(this,"_drawingService");__publicField(this,"_lobbyService");__publicField(this,"_toastService");__publicField(this,"_cloudService");__publicField(this,"_memberService");__publicField(this,"_imageFinishedService");__publicField(this,"name","Save Image");__publicField(this,"description","Adds an icon to the typo toolbar to save the current image locally, to cloud, as gif or as draw command file");__publicField(this,"featureId",12);__publicField(this,"_iconComponent");__publicField(this,"_iconClickSubscription");__publicField(this,"_flyoutComponent");__publicField(this,"_flyoutSubscription");__publicField(this,"_customName");__publicField(this,"_saveCommand",this.useCommand(new ExtensionCommand("save",this,"Save Image","Downloads the current image")).withParameters(params=>params.addParam(new StringOptionalCommandParameter("File name","The filename of the downloaded image",name=>({name}))).run(async(args,command)=>(this._customName=args.name,await this.saveAsPng(),new InterpretableSilentSuccess(command)))))}set customName(value){const val=(value==null?void 0:value.replace(/[^a-z0-9]/gi,"_").toLowerCase())??void 0;this._customName=val&&val.length>0?val:void 0}get customName(){return this._customName}async onActivate(){const elements2=await this._elementsSetup.complete();this._iconComponent=new Icon_button({target:elements2.toolbar,props:{icon:"file-img-floppy-drive-gif",name:"Save Image",order:2,tooltipAction:this.createTooltip,lockTooltip:"Y"}}),this._iconClickSubscription=this._iconComponent.click$.subscribe(()=>{if(this._flyoutComponent)return;const flyoutContent={componentType:Toolbar_save,props:{feature:this}};this._flyoutComponent=new Area_flyout({target:elements2.gameWrapper,props:{componentData:flyoutContent,areaName:"chat",maxHeight:"600px",maxWidth:"300px",title:"Save Image",iconName:"file-img-floppy-drive-gif"}}),this._flyoutSubscription=this._flyoutComponent.closed$.subscribe(()=>{var _a81,_b;this._logger.info("Destroyed flyout"),(_a81=this._flyoutComponent)==null||_a81.$destroy(),(_b=this._flyoutSubscription)==null||_b.unsubscribe(),this._flyoutComponent=void 0})})}async saveInCloud(){const toast=await this._toastService.showLoadingToast("Uploading image");this._imageFinishedService.mapToImageState().pipe(withLatestFrom(this._memberService.member$),catchError(err=>{throw this._logger.error("Failed to save image",err),toast.reject("Unknown error :("),err})).subscribe(async([image,member])=>{if(!image)throw this._logger.error("Failed to get image data, no drawing active?"),toast.reject("Failed to get image"),new Error("No drawing active");if(!member)return this._logger.error("Failed to get member, not logged in?"),toast.reject("You need to log in to use the cloud"),of(!1);this._customName&&(image.name=this._customName),await this._cloudService.uploadToCloud(image,member),toast.resolve()})}async saveAsPng(){const toast=await this._toastService.showLoadingToast("Downloading image");combineLatest$1({blob:fromPromise(this._drawingService.getCurrentImageData()).pipe(map(data=>data.blob)),meta:this._drawingService.imageState$.pipe(take(1)),lobby:this._lobbyService.lobby$.pipe(take(1))}).pipe(catchError(err=>{throw this._logger.error("Failed to download image",err),toast.reject(),err})).subscribe(({blob,meta,lobby})=>{var _a81;if(!meta)throw this._logger.error("Failed to get image meta data, no drawing active?"),toast.reject("Failed to get image"),new Error("No drawing active");if(!lobby)throw this._logger.error("Failed to get lobby, not joined?"),toast.reject("failed to get lobby details"),new Error("Not joined in lobby");const drawer=((_a81=lobby.players.find(player=>player.id===meta.drawerId))==null?void 0:_a81.name)??"unknown";downloadBlob(blob,(this._customName??`skribbl-${meta.word.hints}-by-${drawer}`)+".png"),toast.resolve()})}saveAsGif(){this._logger.debug("Saving as gif")}async saveAsDrawCommands(){this._logger.debug("Saving as draw commands");const toast=await this._toastService.showLoadingToast("Downloading commands");combineLatest$1({meta:this._drawingService.imageState$.pipe(take(1)),lobby:this._lobbyService.lobby$.pipe(take(1)),commands:this._drawingService.commands$.pipe(take(1))}).pipe(catchError(err=>{throw this._logger.error("Failed to download commands",err),toast.reject(),err})).subscribe(({meta,lobby,commands})=>{var _a81;if(!meta)throw this._logger.error("Failed to get image meta data, no drawing active?"),toast.reject("Failed to get image"),new Error("No drawing active");if(!lobby)throw this._logger.error("Failed to get lobby, not joined?"),toast.reject("failed to get lobby details"),new Error("Not joined in lobby");const json=JSON.stringify(commands),drawer=((_a81=lobby.players.find(player=>player.id===meta.drawerId))==null?void 0:_a81.name)??"unknown";downloadText(json,(this._customName??`skribbl-${meta.word.hints}-by-${drawer}`)+".skd"),toast.resolve()})}onDestroy(){var _a81,_b,_c,_d;(_a81=this._iconClickSubscription)==null||_a81.unsubscribe(),(_b=this._iconComponent)==null||_b.$destroy(),(_c=this._flyoutComponent)==null||_c.$destroy(),(_d=this._flyoutSubscription)==null||_d.unsubscribe()}};__name(_ToolbarSaveFeature,"ToolbarSaveFeature");let ToolbarSaveFeature=_ToolbarSaveFeature;__decorateClass$3([inject(ElementsSetup)],ToolbarSaveFeature.prototype,"_elementsSetup");__decorateClass$3([inject(DrawingService)],ToolbarSaveFeature.prototype,"_drawingService");__decorateClass$3([inject(LobbyService)],ToolbarSaveFeature.prototype,"_lobbyService");__decorateClass$3([inject(ToastService)],ToolbarSaveFeature.prototype,"_toastService");__decorateClass$3([inject(CloudService)],ToolbarSaveFeature.prototype,"_cloudService");__decorateClass$3([inject(MemberService)],ToolbarSaveFeature.prototype,"_memberService");__decorateClass$3([inject(ImageFinishedService)],ToolbarSaveFeature.prototype,"_imageFinishedService");function create_fragment$3(ctx){let div1,div0,t0,span,t1,div1_class_value;return{c(){div1=element$1("div"),div0=element$1("div"),t0=space(),span=element$1("span"),t1=text(ctx[0]),attr(div0,"class","typo-tooltip-arrow svelte-ffctjy"),attr(span,"class","svelte-ffctjy"),attr(div1,"class",div1_class_value="typo-tooltip "+ctx[1]+" svelte-ffctjy"),set_style(div1,"top",ctx[3]+"px"),set_style(div1,"left",ctx[2]+"px")},m(target,anchor){insert(target,div1,anchor),append(div1,div0),append(div1,t0),append(div1,span),append(span,t1)},p(ctx2,[dirty]){dirty&1&&set_data(t1,ctx2[0]),dirty&2&&div1_class_value!==(div1_class_value="typo-tooltip "+ctx2[1]+" svelte-ffctjy")&&attr(div1,"class",div1_class_value),dirty&8&&set_style(div1,"top",ctx2[3]+"px"),dirty&4&&set_style(div1,"left",ctx2[2]+"px")},i:noop$1,o:noop$1,d(detaching){detaching&&detach(div1)}}}__name(create_fragment$3,"create_fragment$3");function instance$3($$self,$$props,$$invalidate){let{title}=$$props,{direction}=$$props,{anchorX}=$$props,{anchorY}=$$props;return $$self.$$set=$$props2=>{"title"in $$props2&&$$invalidate(0,title=$$props2.title),"direction"in $$props2&&$$invalidate(1,direction=$$props2.direction),"anchorX"in $$props2&&$$invalidate(2,anchorX=$$props2.anchorX),"anchorY"in $$props2&&$$invalidate(3,anchorY=$$props2.anchorY)},[title,direction,anchorX,anchorY]}__name(instance$3,"instance$3");const _Tooltip=class _Tooltip extends SvelteComponent{constructor(options){super(),init(this,options,instance$3,create_fragment$3,safe_not_equal,{title:0,direction:1,anchorX:2,anchorY:3})}};__name(_Tooltip,"Tooltip");let Tooltip=_Tooltip;const _TooltipsFeature=class _TooltipsFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"name","Tooltips");__publicField(this,"description","Show helpful information when hovering over icons and buttons");__publicField(this,"featureId",35);__publicField(this,"_pointeroverListener",this.handlePointerover.bind(this));__publicField(this,"_currentTarget",new BehaviorSubject(null));__publicField(this,"_targetSubscription");__publicField(this,"_activeTooltips",new Map)}async onActivate(){this._targetSubscription=this._currentTarget.pipe(combineLatestWith(this._tooltipsService.tooltips$)).subscribe(([target,tooltips])=>{this.handleTooltipChange(target,tooltips)}),document.addEventListener("pointerover",this._pointeroverListener)}async onDestroy(){var _a81;(_a81=this._targetSubscription)==null||_a81.unsubscribe(),this._targetSubscription=void 0,document.removeEventListener("pointerover",this._pointeroverListener),this._activeTooltips.forEach(t=>t.tooltip.remove()),this._activeTooltips.clear()}handlePointerover(event){this._logger.debug("Pointerover",event.target);const target=event.target;if(target instanceof HTMLElement){const targets=this._tooltipsService.getTooltipsUntilElement(target);if(targets.length>=1){const target2=targets[0];target2!==this._currentTarget.value&&(this._logger.info("Found new target",targets),this._currentTarget.next(target2))}else this._currentTarget.value!==null&&(this._logger.info("Removed tooltip target",targets),this._currentTarget.next(null))}else this._currentTarget.next(null)}handleTooltipChange(target,tooltips){if(this._logger.info("Tooltip change",target,tooltips),this._activeTooltips.forEach(t=>{t.registration.target!==target&&(this._activeTooltips.delete(t.registration.target),t.tooltip.$destroy())}),target!==null&&!this._activeTooltips.has(target)){const registration=tooltips.find(t=>t.target===target);if(!registration)return;const tooltip=this.buildTooltip(registration);this._activeTooltips.set(target,{registration,tooltip})}}buildTooltip(tooltip){const coordinates=this.getVisibleDimensionsAndCoordinates(tooltip.target),viewportWidth=window.innerWidth,viewportHeight=window.innerHeight,spaceTop=coordinates.top,spaceBottom=viewportHeight-coordinates.top-coordinates.height,spaceLeft=coordinates.left,spaceRight=viewportWidth-coordinates.left-coordinates.width;let direction=tooltip.lock!=="Y"?"E":"N",anchorX=tooltip.lock!=="Y"?coordinates.left+coordinates.width:coordinates.left+coordinates.width/2,anchorY=tooltip.lock!=="Y"?coordinates.top+coordinates.height/2:coordinates.top;return tooltip.lock!=="X"&&spaceTop>spaceBottom&&(spaceTop>spaceLeft&&spaceTop>spaceRight||tooltip.lock==="Y")?(direction="N",anchorX=coordinates.left+coordinates.width/2,anchorY=coordinates.top):tooltip.lock!=="X"&&spaceBottom>spaceTop&&(spaceBottom>spaceLeft&&spaceBottom>spaceRight||tooltip.lock==="Y")?(direction="S",anchorX=coordinates.left+coordinates.width/2,anchorY=coordinates.top+coordinates.height):tooltip.lock!=="Y"&&spaceLeft>spaceRight&&(direction="W",anchorX=coordinates.left,anchorY=coordinates.top+coordinates.height/2),new Tooltip({target:document.body,props:{title:tooltip.title,anchorX,anchorY,direction}})}getVisibleDimensionsAndCoordinates(element2){const elementRect=element2.getBoundingClientRect(),visibleRect={top:elementRect.top,left:elementRect.left,width:elementRect.width,height:elementRect.height};let currentElement=element2;for(;currentElement!==null;){const parent=currentElement.parentElement;if(parent){const parentRect=parent.getBoundingClientRect();getComputedStyle(parent).overflow!=="visible"&&(visibleRect.top=Math.max(visibleRect.top,parentRect.top),visibleRect.left=Math.max(visibleRect.left,parentRect.left),visibleRect.width=Math.min(visibleRect.width,parentRect.right-visibleRect.left),visibleRect.height=Math.min(visibleRect.height,parentRect.bottom-visibleRect.top))}currentElement=parent}return visibleRect.width=Math.min(visibleRect.width,window.innerWidth-visibleRect.left),visibleRect.height=Math.min(visibleRect.height,window.innerHeight-visibleRect.top),visibleRect.top=Math.max(visibleRect.top,0),visibleRect.left=Math.max(visibleRect.left,0),{width:Math.max(0,visibleRect.width),height:Math.max(0,visibleRect.height),top:visibleRect.top,left:visibleRect.left}}};__name(_TooltipsFeature,"TooltipsFeature");let TooltipsFeature=_TooltipsFeature;function create_fragment$2(ctx){let div,img0,img0_src_value,t,img1,img1_src_value,mounted,dispose;return{c(){div=element$1("div"),img0=element$1("img"),t=space(),img1=element$1("img"),src_url_equal(img0.src,img0_src_value="")||attr(img0,"src",img0_src_value),attr(img0,"alt","Exit Lobby"),attr(img0,"class","lobby-exit lobbyNavIcon exit svelte-yw7ztm"),src_url_equal(img1.src,img1_src_value="")||attr(img1,"src",img1_src_value),attr(img1,"alt","Next Lobby"),attr(img1,"class","lobby-next lobbyNavIcon next svelte-yw7ztm"),attr(div,"class","lobby-navigation svelte-yw7ztm")},m(target,anchor){insert(target,div,anchor),append(div,img0),append(div,t),append(div,img1),mounted||(dispose=[listen(img0,"click",ctx[1]),action_destroyer(ctx[0].createTooltip(img0,{title:"Exit Lobby",lock:"Y"})),listen(img1,"click",ctx[2]),action_destroyer(ctx[0].createTooltip(img1,{title:"Next Lobby",lock:"Y"}))],mounted=!0)},p:noop$1,i:noop$1,o:noop$1,d(detaching){detaching&&detach(div),mounted=!1,run_all(dispose)}}}__name(create_fragment$2,"create_fragment$2");function instance$2($$self,$$props,$$invalidate){let{feature}=$$props;const click_handler2=__name(()=>feature.exitLobby(),"click_handler"),click_handler_1=__name(()=>feature.nextLobby(),"click_handler_1");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},[feature,click_handler2,click_handler_1]}__name(instance$2,"instance$2");const _Lobby_navigation=class _Lobby_navigation extends SvelteComponent{constructor(options){super(),init(this,options,instance$2,create_fragment$2,safe_not_equal,{feature:0})}};__name(_Lobby_navigation,"Lobby_navigation");let Lobby_navigation=_Lobby_navigation;var __defProp$2=Object.defineProperty,__decorateClass$2=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$2(target,key,result),result},"__decorateClass$2");const _LobbyNavigationFeature=class _LobbyNavigationFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elementsSetup");__publicField(this,"_lobbyService");__publicField(this,"name","Lobby Navigation");__publicField(this,"description","Show a navigation bar in-game to exit or skip the current lobby");__publicField(this,"featureId",2);__publicField(this,"_component");__publicField(this,"_nextCommand",this.useCommand(new ExtensionCommand("skip",this,"Skip Lobby","Leave the current lobby and join another")).run(async command=>(this.nextLobby(),new InterpretableSuccess(command,"Skipping lobby"))));__publicField(this,"_leaveCommand",this.useCommand(new ExtensionCommand("leave",this,"Left Lobby","Leave the current lobby")).run(async command=>(this.exitLobby(),new InterpretableSuccess(command,"Skipped lobby"))))}async onActivate(){const elements2=await this._elementsSetup.complete();this._component=new Lobby_navigation({target:elements2.gameBar,anchor:elements2.gameSettings,props:{feature:this}})}onDestroy(){var _a81;(_a81=this._component)==null||_a81.$destroy()}nextLobby(){this._lobbyService.lobby$.pipe(tap(lobby=>{lobby!==null&&this._lobbyService.leaveLobby()}),filter(lobby=>lobby===null),take(1)).subscribe(()=>{this._lobbyService.joinLobby()})}exitLobby(){this._lobbyService.lobby$.pipe(take(1),filter(lobby=>lobby!==null)).subscribe(()=>{this._lobbyService.leaveLobby()})}};__name(_LobbyNavigationFeature,"LobbyNavigationFeature");let LobbyNavigationFeature=_LobbyNavigationFeature;__decorateClass$2([inject(ElementsSetup)],LobbyNavigationFeature.prototype,"_elementsSetup");__decorateClass$2([inject(LobbyService)],LobbyNavigationFeature.prototype,"_lobbyService");function create_else_block$1(ctx){let div0,a0,img,img_src_value,t0,t1_value=ctx[1].userName+"",t1,t2,a1,t4,span0,t6,div3,div1,span1,span2,span3,t9_value=ctx[1].bubbles+"",t9,t10,div2,span4,span5,span6,t13_value=Math.round(ctx[1].drops*10)/10+"",t13,t14,if_block_anchor,mounted,dispose,if_block=ctx[2]&&create_if_block_2(ctx);return{c(){div0=element$1("div"),a0=element$1("a"),img=element$1("img"),t0=space(),t1=text(t1_value),t2=space(),a1=element$1("a"),a1.textContent="Manage",t4=space(),span0=element$1("span"),span0.textContent="Logout",t6=space(),div3=element$1("div"),div1=element$1("div"),span1=element$1("span"),span1.textContent="🫧",span2=element$1("span"),span2.textContent="Bubbles:",span3=element$1("span"),t9=text(t9_value),t10=space(),div2=element$1("div"),span4=element$1("span"),span4.textContent="💧",span5=element$1("span"),span5.textContent="Drops:",span6=element$1("span"),t13=text(t13_value),t14=space(),if_block&&if_block.c(),if_block_anchor=empty(),attr(img,"alt","typo icon"),src_url_equal(img.src,img_src_value="")||attr(img,"src",img_src_value),attr(img,"class","svelte-1hgy57u"),attr(a0,"href","https://www.typo.rip"),attr(a0,"class","svelte-1hgy57u"),attr(a1,"href","https://www.typo.rip/user"),attr(a1,"class","svelte-1hgy57u"),attr(span0,"role","button"),attr(span0,"tabindex","0"),attr(span0,"class","svelte-1hgy57u"),attr(div0,"class","member-info-header svelte-1hgy57u"),attr(span1,"class","svelte-1hgy57u"),attr(span2,"class","svelte-1hgy57u"),attr(span3,"class","svelte-1hgy57u"),attr(div1,"class","svelte-1hgy57u"),attr(span4,"class","svelte-1hgy57u"),attr(span5,"class","svelte-1hgy57u"),attr(span6,"class","svelte-1hgy57u"),attr(div2,"class","svelte-1hgy57u"),attr(div3,"class","member-info-stats svelte-1hgy57u")},m(target,anchor){insert(target,div0,anchor),append(div0,a0),append(a0,img),append(a0,t0),append(a0,t1),append(div0,t2),append(div0,a1),append(div0,t4),append(div0,span0),insert(target,t6,anchor),insert(target,div3,anchor),append(div3,div1),append(div1,span1),append(div1,span2),append(div1,span3),append(span3,t9),append(div3,t10),append(div3,div2),append(div2,span4),append(div2,span5),append(div2,span6),append(span6,t13),insert(target,t14,anchor),if_block&&if_block.m(target,anchor),insert(target,if_block_anchor,anchor),mounted||(dispose=[listen(span0,"keydown",ctx[6]),listen(span0,"click",ctx[7])],mounted=!0)},p(ctx2,dirty){dirty&2&&t1_value!==(t1_value=ctx2[1].userName+"")&&set_data(t1,t1_value),dirty&2&&t9_value!==(t9_value=ctx2[1].bubbles+"")&&set_data(t9,t9_value),dirty&2&&t13_value!==(t13_value=Math.round(ctx2[1].drops*10)/10+"")&&set_data(t13,t13_value),ctx2[2]?if_block?if_block.p(ctx2,dirty):(if_block=create_if_block_2(ctx2),if_block.c(),if_block.m(if_block_anchor.parentNode,if_block_anchor)):if_block&&(if_block.d(1),if_block=null)},i:noop$1,o:noop$1,d(detaching){detaching&&(detach(div0),detach(t6),detach(div3),detach(t14),detach(if_block_anchor)),if_block&&if_block.d(detaching),mounted=!1,run_all(dispose)}}}__name(create_else_block$1,"create_else_block$1");function create_if_block_1(ctx){let div,bounceload,current;return bounceload=new Bounceload({props:{content:"Loading..."}}),{c(){div=element$1("div"),create_component(bounceload.$$.fragment)},m(target,anchor){insert(target,div,anchor),mount_component(bounceload,div,null),current=!0},p:noop$1,i(local){current||(transition_in(bounceload.$$.fragment,local),current=!0)},o(local){transition_out(bounceload.$$.fragment,local),current=!1},d(detaching){detaching&&detach(div),destroy_component(bounceload)}}}__name(create_if_block_1,"create_if_block_1");function create_if_block$1(ctx){let div,input,mounted,dispose;return{c(){div=element$1("div"),input=element$1("input"),attr(input,"type","button"),input.value="Login"},m(target,anchor){insert(target,div,anchor),append(div,input),mounted||(dispose=listen(input,"click",ctx[5]),mounted=!0)},p:noop$1,i:noop$1,o:noop$1,d(detaching){detaching&&detach(div),mounted=!1,dispose()}}}__name(create_if_block$1,"create_if_block$1");function create_if_block_2(ctx){let div1,div0,span0,span1,span2,t1_value=ctx[1].userLogin+"",t1;return{c(){div1=element$1("div"),div0=element$1("div"),span0=element$1("span"),span1=element$1("span"),span1.textContent="Typo ID:",span2=element$1("span"),t1=text(t1_value),attr(span0,"class","svelte-1hgy57u"),attr(span1,"class","svelte-1hgy57u"),attr(span2,"class","svelte-1hgy57u"),attr(div0,"class","svelte-1hgy57u"),attr(div1,"class","member-info-stats svelte-1hgy57u")},m(target,anchor){insert(target,div1,anchor),append(div1,div0),append(div0,span0),append(div0,span1),append(div0,span2),append(span2,t1)},p(ctx2,dirty){dirty&2&&t1_value!==(t1_value=ctx2[1].userLogin+"")&&set_data(t1,t1_value)},d(detaching){detaching&&detach(div1)}}}__name(create_if_block_2,"create_if_block_2");function create_fragment$1(ctx){let div,current_block_type_index,if_block,current;const if_block_creators=[create_if_block$1,create_if_block_1,create_else_block$1],if_blocks=[];function select_block_type(ctx2,dirty){return ctx2[1]===null?0:ctx2[1]===void 0?1:2}return __name(select_block_type,"select_block_type"),current_block_type_index=select_block_type(ctx),if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx),{c(){div=element$1("div"),if_block.c(),attr(div,"class","member-info panel svelte-1hgy57u")},m(target,anchor){insert(target,div,anchor),if_blocks[current_block_type_index].m(div,null),current=!0},p(ctx2,[dirty]){let previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx2),current_block_type_index===previous_block_index?if_blocks[current_block_type_index].p(ctx2,dirty):(group_outros(),transition_out(if_blocks[previous_block_index],1,1,()=>{if_blocks[previous_block_index]=null}),check_outros(),if_block=if_blocks[current_block_type_index],if_block?if_block.p(ctx2,dirty):(if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx2),if_block.c()),transition_in(if_block,1),if_block.m(div,null))},i(local){current||(transition_in(if_block),current=!0)},o(local){transition_out(if_block),current=!1},d(detaching){detaching&&detach(div),if_blocks[current_block_type_index].d()}}}__name(create_fragment$1,"create_fragment$1");function instance$1($$self,$$props,$$invalidate){let $member,$devmode,{feature}=$$props;const member=feature.memberStore;component_subscribe($$self,member,value=>$$invalidate(1,$member=value));const devmode=feature.devmodeStore;component_subscribe($$self,devmode,value=>$$invalidate(2,$devmode=value));const click_handler2=__name(()=>feature.login(),"click_handler"),keydown_handler=__name(()=>feature.logout(),"keydown_handler"),click_handler_1=__name(()=>feature.logout(),"click_handler_1");return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(0,feature=$$props2.feature)},[feature,$member,$devmode,member,devmode,click_handler2,keydown_handler,click_handler_1]}__name(instance$1,"instance$1");const _User_info=class _User_info extends SvelteComponent{constructor(options){super(),init(this,options,instance$1,create_fragment$1,safe_not_equal,{feature:0})}};__name(_User_info,"User_info");let User_info=_User_info;var __defProp$1=Object.defineProperty,__decorateClass$1=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp$1(target,key,result),result},"__decorateClass$1");const _UserInfoFeature=class _UserInfoFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elementsSetup");__publicField(this,"_memberService");__publicField(this,"_globalSettingsService");__publicField(this,"_element");__publicField(this,"name","User Info");__publicField(this,"description","Shows information about the logged-in user beneath the avatar selection");__publicField(this,"featureId",13)}async onActivate(){const elements2=await this._elementsSetup.complete();this._element=new User_info({target:elements2.avatarPanel,anchor:elements2.playButton,props:{feature:this}})}onDestroy(){var _a81;(_a81=this._element)==null||_a81.$destroy()}get memberStore(){return fromObservable(this._memberService.member$,null)}get devmodeStore(){return this._globalSettingsService.settings.devMode.store}login(){this._memberService.login()}logout(){this._memberService.logout()}};__name(_UserInfoFeature,"UserInfoFeature");let UserInfoFeature=_UserInfoFeature;__decorateClass$1([inject(ElementsSetup)],UserInfoFeature.prototype,"_elementsSetup");__decorateClass$1([inject(MemberService)],UserInfoFeature.prototype,"_memberService");__decorateClass$1([inject(GlobalSettingsService)],UserInfoFeature.prototype,"_globalSettingsService");function get_each_context(ctx,list,i){const child_ctx=ctx.slice();return child_ctx[2]=list[i],child_ctx}__name(get_each_context,"get_each_context");function create_else_block(ctx){let each_1_anchor,each_value=ensure_array_like(ctx[0]),each_blocks=[];for(let i=0;i<each_value.length;i+=1)each_blocks[i]=create_each_block(get_each_context(ctx,each_value,i));return{c(){for(let i=0;i<each_blocks.length;i+=1)each_blocks[i].c();each_1_anchor=empty()},m(target,anchor){for(let i=0;i<each_blocks.length;i+=1)each_blocks[i]&&each_blocks[i].m(target,anchor);insert(target,each_1_anchor,anchor)},p(ctx2,dirty){if(dirty&1){each_value=ensure_array_like(ctx2[0]);let i;for(i=0;i<each_value.length;i+=1){const child_ctx=get_each_context(ctx2,each_value,i);each_blocks[i]?each_blocks[i].p(child_ctx,dirty):(each_blocks[i]=create_each_block(child_ctx),each_blocks[i].c(),each_blocks[i].m(each_1_anchor.parentNode,each_1_anchor))}for(;i<each_blocks.length;i+=1)each_blocks[i].d(1);each_blocks.length=each_value.length}},i:noop$1,o:noop$1,d(detaching){detaching&&detach(each_1_anchor),destroy_each(each_blocks,detaching)}}}__name(create_else_block,"create_else_block");function create_if_block(ctx){let bounceload,current;return bounceload=new Bounceload({props:{content:"Loading news.."}}),{c(){create_component(bounceload.$$.fragment)},m(target,anchor){mount_component(bounceload,target,anchor),current=!0},p:noop$1,i(local){current||(transition_in(bounceload.$$.fragment,local),current=!0)},o(local){transition_out(bounceload.$$.fragment,local),current=!1},d(detaching){destroy_component(bounceload,detaching)}}}__name(create_if_block,"create_if_block");function create_each_block(ctx){let div1,div0,b,t0_value=ctx[2].title+"",t0,t1,span,t2_value=new Date(Number(ctx[2].date)).toDateString()+"",t2,t3,p,t4_value=ctx[2].content+"",t4,t5;return{c(){div1=element$1("div"),div0=element$1("div"),b=element$1("b"),t0=text(t0_value),t1=space(),span=element$1("span"),t2=text(t2_value),t3=space(),p=element$1("p"),t4=text(t4_value),t5=space(),attr(span,"class","svelte-1x3jcfi"),attr(div0,"class","title svelte-1x3jcfi"),attr(div1,"class","announcement svelte-1x3jcfi")},m(target,anchor){insert(target,div1,anchor),append(div1,div0),append(div0,b),append(b,t0),append(div0,t1),append(div0,span),append(span,t2),append(div1,t3),append(div1,p),append(p,t4),append(div1,t5)},p(ctx2,dirty){dirty&1&&t0_value!==(t0_value=ctx2[2].title+"")&&set_data(t0,t0_value),dirty&1&&t2_value!==(t2_value=new Date(Number(ctx2[2].date)).toDateString()+"")&&set_data(t2,t2_value),dirty&1&&t4_value!==(t4_value=ctx2[2].content+"")&&set_data(t4,t4_value)},d(detaching){detaching&&detach(div1)}}}__name(create_each_block,"create_each_block");function create_fragment(ctx){let div1,div0,current_block_type_index,if_block,current;const if_block_creators=[create_if_block,create_else_block],if_blocks=[];function select_block_type(ctx2,dirty){return ctx2[0]===void 0?0:1}return __name(select_block_type,"select_block_type"),current_block_type_index=select_block_type(ctx),if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx),{c(){div1=element$1("div"),div0=element$1("div"),if_block.c(),attr(div0,"class","news svelte-1x3jcfi"),attr(div1,"class","typo-news svelte-1x3jcfi")},m(target,anchor){insert(target,div1,anchor),append(div1,div0),if_blocks[current_block_type_index].m(div0,null),current=!0},p(ctx2,[dirty]){let previous_block_index=current_block_type_index;current_block_type_index=select_block_type(ctx2),current_block_type_index===previous_block_index?if_blocks[current_block_type_index].p(ctx2,dirty):(group_outros(),transition_out(if_blocks[previous_block_index],1,1,()=>{if_blocks[previous_block_index]=null}),check_outros(),if_block=if_blocks[current_block_type_index],if_block?if_block.p(ctx2,dirty):(if_block=if_blocks[current_block_type_index]=if_block_creators[current_block_type_index](ctx2),if_block.c()),transition_in(if_block,1),if_block.m(div0,null))},i(local){current||(transition_in(if_block),current=!0)},o(local){transition_out(if_block),current=!1},d(detaching){detaching&&detach(div1),if_blocks[current_block_type_index].d()}}}__name(create_fragment,"create_fragment");function instance($$self,$$props,$$invalidate){let{feature}=$$props,{announcements=void 0}=$$props;return $$self.$$set=$$props2=>{"feature"in $$props2&&$$invalidate(1,feature=$$props2.feature),"announcements"in $$props2&&$$invalidate(0,announcements=$$props2.announcements)},[announcements,feature]}__name(instance,"instance");const _Panel_news=class _Panel_news extends SvelteComponent{constructor(options){super(),init(this,options,instance,create_fragment,safe_not_equal,{feature:1,announcements:0})}};__name(_Panel_news,"Panel_news");let Panel_news=_Panel_news;var __defProp2=Object.defineProperty,__decorateClass=__name((decorators,target,key,kind)=>{for(var result=void 0,i=decorators.length-1,decorator;i>=0;i--)(decorator=decorators[i])&&(result=decorator(target,key,result)||result);return result&&__defProp2(target,key,result),result},"__decorateClass");const _PanelNewsFeature=class _PanelNewsFeature extends TypoFeature{constructor(){super(...arguments);__publicField(this,"_elements");__publicField(this,"_apiDataSetup");__publicField(this,"_component");__publicField(this,"name","Typo News");__publicField(this,"description","Displays updates and typo hints on the start page");__publicField(this,"featureId",7)}async onActivate(){const elements2=await this._elements.complete();this._component=new Panel_news({target:elements2.newsTab,props:{feature:this}});const data=await this._apiDataSetup.complete(),version=chrome.runtime.getManifest().version,announcements=data.announcements.filter(announcement=>announcement.type===AnnouncementDtoTypeEnum.Announcement&&(announcement.affectedTypoVersion===version||announcement.affectedTypoVersion===void 0)).sort((a,b)=>Number(b.date)-Number(a.date));this._component.$set({announcements})}onDestroy(){var _a81;(_a81=this._component)==null||_a81.$destroy()}};__name(_PanelNewsFeature,"PanelNewsFeature");let PanelNewsFeature=_PanelNewsFeature;__decorateClass([inject(ElementsSetup)],PanelNewsFeature.prototype,"_elements");__decorateClass([inject(ApiDataSetup)],PanelNewsFeature.prototype,"_apiDataSetup");const interceptor=new Interceptor(!0);LoggingService.defaultLogLevel="warn";new ExtensionContainer(interceptor).registerServices({type:ModalService,scope:"scoped"},{type:ApiService,scope:"singleton"},{type:MemberService,scope:"singleton"},{type:LobbyService,scope:"singleton"},{type:DrawingService,scope:"singleton"},{type:ToolsService,scope:"singleton"},{type:GlobalSettingsService,scope:"singleton"},{type:ImageFinishedService,scope:"singleton"},{type:ImagelabService,scope:"singleton"},{type:ImagePostService,scope:"singleton"},{type:CloudService,scope:"singleton"},{type:ToastService,scope:"scoped"},{type:SocketService,scope:"scoped"},{type:LobbyItemsService,scope:"singleton"},{type:PlayersService,scope:"singleton"},{type:ChatService,scope:"singleton"},{type:LobbyInteractionsService,scope:"singleton"},{type:ThemesService,scope:"singleton"},{type:LobbyConnectionService,scope:"singleton"}).registerSetups(PanelSetup,ElementsSetup,GameSettingsSetup,GamePatchReadySetup,SkribblMessageRelaySetup,ToolbarSetup,SkribblEmitRelaySetup,ControlsSetup,SkribblInitializedSetup,ApiDataSetup,ToastSetup,ChatControlsSetup,PrioritizedCanvasEventsSetup,CssColorVarSelectorsSetup).registerEventProcessors(lobbyJoinedEventRegistration,lobbyLeftEventRegistration,lobbyStateChangedEventRegistration,hintsAddedEventRegistration,lobbyPlayerChangedEventRegistration,roundStartedEventRegistration,wordGuessedEventRegistration,drawEventRegistration,imageResetEventRegistration,messageSentEventRegistration,messageReceivedEventRegistration,chatTypedEventRegistration,toolChangedEventRegistration,sizeChangedEventRegistration,colorChangedEventRegistration,scoreboardVisibilityChangedEventRegistration,playerPopupVisibilityChangedEventRegistration,textOverlayVisibilityChangedEventRegistration,lobbyInteractedEventRegistration,canvasClearedEventRegistration).registerFeatures(UserInfoFeature,PanelNewsFeature,LobbyNavigationFeature,ToolbarSaveFeature,ToolbarImagePostFeature,ToolbarChallengesFeature,ToolbarFullscreenFeature,ToolbarImageLabFeature,ControlsSettingsFeature,PanelChangelogFeature,PanelLobbiesFeature,PanelCabinFeature,PanelFiltersFeature,ChatRecallFeature,ImageAgentFeature,ControlsCloudFeature,GuessCheckFeature,LobbyStatusFeature,PlayerSpritesFeature,PlayerScenesFeature,ChatEmojisFeature,ChatProfileLinkFeature,LoggingFeature,HotkeysFeature,CanvasZoomFeature,LineToolFeature,ChatFocusFeature,PlayerIdsFeature,LobbyTimeVisualizerFeature,DrawingColorToolsFeature,DrawingColorPalettesFeature,ChatQuickReactFeature,ControlsThemesFeature,TooltipsFeature,ChatCopyFormattedFeature,DrawingPressureFeature,ChatCommandsFeature,DrawingBrushLabFeature,DropsFeature,PlayerAwardsFeature);interceptor.triggerPatchInjection();
//# sourceMappingURL=content.ts.js.map
