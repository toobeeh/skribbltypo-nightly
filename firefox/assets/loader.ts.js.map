{"version":3,"file":"loader.ts.js","sources":["../../src/loader/loader.ts"],"sourcesContent":["import { typoRuntime } from \"@/runtime/runtime\";\nimport { createElement } from \"@/util/document/appendElement\";\nimport { requireElement } from \"@/util/document/requiredQuerySelector\";\nimport \"./loader.scss\";\nimport { assets } from \"virtual:asset-urls\";\n\ndocument.documentElement.dataset[\"typo_loading_screen_disabled\"] = (\n  window.location.pathname === \"/terms\" || window.location.pathname === \"/credits\"\n) + \"\";\n\n/* check if document is loaded so that socketio is available, or wait for dom loaded */\nconst loaded = new Promise<void>(resolve => {\n  if(document.readyState === \"interactive\" || document.readyState === \"complete\" || Object.keys(window).includes(\"io\")) resolve();\n  document.addEventListener(\"DOMContentLoaded\", () => resolve());\n});\n\n/* prevent game.js to be sure, in case it gets executed on new body */\nconst scriptObserver = new MutationObserver((nodes) => {\n\n  nodes.forEach(node => {\n    if(node instanceof HTMLScriptElement){\n      if(node.src.includes(\"game.js\")) {\n        node.addEventListener(\"beforescriptexecute\", e => e.preventDefault(), { once: true }); // block for firefox\n        node.src = \"\"; /* to be sure */\n        node.remove();\n      }\n    }\n  });\n});\n\nscriptObserver.observe(document, {\n  childList: true,\n  subtree: true\n});\n\n/* start loading skribbl page */\nconst content = new Promise<HTMLElement>(async (resolve) => {\n\n  /* fetch original skribbl doc and prevent game from executing */\n  let html = await (await fetch(window.location.href)).text();\n  html = html.replaceAll(\"game.js\", \"game.jsblocked\");\n\n  /* create new document wit loaded content */\n  const newDoc = document.createElement(\"html\");\n  newDoc.innerHTML = html;\n  const body = requireElement(\"body\", newDoc);\n  body.dataset[\"typo_loader\"] = \"true\";\n  resolve(body);\n});\n\n/**\n * replace document body as soon as loaded\n * this has the advantage that if typo is for some reason injected after the game.js is loaded,\n * the whole page will reset and execution of the game.js is in the hands of typo\n */\nloaded.then(async () => {\n  const body = await content;\n  document.body = body;\n  scriptObserver.disconnect();\n  signature();\n});\n\n/* append file css variables to head */\nconst css = `\n:root {\n  ${Object.entries(assets).map(([key, value]) => `--file-${key}: url(\"${value()}\");`).join(\"\\n\")}\n}\n`;\nconst style = createElement(`<style>${css}</style>`);\ndocument.head.append(style);\n\n/* hello there :) */\nconst signature = () => {\n  console.clear();\n  console.log(`%c\n        _             _   _       _       _   _                           \n       | |           (_) | |     | |     | | | |     %cskribbl modded with%c\n  ___  | | __  _ __   _  | |__   | |__   | | | |_   _   _   _ __     ___  \n / __| | |/ / | '__| | | | '_ \\\\  | '_ \\\\  | | | __| | | | | | '_ \\\\   / _ \\\\ \n \\\\__ \\\\ |   <  | |    | | | |_) | | |_) | | | | |_  | |_| | | |_) | | (_) |\n |___/ |_|\\\\_\\\\ |_|    |_| |_.__/  |_.__/  |_|  \\\\__|  \\\\__, | | .__/   \\\\___/ \n                                                     __/ | | |            \n                                                    |___/  |_|     %cby @tobeh %c\n\n        ➜ Typo & all its backend is open source: https://github.com/toobeeh/skribbltypo\n        ➜ Join the community: https://discord.com/invite/pAapmUmWAM\n        ➜ Find more infos at: https://www.typo.rip/\n        ➜ Support development: https://patreon.com/skribbltypo\n        \n        [ ${typoRuntime.getReleaseDetails().versionName} @ ${typoRuntime.getReleaseDetails().runtime} ]\n                                                                    \n                                                    `,\n    \"color: lightblue\",\n    \"color:#2596be; font-family:'Arial'; font-weight:bold; font-style:italic; letter-spacing:2em\",\n    \"color: lightblue\",\n    \"color:#2596be; font-family:'Arial'; font-weight:bold; font-style:italic; letter-spacing:2em\", \"color:#f39656\"\n  );\n};\n\n\n\n\n"],"names":[],"mappings":";;;;AAMA,SAAS,gBAAgB,QAAQ,8BAA8B,KAC7D,OAAO,SAAS,aAAa,YAAY,OAAO,SAAS,aAAa,cACpE;AAGJ,MAAM,SAAS,IAAI,QAAc,CAAW,YAAA;AAC1C,MAAG,SAAS,eAAe,iBAAiB,SAAS,eAAe,cAAc,OAAO,KAAK,MAAM,EAAE,SAAS,IAAI,EAAW,SAAA;AAC9H,WAAS,iBAAiB,oBAAoB,MAAM,QAAS,CAAA;AAC/D,CAAC;AAGD,MAAM,iBAAiB,IAAI,iBAAiB,CAAC,UAAU;AAErD,QAAM,QAAQ,CAAQ,SAAA;AACpB,QAAG,gBAAgB,mBAAkB;AACnC,UAAG,KAAK,IAAI,SAAS,SAAS,GAAG;AAC1B,aAAA,iBAAiB,uBAAuB,CAAK,MAAA,EAAE,kBAAkB,EAAE,MAAM,KAAA,CAAM;AACpF,aAAK,MAAM;AACX,aAAK,OAAO;AAAA,MACd;AAAA,IACF;AAAA,EAAA,CACD;AACH,CAAC;AAED,eAAe,QAAQ,UAAU;AAAA,EAC/B,WAAW;AAAA,EACX,SAAS;AACX,CAAC;AAGD,MAAM,UAAU,IAAI,QAAqB,OAAO,YAAY;AAGtD,MAAA,OAAO,OAAO,MAAM,MAAM,OAAO,SAAS,IAAI,GAAG;AAC9C,SAAA,KAAK,WAAW,WAAW,gBAAgB;AAG5C,QAAA,SAAS,SAAS,cAAc,MAAM;AAC5C,SAAO,YAAY;AACb,QAAA,OAAO,eAAe,QAAQ,MAAM;AACrC,OAAA,QAAQ,aAAa,IAAI;AAC9B,UAAQ,IAAI;AACd,CAAC;AAOD,OAAO,KAAK,YAAY;AACtB,QAAM,OAAO,MAAM;AACnB,WAAS,OAAO;AAChB,iBAAe,WAAW;AAChB;AACZ,CAAC;AAGD,MAAM,MAAM;AAAA;AAAA,IAER,OAAO,QAAQ,MAAM,EAAE,IAAI,CAAC,CAAC,KAAK,KAAK,MAAM,UAAU,GAAG,UAAU,MAAO,CAAA,KAAK,EAAE,KAAK,IAAI,CAAC;AAAA;AAAA;AAGhG,MAAM,QAAQ,cAAc,UAAU,GAAG,UAAU;AACnD,SAAS,KAAK,OAAO,KAAK;AAG1B,MAAM,YAAY,6BAAM;AACtB,UAAQ,MAAM;AACN,UAAA;AAAA,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAeF,YAAY,oBAAoB,WAAW,MAAM,YAAY,oBAAoB,OAAO;AAAA;AAAA;AAAA,IAGhG;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IAA+F;AAAA,EAAA;AAEnG,GAzBkB;"}