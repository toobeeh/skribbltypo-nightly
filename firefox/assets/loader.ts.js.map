{"version":3,"file":"loader.ts.js","sources":["../../src/loader/loader.ts"],"sourcesContent":["import { typoRuntime } from \"@/runtime/runtime\";\nimport { createElement } from \"@/util/document/appendElement\";\nimport { requireElement } from \"@/util/document/requiredQuerySelector\";\nimport \"./loader.scss\";\nimport { assets } from \"virtual:asset-urls\";\n\ndocument.documentElement.dataset[\"typo_loading_screen_disabled\"] = (\n  window.location.pathname === \"/terms\" || window.location.pathname === \"/credits\"\n) + \"\";\n\n/* check if document is loaded so that socketio is available, or wait for dom loaded */\nconst loaded = new Promise<void>(resolve => {\n  if(document.readyState === \"interactive\" || document.readyState === \"complete\" || Object.keys(window).includes(\"io\")) resolve();\n  document.addEventListener(\"DOMContentLoaded\", () => resolve());\n});\n\n/* prevent game.js to be sure, in case it gets executed on new body */\nconst scriptObserver = new MutationObserver((nodes) => {\n\n  nodes.forEach(node => {\n    if(node instanceof HTMLScriptElement){\n      if(node.src.includes(\"game.js\")) {\n        node.addEventListener(\"beforescriptexecute\", e => e.preventDefault(), { once: true }); // block for firefox\n        node.src = \"\"; /* to be sure */\n        node.remove();\n      }\n    }\n  });\n});\n\nscriptObserver.observe(document, {\n  childList: true,\n  subtree: true\n});\n\n/* start loading skribbl page */\nconst content = new Promise<HTMLElement>(async (resolve) => {\n\n  /* fetch original skribbl doc and prevent game from executing */\n  let html = await (await fetch(window.location.href)).text();\n  html = html.replaceAll(\"game.js\", \"game.jsblocked\");\n\n  /* create new document wit loaded content */\n  const newDoc = document.createElement(\"html\");\n  newDoc.innerHTML = html;\n  const body = requireElement(\"body\", newDoc);\n  body.dataset[\"typo_loader\"] = \"true\";\n  resolve(body);\n});\n\n/**\n * replace document body as soon as loaded\n * this has the advantage that if typo is for some reason injected after the game.js is loaded,\n * the whole page will reset and execution of the game.js is in the hands of typo\n */\nloaded.then(async () => {\n  const body = await content;\n  document.body = body;\n  scriptObserver.disconnect();\n  signature();\n});\n\n/* append file css variables to head */\nconst css = `\n:root {\n  ${Object.entries(assets).map(([key, value]) => `--file-${key}: url(\"${value()}\");`).join(\"\\n\")}\n}\n`;\nconst style = createElement(`<style>${css}</style>`);\ndocument.head.append(style);\n\n/* hello there :) */\nconst signature = () => {\n  console.clear();\n  console.log(`%c\n        _             _   _       _       _   _                           \n       | |           (_) | |     | |     | | | |     %cskribbl modded with%c\n  ___  | | __  _ __   _  | |__   | |__   | | | |_   _   _   _ __     ___  \n / __| | |/ / | '__| | | | '_ \\\\  | '_ \\\\  | | | __| | | | | | '_ \\\\   / _ \\\\ \n \\\\__ \\\\ |   <  | |    | | | |_) | | |_) | | | | |_  | |_| | | |_) | | (_) |\n |___/ |_|\\\\_\\\\ |_|    |_| |_.__/  |_.__/  |_|  \\\\__|  \\\\__, | | .__/   \\\\___/ \n                                                     __/ | | |            \n                                                    |___/  |_|     %cby @tobeh %c\n\n        ➜ Typo & all its backend is open source: https://github.com/toobeeh/skribbltypo\n        ➜ Join the community: https://discord.com/invite/pAapmUmWAM\n        ➜ Find more infos at: https://www.typo.rip/\n        ➜ Support development: https://patreon.com/skribbltypo\n        \n        [ ${typoRuntime.getReleaseDetails().versionName} @ ${typoRuntime.getReleaseDetails().runtime} ]\n                                                                    \n                                                    `,\n    \"color: lightblue\",\n    \"color:#2596be; font-family:'Arial'; font-weight:bold; font-style:italic; letter-spacing:2em\",\n    \"color: lightblue\",\n    \"color:#2596be; font-family:'Arial'; font-weight:bold; font-style:italic; letter-spacing:2em\", \"color:#f39656\"\n  );\n};\n\n\n\n\n"],"names":[],"mappings":"i2JAMA,SAAS,gBAAgB,QAAQ,8BAC/B,OAAO,SAAS,WAAa,UAAY,OAAO,SAAS,WAAa,YACpE,GAGJ,MAAM,OAAS,IAAI,QAAyB,SAAA,EACvC,SAAS,aAAe,eAAiB,SAAS,aAAe,YAAc,OAAO,KAAK,MAAM,EAAE,SAAS,IAAI,IAAW,QAAA,EAC9H,SAAS,iBAAiB,mBAAoB,IAAM,QAAS,CAAA,CAC/D,CAAC,EAGK,eAAiB,IAAI,iBAAkB,OAAU,CAErD,MAAM,QAAgB,MAAA,CACjB,gBAAgB,mBACd,KAAK,IAAI,SAAS,SAAS,IACvB,KAAA,iBAAiB,sBAA4B,GAAA,EAAE,iBAAkB,CAAE,KAAM,EAAA,CAAM,EACpF,KAAK,IAAM,GACX,KAAK,OAAO,EAEhB,CACD,CACH,CAAC,EAED,eAAe,QAAQ,SAAU,CAC/B,UAAW,GACX,QAAS,EACX,CAAC,EAGD,MAAM,QAAU,IAAI,QAAqB,MAAO,SAAY,CAGtD,IAAA,KAAO,MAAO,MAAM,MAAM,OAAO,SAAS,IAAI,GAAG,OAC9C,KAAA,KAAK,WAAW,UAAW,gBAAgB,EAG5C,MAAA,OAAS,SAAS,cAAc,MAAM,EAC5C,OAAO,UAAY,KACb,MAAA,KAAO,eAAe,OAAQ,MAAM,EACrC,KAAA,QAAQ,YAAiB,OAC9B,QAAQ,IAAI,CACd,CAAC,EAOD,OAAO,KAAK,SAAY,CACtB,MAAM,KAAO,MAAM,QACnB,SAAS,KAAO,KAChB,eAAe,WAAW,EAChB,WACZ,CAAC,EAGD,MAAM,IAAM;AAAA;AAAA,IAER,OAAO,QAAQ,MAAM,EAAE,IAAI,CAAC,CAAC,IAAK,KAAK,IAAM,UAAU,GAAG,UAAU,MAAO,CAAA,KAAK,EAAE,KAAK;AAAA,CAAI,CAAC;AAAA;AAAA,EAG1F,MAAQ,cAAc,UAAU,GAAG,UAAU,EACnD,SAAS,KAAK,OAAO,KAAK,EAG1B,MAAM,UAAY,WAAM,CACtB,QAAQ,MAAM,EACN,QAAA,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAeF,YAAY,oBAAoB,WAAW,MAAM,YAAY,oBAAoB,OAAO;AAAA;AAAA,sDAGhG,mBACA,8FACA,mBACA,8FAA+F,eAAA,CAEnG,EAzBkB"}